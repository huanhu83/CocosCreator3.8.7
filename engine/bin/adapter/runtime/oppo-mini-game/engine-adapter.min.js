!function i(a,o,r){function c(t,e){if(!o[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(s)return s(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}n=o[t]={exports:{}},a[t][0].call(n.exports,function(e){return c(a[t][1][e]||e)},n,n.exports,i,a,o,r)}return o[t].exports}for(var s="function"==typeof require&&require,e=0;e<r.length;e++)c(r[e]);return c}({1:[function(e,t,n){"use strict";function i(){this._delegate=null,this._editing=!1,this._eventListeners={onKeyboardInput:null,onKeyboardConfirm:null,onKeyboardComplete:null}}var a,o,r,c,s;cc&&cc.internal&&cc.internal.EditBox&&(a=cc.internal.EditBox,o=cc.js,r=a.KeyboardReturnType,s=c=null,o.extend(i,a._EditBoxImpl),a._EditBoxImpl=i,Object.assign(i.prototype,{init:function(e){e?this._delegate=e:cc.error("EditBox init failed")},beginEditing:function(){var t=this;this._editing||this._ensureKeyboardHide(function(){var e=t._delegate;t._showKeyboard(),t._registerKeyboardEvent(),t._editing=!0,s=t,e._editBoxEditingDidBegan()})},endEditing:function(){this._hideKeyboard();var e=this._eventListeners;e.onKeyboardComplete&&e.onKeyboardComplete()},_registerKeyboardEvent:function(){var n=this,i=this._delegate,e=this._eventListeners;e.onKeyboardInput=function(e){i._string!==e.value&&i._editBoxTextChanged(e.value)},e.onKeyboardConfirm=function(e){i._editBoxEditingReturn();var t=n._eventListeners;t.onKeyboardComplete&&t.onKeyboardComplete()},e.onKeyboardComplete=function(){n._editing=!1,s=null,n._unregisterKeyboardEvent(),i._editBoxEditingDidEnded()},ral.onKeyboardInput(e.onKeyboardInput),ral.onKeyboardConfirm(e.onKeyboardConfirm),ral.onKeyboardComplete(e.onKeyboardComplete)},_unregisterKeyboardEvent:function(){var e=this._eventListeners;e.onKeyboardInput&&(ral.offKeyboardInput(e.onKeyboardInput),e.onKeyboardInput=null),e.onKeyboardConfirm&&(ral.offKeyboardConfirm(e.onKeyboardConfirm),e.onKeyboardConfirm=null),e.onKeyboardComplete&&(ral.offKeyboardComplete(e.onKeyboardComplete),e.onKeyboardComplete=null)},_otherEditing:function(){return!!s&&s!==this&&s._editing},_ensureKeyboardHide:function(e){var t=this._otherEditing();if(!t&&!c)return e();c&&clearTimeout(c),t&&s.endEditing(),c=setTimeout(function(){c=null,e()},600)},_showKeyboard:function(){var e=this._delegate,t=e.inputMode===a.InputMode.ANY;ral.showKeyboard({defaultValue:e.string,maxLength:e.maxLength<0?65535:e.maxLength,multiple:t,confirmHold:!1,confirmType:function(e){switch(e){case r.DEFAULT:case r.DONE:return"done";case r.SEND:return"send";case r.SEARCH:return"search";case r.GO:return"go";case r.NEXT:return"next"}return"done"}(e.returnType),success:function(e){},fail:function(e){cc.warn(e.errMsg)}})},_hideKeyboard:function(){ral.hideKeyboard({success:function(e){},fail:function(e){cc.warn(e.errMsg)}})}}))},{}],2:[function(s,R,I){"use strict";var l=s("./cache-manager"),e=s("./fs-utils"),u=e.downloadFile,a=e.readText,o=e.readArrayBuffer,i=e.readJson,f=e.loadSubpackage,d=e.getUserDataPath,h=e._subpackagesPath,p=(cc.assetManager.fsUtils=ral.fsUtils,/^https?:\/\/.*/),m=cc.assetManager.downloader,e=cc.assetManager.parser,t=cc.assetManager.presets,y=(m.maxConcurrency=12,m.maxRequestsPerFrame=64,t.scene.maxConcurrency=12,t.scene.maxRequestsPerFrame=64,{}),g={};function n(e,t,n){if(p.test(e))n&&n(new Error("Can not load remote scripts"));else{if(g[e])return n&&n();s(e),g[e]=!0,n&&n(null)}}function r(t,e,n){cc.AudioPlayer.load(t).then(function(e){e={player:e,url:t,duration:e.duration,type:e.type};n(null,e)}).catch(function(e){n(e)})}function c(i,t,a,e,o){var n=D(i,a);n.inLocal?t(n.url,a,o):n.inCache?(l.updateLastTime(i),t(n.url,a,function(e,t){e&&l.removeCache(i),o(e,t)})):u(i,null,a.header,e,function(e,n){e?o(e,null):t(n,a,function(e,t){e||(l.tempFiles.add(i,n),l.cacheFile(i,n,a.cacheEnabled,a.__cacheBundleRoot__,!0)),o(e,t)})})}function v(e,t,n){o(e,n)}function b(e,t,n){a(e,n)}function _(e,t,n){i(e,n)}function w(e,t,n){c(e,_,t,t.onFileProgress,n)}function F(e,t,n){var i=function(e){var t=e.lastIndexOf(".ttf");-1===t&&(t=e.lastIndexOf(".tmp"));if(-1===t)return e;var n=e.lastIndexOf("/");e="".concat(-1===n?e.substring(0,t):e.substring(n+1,t),"_LABEL");return e}(e),e=new FontFace(i,"url('".concat(e,"')"));document.fonts.add(e),e.load(),e.loaded.then(function(){n(null,i)},function(){cc.warnID(4933,i),n(null,i)})}function P(e,t,n){n(null,e)}function E(e,t,n){c(e,P,t,t.onFileProgress,n)}function T(e,n,i){o(e,function(e,t){if(e)return i(e);O(t,n,i)})}function x(e,n,i){o(e,function(e,t){if(e)return i(e);k(t,n,i)})}function S(e,n,i){o(e,function(e,t){if(e)return i(e);M(t,n,i)})}function C(e,n,i){a(e,function(e,t){if(e)return i(e);j(t,n,i)})}var O=e.parsePVRTex,k=e.parsePKMTex,M=e.parseASTCTex,j=e.parsePlist,D=(m.downloadScript=n,m._downloadArrayBuffer=function(e,t,n){c(e,v,t,t.onFileProgress,n)},m._downloadJson=w,e.parsePVRTex=T,e.parsePKMTex=x,e.parseASTCTex=S,e.parsePlist=C,m.register({".js":n,".mp3":E,".ogg":E,".wav":E,".m4a":E,".png":E,".jpg":E,".bmp":E,".jpeg":E,".gif":E,".ico":E,".tiff":E,".image":E,".webp":E,".pvr":E,".pkm":E,".astc":E,".font":E,".eot":E,".ttf":E,".woff":E,".svg":E,".ttc":E,".txt":E,".xml":E,".vsh":E,".fsh":E,".atlas":E,".tmx":E,".tsx":E,".plist":E,".fnt":E,".json":w,".ExportJson":E,".binary":E,".bin":E,".dbbin":E,".skel":E,".mp4":E,".avi":E,".mov":E,".mpg":E,".mpeg":E,".rm":E,".rmvb":E,bundle:function(e,t,r){var n,c,i,a=cc.path.basename(e),o=(o=t.version||cc.assetManager.downloader.bundleVers[a])?"".concat(o,"."):"";y[a]?(i="".concat(h).concat(a,"/config.").concat(o,"json"),f(a,t.onFileProgress,function(e){e?r(e,null):w(i,t,function(e,t){t&&(t.base="".concat(h).concat(a,"/")),r(e,t)})})):(p.test(e)||e.startsWith(d())?(c=e,n="src/bundle-scripts/".concat(a,"/index.").concat(o,"js"),l.makeBundleFolder(a)):-1!==m.remoteBundles.indexOf(a)?(c="".concat(m.remoteServerAddress,"remote/").concat(a),n="src/bundle-scripts/".concat(a,"/index.").concat(o,"js"),l.makeBundleFolder(a)):(c="assets/".concat(a),n="assets/".concat(a,"/index.").concat(o,"js")),g[n]||(s(n),g[n]=!0),t.__cacheBundleRoot__=a,w(i="".concat(c,"/config.").concat(o,"json"),t,function(e,n){var i,a,o;e?r&&r(e):n.isZip?(e=n.zipVersion,e="".concat(c,"/res.").concat(e?"".concat(e,"."):"","zip"),i=e,a=t,o=function(e,t){e?r&&r(e):(n.base="".concat(t,"/res/"),r&&r(null,n))},(e=l.cachedFiles.get(i))?(l.updateLastTime(i),o&&o(null,e.url)):p.test(i)?u(i,null,a.header,a.onFileProgress,function(e,t){e?o&&o(e):l.unzipAndCacheBundle(i,t,a.__cacheBundleRoot__,o)}):l.unzipAndCacheBundle(i,i,a.__cacheBundleRoot__,o)):(n.base="".concat(c,"/"),r&&r(null,n))}))},default:function(e,t,n){c(e,b,t,t.onFileProgress,n)}}),e.register({".png":m.downloadDomImage,".jpg":m.downloadDomImage,".bmp":m.downloadDomImage,".jpeg":m.downloadDomImage,".gif":m.downloadDomImage,".ico":m.downloadDomImage,".tiff":m.downloadDomImage,".image":m.downloadDomImage,".webp":m.downloadDomImage,".pvr":T,".pkm":x,".astc":S,".font":F,".eot":F,".ttf":F,".woff":F,".svg":F,".ttc":F,".mp3":r,".ogg":r,".wav":r,".m4a":r,".txt":b,".xml":b,".vsh":b,".fsh":b,".atlas":b,".tmx":b,".tsx":b,".fnt":b,".plist":C,".binary":v,".bin":v,".dbbin":v,".skel":v,".ExportJson":_}),function(e,t){var n=!1,i=!1;return!e.startsWith(d())&&p.test(e)?t.reload||((t=l.cachedFiles.get(e))?(i=!0,e=t.url):(t=l.tempFiles.get(e))&&(n=!0,e=t)):n=!0,{url:e,inLocal:n,inCache:i}}),K=(cc.assetManager.transformPipeline.append(function(e){for(var t=e.output=e.input,n=0,i=t.length;n<i;n++){var a=t[n],o=a.options;if(a.config)o.__cacheBundleRoot__=a.config.name;else{if("bundle"===a.ext)continue;o.cacheEnabled=void 0!==o.cacheEnabled&&o.cacheEnabled}".cconb"===a.ext?a.url=a.url.replace(a.ext,".bin"):".ccon"===a.ext&&(a.url=a.url.replace(a.ext,".json"))}}),cc.assetManager.init);cc.assetManager.init=function(e){K.call(cc.assetManager,e);e=cc.settings.querySettings("assets","subpackages");e&&e.forEach(function(e){return y[e]="".concat(h).concat(e)}),l.init()}},{"./cache-manager":3,"./fs-utils":5}],3:[function(e,t,n){"use strict";var e=e("./fs-utils"),i=e.getUserDataPath,a=e.readJsonSync,c=e.makeDirSync,o=e.writeFileSync,u=e.copyFile,f=e.downloadFile,r=e.deleteFile,s=e.rmdirSync,l=e.unzip,d=e.isOutOfStorage,h=!1,p=null,m=!1,y=0,g=/^https?:\/\/.*/;cc.assetManager.cacheManager=t.exports={cacheDir:"gamecaches",cachedFileName:"cacheList.json",cacheEnabled:!0,autoClear:!0,cacheInterval:500,deleteInterval:500,writeFileInterval:2e3,outOfStorage:!1,tempFiles:null,cachedFiles:null,cacheQueue:{},version:"1.0",getCache:function(e){return this.cachedFiles.has(e)?this.cachedFiles.get(e).url:""},getTemp:function(e){return this.tempFiles.has(e)?this.tempFiles.get(e):""},init:function(){this.cacheDir="".concat(i(),"/").concat(this.cacheDir);var e="".concat(this.cacheDir,"/").concat(this.cachedFileName),t=a(e);t instanceof Error||!t.version?(t instanceof Error||s(this.cacheDir,!0),this.cachedFiles=new cc.AssetManager.Cache,c(this.cacheDir,!0),o(e,JSON.stringify({files:this.cachedFiles._map,version:this.version}),"utf8")):this.cachedFiles=new cc.AssetManager.Cache(t.files),this.tempFiles=new cc.AssetManager.Cache},updateLastTime:function(e){this.cachedFiles.has(e)&&(this.cachedFiles.get(e).lastTime=Date.now())},_write:function(){p=null,o("".concat(this.cacheDir,"/").concat(this.cachedFileName),JSON.stringify({files:this.cachedFiles._map,version:this.version}),"utf8")},writeCacheFile:function(){p=p||setTimeout(this._write.bind(this),this.writeFileInterval)},_cache:function(){h=!1;var e,t,n,i,a,o,r,c=this,s="";for(e in this.cacheQueue){s=e;break}function l(e){if(e){if(d(e.message))return c.outOfStorage=!0,void(c.autoClear&&c.clearLRU())}else c.cachedFiles.add(s,{bundle:a,url:r,lastTime:o}),c.writeCacheFile();delete c.cacheQueue[s],cc.js.isEmptyObject(c.cacheQueue)||h||(h=!0,setTimeout(c._cache.bind(c),c.cacheInterval))}s&&(n=(t=this.cacheQueue[s]).srcUrl,i=t.isCopy,a=t.cacheBundleRoot,o=Date.now().toString(),r="",r=(a?"".concat(this.cacheDir,"/").concat(a,"/"):"".concat(this.cacheDir,"/")).concat(o).concat(y++).concat(cc.path.extname(s)),i?u(n,r,l):f(n,r,null,l))},cacheFile:function(e,t,n,i,a){!(n=void 0!==n?n:this.cacheEnabled)||this.cacheQueue[e]||this.cachedFiles.has(e)||(this.cacheQueue[e]={srcUrl:t,cacheBundleRoot:i,isCopy:a},h)||this.outOfStorage||(h=!0,setTimeout(this._cache.bind(this),this.cacheInterval))},clearCache:function(){var t=this;s(this.cacheDir,!0),this.cachedFiles=new cc.AssetManager.Cache,c(this.cacheDir,!0),this.outOfStorage=!1,clearTimeout(p),this._write(),cc.assetManager.bundles.forEach(function(e){g.test(e.base)&&t.makeBundleFolder(e.name)})},clearLRU:function(){if(!m){m=!0;var n=[],i=this;this.cachedFiles.forEach(function(t,e){i._isZipFile(e)&&cc.assetManager.bundles.find(function(e){return-1!==e.base.indexOf(t.url)})||n.push({originUrl:e,url:t.url,lastTime:t.lastTime})}),n.sort(function(e,t){return e.lastTime-t.lastTime}),n.length=Math.floor(n.length/3),n.length<3?console.warn("Insufficient storage, cleaning now"):n.length=Math.floor(n.length/3);for(var e=0,t=n.length;e<t;e++){var a="".concat(cc.assetManager.utils.getUuidFromURL(n[e].originUrl),"@native");cc.assetManager.files.remove(a),this.cachedFiles.remove(n[e].originUrl)}clearTimeout(p),this._write(),setTimeout(function e(){var t=n.pop();i._removePathOrFile(t.originUrl,t.url),0<n.length?setTimeout(e,i.deleteInterval):m=!1},i.deleteInterval)}},removeCache:function(e){var t;this.cachedFiles.has(e)&&(t=this.cachedFiles.remove(e).url,clearTimeout(p),this._write(),this._removePathOrFile(e,t))},_removePathOrFile:function(e,t){!this._isZipFile(e)||this._isZipFile(t)?r(t,this._deleteFileCB.bind(this)):(s(t,!0),this._deleteFileCB())},_deleteFileCB:function(e){e||(this.outOfStorage=!1)},makeBundleFolder:function(e){c("".concat(this.cacheDir,"/").concat(e),!0)},unzipAndCacheBundle:function(t,e,n,i){var a=Date.now().toString(),o="".concat(this.cacheDir,"/").concat(n,"/").concat(a).concat(y++),r=this;c(o,!0),l(e,o,function(e){e?(s(o,!0),d(e.message)&&(r.outOfStorage=!0,r.autoClear)&&r.clearLRU(),i&&i(e)):(r.cachedFiles.add(t,{bundle:n,url:o,lastTime:a}),r.writeCacheFile(),i&&i(null,o))})},_isZipFile:function(e){return".zip"===e.slice(-4)}}},{"./fs-utils":5}],4:[function(e,t,n){"use strict";var i=ral.createCanvas.bind(ral);ral.createCanvas=function(){var e=i();return e.style={},e}},{}],5:[function(e,t,n){"use strict";var a=ral.getFileSystemManager?ral.getFileSystemManager():null,i=/the maximum size of the file storage/,r={fs:a,_subpackagesPath:"usr_",isOutOfStorage:function(e){return i.test(e)},getUserDataPath:function(){return ral.env.USER_DATA_PATH},checkFsValid:function(){return!!a||(console.warn("can not get the file system!"),!1)},deleteFile:function(t,n){a.unlink({filePath:t,success:function(){n&&n(null)},fail:function(e){console.warn("Delete file failed: path: ".concat(t," message: ").concat(e.errMsg)),n&&n(new Error(e.errMsg))}})},downloadFile:function(t,e,n,i,a){var o={url:t,success:function(e){200===e.statusCode?a&&a(null,e.tempFilePath||e.filePath):(e.filePath&&r.deleteFile(e.filePath),console.warn("Download file failed: path: ".concat(t," message: ").concat(e.statusCode)),a&&a(new Error(e.statusCode),null))},fail:function(e){console.warn("Download file failed: path: ".concat(t," message: ").concat(e.errMsg)),a&&a(new Error(e.errMsg),null)}},e=(e&&(o.filePath=e),n&&(o.header=n),ral.downloadFile(o));i&&e.onProgressUpdate(i)},saveFile:function(t,e,n){ral.saveFile({tempFilePath:t,filePath:e,success:function(e){n&&n(null)},fail:function(e){console.warn("Save file failed: path: ".concat(t," message: ").concat(e.errMsg)),n&&n(new Error(e.errMsg))}})},copyFile:function(t,e,n){a.copyFile({srcPath:t,destPath:e,success:function(){n&&n(null)},fail:function(e){console.warn("Copy file failed: path: ".concat(t," message: ").concat(e.errMsg)),n&&n(new Error(e.errMsg))}})},writeFile:function(t,e,n,i){a.writeFile({filePath:t,encoding:n,data:e,success:function(){i&&i(null)},fail:function(e){console.warn("Write file failed: path: ".concat(t," message: ").concat(e.errMsg)),i&&i(new Error(e.errMsg))}})},writeFileSync:function(t,e,n){try{return a.writeFileSync(t,e,n),null}catch(e){return console.warn("Write file failed: path: ".concat(t," message: ").concat(e.message)),new Error(e.message)}},readFile:function(t,e,n){a.readFile({filePath:t,encoding:e,success:function(e){n&&n(null,e.data)},fail:function(e){console.warn("Read file failed: path: ".concat(t," message: ").concat(e.errMsg)),n&&n(new Error(e.errMsg),null)}})},readDir:function(t,n){a.readdir({dirPath:t,success:function(e){n&&n(null,e.files)},fail:function(e){console.warn("Read directory failed: path: ".concat(t," message: ").concat(e.errMsg)),n&&n(new Error(e.errMsg),null)}})},readText:function(e,t){r.readFile(e,"utf8",t)},readArrayBuffer:function(e,t){r.readFile(e,"binary",t)},readJson:function(i,a){r.readFile(i,"utf8",function(t,e){var n=null;if(!t)try{n=JSON.parse(e)}catch(e){console.warn("Read json failed: path: ".concat(i," message: ").concat(e.message)),t=new Error(e.message)}a&&a(t,n)})},readJsonSync:function(t){try{var e=a.readFileSync(t,"utf8");return JSON.parse(e)}catch(e){return console.warn("Read json failed: path: ".concat(t," message: ").concat(e.message)),new Error(e.message)}},makeDirSync:function(t,e){try{return a.mkdirSync(t,e),null}catch(e){return console.warn("Make directory failed: path: ".concat(t," message: ").concat(e.message)),new Error(e.message)}},rmdirSync:function(t,e){try{return a.rmdirSync(t,e),null}catch(e){return console.warn("rm directory failed: path: ".concat(t," message: ").concat(e.message)),new Error(e.message)}},exists:function(e,t){a.access({path:e,success:function(){t&&t(!0)},fail:function(){t&&t(!1)}})},loadSubpackage:function(t,e,n){var i=ral.loadSubpackage({name:"".concat(r._subpackagesPath).concat(t),success:function(){n&&n()},fail:function(e){console.warn("Load Subpackage failed: path: ".concat(t," message: ").concat(e.errMsg)),n&&n(new Error("Failed to load subpackage ".concat(t,": ").concat(e.errMsg)))}});return e&&i.onProgressUpdate(e),i},unzip:function(t,e,n){a.unzip({zipFilePath:t,targetPath:e,success:function(){n&&n(null)},fail:function(e){console.warn("unzip failed: path: ".concat(t," message: ").concat(e.errMsg)),n&&n(new Error("unzip failed: ".concat(e.errMsg)))}})}};window.fsUtils=t.exports=r},{}],6:[function(e,t,n){"use strict";cc.game.restart=function(){},ral.onWindowResize&&ral.onWindowResize(function(e,t){cc.game.canvas&&cc.view.setCanvasSize(e,t)})},{}],7:[function(e,t,n){"use strict";e("./fs-utils"),e("./canvas"),e("./asset-manager.js"),e("./EditBox.js"),e("./game.js"),e("./wasm.js")},{"./EditBox.js":1,"./asset-manager.js":2,"./canvas":4,"./fs-utils":5,"./game.js":6,"./wasm.js":8}],8:[function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}"object"===i(ral.WebAssembly)&&"function"==typeof ral.WebAssembly.instantiateFromFile&&(ral.WebAssembly.instantiate=ral.WebAssembly.instantiateFromFile,window.CCWebAssembly=ral.WebAssembly)},{}],9:[function(e,t,n){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function c(i){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?r(Object(a),!0).forEach(function(e){var t,n;t=i,n=a[e=e],(e=l(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(a,e))})}return i}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,l(i.key),i)}}function l(e){e=function(e,t){if("object"!==o(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===o(e)?e:String(e)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function f(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=a(n),t=(e=i?(e=a(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d,h,p,m,y,g,i;cc.internal.VideoPlayer&&(d=cc.internal.VideoPlayer.EventType,h=cc.Vec3,p=cc.mat4(),m=new h,y=new h,g=ral.getSystemInfoSync().pixelRatio,cc.internal.VideoPlayerImplManager.getImpl=function(e){return new i(e)},i=function(e){var t=a;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e);var n,i=f(a);function a(e){if(this instanceof a)return i.call(this,e);throw new TypeError("Cannot call a class as a function")}return t=a,(e=[{key:"syncClip",value:function(e){this.removeVideoPlayer(),e&&this.createVideoPlayer(e._nativeAsset)}},{key:"syncURL",value:function(e){this.removeVideoPlayer(),e&&this.createVideoPlayer(e)}},{key:"onCanplay",value:function(){this._loaded||(this._loaded=!0,this.setVisible(this._visible),this.dispatchEvent(d.READY_TO_PLAY),this.delayedPlay())}},{key:"_bindEvent",value:function(){var e=this._video,t=this;e&&(e.onPlay(function(){t._video===e&&(t._playing=!0,t.dispatchEvent(d.PLAYING))}),e.onEnded(function(){t._video===e&&(t._playing=!1,t._currentTime=t._duration,t.dispatchEvent(d.COMPLETED))}),e.onPause(function(){t._video===e&&(t._playing=!1,t.dispatchEvent(d.PAUSED))}),e.onTimeUpdate(function(e){t._duration=e.duration,t._currentTime=e.position}))}},{key:"_unbindEvent",value:function(){var e=this._video;e&&(e.offPlay(),e.offEnded(),e.offPause(),e.offTimeUpdate())}},{key:"createVideoPlayer",value:function(e){var t;ral.createVideo?(this._video||(t=this._getInitRect(),this._video=ral.createVideo(c({},t,{src:e,objectFit:"contain",live:!1,showCenterPlayBtn:!1,controls:!1})),this._duration=0,this._currentTime=0,this._loaded=!1,this.setVisible(this._visible),this._bindEvent(),this._forceUpdate=!0),this.setURL(e),this._forceUpdate=!0):console.warn("VideoPlayer not supported")}},{key:"setURL",value:function(e){var n,t,i=this._video;i&&i.src!==e&&(i.stop(),this._unbindEvent(),i.src=e,i.muted=!0,(n=this)._loaded=!1,t=function(e){var t=JSON.parse(e.position);"object"===o(t)?(n._duration=t.duration,n._currentTime=t.position):(n._duration=e.duration,n._currentTime=e.position)},i.onPlay(function e(){i.offPlay(e),i.offTimeUpdate(t),n.enable(),n._bindEvent(),i.stop(),i.muted=!1,n._loaded=!0,n._playing=!1,n._currentTime=0,n.dispatchEvent(d.READY_TO_PLAY)}),i.onTimeUpdate(t),i.play())}},{key:"removeVideoPlayer",value:function(){var e=this.video;e&&(e.stop(),e.destroy(),this._playing=!1,this._loaded=!1,this._loadedMeta=!1,this._ignorePause=!1,this._cachedCurrentTime=0,this._video=null)}},{key:"setVisible",value:function(e){var t=this._video;t&&this._visible!==e&&(t.width=e&&this._actualWidth||0,this._visible=e)}},{key:"getDuration",value:function(){return this.duration()}},{key:"duration",value:function(){return this._duration}},{key:"syncPlaybackRate",value:function(e){var t=this._video;t&&e!==t.playbackRate&&(.5===e|.8===e|1===e|1.25===e|1.5===e?t.playbackRate=e:console.warn("The platform does not support this PlaybackRate!"))}},{key:"syncVolume",value:function(){console.warn("The platform does not support")}},{key:"syncMute",value:function(e){var t=this._video;t&&t.muted!==e&&(t.muted=e)}},{key:"syncLoop",value:function(e){var t=this._video;t&&t.loop!==e&&(t.loop=e)}},{key:"syncStayOnBottom",value:function(){console.warn("The platform does not support")}},{key:"getCurrentTime",value:function(){return this.video?this.currentTime():-1}},{key:"currentTime",value:function(){return this._currentTime}},{key:"seekTo",value:function(e){var t=this._video;t&&this._loaded&&t.seek(e)}},{key:"disable",value:function(e){this._video&&(e||this._video.pause(),this.setVisible(!1),this._visible=!1)}},{key:"enable",value:function(){this._video&&(this.setVisible(!0),this._visible=!0)}},{key:"canPlay",value:function(){this._video.play(),this.syncCurrentTime()}},{key:"resume",value:function(){var e=this._video;!this._playing&&e&&e.play()}},{key:"pause",value:function(){var e=this._video;this._playing&&e&&e.pause()}},{key:"stop",value:function(){var t=this,e=this._video;e&&this._visible&&e.stop().then(function(e){e.errMsg&&!e.errMsg.includes("ok")?console.error("failed to stop video player"):(t._currentTime=0,t._playing=!1,t.dispatchEvent(d.STOPPED))})}},{key:"canFullScreen",value:function(e){this._video&&this.setFullScreenEnabled(e)}},{key:"setFullScreenEnabled",value:function(e){var t=this._video;t&&this._fullScreenEnabled!==e&&(e?t.requestFullScreen():t.exitFullScreen(),this._fullScreenEnabled=e)}},{key:"syncKeepAspectRatio",value:function(e){console.warn("On wechat game videoPlayer is always keep the aspect ratio")}},{key:"syncMatrix",value:function(){}},{key:"_getInitRect",value:function(){if(this._component&&this._uiTrans){var e,t,n=this.UICamera;if(n)return this._component.node.getWorldMatrix(p),e=this._uiTrans.contentSize.width,t=this._uiTrans.contentSize.height,this._m00=p.m00,this._m01=p.m01,this._m04=p.m04,this._m05=p.m05,this._m12=p.m12,this._m13=p.m13,this._w=e,this._h=t,cc.game.canvas.width,e=cc.game.canvas.height,t=this._uiTrans.anchorPoint,h.set(m,-t.x*this._w,(1-t.y)*this._h,0),h.set(y,(1-t.x)*this._w,-t.y*this._h,0),h.transformMat4(m,m,p),h.transformMat4(y,y,p),n.worldToScreen(m,m),n.worldToScreen(y,y),t=y.x-m.x,n=m.y-y.y,{x:m.x/g,y:(e-m.y)/g,width:t/g,height:n/g}}}}])&&s(t.prototype,e),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(cc.internal.VideoPlayerImpl))},{}],10:[function(e,t,n){"use strict";e("../../../common/engine/index"),e("./VideoPlayer")},{"../../../common/engine/index":7,"./VideoPlayer":9}]},{},[10]);