System.register(["./gc-object-BD6DANSw.js","./index-BcjqSS2q.js","./_virtual_internal_constants-CVZmBipG.js","./global-exports-ZavlJGEN.js","./animation-component-Dn_cQlIW.js","./scene-D5fG1En6.js","./node-event-BDYemSfE.js","./deprecated-BaebfHhU.js","./device-manager-BCOP-4pU.js","./buffer-barrier-CZBuOw0V.js","./instantiate-B8jTMe8K.js","./move-DN1M4QQp.js","./3d.js","./prefab-CJahvMeV.js","./create-mesh-CgNcAxLl.js","./debug-view-zRQBd5E1.js","./pipeline-state-manager-C4BAah3w.js","./mesh-renderer-B_2j2ns-.js","./director-D6Xf3-Ej.js","./deprecated-CWS71dkv.js","./touch-Ch03mDFP.js","./mesh-BsaPYlYJ.js","./wasm-web-DpHjq6qw.js","./deprecated-gv6rCJsk.js","./zlib.min-CyXMsivM.js","./util-BWh5q49O.js","./capsule-C5D-FUD0.js","./skeleton-hXUbiLKQ.js","./deprecated-BfPl6EQ2.js","./camera-component-DK1ym1MK.js","./model-renderer-KnEZ5pPV.js","./renderer-DVTO-7-w.js"],(function(t){"use strict";var e,n,r,i,o,a,s,u,l,c,h,f,p,d,v,_,y,g,m,E,T,A,b,C,S,w,P,O,N,I,x,k,R,L,M,D,B,U,F,V,G,W,z,j,H,Q,Y,q,Z,X,J,K,$,tt,et,nt,rt,it,ot,at,st,ut,lt,ct,ht,ft,pt,dt,vt,_t,yt,gt,mt,Et,Tt,At,bt,Ct,St,wt,Pt,Ot,Nt,It,xt,kt,Rt,Lt,Mt,Dt,Bt,Ut,Ft,Vt,Gt,Wt,zt,jt,Ht,Qt,Yt,qt,Zt,Xt,Jt;return{setters:[function(t){e=t._,n=t.a,r=t.h,i=t.F,o=t.aN,a=t.w,s=t.b,u=t.j,l=t.aT,c=t.l,h=t.aG,f=t.au,p=t.aH,d=t.L,v=t.aU,_=t.aJ,y=t.r,g=t.aQ,m=t.U,E=t.aB,T=t.Q,A=t.aw,b=t.P,C=t.t,S=t.a5,w=t.az},function(t){P=t.c,O=t.a,N=t.az,I=t.s,x=t.aA,k=t.b9,R=t.f,L=t.Q,M=t.e,D=t.M,B=t.N,U=t.a8,F=t.ba,V=t.b,G=t.b4,W=t.t,z=t.V,j=t.a7,H=t.b6,Q=t.aZ,Y=t.P,q=t.C,Z=t.k,X=t.aK,J=t.S},null,function(t){K=t.l,$=t.c},function(e){tt=e.C,et=e.A,nt=e.c,rt=e.b,it=e.T,ot=e.i,at=e.e,st=e.U,ut=e.d,lt=e.t,ct=e.n,ht=e.f,ft=e.h,pt=e.W,dt=e.j,vt=e.k,_t=e.l,yt=e.m,gt=e.o,mt=e.p,Et=e.q,Tt=e.H,At=e.O,bt=e.Q,Ct=e.R,St=e.S,wt=e.r,Pt=e.V,Ot=e.s,Nt=e.u,t({AnimCurve:e.w,Animation:e.a,AnimationClip:e.h,AnimationComponent:e.a,AnimationState:e.A,EventInfo:e.E,RatioSampler:e.v,computeRatioByType:e.y,sampleAnimationCurve:e.x})},function(t){It=t.b,xt=t.Q,kt=t.K,Rt=t.d,Lt=t.f,Mt=t.R,Dt=t.H,Bt=t.N},function(t){Ut=t.A,Ft=t.C},null,function(t){Vt=t.d},function(t){Gt=t.j,Wt=t.P},function(t){zt=t.i},function(t){jt=t.s},null,null,function(t){Ht=t._},null,null,function(t){Qt=t.M},function(t){Yt=t.d,qt=t.D},function(e){Zt=e.c,Xt=e.d,Jt=e.e,t({getPathFromRoot:e.f,getWorldTransformUntilRoot:e.g})},null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var Kt,$t,te,ee,ne;P(tt+"EmbeddedPlayer")((Kt=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).begin=$t&&$t(),e.end=te&&te(),e.reconciledSpeed=ee&&ee(),e.playable=ne&&ne(),e}return e(n,t),n}(N),$t=O(Kt.prototype,"begin",[I],(function(){return 0})),te=O(Kt.prototype,"end",[I],(function(){return 0})),ee=O(Kt.prototype,"reconciledSpeed",[I],(function(){return!1})),ne=O(Kt.prototype,"playable",[I],(function(){return null})),Kt));var re,ie,oe,ae=function(){},se=function(){function t(t){this._randomAccess=t}return t.prototype.setTime=function(){},n(t,[{key:"randomAccess",get:function(){return this._randomAccess}}]),t}();P(tt+"EmbeddedAnimationClipPlayable")((re=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).path=ie&&ie(),e.clip=oe&&oe(),e}return e(n,t),n.prototype.instantiate=function(t){var e=this.clip,n=this.path;if(!e)return null;var i=t.getChildByPath(n);if(!i)return r(3938,n,t.getPathInHierarchy(),e.name),null;var o=new et(e);return o.initialize(i),new ce(o)},n}(ae),ie=O(re.prototype,"path",[I],(function(){return""})),oe=O(re.prototype,"clip",[I],(function(){return null})),re));var ue,le,ce=function(t){function n(e){var n;return(n=t.call(this,!0)||this)._animationState=void 0,n._animationState=e,n}e(n,t);var r=n.prototype;return r.destroy=function(){this._animationState.destroy()},r.play=function(){this._animationState.play()},r.pause=function(){this._animationState.pause()},r.stop=function(){this._animationState.stop()},r.setSpeed=function(t){this._animationState.speed=t},r.setTime=function(t){this._animationState.time=t},n}(se);P(tt+"EmbeddedParticleSystemPlayable")((ue=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).path=le&&le(),e}return e(n,t),n.prototype.instantiate=function(t){var e=t.getChildByPath(this.path);if(!e)return i("Hierarchy path "+this.path+" does not exists."),null;var n=o("cc.ParticleSystem");if(!n)return i("Particle system is required for embedded particle system player."),null;var r=e.getComponent(n);return r?new pe(r):(i(this.path+" does not includes a particle system component."),null)},n}(ae),le=O(ue.prototype,"path",[I],(function(){return""})),ue));var he,fe,pe=function(t){function n(e){var n;return(n=t.call(this,!1)||this)._particleSystem=void 0,n._particleSystem=e,n}e(n,t);var r=n.prototype;return r.destroy=function(){},r.play=function(){this._particleSystem.play()},r.pause=function(){this._particleSystem.stopEmitting()},r.stop=function(){this._particleSystem.stopEmitting()},r.setSpeed=function(t){this._particleSystem.simulationSpeed=t},n}(se),de=I;P(tt+"RealArrayTrack")((he=function(t){function r(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this)._channels=fe&&fe(),e}e(r,t);var i=r.prototype;return i.channels=function(){return this._channels},i[nt]=function(){return new Oe(this._channels.map((function(t){return t.curve})))},n(r,[{key:"elementCount",get:function(){return this._channels.length},set:function(t){var e=this._channels.length;if(t<e)this._channels.splice(t);else if(t>e){var n;(n=this._channels).push.apply(n,Array.from({length:t-e},(function(){return new rt(new x)})))}}}]),r}(it),fe=O(he.prototype,"_channels",[de],(function(){return[]})),he));var ve,_e,ye,ge,me,Ee,Te,Ae,be,Ce,Se,we,Pe,Oe=function(){function t(t){this._curves=t,this._result=new Array(t.length).fill(0)}return t.prototype.evaluate=function(t){for(var e=this._result,n=e.length,r=0;r<n;++r)e[r]=this._curves[r].evaluate(t);return this._result},n(t,[{key:"requiresDefault",get:function(){return!1}}]),t}(),Ne=P("cc.animation.UniformProxyFactory")((_e=function(){function t(t,e){this.passIndex=ye&&ye(),this.uniformName=ge&&ge(),l(this,"channelIndex",me,this),this.passIndex=e||0,this.uniformName=t||""}return t.prototype.forTarget=function(t){if(t instanceof It){var e=this.passIndex,n=this.uniformName,r=this.channelIndex;if(e<0||e>=t.passes.length)a(3941,t.name,e);else{var o=t.passes[e],s=o.getHandle(n);if(s){if(Mt(s)<Gt.SAMPLER1D){var u=void 0===r?s:o.getHandle(n,r,Gt.FLOAT);return u?Ie(o,n)?{set:function(t){o.setUniformArray(u,t)}}:{set:function(t){o.setUniform(u,t)}}:void a(3943,t.name,e,n,r)}var l=Dt(s),c=o.properties[n],h=c&&c.value?""+c.value+xt(c.type):kt(c.type),f=Rt.get(h);return f||(i("Illegal texture default value: "+h+"."),f=Rt.get("default-texture")),{set:function(t){t||(t=f);var e=t.getGFXTexture();e&&e.width&&e.height&&(o.bindTexture(l,e),t instanceof Lt&&o.bindSampler(l,Vt.gfxDevice.getSampler(t.getSamplerInfo())))}}}a(3942,t.name,e,n)}}else a(3940,t)},t}(),ye=O(_e.prototype,"passIndex",[I],(function(){return 0})),ge=O(_e.prototype,"uniformName",[I],(function(){return""})),me=s(_e.prototype,"channelIndex",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),ve=_e))||ve;function Ie(t,e){for(var n,r=u(t.shaderInfo.blocks);!(n=r()).done;)for(var i,o=n.value,a=u(o.members);!(i=a()).done;){var s=i.value;if(s.name===e)return s.count>1}return!1}var xe,ke=P("cc.animation.MorphWeightValueProxy")((Te=function(){function t(){this.subMeshIndex=Ae&&Ae(),this.shapeIndex=be&&be()}return t.prototype.forTarget=function(t){var e=this;return{set:function(n){t.setWeight(n,e.subMeshIndex,e.shapeIndex)}}},t}(),Ae=O(Te.prototype,"subMeshIndex",[I],(function(){return 0})),be=O(Te.prototype,"shapeIndex",[I],(function(){return 0})),Ee=Te))||Ee,Re=P("cc.animation.MorphWeightsValueProxy")((Se=function(){function t(){this.subMeshIndex=we&&we()}return t.prototype.forTarget=function(t){var e=this;return{set:function(n){t.setWeights(n,e.subMeshIndex)}}},t}(),we=O(Se.prototype,"subMeshIndex",[I],(function(){return 0})),Ce=Se))||Ce,Le=P("cc.animation.MorphWeightsAllValueProxy")(Pe=function(){function t(){}return t.prototype.forTarget=function(t){return{set:function(e){for(var n,r,i=null!==(n=null==(r=t.mesh)?void 0:r.struct.primitives.length)&&void 0!==n?n:0,o=0;o<i;++o)t.setWeights(e,o)}}},t}())||Pe,Me=Symbol("[[Owner]]");function De(t,e){c(t[Me]===e)}function Be(t,e){t[Me]=e}function Ue(t){t[Me]=void 0}!function(t){t[t.FLOAT=0]="FLOAT",t[t.BOOLEAN=1]="BOOLEAN",t[t.TRIGGER=2]="TRIGGER",t[t.INTEGER=3]="INTEGER",t[t.VEC3_experimental=4]="VEC3_experimental",t[t.QUAT_experimental=5]="QUAT_experimental"}(xe||(xe={}));var Fe,Ve,Ge,We,ze,je,He,Qe,Ye=Symbol("CreateInstance"),qe=function(){function t(t){this._refs=[],this.type=t}return t.prototype.bind=function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return this._refs.push({fn:t,thisArg:e,args:r}),this.getValue()},n(t,[{key:"value",get:function(){return this.getValue()},set:function(t){this.setValue(t);for(var e,n=u(this._refs);!(e=n()).done;){var r=e.value,i=r.fn,o=r.thisArg,a=r.args;i.call.apply(i,[o,t].concat(a))}}}]),t}(),Ze=P("cc.animation.PlainVariable")((Ve=function(){function t(t){if(this._type=Ge&&Ge(),this._value=We&&We(),void 0!==t)switch(this._type=t,t){default:break;case xe.FLOAT:case xe.INTEGER:this._value=0;break;case xe.BOOLEAN:this._value=!1}}return t.prototype[Ye]=function(){return new Xe(this._type,this._value)},n(t,[{key:"type",get:function(){return this._type}},{key:"value",get:function(){return this._value},set:function(t){switch(this._type){default:break;case xe.FLOAT:c("number"==typeof t);break;case xe.INTEGER:c(Number.isInteger(t));break;case xe.BOOLEAN:c("boolean"==typeof t)}this._value=t}}]),t}(),Ge=O(Ve.prototype,"_type",[I],(function(){return xe.FLOAT})),We=O(Ve.prototype,"_value",[I],(function(){return 0})),Fe=Ve))||Fe,Xe=function(t){function n(e,n){var r;return(r=t.call(this,e)||this)._value=void 0,r._value=n,r}e(n,t);var r=n.prototype;return r.getValue=function(){return this._value},r.setValue=function(t){this._value=t},n}(qe);!function(t){t[t.AFTER_CONSUMED=0]="AFTER_CONSUMED",t[t.NEXT_FRAME_OR_AFTER_CONSUMED=1]="NEXT_FRAME_OR_AFTER_CONSUMED"}(Qe||(Qe={})),c(!(Qe.AFTER_CONSUMED<<1));var Je,Ke,$e,tn,en,nn,rn=P("cc.animation.TriggerVariable")((je=function(){function t(){this._flags=He&&He()}return t.prototype[Ye]=function(){return new on(this.value,this.resetMode)},n(t,[{key:"type",get:function(){return xe.TRIGGER}},{key:"value",get:function(){return!!(1&this._flags)},set:function(t){t?this._flags|=1:this._flags&=-2}},{key:"resetMode",get:function(){return(6&this._flags)>>1},set:function(t){this._flags&=-7,this._flags|=t<<1}}]),t}(),He=O(je.prototype,"_flags",[I],(function(){return 0})),ze=je))||ze,on=function(t){function n(e,n){var r;return(r=t.call(this,xe.TRIGGER)||this).resetMode=Qe.AFTER_CONSUMED,r._value=void 0,r.resetMode=n,r._value=e,r}e(n,t);var r=n.prototype;return r.getValue=function(){return this._value},r.setValue=function(t){this._value=t},n}(qe),an=P("cc.animation.Vec3Variable")((Ke=function(){function t(){this._value=$e&&$e()}return t.prototype[Ye]=function(){return new sn(this.value)},n(t,[{key:"type",get:function(){return xe.VEC3_experimental}},{key:"value",get:function(){return this._value},set:function(t){R.copy(this._value,t)}}]),t}(),$e=O(Ke.prototype,"_value",[I],(function(){return new R})),Je=Ke))||Je,sn=function(t){function n(e){var n;return(n=t.call(this,xe.VEC3_experimental)||this)._value=new R,R.copy(n._value,e),n}e(n,t);var r=n.prototype;return r.getValue=function(){return this._value},r.setValue=function(t){c(t instanceof R),R.copy(this._value,t)},n}(qe),un=P("cc.animation.QuatVariable")((en=function(){function t(){this._value=nn&&nn()}return t.prototype[Ye]=function(){return new ln(this._value)},n(t,[{key:"type",get:function(){return xe.QUAT_experimental}},{key:"value",get:function(){return this._value},set:function(t){L.copy(this._value,t)}}]),t}(),nn=O(en.prototype,"_value",[I],(function(){return new L})),tn=en))||tn,ln=function(t){function n(e){var n;return(n=t.call(this,xe.QUAT_experimental)||this)._value=new L,L.copy(n._value,e),n}e(n,t);var r=n.prototype;return r.getValue=function(){return this._value},r.setValue=function(t){c(t instanceof L),L.copy(this._value,t)},n}(qe);function cn(t,e){var n;switch(t){case xe.FLOAT:case xe.INTEGER:case xe.BOOLEAN:n=new Ze(t);break;case xe.TRIGGER:n=new rn;break;case xe.VEC3_experimental:n=new an;break;case xe.QUAT_experimental:n=new un;break;default:throw new Error("Unknown variable type "+t)}return void 0!==e&&(n.value=e),n}var hn,fn,pn,dn,vn,_n,yn=function(t){function n(e){var n;return(n=t.call(this,e+" transition is invalid")||this).name="TransitionRejectError",n}return e(n,t),n}(h(Error)),gn=function(t){function n(e){return t.call(this,"Graph variable "+e+" is not defined")||this}return e(n,t),n}(h(Error)),mn=function(t){function n(e,n,r){return t.call(this,"Expect graph variable "+e+" to have type '"+n+"' instead of received '"+(null!=r?r:typeof r)+"'")||this}return e(n,t),n}(h(Error));function En(t){var e=t[M];if("object"==typeof e&&e){var n=e;return null==n.clone?void 0:n.clone(t)}}var Tn,An,bn,Cn,Sn,wn,Pn,On,Nn,In,xn,kn,Rn=Symbol("[[Outgoing transitions]]"),Ln=Symbol("[[Incoming transitions]]"),Mn=P,Dn=I,Bn=Mn("cc.animation.State")((fn=function(t){function n(){var e;return(e=t.call(this)||this).name=pn&&pn(),e[Rn]=[],e[Ln]=[],e}return e(n,t),n.prototype.copyTo=function(t){t.name=this.name,t[M]=En(this)},n}(N),pn=O(fn.prototype,"name",[Dn],(function(){return""})),hn=fn))||hn,Un=Mn(tt+"InteractiveState")((vn=function(t){function r(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this)._components=_n&&_n(),e}e(r,t);var i=r.prototype;return i.addComponent=function(t){var e=new t;return this._components.push(e),e},i.removeComponent=function(t){f(this._components,t)},i.instantiateComponents=function(){return this._components.map((function(t){return zt(t)}))},i.copyTo=function(e){t.prototype.copyTo.call(this,e),e._components=this.instantiateComponents()},n(r,[{key:"components",get:function(){return this._components}}]),r}(Bn),_n=O(vn.prototype,"_components",[Dn],(function(){return[]})),dn=vn))||dn,Fn=P(tt+"AnimationGraphEventBinding")((An=function(){function t(){this.methodName=bn&&bn()}var e=t.prototype;return e.emit=function(t){this.methodName&&ot(t,this.methodName,[])},e.copyTo=function(t){return t.methodName=this.methodName,this},n(t,[{key:"isBound",get:function(){return!!this.methodName}}]),t}(),bn=O(An.prototype,"methodName",[I],(function(){return""})),Tn=An))||Tn,Vn=P("cc.animation.Motion")((Sn=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).motion=wn&&wn(),e.speed=Pn&&Pn(),e.speedMultiplier=On&&On(),e.speedMultiplierEnabled=Nn&&Nn(),e.transitionInEventBinding=In&&In(),e.transitionOutEventBinding=xn&&xn(),e}e(n,t);var r=n.prototype;return r.__callOnAfterDeserializeRecursive=function(){var t;null==(t=this.motion)||t.__callOnAfterDeserializeRecursive()},r.copyTo=function(e){var n,r;return t.prototype.copyTo.call(this,e),e.motion=null!==(n=null==(r=this.motion)?void 0:r.clone())&&void 0!==n?n:null,e.speed=this.speed,e.speedMultiplier=this.speedMultiplier,e.speedMultiplierEnabled=this.speedMultiplierEnabled,this.transitionInEventBinding.copyTo(e.transitionInEventBinding),this.transitionOutEventBinding.copyTo(e.transitionOutEventBinding),this},n}(Un),wn=O(Sn.prototype,"motion",[I],(function(){return null})),Pn=O(Sn.prototype,"speed",[I],(function(){return 1})),On=O(Sn.prototype,"speedMultiplier",[I],(function(){return""})),Nn=O(Sn.prototype,"speedMultiplierEnabled",[I],(function(){return!1})),In=O(Sn.prototype,"transitionInEventBinding",[I],(function(){return new Fn})),xn=O(Sn.prototype,"transitionOutEventBinding",[I],(function(){return new Fn})),Cn=Sn))||Cn,Gn=Symbol("[[OnAfterDeserialized]]"),Wn=P(tt+"AnimationGraphLike")(kn=function(t){function n(){return t.apply(this,arguments)||this}return e(n,t),n}(Ut))||kn;function zn(t,e,n){var r=Object.prototype.propertyIsEnumerable;if(!r.call(t,e))return t;if(n in t)return t;var i={};return"symbol"==typeof e?(Object.entries(t).forEach((function(t){var e=t[0],n=t[1];i[e]=n})),Object.getOwnPropertySymbols(t).forEach((function(o){r.call(t,o)&&(i[o===e?n:o]=t[o])}))):(Object.entries(t).forEach((function(t){var r=t[0],o=t[1];i[r===e?n:r]=o})),Object.getOwnPropertySymbols(t).forEach((function(e){r.call(t,e)&&(i[e]=t[e])}))),i}var jn,Hn,Qn,Yn,qn,Zn,Xn,Jn,Kn=function(){var t=!1;try{t=[]instanceof function(){function t(){}return t[Symbol.hasInstance]=function(t){return Array.isArray(t)},t}()}catch(e){t=!1}return t?function(t){function e(){throw new Error("This function can not be called as a constructor.")}return Object.defineProperty(e,Symbol.hasInstance,{value:function(e){return e instanceof t}}),e}:function(t){return t}}(),$n=P(tt+"PoseGraphNodeShell")((Hn=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this)._bindings=Qn&&Qn(),e}e(n,t);var r=n.prototype;return r.getBindings=function(){return this._bindings},r.addBinding=function(t,e,n){this._emplaceBinding(new nr(t,e,n))},r.deleteBinding=function(t){var e=this._findBindingIndex(t);e>=0&&this._bindings.splice(e,1)},r.moveArrayElementBindingForward=function(t,e,n){for(var r=this._bindings,i=[],o=0;o<r.length;++o){var a=r[o],s=a.inputPath,u=s[0],l=s[1];u===t&&(void 0===l?-1:l)>=e&&(i.push(a),r.splice(o,1))}for(var c=0,h=i;c<h.length;c++){var f=h[c],p=f.inputPath,d=p[0],v=p[1],_=void 0===v?-1:v;this.addBinding([d,_+(n?-1:1)],f.producer,f.outputIndex)}},r.deleteBindingTo=function(t){for(var e=this._bindings,n=0;n<e.length;++n)e[n].producer===t&&e.splice(n,1)},r.findBinding=function(t){var e=this._findBindingIndex(t);return e>=0?this._bindings[e]:void 0},r._findBindingIndex=function(t){return this._bindings.findIndex((function(e){return tr(e.inputPath,t)}))},r._emplaceBinding=function(t){var e=this._bindings.findIndex((function(e){return tr(e.inputPath,t.inputPath)}));e>=0?this._bindings[e]=t:this._bindings.push(t)},n}(N),Qn=O(Hn.prototype,"_bindings",[I],(function(){return[]})),jn=Hn))||jn;function tr(t,e){var n=t[0],r=t[1],i=e[0],o=e[1];return n===i&&r===o}var er,nr=P(tt+"PoseGraphNodeInputBinding")((qn=function(){function t(t,e,n){this._inputPath=Zn&&Zn(),this._producer=Xn&&Xn(),this._outputIndex=Jn&&Jn(),this._inputPath=t,this._producer=e,void 0!==n&&(this._outputIndex=n)}return n(t,[{key:"inputPath",get:function(){return this._inputPath}},{key:"producer",get:function(){return this._producer}},{key:"outputIndex",get:function(){return this._outputIndex}}]),t}(),Zn=O(qn.prototype,"_inputPath",[I],null),Xn=O(qn.prototype,"_producer",[I],null),Jn=O(qn.prototype,"_outputIndex",[I],(function(){return 0})),Yn=qn))||Yn,rr=function(t){function n(e){return t.call(this,"Can not add the specified "+e.toString()+" since it has already been added into another graph.")||this}return e(n,t),n}(h(Error)),ir=function(t){function n(e){return t.call(this,"Can not perform specified operation on "+e.toString()+" since it has not been added in to graph.")||this}return e(n,t),n}(h(Error));!function(t){t[t.FLOAT=0]="FLOAT",t[t.INTEGER=1]="INTEGER",t[t.BOOLEAN=2]="BOOLEAN",t[t.VEC3=3]="VEC3",t[t.QUAT=4]="QUAT",t[t.POSE=5]="POSE"}(er||(er={}));var or=function(t){function n(){return t.apply(this,arguments)||this}return e(n,t),n}(N),ar=new WeakMap;function sr(t){var e=ar.get(t);if(e)return e;var n={};return ar.set(t,n),n}function ur(t){return function(e){if(p(e,or)||(d("This kind of decorator should only be applied to pose graph node classes."),0)){var n=sr(e);t(n)}}}var lr=function(t){return ur((function(e){e.category=t}))},cr=function(t){return ur((function(e){e.factory=t}))},hr=function(t){return void 0===t&&(t=!0),ur((function(e){e.hide=t}))},fr=function(t){return ur((function(e){var n;Object.assign(null!==(n=e.appearance)&&void 0!==n?n:e.appearance={},t)}))};var pr=["arraySyncGroup"],dr=function(){function t(){this._classInputMap=new WeakMap}var e=t.prototype;return e.setPropertyNodeInputRecord=function(t,e,n){var r=this._classInputMap.get(t);r||(r={properties:{}},this._classInputMap.set(t,r)),n.arraySyncGroup;var i=v(n,pr),o=n.arraySyncGroup;if(o){var a,s;r.arraySyncGroups||(r.arraySyncGroups={});var u=null!==(s=(a=r.arraySyncGroups)[o])&&void 0!==s?s:a[o]={members:[]};u.members.includes(e)||u.members.push(e),i.arraySyncGroup=u}r.properties[e]=Object.freeze(i)},e.getInputKeys=function(t){var e=this,n=[];return function r(i){if(i){r(_(i));var o=e._classInputMap.get(i);if(o)for(var a=function(){var e=u[s][0];if(n.findIndex((function(t){var n=t[0];return e===n}))>=0)return 1;var r=t[e];if(Array.isArray(r))for(var i=0;i<r.length;++i)n.push([e,i]);else n.push([e])},s=0,u=Object.entries(o.properties);s<u.length;s++)a()}}(t.constructor),n},e.isPoseInput=function(t,e){var n=e[0],r=this._getPropertyNodeInputRecord(t.constructor,n);return!!r&&r.type===er.POSE},e.getInputMetadata=function(t,e){var n=e[0],r=e[1],i=void 0===r?-1:r,o=this._getPropertyNodeInputRecord(t.constructor,n);if(o){var a=t[n];if(Array.isArray(a)){if(i<0||i>=a.length)return;var s,u,l=null!==(s=null==(u=o.getArrayElementDisplayName)?void 0:u.call(t,i))&&void 0!==s?s:o.displayName;return{type:o.type,displayName:l,deletable:!(o.arraySyncGroup&&o.arraySyncGroupFollower),insertPoint:!0}}return{type:o.type,displayName:o.displayName}}},e.hasInput=function(t,e){var n=e[0],r=e[1],i=void 0===r?-1:r;if(!this._getPropertyNodeInputRecord(t.constructor,n))return!1;var o=t[n];return!Array.isArray(o)||!(i<0||i>=o.length)},e.getInputInsertInfos=function(t){for(var e={},n=t.constructor;n;n=_(n)){var r=this._classInputMap.get(n);if(r)for(var i in r.properties){var o=r.properties[i],a=t[i];if(Array.isArray(a)){if(o.arraySyncGroup&&o.arraySyncGroupFollower)continue;e[i]={displayName:i}}}}return e},e.deleteInput=function(t,e,n){var r=n[0],i=n[1],o=void 0===i?-1:i,a=this._getPropertyNodeInputRecord(e.constructor,r);if(a){var s=e[r];if(Array.isArray(s)&&!(o<0||o>=s.length)){var u=a.arraySyncGroup;u?this._deleteInputInArraySyncGroup(t,e,u,s.length,o):_r(t,e,n)}}},e.insertInput=function(t,e,n){var r=n,i=this._getPropertyNodeInputRecord(e.constructor,r);if(i){var o=e[r];if(Array.isArray(o)){var a=o.length,s=i.arraySyncGroup;s?this._insertInputInArraySyncGroup(t,e,s,o.length,a):vr(t,e,[r,a],yr(i.type))}}},e._getPropertyNodeInputRecord=function(t,e){if(t){var n=this._classInputMap.get(t);if(n){var r=n.properties[e];if(r)return r}return this._getPropertyNodeInputRecord(_(t),e)}},e._insertInputInArraySyncGroup=function(t,e,n,r,i){for(var o=0;o<n.members.length;++o){var a=n.members[o],s=this._getPropertyNodeInputRecord(e.constructor,a);c(s);var u=e[a];Array.isArray(u)&&u.length===r&&vr(t,e,[a,i],yr(s.type))}},e._deleteInputInArraySyncGroup=function(t,e,n,r,i){for(var o=0;o<n.members.length;++o){var a=n.members[o],s=this._getPropertyNodeInputRecord(e.constructor,a);c(s);var u=e[a];Array.isArray(u)&&u.length===r&&_r(t,e,[a,i])}},t}();function vr(t,e,n,r){var i=t.getShell(e);if(!i)throw new ir(e);var o=n[0],a=n[1],s=void 0===a?-1:a,u=e[o];Array.isArray(u)&&(u.splice(s,0,r),i.moveArrayElementBindingForward(o,s+1,!1))}function _r(t,e,n){var r=t.getShell(e);if(!r)throw new ir(e);var i=n[0],o=n[1],a=void 0===o?-1:o,s=e[i];Array.isArray(s)&&(a<0||a>=s.length||(r.deleteBinding(n),s.splice(a,1),r.moveArrayElementBindingForward(i,a+1,!0)))}function yr(t){switch(t){default:c(!1);case er.FLOAT:case er.INTEGER:return 0;case er.BOOLEAN:return!1;case er.POSE:return null;case er.VEC3:return new R;case er.QUAT:return new L}}var gr,mr=new dr,Er=new R,Tr=new R,Ar=new L;new L;var br,Cr,Sr,wr=function(){function t(){this._position=new R,this._rotation=new L,this._scale=R.clone(R.ONE)}return t.clone=function(e){var n=new t;return t.copy(n,e),n},t.setIdentity=function(t){return R.copy(t._position,R.ZERO),L.copy(t._rotation,L.IDENTITY),R.copy(t._scale,R.ONE),t},t.copy=function(t,e){return R.copy(t._position,e._position),L.copy(t._rotation,e._rotation),R.copy(t._scale,e._scale),t},t.equals=function(t,e,n){return R.equals(t._position,e._position,n)&&L.equals(t._rotation,e._rotation,n)&&R.equals(t._scale,e._scale,n)},t.strictEquals=function(t,e){return R.strictEquals(t._position,e._position)&&L.strictEquals(t._rotation,e._rotation)&&R.strictEquals(t._scale,e._scale)},t.lerp=function(e,n,r,i){return 0===i?t.copy(e,n):1===i?t.copy(e,r):(R.lerp(e._position,n._position,r._position,i),L.slerp(e._rotation,n._rotation,r._rotation,i),R.lerp(e._scale,n._scale,r._scale,i),e)},t.multiply=function(t,e,n){var r=L.multiply(Ar,e._rotation,n._rotation),i=R.multiply(Er,n._scale,e._scale),o=R.multiply(Tr,n._position,e._scale);return R.transformQuat(o,o,e._rotation),R.add(o,o,e._position),R.copy(t._position,o),L.copy(t._rotation,r),R.copy(t._scale,i),t},t.invert=function(t,e){var n=t._rotation,r=t._scale,i=t._position;return L.invert(n,e._rotation),Pr(r,e._scale,B),R.negate(i,e._position),R.multiply(i,i,r),R.transformQuat(i,i,n),t},t.fromMatrix=function(t,e){return D.toSRT(e,t._rotation,t._position,t._scale),t},t.toMatrix=function(t,e){return D.fromSRT(t,e._rotation,e._position,e._scale)},n(t,[{key:"position",get:function(){return this._position},set:function(t){R.copy(this._position,t)}},{key:"rotation",get:function(){return this._rotation},set:function(t){L.copy(this._rotation,t)}},{key:"scale",get:function(){return this._scale},set:function(t){R.copy(this._scale,t)}}]),t}();function Pr(t,e,n){var r=e.x,i=e.y,o=e.z;return R.set(t,Math.abs(r)<=n?0:1/r,Math.abs(i)<=n?0:1/i,Math.abs(o)<=n?0:1/o)}function Or(t,e,n){return R.subtract(t.position,e.position,n.position),Rr(t.rotation,n.rotation,e.rotation),R.subtract(t.scale,e.scale,n.scale),t}gr=wr,wr.IDENTITY=Object.freeze(new gr),wr.ZERO=Object.freeze((br=new gr,R.copy(br._position,R.ZERO),L.set(br._rotation,0,0,0,0),R.copy(br._scale,R.ZERO),br)),wr.calculateRelative=(Cr=new L,Sr=new R,function(t,e,n){var r=L.invert(Cr,n._rotation),i=Pr(Sr,n._scale,B),o=R.subtract(Tr,e._position,n._position);return R.transformQuat(o,o,r),R.multiply(o,o,i),R.copy(t._position,o),L.multiply(t._rotation,r,e._rotation),R.multiply(t._scale,e._scale,i),t});var Nr,Ir,xr,kr=(Nr=new L,function(t,e,n,r){R.scaleAndAdd(t.position,e.position,n.position,r);var i=L.slerp(Nr,L.IDENTITY,n.rotation,r);return L.multiply(t.rotation,i,e.rotation),R.scaleAndAdd(t.scale,e.scale,n.scale,r),t}),Rr=(Ir=new L,function(t,e,n){var r=L.invert(Ir,e);return L.multiply(t,n,r)}),Lr=Object.freeze(function(){var t=new wr;return t.position=R.ZERO,t.rotation=L.IDENTITY,t.scale=R.ZERO,t}()),Mr=function(){function t(t,e){this.transforms=void 0,this.auxiliaryCurves=void 0,this._poseTransformSpace=xr.LOCAL,this.transforms=t,this.auxiliaryCurves=e}return t._create=function(e,n){return new t(e,n)},t}();!function(t){t[t.LOCAL=0]="LOCAL",t[t.COMPONENT=1]="COMPONENT"}(xr||(xr={}));var Dr=function(){function t(t){c(t.every((function(t){return t<Math.pow(2,16)})),"The number of transforms exceeds the max allowed(2 ** 16)"),this._involvedTransforms=new Uint16Array(t)}return n(t,[{key:"involvedTransforms",get:function(){return this._involvedTransforms}}]),t}();function Br(t,e,n,r){void 0===r&&(r=void 0),Ur(t.transforms,e.transforms,n,r),zr(t.auxiliaryCurves,e.auxiliaryCurves,n)}function Ur(t,e,n,r){void 0===r&&(r=void 0);var i=t.length;if(c(i===t.length),0!==n)if(1!==n)if(r)for(var o=0;o<r.involvedTransforms.length;++o){var a=r.involvedTransforms[o];Wr(t,e,n,a)}else for(var s=0;s<i;++s)Wr(t,e,n,s);else r?Fr(t,e,r):t.set(e)}function Fr(t,e,n){var r=t.length;c(r===t.length);for(var i=0;i<n.involvedTransforms.length;++i){var o=n.involvedTransforms[i];t.copyRange(o,e,o,1)}}var Vr,Gr,Wr=(Vr=new wr,Gr=new wr,function(t,e,n,r){var i=t.getTransform(r,Gr),o=e.getTransform(r,Vr);wr.lerp(i,i,o,n),t.setTransform(r,i)});function zr(t,e,n){var r=e.length;c(r===t.length);for(var i=0;i<r;++i)t[i]=U(t[i],e[i],n)}var jr=function(){var t=new wr,e=new wr;return function(n,r,i){var o=r.getTransform(i,t),a=n.getTransform(i,e);Or(a,a,o),n.setTransform(i,a)}}();function Hr(t,e){var n=t.length;c(n===e.length);for(var r=0;r<n;++r)jr(t,e,r)}function Qr(t,e){var n=t.length;c(n===e.length);for(var r=0;r<t.length;++r)t[r]-=e[r]}function Yr(t,e,n,r){void 0===r&&(r=void 0),Jr(t.transforms,e.transforms,n,r),Kr(t.auxiliaryCurves,e.auxiliaryCurves,n)}var qr,Zr,Xr=function(){var t=new wr,e=new wr;return function(n,r,i,o){var a=r.getTransform(o,t),s=n.getTransform(o,e);kr(s,s,a,i),n.setTransform(o,s)}}();function Jr(t,e,n,r){void 0===r&&(r=void 0);var i=t.length;if(c(i===e.length),r)for(var o=0;o<r.involvedTransforms.length;++o){var a=r.involvedTransforms[o];Xr(t,e,n,a)}else for(var s=0;s<i;++s)Xr(t,e,n,s)}function Kr(t,e,n){var r=t.length;c(r===e.length);for(var i=0;i<t.length;++i)t[i]+=e[i]*n}!function(t){t[t.NO=0]="NO",t[t.LOCAL=1]="LOCAL",t[t.COMPONENT=2]="COMPONENT"}(Zr||(Zr={})),y(Zr);var $r,ti,ei,ni,ri,ii,oi=P(tt+"PoseNode")(qr=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this)._dependencyEvaluation=void 0,e}e(n,t);var r=n.prototype;return r.update=function(t){var e;null==(e=this._dependencyEvaluation)||e.evaluate(),this.doUpdate(t)},r.evaluate=function(t,e){var n=this.doEvaluate(t),r=n._poseTransformSpace;switch(e){default:c(!1);case Zr.NO:break;case Zr.LOCAL:r===xr.COMPONENT&&t._poseTransformsSpaceComponentToLocal(n),c(n._poseTransformSpace===xr.LOCAL);break;case Zr.COMPONENT:r===xr.LOCAL&&t._poseTransformsSpaceLocalToComponent(n),c(n._poseTransformSpace===xr.COMPONENT)}return n},n.evaluateDefaultPose=function(t,e){switch(e){default:c(!1);case Zr.NO:case Zr.LOCAL:return t.pushDefaultedPose();case Zr.COMPONENT:return t.pushDefaultedPoseInComponentSpace()}},r._setDependencyEvaluation=function(t){this._dependencyEvaluation=t},r._forceEvaluateEvaluation=function(){var t;null==(t=this._dependencyEvaluation)||t.evaluate()},n}(or))||qr,ai=function(t){function r(e){var n;return(n=t.call(this)||this)._outputTypes=[],n._outputTypes=e,n}e(r,t);var i=r.prototype;return i.getOutputType=function(t){return this._outputTypes[t]},i.link=function(){},n(r,[{key:"outputCount",get:function(){return this._outputTypes.length}}]),r}(or),si=function(t){function n(e){return t.call(this,[e])||this}return e(n,t),n.prototype.selfEvaluate=function(t){t[0]=this.selfEvaluateDefaultOutput()},n}(ai);function ui(t){return function(e,n){var r=e.constructor;t.type!==er.POSE||p(r,oi)?p(r,oi)||p(r,ai)?li(t)(e,n):d("@input can be only applied to fields of subclasses of PoseNode or PureValueNode."):d("@input specifying pose input can be only applied to fields of subclasses of PoseNode.")}}function li(t){return function(e,n){if("string"==typeof n){var r=e.constructor;mr.setPropertyNodeInputRecord(r,n,t),F(e,n).__internalFlags|=g.STANDALONE|g.IMPLICIT_VISIBLE}else d("@input can be only applied to string-named fields.")}}var ci,hi,fi,pi,di,vi,_i,yi,gi,mi,Ei,Ti,Ai,bi,Ci,Si,wi,Pi,Oi,Ni,Ii,xi,ki,Ri,Li,Mi,Di,Bi,Ui,Fi,Vi,Gi,Wi,zi,ji,Hi,Qi,Yi,qi,Zi,Xi,Ji,Ki,$i,to,eo,no,ro,io,oo,ao,so,uo,lo,co,ho,fo,po,vo,_o,yo=($r=P(tt+"PoseGraphOutputNode"),ti=fr({themeColor:"#CD3A58",inline:!0}),ei=li({type:er.POSE}),$r(ni=ti((ri=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r))||this,l(e,"pose",ii,m(e)),e}return e(n,t),n}(or),ii=s(ri.prototype,"pose",[I,ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ni=ri))||ni)||ni),go=P(tt+"PoseGraph")((hi=function(t){function r(){var e;return(e=t.call(this)||this)._outputNode=fi&&fi(),e._nodes=pi&&pi(),e._shells=di&&di(),e._shellMap=vi&&vi(),e.addNode(e._outputNode),e}e(r,t);var i=r.prototype;return i.__callOnAfterDeserializeRecursive=function(){c(this._nodes.length===this._shells.length);for(var t=0;t<this._nodes.length;++t){var e=this._nodes[t],n=this._shells[t];this._shellMap.set(e,n),null==e.__callOnAfterDeserializeRecursive||e.__callOnAfterDeserializeRecursive()}},i.nodes=function(){return this._nodes.values()},i.addNode=function(t){if(this._shellMap.has(t))throw new rr(t);var e=new $n;return this._shells.push(e),this._nodes.push(t),this._shellMap.set(t,e),t},i.removeNode=function(t){if(t!==this._outputNode){var e=this._nodes.indexOf(t);if(!(e<0)){c(this._shellMap.has(t));for(var n,r=u(this._shells);!(n=r()).done;)n.value.deleteBindingTo(t);E(this._shells,e),E(this._nodes,e),this._shellMap.delete(t)}}else d("Can not remove the output node.")},i.getShell=function(t){return this._shellMap.get(t)},n(r,[{key:"outputNode",get:function(){return this._outputNode}}]),r}(N),fi=O(hi.prototype,"_outputNode",[I],(function(){return new yo})),pi=O(hi.prototype,"_nodes",[I],(function(){return[]})),di=O(hi.prototype,"_shells",[I],(function(){return[]})),vi=O(hi.prototype,"_shellMap",[I],(function(){return new Map})),ci=hi))||ci,mo=P(tt+"Transition")((yi=function(t){function n(e,n,r){var i;return(i=t.call(this)||this).from=gi&&gi(),i.to=mi&&mi(),i.conditions=Ei&&Ei(),i[Me]=void 0,i.from=e,i.to=n,r&&(i.conditions=r),i}return e(n,t),n.prototype.copyTo=function(t){t.conditions=this.conditions.map((function(t){return t.clone()}))},n}(N),gi=O(yi.prototype,"from",[I],null),mi=O(yi.prototype,"to",[I],null),Ei=O(yi.prototype,"conditions",[I],(function(){return[]})),_i=yi))||_i,Eo=P(tt+"DurationalTransition")((Ai=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).destinationStart=bi&&bi(),e.relativeDestinationStart=Ci&&Ci(),e.startEventBinding=Si&&Si(),e.endEventBinding=wi&&wi(),e[Me]=void 0,e}return e(n,t),n.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),e.destinationStart=this.destinationStart,e.relativeDestinationStart=this.relativeDestinationStart,this.startEventBinding.copyTo(e.startEventBinding),this.endEventBinding.copyTo(e.endEventBinding)},n}(mo),bi=O(Ai.prototype,"destinationStart",[I],(function(){return 0})),Ci=O(Ai.prototype,"relativeDestinationStart",[I],(function(){return!1})),Si=O(Ai.prototype,"startEventBinding",[I],(function(){return new Fn})),wi=O(Ai.prototype,"endEventBinding",[I],(function(){return new Fn})),Ti=Ai))||Ti,To=P(tt+"AnimationTransition")((Oi=function(t){function r(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).duration=Ni&&Ni(),e.relativeDuration=Ii&&Ii(),e.exitConditionEnabled=xi&&xi(),e._exitCondition=ki&&ki(),e}return e(r,t),r.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),e.duration=this.duration,e.relativeDuration=this.relativeDuration,e.exitConditionEnabled=this.exitConditionEnabled,e.exitCondition=this.exitCondition},n(r,[{key:"exitCondition",get:function(){return this._exitCondition},set:function(t){c(t>=0),this._exitCondition=t}}]),r}(Eo),Ni=O(Oi.prototype,"duration",[I],(function(){return.3})),Ii=O(Oi.prototype,"relativeDuration",[I],(function(){return!1})),xi=O(Oi.prototype,"exitConditionEnabled",[I],(function(){return!0})),ki=O(Oi.prototype,"_exitCondition",[I],(function(){return 1})),Pi=Oi))||Pi;function Ao(t){return t instanceof To}var bo,Co=P(tt+"EmptyState")(Ri=function(t){function n(){return t.apply(this,arguments)||this}return e(n,t),n}(Bn))||Ri,So=P(tt+"EmptyStateTransition")((Mi=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).duration=Di&&Di(),e}return e(n,t),n.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),e.duration=this.duration},n}(Eo),Di=O(Mi.prototype,"duration",[I],(function(){return.3})),Li=Mi))||Li,wo=P(tt+"ProceduralPoseState")((Ui=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).graph=Fi&&Fi(),e.transitionInEventBinding=Vi&&Vi(),e.transitionOutEventBinding=Gi&&Gi(),e}e(n,t);var r=n.prototype;return r.__callOnAfterDeserializeRecursive=function(){this.graph.__callOnAfterDeserializeRecursive()},r.copyTo=function(e){return t.prototype.copyTo.call(this,e),this.transitionInEventBinding.copyTo(e.transitionInEventBinding),this.transitionOutEventBinding.copyTo(e.transitionOutEventBinding),this},n}(Bn),Fi=O(Ui.prototype,"graph",[I],(function(){return new go})),Vi=O(Ui.prototype,"transitionInEventBinding",[I],(function(){return new Fn})),Gi=O(Ui.prototype,"transitionOutEventBinding",[I],(function(){return new Fn})),Bi=Ui))||Bi,Po=Kn(wo),Oo=P(tt+"ProceduralPoseTransition")((zi=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).duration=ji&&ji(),e}return e(n,t),n.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),e.duration=this.duration},n}(Eo),ji=O(zi.prototype,"duration",[I],(function(){return.3})),Wi=zi))||Wi,No=Kn(Oo),Io=P("cc.animation.StateMachine")((Qi=function(t){e(i,t);var r=i.prototype;function i(e){var n;return(n=t.call(this)||this)._states=Yi&&Yi(),n._transitions=qi&&qi(),n._entryState=Zi&&Zi(),n._exitState=Xi&&Xi(),n._anyState=Ji&&Ji(),n._allowEmptyStates=!0,n._allowEmptyStates=null!=e&&e,n._entryState=n._addState(new Bn),n._entryState.name="Entry",n._exitState=n._addState(new Bn),n._exitState.name="Exit",n._anyState=n._addState(new Bn),n._anyState.name="Any",n}return r.__callOnAfterDeserializeRecursive=function(){this[Gn]();for(var t=this._states.length,e=0;e<t;++e){var n=this._states[e];n instanceof xo?n.stateMachine.__callOnAfterDeserializeRecursive():(n instanceof wo||n instanceof Vn)&&n.__callOnAfterDeserializeRecursive()}},r[Gn]=function(){var t=this;this._states.forEach((function(e){return Be(e,t)})),this._transitions.forEach((function(t){t.from[Rn].push(t),t.to[Ln].push(t)}))},r.states=function(){return this._states},r.transitions=function(){return this._transitions},r.getTransitionsBetween=function(t,e){return De(t,this),De(e,this),t[Rn].filter((function(t){return t.to===e}))},r.getOutgoings=function(t){return De(t,this),t[Rn]},r.getIncomings=function(t){return De(t,this),t[Ln]},r.addMotion=function(){return this._addState(new Vn)},r.addSubStateMachine=function(){return this._addState(new xo(this._allowEmptyStates))},r.addEmpty=function(){if(!this._allowEmptyStates)throw new Error("Empty states are now allowed in this state machine.");return this._addState(new Co)},r.addProceduralPoseState=function(){return this._addState(new wo)},r.remove=function(t){De(t,this),t!==this.entryState&&t!==this.exitState&&t!==this.anyState&&(this.eraseTransitionsIncludes(t),f(this._states,t),Ue(t))},r.connect=function(t,e,n){if(De(t,this),De(e,this),e===this.entryState)throw new yn("to-entry");if(e===this.anyState)throw new yn("to-any");if(t===this.exitState)throw new yn("from-exit");var r=t instanceof Vn||t===this._anyState?new To(t,e,n):t instanceof Co?new So(t,e,n):t instanceof wo?new Oo(t,e,n):new mo(t,e,n);return Be(r,this),this._transitions.push(r),t[Rn].push(r),e[Ln].push(r),r},r.disconnect=function(t,e){De(t,this),De(e,this);for(var n=t[Rn],r=e[Ln],i=this._transitions,o=n.filter((function(t){return t.to===e})),a=o.length,s=function(){var t=o[u];f(n,t),c(f(i,t)),T(A(r,(function(e){return e===t}))),Ue(t)},u=0;u<a;++u)s()},r.removeTransition=function(t){c(f(this._transitions,t)),T(A(t.from[Rn],(function(e){return e===t}))),T(A(t.to[Ln],(function(e){return e===t}))),Ue(t)},r.eraseOutgoings=function(t){var e=this;De(t,this);for(var n=t[Rn],r=function(){var t=n[i],r=t.to;c(f(e._transitions,t)),T(A(r[Ln],(function(e){return e===t}))),Ue(t)},i=0;i<n.length;++i)r();n.length=0},r.eraseIncomings=function(t){var e=this;De(t,this);for(var n=t[Ln],r=function(){var t=n[i],r=t.from;c(f(e._transitions,t)),T(A(r[Rn],(function(e){return e===t}))),Ue(t)},i=0;i<n.length;++i)r();n.length=0},r.eraseTransitionsIncludes=function(t){this.eraseIncomings(t),this.eraseOutgoings(t)},r.adjustTransitionPriority=function(t,e){var n=t.from;if(0!==e){var r=n[Rn],i=r.indexOf(t);c(i>=0);var o=V(i+e,0,r.length-1),a=this._transitions,s=a.indexOf(t);c(s>=0);var u=s;if(o>i)for(var l=i+1;l<=o;++l){var h=r[l],f=a.indexOf(h);c(f>=0),a[u]=h,u=f}else if(i>o)for(var p=i-1;p>=o;--p){var d=r[p],v=a.indexOf(d);c(v>=0),a[u]=d,u=v}a[u]=t,jt(r,i,o)}},r.copyTo=function(t){for(var e,n=t._states.filter((function(e){switch(e){case t._entryState:case t._exitState:case t._anyState:return!0;default:return!1}})),r=u(n);!(e=r()).done;){var i=e.value;t.remove(i)}for(var o,a=new Map,s=u(this._states);!(o=s()).done;){var l=o.value;switch(l){case this._entryState:a.set(l,t._entryState);break;case this._exitState:a.set(l,t._exitState);break;case this._anyState:a.set(l,t._anyState);break;default:if(l instanceof Vn||l instanceof xo||l instanceof Co||l instanceof wo){if(l instanceof Co&&!t._allowEmptyStates)continue;var h=zt(l);t._addState(h),a.set(l,h)}else c(!1)}}for(var f,p=u(this._transitions);!(f=p()).done;){var d=f.value;if(t._allowEmptyStates||!(d.from instanceof Co||d.to instanceof Co)){var v=a.get(d.from),_=a.get(d.to);c(v&&_);var y=t.connect(v,_);y.conditions=d.conditions.map((function(t){return t.clone()})),y instanceof To?(c(d instanceof To),d.copyTo(y)):y instanceof So?(c(d instanceof So),d.copyTo(y)):y instanceof wo?(c(d instanceof wo),d.copyTo(y)):d.copyTo(y)}}},r.clone=function(){var t=new i(this._allowEmptyStates);return this.copyTo(t),t},r._addState=function(t){return Be(t,this),this._states.push(t),t},n(i,[{key:"allowEmptyStates",get:function(){return this._allowEmptyStates}},{key:"entryState",get:function(){return this._entryState}},{key:"exitState",get:function(){return this._exitState}},{key:"anyState",get:function(){return this._anyState}}]),i}(N),Yi=O(Qi.prototype,"_states",[I],(function(){return[]})),qi=O(Qi.prototype,"_transitions",[I],(function(){return[]})),Zi=O(Qi.prototype,"_entryState",[I],null),Xi=O(Qi.prototype,"_exitState",[I],null),Ji=O(Qi.prototype,"_anyState",[I],null),Hi=Qi))||Hi,xo=P("cc.animation.SubStateMachine")(($i=function(t){function r(e){var n;return(n=t.call(this)||this)._stateMachine=to&&to(),n._stateMachine=new Io(e),n}return e(r,t),r.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),this._stateMachine.copyTo(e._stateMachine)},n(r,[{key:"stateMachine",get:function(){return this._stateMachine}}]),r}(Un),to=O($i.prototype,"_stateMachine",[I],null),Ki=$i))||Ki,ko=P(tt+"PoseGraphStash")((no=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).graph=ro&&ro(),e}return e(n,t),n}(N),ro=O(no.prototype,"graph",[I],(function(){return new go})),eo=no))||eo,Ro=P("cc.animation.Layer")((oo=function(){var t=e.prototype;function e(){this[Me]=void 0,this._stateMachine=ao&&ao(),this.name=so&&so(),this.weight=uo&&uo(),this.mask=lo&&lo(),this.additive=co&&co(),this._stashes=ho&&ho(),this._stateMachine=new Io(!0)}return t.__callOnAfterDeserializeRecursive=function(){for(var t in this.stateMachine._allowEmptyStates=!0,this.stateMachine.__callOnAfterDeserializeRecursive(),this._stashes)this._stashes[t].graph.__callOnAfterDeserializeRecursive()},t.stashes=function(){return Object.entries(this._stashes)},t.getStash=function(t){return this._stashes[t]},t.addStash=function(t){return this._stashes[t]=new ko},t.removeStash=function(t){delete this._stashes[t]},t.renameStash=function(t,e){this._stashes=zn(this._stashes,t,e)},n(e,[{key:"stateMachine",get:function(){return this._stateMachine}}]),e}(),ao=O(oo.prototype,"_stateMachine",[I],null),so=O(oo.prototype,"name",[I],(function(){return""})),uo=O(oo.prototype,"weight",[I],(function(){return 1})),lo=O(oo.prototype,"mask",[I],(function(){return null})),co=O(oo.prototype,"additive",[I],(function(){return!1})),ho=O(oo.prototype,"_stashes",[I],(function(){return{}})),io=oo))||io;!function(t){t[t.override=0]="override",t[t.additive=1]="additive"}(bo||(bo={}));var Lo,Mo=P("cc.animation.AnimationGraph")((po=function(t){function r(){var e;return(e=t.call(this)||this)._layers=vo&&vo(),e._variables=_o&&_o(),e}e(r,t);var i=r.prototype;return i.onLoaded=function(){for(var t=this._layers,e=t.length,n=0;n<e;++n)t[n].__callOnAfterDeserializeRecursive()},i.addLayer=function(){var t=new Ro;return this._layers.push(t),t},i.removeLayer=function(t){E(this._layers,t)},i.moveLayer=function(t,e){jt(this._layers,t,e)},i.addVariable=function(t,e,n){var r=cn(e,n);return this._variables[t]=r,r},i.removeVariable=function(t){delete this._variables[t]},i.getVariable=function(t){return this._variables[t]},i.renameVariable=function(t,e){this._variables=zn(this._variables,t,e)},n(r,[{key:"layers",get:function(){return this._layers}},{key:"variables",get:function(){return Object.entries(this._variables)}}]),r}(Wn),vo=O(po.prototype,"_layers",[I],(function(){return[]})),_o=O(po.prototype,"_variables",[I],(function(){return{}})),fo=po))||fo,Do=Symbol("[[createEval]]"),Bo=P(tt+"MotionBase")(Lo=function(t){function n(){return t.apply(this,arguments)||this}return e(n,t),n.prototype.__callOnAfterDeserializeRecursive=function(){},n}(N))||Lo;function Uo(t,e,n,r,i,o){if(0===e)return o.time=0,o.ratio=0,o.direction=1,o.stopped=!!Number.isFinite(r),o.iterations=0,o;var a=!1,s=t>0?t/e:-t/e;if(s>=r){s=r,a=!0;var u=r-(0|r);0===u&&(u=1),t=u*e*(t>0?1:-1)}if(t>e){var l=t%e;t=0===l?e:l}else t<0&&0!=(t%=e)&&(t+=e);var c=!1,h=n&G.ShouldWrap;h&&(c=Fo(n,s));var f=c?-1:1;return h&&c&&(t=e-t),o.time=t,o.ratio=o.time/e,o.direction=f,o.stopped=a,o.iterations=s,o}function Fo(t,e){var n=!1;return(t&G.PingPong)===G.PingPong&&(e-(0|e)==0&&e>0&&(e-=1),1&e&&(n=!n)),(t&G.Reverse)===G.Reverse&&(n=!n),n}var Vo=new R,Go=new L,Wo=function(){function t(t){this._transformHandle=t}return t.prototype.destroy=function(){this._transformHandle.destroy()},t}(),zo=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var r=n.prototype;return r.setValue=function(t,e){e.transforms.setPosition(this._transformHandle.index,t)},r.getValue=function(t){return t.transforms.getPosition(this._transformHandle.index,Vo)},n}(Wo),jo=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var r=n.prototype;return r.setValue=function(t,e){e.transforms.setRotation(this._transformHandle.index,t)},r.getValue=function(t){return t.transforms.getRotation(this._transformHandle.index,Go)},n}(Wo),Ho=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var r=n.prototype;return r.setValue=function(t,e){var r=L.fromEuler(n._EULER_TO_QUAT_CACHE,t.x,t.y,t.z);e.transforms.setRotation(this._transformHandle.index,r)},r.getValue=function(t){var e=t.transforms.getRotation(this._transformHandle.index,Go);return L.toEuler(Vo,e)},n}(Wo);Ho._EULER_TO_QUAT_CACHE=new L;var Qo=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var r=n.prototype;return r.setValue=function(t,e){e.transforms.setScale(this._transformHandle.index,t)},r.getValue=function(t){return t.transforms.getScale(this._transformHandle.index,Vo)},n}(Wo),Yo=function(){function t(t){this._handle=t}var e=t.prototype;return e.destroy=function(){this._handle.destroy()},e.setValue=function(t,e){e.auxiliaryCurves[this._handle.index]=t},e.getValue=function(t){return t.auxiliaryCurves[this._handle.index]},t}();function qo(t,e){switch(e){case"position":return new zo(t);case"rotation":return new jo(t);case"eulerAngles":return new Ho(t);case"scale":return new Qo(t);default:c(!1)}}var Zo=function(){function t(t){this.binding=t}var e=t.prototype;return e.destroy=function(){},e.setValue=function(t){this.binding.setValue(t)},e.getValue=function(){var t,e,n;return null!==(t=null==(e=(n=this.binding).getValue)?void 0:e.call(n))&&void 0!==t?t:void 0},t}(),Xo=function(){function t(t,e){this._binding=void 0,this._trackSampler=void 0,this._binding=t,this._trackSampler=e}var e=t.prototype;return e.destroy=function(){this._binding.destroy()},e.evaluate=function(t,e){var n=this._trackSampler,r=this._binding,i=n.requiresDefault?r.getValue(e):void 0,o=n.evaluate(t,i);r.setValue(o,e)},t}();function Jo(t,e,n){var r=Ko(e[lt],n);return r||a(3937,t.name,n.origin.name),null!=r?r:void 0}function Ko(t,e){var n=e.origin,r=t.path,i=t.proxy,o=r.length,a=o-1;if(0!==o&&(r.isPropertyAt(a)||r.isElementAt(a))&&!i){var s=r.isPropertyAt(a)?r.parsePropertyAt(a):r.parseElementAt(a),u=r[ct](n,0,o-1);if(null===u)return null;if(u instanceof Bt&&ht(s)){var l=function(){for(var t=[],e=u;e&&e!==n;e=e.parent)t.unshift(e.name);return e===n?t.join("/"):void 0}();if("string"==typeof l){var c=e.bindTransform(l);if(!c)return;return qo(c,s)}}}var h=t.createRuntimeBinding(e.origin,void 0,!1);return h?new Zo(h):null}var $o=function(){function t(t,e){this._binding=t,this._curve=e}return t.prototype.evaluate=function(t,e){var n=this._curve,r=this._binding,i=e,o=n.evaluate(t);r.setValue(o,i)},t}();function ta(t,e){return t.isAdditive_experimental?new Na(t,e):new Oa(t,e)}var ea,na,ra,ia,oa,aa,sa,ua,la,ca,ha,fa,pa,da,va,_a,ya,ga,ma,Ea,Ta,Aa,ba,Ca,Sa,wa,Pa,Oa=function(){function t(t,e){this._trackEvaluations=[],this._exoticAnimationEvaluation=void 0,this._auxiliaryCurveEvaluations=[],t._trySyncLegacyData();for(var n,r,i=[],o=[],a=t.tracks,s=t[at],l=u(a);!(r=l()).done;){var c=r.value;if(!(c instanceof st||Array.from(c.channels()).every((function(t){return 0===t.curve.keyFramesCount})))){var h=Jo(t,c,e);if(h){var f=c[nt](),p=new Xo(h,f);i.push(p)}}}s&&(n=s.createEvaluatorForAnimationGraph(e));for(var d=t.getAuxiliaryCurveNames_experimental(),v=d.length,_=0;_<v;++_){var y=d[_],g=t.getAuxiliaryCurve_experimental(y),m=e.bindAuxiliaryCurve(y),E=new Yo(m);o.push(new $o(E,g))}this._trackEvaluations=i,this._exoticAnimationEvaluation=n,this._auxiliaryCurveEvaluations=o}var e=t.prototype;return e.destroy=function(){var t;null==(t=this._exoticAnimationEvaluation)||t.destroy();for(var e=this._trackEvaluations,n=e.length,r=0;r<n;++r)e[r].destroy()},e.evaluate=function(t,e){for(var n=this._trackEvaluations,r=this._exoticAnimationEvaluation,i=this._auxiliaryCurveEvaluations,o=e.pushDefaultedPose(),a=n.length,s=0;s<a;++s)n[s].evaluate(t,o);r&&r.evaluate(t,o);for(var u=i.length,l=0;l<u;++l)i[l].evaluate(t,o);return o},t}(),Na=function(){function t(t,e){this._clipEval=void 0,this._refClipEval=void 0,this._clipEval=new Oa(t,e);var n=t[ut].refClip;n&&n!==t&&(this._refClipEval=new Oa(n,e))}var e=t.prototype;return e.destroy=function(){var t;this._clipEval.destroy(),null==(t=this._refClipEval)||t.destroy()},e.evaluate=function(t,e){var n,r,i=this._clipEval.evaluate(t,e);return r=this._refClipEval?this._refClipEval.evaluate(0,e):this._clipEval.evaluate(0,e),Hr((n=i).transforms,r.transforms),Qr(n.auxiliaryCurves,r.auxiliaryCurves),e.popPose(),i},t}(),Ia=W,xa=(ea=P("cc.animation.ClipMotion"),na=Ia(ft),ea((ia=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).clip=oa&&oa(),e}e(n,t);var r=n.prototype;return r[Do]=function(t,e){return this.clip?new Ra(t,this.clip,e):null},r.clone=function(){var t=new n;return t.clip=this.clip,t[M]=En(this),t},n}(Bo),oa=O(ia.prototype,"clip",[na,I],(function(){return null})),ra=ia))||ra),ka=Symbol("EvaluatePort"),Ra=function(){function t(t,e,n){var r,i;this._clipEmbeddedPlayerEval=null,this._frameEventEval=null,this._wrapInfo=new pt,this._duration=0,this._ignoreEmbeddedPlayers=void 0,this._originalClip=e,this._ignoreEmbeddedPlayers=n;var o=null!==(r=null==(i=t.clipOverrides)?void 0:i.get(e))&&void 0!==r?r:e;this._setClip(o,t)}var e=t.prototype;return e.createPort=function(){return new La(this)},e.getClipStatuses=function(t){var e=this,n=!1;return{next:function(){return n?{done:!0,value:void 0}:(n=!0,{done:!1,value:{__DEBUG_ID__:e.__DEBUG__ID__,clip:e._clip,weight:t}})}}},e[ka]=function(t,e){var n,r,i=this._duration,o=this._clip.duration,a=this._clipEval,s=i*t,u=this._clip.wrapMode,l=Uo(s,i,u,(u&G.Loop)===G.Loop?1/0:1,0,this._wrapInfo),c=l.ratio*o,h=a.evaluate(c,e);return null==(n=this._frameEventEval)||n.sample(l.ratio,l.direction,l.iterations),null==(r=this._clipEmbeddedPlayerEval)||r.evaluate(c,Math.trunc(l.iterations)),h},e.overrideClips=function(t){var e,n=this._originalClip,r=null==(e=t.clipOverrides)?void 0:e.get(n);r&&this._setClip(r,t)},e.reenter=function(){var t;null==(t=this._frameEventEval)||t.reset()},e._setClip=function(t,e){var n;null==(n=this._clipEval)||n.destroy(),this._frameEventEval=null,this._clipEmbeddedPlayerEval&&(this._clipEmbeddedPlayerEval.destroy(),this._clipEmbeddedPlayerEval=null),this._clip=t,this._duration=0===t.speed?0:t.duration/t.speed,this._clipEval=ta(t,e),this._frameEventEval=t.createEventEvaluator(e.origin),!this._ignoreEmbeddedPlayers&&t.containsAnyEmbeddedPlayer()&&(this._clipEmbeddedPlayerEval=t.createEmbeddedPlayerEvaluator(e.origin))},n(t,[{key:"duration",get:function(){return this._duration}}]),t}(),La=function(){function t(t){this._eval=void 0,this._eval=t}var e=t.prototype;return e.evaluate=function(t,e){return this._eval[ka](t,e)},e.reenter=function(){this._eval.reenter()},t}(),Ma=P,Da=I,Ba=Ma(tt+"AnimationBlendItem")((sa=function(){function t(){this.motion=ua&&ua()}var e=t.prototype;return e.clone=function(){var e=new t;return this._copyTo(e),e},e._copyTo=function(t){var e,n;return t.motion=null!==(e=null==(n=this.motion)?void 0:n.clone())&&void 0!==e?e:null,t},t}(),ua=O(sa.prototype,"motion",[Da],(function(){return null})),aa=sa))||aa,Ua=Ma(tt+"AnimationBlend")((ca=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).name=ha&&ha(),e}return e(n,t),n.prototype.copyTo=function(t){t.name=this.name,t[M]=En(this)},n}(Bo),ha=O(ca.prototype,"name",[Da],(function(){return""})),la=ca))||la,Fa=function(){function t(t,e,n,r,i){this._childEvaluators=r.map((function(n){var r,i;return null!==(r=null==(i=n.motion)?void 0:i[Do](t,e))&&void 0!==r?r:null})),this._weights=new Array(this._childEvaluators.length).fill(0),this._inputs=[].concat(i)}var e=t.prototype;return e.createPort=function(){return new Va(this,this._childEvaluators.map((function(t){var e;return null!==(e=null==t?void 0:t.createPort())&&void 0!==e?e:null})))},e.getChildWeight=function(t){return this._weights[t]},e.getChildMotionEval=function(t){return this._childEvaluators[t]},e.getClipStatuses=function(t){var e,n=this._childEvaluators,r=this._weights,i=n.length,o=0;return{next:function(){for(;;){if(e){var a=e.next();if(!a.done)return a}if(o>=i)return{done:!0,value:void 0};var s=n[o];e=null==s?void 0:s.getClipStatuses(t*r[o]),++o}}}},e.__evaluatePort=function(t,e,n){for(var r=this._childEvaluators.length,i=0,o=null,a=0;a<r;++a){var s,u=this._weights[a];if(u){var l=null==(s=t.childPorts[a])?void 0:s.evaluate(e,n);l&&(i+=u,o?(i&&Br(o,l,u/i),n.popPose()):o=l)}}return o||n.pushDefaultedPose()},e.overrideClips=function(t){for(var e=0;e<this._childEvaluators.length;++e){var n;null==(n=this._childEvaluators[e])||n.overrideClips(t)}},e.setInput=function(t,e){this._inputs[e]=t,this.doEval()},e.doEval=function(){this.eval(this._weights,this._inputs)},n(t,[{key:"childCount",get:function(){return this._weights.length}},{key:"duration",get:function(){for(var t=0,e=0;e<this._childEvaluators.length;++e){var n,r;t+=(null!==(n=null==(r=this._childEvaluators[e])?void 0:r.duration)&&void 0!==n?n:0)*this._weights[e]}return t}}]),t}(),Va=function(){function t(t,e){this.childPorts=[],this._host=void 0,this._host=t,this.childPorts=e}var e=t.prototype;return e.evaluate=function(t,e){return this._host.__evaluatePort(this,t,e)},e.reenter=function(){for(var t=this.childPorts,e=t.length,n=0;n<e;++n){var r;null==(r=t[n])||r.reenter()}},t}(),Ga=P,Wa=I,za=Ga(tt+"BindableNumber")((pa=function(){function t(t){void 0===t&&(t=0),this.variable=da&&da(),this.value=va&&va(),this.value=t}return t.prototype.clone=function(){var e=new t;return e.value=this.value,e.variable=this.variable,e},t}(),da=O(pa.prototype,"variable",[Wa],(function(){return""})),va=O(pa.prototype,"value",[Wa],(function(){return 0})),fa=pa))||fa,ja=Ga(tt+"BindableBoolean")((ya=function(){function t(t){void 0===t&&(t=!1),this.variable=ga&&ga(),this.value=ma&&ma(),this.value=t}return t.prototype.clone=function(){var e=new t;return e.value=this.value,e.variable=this.variable,e},t}(),ga=O(ya.prototype,"variable",[Wa],(function(){return""})),ma=O(ya.prototype,"value",[Wa],(function(){return!1})),_a=ya))||_a;function Ha(t,e,n,r,i){var o=e.variable,a=e.value;if(!o)return a;var s=t.getVar(o);if(!Qa(s,o))return a;if(s.type!==n)throw new mn(o,"number");for(var u=arguments.length,l=new Array(u>5?u-5:0),c=5;c<u;c++)l[c-5]=arguments[c];return s.bind.apply(s,[r,i].concat(l))}function Qa(t,e){if(t)return!0;throw new gn(e)}function Ya(t,e,n){if(t!==e)throw new mn(n,"number")}function qa(t,e){if(t!==xe.TRIGGER)throw new mn(e,"trigger")}function Za(t,e,n){if(t.fill(0),0===e.length);else if(n<=e[0])t[0]=1;else if(n>=e[e.length-1])t[t.length-1]=1;else{for(var r=0,i=1;i<e.length;++i)if(e[i]>n){r=i;break}var o=e[r-1],a=e[r],s=a-o;t[r-1]=(a-n)/s,t[r]=(n-o)/s}}var Xa,Ja,Ka=P,$a=I,ts=Ka(tt+"AnimationBlend1DItem")((Ta=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).threshold=Aa&&Aa(),e}e(n,t);var r=n.prototype;return r.clone=function(){var t=new n;return this._copyTo(t),t},r._copyTo=function(e){return t.prototype._copyTo.call(this,e),e.threshold=this.threshold,e},n}(Ba),Aa=O(Ta.prototype,"threshold",[$a],(function(){return 0})),Ea=Ta))||Ea,es=Ka("cc.animation.AnimationBlend1D")((Pa=function(t){function r(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this)._items=Sa&&Sa(),e.param=wa&&wa(),e}e(r,t);var i=r.prototype;return i.clone=function(){var t=new r;return this.copyTo(t),t._items=this._items.map((function(t){return t.clone()})),t.param=this.param.clone(),t},i[Do]=function(t,e){var n=new ns(t,e,this,this._items,this._items.map((function(t){return t.threshold})),0),r=Ha(t,this.param,xe.FLOAT,n.setInput,n,0);return n.setInput(r,0),n},n(r,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t).sort((function(t,e){return t.threshold-e.threshold}))}}]),r}(Ua),Pa.Item=ts,Sa=O((Ca=Pa).prototype,"_items",[$a],(function(){return[]})),wa=O(Ca.prototype,"param",[$a],(function(){return new za})),ba=Ca))||ba,ns=function(t){function n(e,n,r,i,o,a){var s;return(s=t.call(this,e,n,r,i,[a])||this)._thresholds=o,s.doEval(),s}return e(n,t),n.prototype.eval=function(t,e){var n=e[0];Za(t,this._thresholds,n)},n}(Fa),rs=(Xa=new z,Ja={wA:0,wB:0},function(t,e,n){if(c(t.length===e.length),0!==e.length)if(1!==e.length)if(z.strictEquals(n,z.ZERO)){var r=e.findIndex((function(t){return z.strictEquals(t,z.ZERO)}));r>=0?t[r]=1:t.fill(1/e.length)}else{for(var i=-1,o=-1,a=-1,s=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY,l=n.x,h=n.y,f=0;f<e.length;++f){var p=e[f];if(z.equals(p,z.ZERO))a=f;else{var d=z.normalize(Xa,p),v=z.dot(d,n);d.x*h-d.y*l>0?v>=u&&(u=v,i=f):v>=s&&(s=v,o=f)}}var _=0;if(i<0||o<0)_=1;else{var y=(S=e[i],w=e[o],P=n,O=Ja,(N=z.cross(S,w))?(O.wA=z.cross(P,w)/N,O.wB=z.cross(P,S)/-N):(O.wA=0,O.wB=0),O),g=y.wA,m=y.wB,E=0,T=0,A=g+m;A>1?(E=g/A,T=m/A):A<0?(E=0,T=0,_=1):(E=g,T=m,_=1-A),t[i]=E,t[o]=T}if(_>0)if(a>=0)t[a]=_;else for(var b=_/t.length,C=0;C<t.length;++C)t[C]+=b}else t[0]=1;var S,w,P,O,N});function is(t,e,n){os(t,e,n,_s)}function os(t,e,n,r){t.fill(0);for(var i=new z(0,0),o=new z(0,0),a=0,s=e.length,u=0;u<s;++u){for(var l=Number.MAX_VALUE,c=!1,h=0;h<s;++h)if(u!==h){r(e[u],e[h],n,i,o);var f=1-z.dot(i,o)/z.lengthSqr(o);if(f<0){c=!0;break}l=Math.min(l,f)}c||(t[u]=l,a+=l)}a>0&&t.forEach((function(e,n){return t[n]=e/a}))}var as,ss,us,ls,cs,hs,fs,ps,ds,vs,_s=function(t,e,n,r,i){z.subtract(r,n,t),z.subtract(i,e,t)},ys=function(){function t(e){for(var n=t._ANGLE_MULTIPLIER,r=e.length,i=this._exampleMagnitudes=new Array(r).fill(0),o=this._exampleDirections=e.map((function(t,e){var n=z.copy(new z,t),r=z.len(n);return i[e]=r,j(r,0,1e-5)||z.multiplyScalar(n,n,1/r),n})),a=this._precomputedVIJs=new Float32Array(3*r*r),s=0;s<r;++s)for(var u=i[s],l=o[s],c=0;c<r;++c)if(s!==c){var h=i[c],f=o[c],p=(u+h)/2,d=3*(r*s+c);a[d+0]=(h-u)/p,a[d+1]=gs(l,f)*n,a[d+2]=p}this._cacheVIXAngles=new Float32Array(r)}return t.prototype.interpolate=function(e,n){var r=this._exampleDirections,i=this._exampleMagnitudes,o=this._precomputedVIJs,a=this._cacheVIXAngles,s=t._CACHE_INPUT_DIRECTION,u=t._CACHE_VIJ,l=t._CACHE_VIX,h=t._ANGLE_MULTIPLIER,f=r.length;if(c(e.length===f),0!==f)if(1!==f){var p=n,d=z.len(p),v=a;if(z.equals(p,z.ZERO))for(var _=0;_<f;++_)v[_]=0;else for(var y=z.multiplyScalar(s,p,1/d),g=0;g<f;++g){var m=r[g];z.equals(m,z.ZERO)?v[g]=0:v[g]=gs(m,y)*h}for(var E=0,T=0;T<f;++T){for(var A=i[T],b=r[T],C=Number.POSITIVE_INFINITY,S=0;S<f;++S)if(T!==S){var w=r[S],P=3*(f*T+S),O=o[P+0],N=o[P+1],I=o[P+2],x=N,k=v[T];z.equals(b,z.ZERO)?x=v[S]:z.equals(w,z.ZERO)?x=v[T]:z.equals(p,z.ZERO)&&(k=x);var R=z.set(u,O,x),L=z.set(l,(d-A)/I,k),M=1-z.dot(L,R)/z.lengthSqr(R);if(M<=0){C=0;break}C=Math.min(C,M)}e[T]=C,E+=C}if(E>0)for(var D=0;D<f;++D)e[D]/=E;else for(var B=1/f,U=0;U<f;++U)e[U]=B}else e[0]=1},t}();function gs(t,e){var n=z.angle(t,e);return t.x*e.y-t.y*e.x<0?-n:n}ys._CACHE_INPUT_DIRECTION=new z,ys._CACHE_VIJ=new z,ys._CACHE_VIX=new z,ys._ANGLE_MULTIPLIER=1;var ms,Es=P,Ts=I;!function(t){t[t.SIMPLE_DIRECTIONAL=0]="SIMPLE_DIRECTIONAL",t[t.FREEFORM_CARTESIAN=1]="FREEFORM_CARTESIAN",t[t.FREEFORM_DIRECTIONAL=2]="FREEFORM_DIRECTIONAL"}(ms||(ms={})),y(ms);var As,bs,Cs,Ss,ws,Ps,Os=Es(tt+"AnimationBlend2DItem")((ss=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).threshold=us&&us(),e}e(n,t);var r=n.prototype;return r.clone=function(){var t=new n;return this._copyTo(t),t},r._copyTo=function(e){return t.prototype._copyTo.call(this,e),z.copy(e.threshold,this.threshold),e},n}(Ba),us=O(ss.prototype,"threshold",[Ts],(function(){return new z})),as=ss))||as,Ns=Es("cc.animation.AnimationBlend2D")((vs=function(t){function r(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this)._items=hs&&hs(),e.paramX=fs&&fs(),e.paramY=ps&&ps(),e._algorithm=ds&&ds(),e._polarSpaceGBI=void 0,e}e(r,t);var i=r.prototype;return i.__callOnAfterDeserializeRecursive=function(){this._tryReconstructPolarSpaceInterpolator()},i.clone=function(){var t=new r;return this.copyTo(t),t._items=this._items.map((function(t){var e;return null!==(e=null==t?void 0:t.clone())&&void 0!==e?e:null})),t.paramX=this.paramX.clone(),t.paramY=this.paramY.clone(),t.algorithm=this._algorithm,t},i[Do]=function(t,e){var n,r=this.algorithm;switch(r){case ms.FREEFORM_DIRECTIONAL:c(this._polarSpaceGBI,"The polar space interpolator is not setup correctly!"),n=new xs(t,e,this,this._items,this._polarSpaceGBI,[0,0]);break;default:c(!1);case ms.SIMPLE_DIRECTIONAL:case ms.FREEFORM_CARTESIAN:n=new Is(t,e,this,this._items,this._items.map((function(t){return t.threshold})),r,[0,0])}var i=Ha(t,this.paramX,xe.FLOAT,n.setInput,n,0),o=Ha(t,this.paramY,xe.FLOAT,n.setInput,n,1);return n.setInput(i,0),n.setInput(o,1),n},i._tryReconstructPolarSpaceInterpolator=function(){this._algorithm===ms.FREEFORM_DIRECTIONAL?this._polarSpaceGBI=new ys(this._items.map((function(t){return t.threshold}))):this._polarSpaceGBI=void 0},n(r,[{key:"algorithm",get:function(){return this._algorithm},set:function(t){t!==this._algorithm&&(this._algorithm=t,this._tryReconstructPolarSpaceInterpolator())}},{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t),this._tryReconstructPolarSpaceInterpolator()}}]),r}(Ua),vs.Algorithm=ms,vs.Item=Os,hs=O((cs=vs).prototype,"_items",[Ts],(function(){return[]})),fs=O(cs.prototype,"paramX",[Ts],(function(){return new za})),ps=O(cs.prototype,"paramY",[Ts],(function(){return new za})),ds=O(cs.prototype,"_algorithm",[Ts],(function(){return ms.SIMPLE_DIRECTIONAL})),ls=cs))||ls,Is=function(t){function n(e,n,r,i,o,a,s){var u;return(u=t.call(this,e,n,r,i,s)||this)._thresholds=void 0,u._algorithm=void 0,u._value=new z,u._thresholds=o,u._algorithm=a,u.doEval(),u}return e(n,t),n.prototype.eval=function(t,e){var n=e[0],r=e[1];switch(z.set(this._value,n,r),t.fill(0),this._algorithm){case ms.SIMPLE_DIRECTIONAL:rs(t,this._thresholds,this._value);break;case ms.FREEFORM_CARTESIAN:is(t,this._thresholds,this._value)}},n}(Fa),xs=function(t){function n(e,n,r,i,o,a){var s;return(s=t.call(this,e,n,r,i,a)||this)._interpolator=void 0,s._value=new z,s._interpolator=o,s.doEval(),s}return e(n,t),n.prototype.eval=function(t,e){var n=e[0],r=e[1];z.set(this._value,n,r),t.fill(0),this._interpolator.interpolate(t,this._value)},n}(Fa),ks=P,Rs=I,Ls=ks(tt+"AnimationBlendDirectItem")((bs=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).weight=Cs&&Cs(),e}e(n,t);var r=n.prototype;return r.clone=function(){var t=new n;return this._copyTo(t),t},r._copyTo=function(e){return t.prototype._copyTo.call(this,e),e.weight=this.weight,e},n}(Ba),Cs=O(bs.prototype,"weight",[Rs],(function(){return new za(0)})),As=bs))||As;ks("cc.animation.AnimationBlendDirect")((Ps=function(t){function r(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this)._items=ws&&ws(),e}e(r,t);var i=r.prototype;return i.clone=function(){var t=new r;return this.copyTo(t),t._items=this._items.map((function(t){var e;return null!==(e=null==t?void 0:t.clone())&&void 0!==e?e:null})),t},i[Do]=function(t,e){for(var n=new fu(t,e,this,this._items,new Array(this._items.length).fill(0)),r=0;r<this._items.length;++r){var i=Ha(t,this._items[r].weight,xe.FLOAT,n.setInput,n,r);n.setInput(i,r)}return n},n(r,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t)}}]),r}(Ua),Ps.Item=Ls,ws=O((Ss=Ps).prototype,"_items",[Rs],(function(){return[]})),Ss));var Ms,Ds,Bs,Us,Fs,Vs,Gs,Ws,zs,js,Hs,Qs,Ys,qs,Zs,Xs,Js,Ks,$s,tu,eu,nu,ru,iu,ou,au,su,uu,lu,cu,hu,fu=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).doEval(),e}return e(n,t),n.prototype.eval=function(t,e){for(var n=t.length,r=0;r<n;++r)t[r]=e[r]},n}(Fa),pu=P("cc.JointMask")((Ds=function(){this.path=Bs&&Bs(),this.enabled=Us&&Us()},Bs=O(Ds.prototype,"path",[I],(function(){return""})),Us=O(Ds.prototype,"enabled",[I],(function(){return!0})),Ms=Ds))||Ms,du=(Fs=P(tt+"AnimationMask"),Vs=W(pu),Fs((Ws=function(t){function r(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this)._jointMasks=zs&&zs(),e}e(r,t);var i=r.prototype;return i.addJoint=function(t,e){this.removeJoint(t);var n=new pu;n.path=t,n.enabled=e,this._jointMasks.push(n)},i.removeJoint=function(t){A(this._jointMasks,(function(e){return e.path===t}))},i.clear=function(){this._jointMasks.length=0},i.filterDisabledNodes=function(t){for(var e=this._jointMasks,n=e.length,r=new Set,i=0;i<n;++i){var o=e[i],a=o.path;if(!o.enabled){var s=t.getChildByPath(a);s&&r.add(s)}}return r},i.isExcluded=function(t){var e,n;return!(null===(e=null==(n=this._jointMasks.find((function(e){return e.path===t})))?void 0:n.enabled)||void 0===e||e)},n(r,[{key:"joints",get:function(){return this._jointMasks},set:function(t){this.clear();for(var e,n=u(t);!(e=n()).done;){var r=e.value;this.addJoint(r.path,r.enabled)}}}]),r}(Ut),zs=O(Ws.prototype,"_jointMasks",[I],(function(){return[]})),s(Ws.prototype,"joints",[Vs],Object.getOwnPropertyDescriptor(Ws.prototype,"joints"),Ws.prototype),Gs=Ws))||Gs),vu=P(tt+"ClipOverrideEntry")((Qs=function(){this.original=Ys&&Ys(),this.substitution=qs&&qs()},Ys=O(Qs.prototype,"original",[I],(function(){return null})),qs=O(Qs.prototype,"substitution",[I],(function(){return null})),Hs=Qs))||Hs,_u=(Zs=P(tt+"AnimationGraphVariant"),Xs=W(Mo),Zs((Ks=function(t){function r(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this)._graph=$s&&$s(),e._clipOverrides=tu&&tu(),e}return e(r,t),n(r,[{key:"original",get:function(){return this._graph},set:function(t){this._graph=t}},{key:"clipOverrides",get:function(){return this._clipOverrides}}]),r}(Wn),s(Ks.prototype,"original",[Xs],Object.getOwnPropertyDescriptor(Ks.prototype,"original"),Ks.prototype),$s=O(Ks.prototype,"_graph",[I],(function(){return null})),tu=O(Ks.prototype,"_clipOverrides",[I],(function(){return new yu})),Js=Ks))||Js),yu=P(tt+"ClipOverrideMap")((js=Symbol.iterator,nu=function(){function t(){this._entries=ru&&ru()}var e=t.prototype;return e[js]=function(){return this._entries[Symbol.iterator]()},e.has=function(t){return!!this._entries.find((function(e){return e.original===t}))},e.get=function(t){var e=this._entries.find((function(e){return e.original===t}));return null==e?void 0:e.substitution},e.set=function(t,e){var n=this._entries.find((function(e){return e.original===t}));if(n)n.substitution=e;else{var r=new vu;r.original=t,r.substitution=e,this._entries.push(r)}},e.delete=function(t){A(this._entries,(function(e){return e.original===t}))},e.clear=function(){this._entries.length=0},n(t,[{key:"size",get:function(){return this._entries.length}}]),t}(),ru=O(nu.prototype,"_entries",[I],(function(){return[]})),eu=nu))||eu,gu="i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes/",mu=gu+"/i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes_blend/",Eu={listEntries:function(t){return[].concat(t.animationGraph.layers[t.layerIndex].stashes()).map((function(t){var e=t[0];return{arg:e,menu:e}}))},create:function(t){var e=new Tu;return e.stashName=t,e}},Tu=P(tt+"PoseNodeUseStashedPose")(iu=lr(gu)(iu=cr(Eu)(iu=fr({inline:!0})((ou=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).stashName=au&&au(),e._runtimeStash=void 0,e}e(n,t);var r=n.prototype;return r.bind=function(t){var e=this.stashName;if(e){var n=t.stashView.bindStash(e);this._runtimeStash=n}},r.settle=function(){},r.reenter=function(){var t;null==(t=this._runtimeStash)||t.reenter()},r.doUpdate=function(t){var e;null==(e=this._runtimeStash)||e.requestUpdate(t)},r.doEvaluate=function(t){var e,n;return null!==(e=null==(n=this._runtimeStash)?void 0:n.evaluate(t))&&void 0!==e?e:t.pushDefaultedPose()},n}(oi),au=O(ou.prototype,"stashName",[I],(function(){return""})),iu=ou))||iu)||iu)||iu)||iu,Au=P,bu=I;!function(t){t[t.TRUTHY=0]="TRUTHY",t[t.FALSY=1]="FALSY"}(hu||(hu={})),Au(tt+"UnaryCondition")(((cu=function(){function t(){this.operator=uu&&uu(),this.operand=lu&&lu()}var e=t.prototype;return e.clone=function(){var e=new t;return e.operator=this.operator,e.operand=this.operand.clone(),e},e[Do]=function(t){var e=this.operator,n=this.operand,r=new Su(e,!1),i=Ha(t,n,xe.BOOLEAN,r.setOperand,r);return r.reset(i),r},t}()).Operator=hu,uu=O((su=cu).prototype,"operator",[bu],(function(){return hu.TRUTHY})),lu=O(su.prototype,"operand",[bu],(function(){return new ja})),su));var Cu,Su=function(){function t(t,e){this._operator=t,this._operand=e,this._eval()}var e=t.prototype;return e.reset=function(t){this.setOperand(t)},e.setOperand=function(t){this._operand=t,this._eval()},e.eval=function(){return this._result},e._eval=function(){var t=this._operand;switch(this._operator){default:case hu.TRUTHY:this._result=!!t;break;case hu.FALSY:this._result=!t}},t}();!function(t){t[t.FLOAT=0]="FLOAT",t[t.INTEGER=3]="INTEGER"}(Cu||(Cu={}));var wu,Pu=function(){},Ou=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(){}};!function(t){t[t.MOTION=1]="MOTION",t[t.POSE=2]="POSE",t[t.EMPTY=4]="EMPTY",t[t.WEIGHTED=7]="WEIGHTED"}(wu||(wu={}));var Nu,Iu,xu,ku,Ru,Lu,Mu,Du=I,Bu=P(tt+"TCVariableBinding")(Nu=Ou(Cu.FLOAT,Cu.INTEGER)((Iu=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).type=xu&&xu(),e.variableName=ku&&ku(),e}e(n,t);var r=n.prototype;return r.getValueType=function(){return this.type},r.bind=function(t){var e=t.getVar(this.variableName);if(e)return new Uu(e)},n}(Pu),xu=O(Iu.prototype,"type",[Du,H],(function(){return Cu.FLOAT})),ku=O(Iu.prototype,"variableName",[Du],(function(){return""})),Nu=Iu))||Nu)||Nu,Uu=function(){function t(t){this._varInstance=t}return t.prototype.evaluate=function(){return this._varInstance.value},t}(),Fu=I;P(tt+"TCAuxiliaryCurveBinding")(Ru=Ou(Cu.FLOAT)((Lu=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).curveName=Mu&&Mu(),e}e(n,t);var r=n.prototype;return r.getValueType=function(){return Cu.FLOAT},r.bind=function(t){var e=t.getEvaluationTimeAuxiliaryCurveView();return new zu(e,this.curveName)},n}(Pu),Mu=O(Lu.prototype,"curveName",[Fu],(function(){return""})),Ru=Lu))||Ru);var Vu,Gu,Wu,zu=function(){function t(t,e){this._view=t,this._curveName=e}return t.prototype.evaluate=function(){return this._view.get(this._curveName)},t}();Vu=P(tt+"TCStateWeightBinding"),Gu=Ou(Cu.FLOAT),wu.WEIGHTED,Vu(Wu=Gu(Wu=void(Wu=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var r=n.prototype;return r.getValueType=function(){return Cu.FLOAT},r.bind=function(){return new Yu},n}(Pu))||Wu)||Wu);var ju,Hu,Qu,Yu=function(){function t(){}return t.prototype.evaluate=function(t){return t.sourceStateWeight},t}();ju=P(tt+"TCStateMotionTimeBinding"),Hu=Ou(Cu.FLOAT),wu.POSE,ju(Qu=Hu(Qu=void(Qu=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var r=n.prototype;return r.getValueType=function(){return Cu.FLOAT},r.bind=function(){return new el},n}(Pu))||Qu)||Qu);var qu,Zu,Xu,Ju,Ku,$u,tl,el=function(){function t(){}return t.prototype.evaluate=function(t){return t.sourceStateMotionTimeNormalized},t}(),nl=P,rl=I;!function(t){t[t.EQUAL_TO=0]="EQUAL_TO",t[t.NOT_EQUAL_TO=1]="NOT_EQUAL_TO",t[t.LESS_THAN=2]="LESS_THAN",t[t.LESS_THAN_OR_EQUAL_TO=3]="LESS_THAN_OR_EQUAL_TO",t[t.GREATER_THAN=4]="GREATER_THAN",t[t.GREATER_THAN_OR_EQUAL_TO=5]="GREATER_THAN_OR_EQUAL_TO"}(tl||(tl={})),nl(tt+"BinaryCondition")((($u=function(){function t(){this.operator=Zu&&Zu(),this.lhs=Xu&&Xu(),this.lhsBinding=Ju&&Ju(),this.rhs=Ku&&Ku()}var e=t.prototype;return e.clone=function(){var e=new t;return e.operator=this.operator,e.lhs=this.lhs,e.lhsBinding=zt(this.lhsBinding),e.rhs=this.rhs,e},e[Do]=function(t){var e,n=null==(e=this.lhsBinding)?void 0:e.bind(t);return new ul(this.operator,this.lhs,this.rhs,n)},t}()).Operator=tl,Zu=O((qu=$u).prototype,"operator",[rl],(function(){return tl.EQUAL_TO})),Xu=O(qu.prototype,"lhs",[rl],(function(){return 0})),Ju=O(qu.prototype,"lhsBinding",[rl],(function(){return new Bu})),Ku=O(qu.prototype,"rhs",[rl],(function(){return 0})),qu));var il,ol,al,sl,ul=function(){function t(t,e,n,r){this._operator=t,this._lhsBindingEvaluation=r,this._lhsValue=e,this._rhsValue=n}return t.prototype.eval=function(t){var e,n,r=null!==(e=null==(n=this._lhsBindingEvaluation)?void 0:n.evaluate(t))&&void 0!==e?e:this._lhsValue,i=this._rhsValue;switch(this._operator){default:case tl.EQUAL_TO:return r===i;case tl.NOT_EQUAL_TO:return r!==i;case tl.LESS_THAN:return r<i;case tl.LESS_THAN_OR_EQUAL_TO:return r<=i;case tl.GREATER_THAN:return r>i;case tl.GREATER_THAN_OR_EQUAL_TO:return r>=i}},t}(),ll=I,cl=P(tt+"TriggerCondition")((ol=function(){function t(){this.trigger=al&&al()}var e=t.prototype;return e.clone=function(){var e=new t;return e.trigger=this.trigger,e},e[Do]=function(t){var e=new hl(!1),n=t.getVar(this.trigger);return Qa(n,this.trigger)&&(qa(n.type,this.trigger),e.setTrigger(n.bind(e.setTrigger,e))),e},t}(),al=O(ol.prototype,"trigger",[ll],(function(){return""})),il=ol))||il,hl=function(){function t(t){this._triggered=!1,this._triggered=t}var e=t.prototype;return e.setTrigger=function(t){this._triggered=t},e.eval=function(){return this._triggered},t}(),fl=P(tt+"StateMachineComponent")(sl=function(){function t(){}var e=t.prototype;return e.onMotionStateEnter=function(){},e.onMotionStateExit=function(){},e.onMotionStateUpdate=function(){},e.onStateMachineEnter=function(){},e.onStateMachineExit=function(){},t}())||sl,pl=10,dl=Float64Array.BYTES_PER_ELEMENT*pl,vl=R.fromArray,_l=R.toArray,yl=L.fromArray,gl=L.toArray,ml=function(){function t(t,e,n){this._data=void 0,this._data=void 0===t?new Float64Array:"number"==typeof t?new Float64Array(pl*t):new Float64Array(t,e,"number"==typeof n?pl*n:void 0)}var e=t.prototype;return e.getTransform=function(t,e){var n=this._data,r=e.position,i=e.rotation,o=e.scale,a=pl*t;return vl(r,n,a),yl(i,n,a+3),vl(o,n,a+7),e},e.getPosition=function(t,e){var n=this._data;return vl(e,n,pl*t),e},e.getRotation=function(t,e){var n=this._data;return yl(e,n,pl*t+3),e},e.getScale=function(t,e){var n=this._data;return vl(e,n,pl*t+7),e},e.setTransform=function(t,e){var n=this._data,r=e.position,i=e.rotation,o=e.scale,a=pl*t;_l(n,r,a),gl(n,i,a+3),_l(n,o,a+7)},e.setPosition=function(t,e){var n=this._data;_l(n,e,pl*t)},e.setRotation=function(t,e){var n=this._data;gl(n,e,pl*t+3)},e.setScale=function(t,e){var n=this._data;_l(n,e,pl*t+7)},e.copyWithin=function(t,e,n){this._data.copyWithin(t*pl,e*pl,"number"==typeof n?n*pl:void 0)},e.fill=function(t,e,n){var r,i,o=this.length;if(null!==(r=e)&&void 0!==r||(e=0),null!==(i=n)&&void 0!==i||(n=o),!(e>=o)){this.setTransform(e,t);for(var a=e+1;a<n;++a)this.copyWithin(a,e,e+1)}},e.fillZero=function(t,e){this._data.fill(0,"number"==typeof t?t*pl:void 0,"number"==typeof e?e*pl:void 0)},e.set=function(t,e){this._data.set(t._data,"number"==typeof e?e*pl:void 0)},e.slice=function(e,n){var r=this._data.slice("number"==typeof e?e*pl:void 0,"number"==typeof n?n*pl:void 0);return new t(r.buffer,r.byteOffset,r.length/pl)},e.copyRange=function(t,e,n,r){for(var i=pl*r,o=this._data,a=pl*t,s=e._data,u=pl*n,l=0;l<i;++l)o[a+l]=s[u+l]},n(t,[{key:"buffer",get:function(){return this._data.buffer}},{key:"byteLength",get:function(){return this._data.byteLength}},{key:"byteOffset",get:function(){return this._data.byteOffset}},{key:"length",get:function(){return this._data.length/pl}}],[{key:"BYTES_PER_ELEMENT",get:function(){return dl}}]),t}(),El=Symbol("[[The count of pages used by this allocator.]]"),Tl=Symbol("[[Notify that theres is no allocator on the stack anymore.]]"),Al=function(t){this.buffer=void 0,this.useCount=0,this.buffer=new ArrayBuffer(t)},bl=function(){function t(t,e){this._locking=!1,this._pages=[],this._allocatorCount=0,this._manager=t,this._pageSize=e}var e=t.prototype;return e.debugLock=function(){c(!this._locking,"The memory is locking."),this._locking=!0},e.debugUnlock=function(){c(this._locking,"Wrong execution logic: the memory is not locking."),this._locking=!1},e.getPageMemory=function(t){return c(t>=0&&t<this._pages.length,"Page index out of range"),this._pages[t].buffer},e.pushPage=function(t){var e=t[El];c(e<=this._pages.length),e===this._pages.length&&this._pushNewPage(),c(e<this._pages.length);var n=this._pages[e];return++n.useCount,++t[El],n},e.popPage=function(t){var e=t[El];c(e>0);var n=e-1,r=this._pages[n];c(r.useCount>0),--r.useCount,--t[El],0===r.useCount&&(c(n===this._pages.length-1),this._pages.pop())},e.createAllocator=function(t){var e=new Sl(this,t);return++this._allocatorCount,e},e.destroyAllocator=function(t){for(var e=t[El],n=0;n<e;++n){var r=this._pages[n];c(r.useCount>0),--r.useCount}c(this._allocatorCount>0),--this._allocatorCount,0===this._allocatorCount&&this._manager[Tl](this)},e._pushNewPage=function(){var t=new Al(this._pageSize);this._pages.push(t)},n(t,[{key:"pageSize",get:function(){return this._pageSize}},{key:"debugLocking",get:function(){return this._locking}},{key:"allocatorCount",get:function(){return this._allocatorCount}}]),t}(),Cl=function(t,e){this.buffer=t,this.byteOffset=e},Sl=function(){function t(t,e){this[El]=0,this._slicesPerPage=0,this._slices=[],this._resource=t,this._sliceSize=e;var n=Math.floor(this._resource.pageSize/e);c(n>0),this._slicesPerPage=n}var e=t.prototype;return e.destroy=function(){c(0===this._slices.length,"Can not destroy the allocator since it's not empty."),c(!this._resource.debugLocking,"Can not destroy the allocator since it's locking."),this._resource.destroyAllocator(this)},e.debugLock=function(){this._resource.debugLock()},e.debugUnlock=function(){this._resource.debugUnlock()},e.push=function(){var t=this._sliceSize,e=this._slices,n=this._slicesPerPage,r=e.length,i=0,o=0;if(0===t)0===this[El]&&this._resource.pushPage(this),c(1===this[El]);else{var a=n*this[El];c(r<=a),r===a&&(this._resource.pushPage(this),c(r<n*this[El])),o=(r-(i=r%n))/n,c(this[El]*n>=r)}var s=this._resource.getPageMemory(o),u=new Cl(s,t*i);return this._slices.push(u),u},e.pop=function(){var t=this._slices,e=this._slicesPerPage,n=t.length;c(n>0);var r=n-1;0===this._sliceSize?(c(1===this[El]),0===r&&this._resource.popPage(this)):0==r%e&&this._resource.popPage(this),this._slices.pop()},n(t,[{key:"isEmpty",get:function(){return 0===this._slices.length}}]),t}(),wl=function(){function t(t){this._stacks=new Map,this._thresholds=t,c(t.every((function(t,e,n){return 0===e||t>n[e-1]})))}var e=t.prototype;return e.createAllocator=function(t){var e=t,n=this._selectStackPageSize(e),r=this._stacks.get(n);return r||(r=new bl(this,n),this._stacks.set(n,r)),r.createAllocator(e)},e[Tl]=function(t){for(var e,n=!1,r=u(this._stacks);!(e=r()).done;){var i=e.value,o=i[0];if(i[1]===t){this._stacks.delete(o),n=!0;break}}n||c(!1,"Given allocator is not of mime.")},e._selectStackPageSize=function(t){var e=Q(this._thresholds,t),n=t;return e>=0?n=this._thresholds[e]:(e=~e)===this._thresholds.length||(c(e>=0&&e<this._thresholds.length),n=this._thresholds[e]),n},n(t,[{key:"isEmpty",get:function(){return 0===this._stacks.size}}]),t}(),Pl=function(){function t(t,e){this._poses=[],this._allocatedCount=0,this._memoryAllocator=void 0,this._transformCount=t,this._auxiliaryCurveCount=e;var n=Ol(t,e,1);this._memoryAllocator=Il.createAllocator(n)}var e=t.prototype;return e.destroy=function(){c(0===this._allocatedCount,"Can not destroy the allocator since it's not empty.");for(var t=0;t<this._poses.length;++t)this._memoryAllocator.pop();return this._poses.length=0,this._memoryAllocator.destroy()},e.push=function(){0===this._allocatedCount&&this._memoryAllocator.debugLock(),this._allocatedCount===this._poses.length&&(this._allocateNewPose(),c(this._allocatedCount<this._poses.length));var t=this._poses[this._allocatedCount];return++this._allocatedCount,t},e.pop=function(){c(this._allocatedCount>0,"PoseStackAllocator: push/pop does not match."),--this._allocatedCount,0===this._allocatedCount&&this._memoryAllocator.debugUnlock()},e._allocateNewPose=function(){var t=this._memoryAllocator.push(),e=ml.BYTES_PER_ELEMENT*this._transformCount,n=t.byteOffset,r=new ml(t.buffer,n,this._transformCount),i=new Float64Array(t.buffer,n+e,this._auxiliaryCurveCount),o=Mr._create(r,i);this._poses.push(o)},n(t,[{key:"allocatedCount",get:function(){return this._allocatedCount}},{key:"top",get:function(){return c(this._allocatedCount>0),this._poses[this._allocatedCount-1]}}]),t}();function Ol(t,e,n){return(ml.BYTES_PER_ELEMENT*t+Float64Array.BYTES_PER_ELEMENT*e)*n}var Nl,Il=new wl([Ol(128,10,4)]);function xl(t,e){for(var n=t.length,r=0;r<n&&e(t[r],r,t);++r);if(r===n)return n;for(var i=r,o=r+1;o<n;++o){var a=t[o];if(e(a,o,t)){var s=a;t[o]=t[i],t[i]=s,++i}}return i}!function(t){t[t.WORLD=0]="WORLD",t[t.COMPONENT=1]="COMPONENT",t[t.PARENT=2]="PARENT",t[t.LOCAL=3]="LOCAL"}(Nl||(Nl={})),y(Nl);var kl=Symbol("PoseHeapAllocator");function Rl(t){return kl in t}var Ll=function(){function t(t,e){this._transformCount=0,this._metaValueCount=0,this._pages=[],this._allocatedCount=0,this._foremostPossibleFreePage=0,this._transformCount=t,this._metaValueCount=e}var e=t.prototype;return e.allocatePose=function(){++this._allocatedCount;for(var t=this._pages,e=t.length,n=this._foremostPossibleFreePage;n<e;++n){var r=t[n],i=r.tryAllocate();if(i)return i[kl].pageIndex=n,0===r.freeCount&&++this._foremostPossibleFreePage,i}var o=this._allocatePoseInNewPage();return this._foremostPossibleFreePage=o[kl].pageIndex,o},e.destroyPose=function(t){c(Rl(t));var e=this._pages,n=e.length,r=t[kl].pageIndex;c(r>=0&&r<n);var i=e[r];i.deallocate(t),--this._allocatedCount,r<this._foremostPossibleFreePage&&(c(i.freeCount>0),this._foremostPossibleFreePage=r)},e._allocatePoseInNewPage=function(){var t=new Ql(this._transformCount,this._metaValueCount,4),e=this._pages.length;this._pages.push(t);var n=t.tryAllocate();return c(n),n[kl].pageIndex=e,n},n(t,[{key:"allocatedCount",get:function(){return this._allocatedCount}}]),t}(),Ml=function(){function t(){this._id=-1}return n(t,[{key:"pageIndex",get:function(){return this._id>>Bl},set:function(t){this._id&=Dl,this._id|=t<<Bl}},{key:"poseIndex",get:function(){return this._id&Dl},set:function(t){this._id&=~Dl,this._id|=t}}]),t}(),Dl=7,Bl=3;c(Dl+1>=8);var Ul,Fl,Vl,Gl,Wl,zl,jl,Hl,Ql=function(){function t(t,e,n){this._buffer=void 0,this._idleFlags=15,this._poses=void 0,this._freeCount=0,this._transformCount=t,this._metaValueCount=e,this._capacity=n;var r=(ml.BYTES_PER_ELEMENT*t+Float64Array.BYTES_PER_ELEMENT*e)*n;this._buffer=new ArrayBuffer(r),this._poses=new Array(n).fill(null),this._freeCount=n}var e=t.prototype;return e.tryAllocate=function(){var t,e,n=this._poses,r=this._idleFlags,i=this._capacity,o=0===(e=r)?1/0:Math.log2(e&-e);if(o>=i)return null;c(o>=0&&o<n.length);var a=null!==(t=n[o])&&void 0!==t?t:n[o]=this._createPose(o);return a[kl].poseIndex=o,this._idleFlags&=~(1<<o),c(this._freeCount>0),--this._freeCount,a},e.deallocate=function(t){var e=this._poses,n=t[kl].poseIndex;c(n>=0&&n<e.length),c(e[n]===t),this._idleFlags|=1<<n,c(this._freeCount<this._capacity),++this._freeCount},e._createPose=function(t){var e=ml.BYTES_PER_ELEMENT*this._transformCount,n=(e+Float64Array.BYTES_PER_ELEMENT*this._metaValueCount)*t,r=new ml(this._buffer,n,this._transformCount),i=new Float64Array(this._buffer,n+e,this._metaValueCount),o=Mr._create(r,i);return o[kl]=new Ml,o},n(t,[{key:"capacity",get:function(){return this._capacity}},{key:"freeCount",get:function(){return this._freeCount}}]),t}();function Yl(t,e){if(t.name===e)return t;for(var n=t.children.length,r=0;r<n;++r){var i=Yl(t.children[r],e);if(i)return i}return null}var ql,Zl=function(){function t(t,e,n,r){var i=this;this._origin=void 0,this._layoutMaintainer=void 0,this._varRegistry=void 0,this._additiveFlagStack=[],this._triggerResetter=function(t){return i._resetTrigger(t)},this._isLayerWideContextPropertiesSet=!1,this._stashView=void 0,this._motionSyncManager=void 0,this._clipOverrides=void 0,this._controller=r,this._origin=t,this._layoutMaintainer=e,this._varRegistry=n,this._additiveFlagStack=[!1]}var e=t.prototype;return e.bindTransform=function(t){var e=this._origin.getChildByPath(t);return e?this._layoutMaintainer.getOrCreateTransformBinding(e):null},e.bindTransformByName=function(t){var e=Yl(this._origin,t);return e?this._layoutMaintainer.getOrCreateTransformBinding(e):null},e.getBoneChildren=function(t){var e=Yl(this._origin,t);return e?e.children.map((function(t){return t.name})):[]},e.getParentBoneNameByName=function(t){var e,n=Yl(this._origin,t);return n?n===this._origin?"":null==(e=n.parent)?void 0:e.name:null},e.bindAuxiliaryCurve=function(t){return this._layoutMaintainer.getOrCreateAuxiliaryCurveBinding(t)},e.getEvaluationTimeAuxiliaryCurveView=function(){return this._layoutMaintainer.auxiliaryCurveRegistry},e.getVar=function(t){return this._varRegistry[t]},e._pushAdditiveFlag=function(t){this._additiveFlagStack.push(t)},e._popAdditiveFlag=function(){c(this._additiveFlagStack.length>1),this._additiveFlagStack.pop()},e._integrityCheck=function(){return 1===this._additiveFlagStack.length},e._setLayerWideContextProperties=function(t,e){c(!this._isLayerWideContextPropertiesSet),this._isLayerWideContextPropertiesSet=!0,this._stashView=t,this._motionSyncManager=e},e._unsetLayerWideContextProperties=function(){c(this._isLayerWideContextPropertiesSet),this._isLayerWideContextPropertiesSet=!1,this._stashView=void 0,this._motionSyncManager=void 0},e._setClipOverrides=function(t){this._clipOverrides=t},e._resetTrigger=function(t){var e=this._varRegistry[t];e&&(e.value=!1)},n(t,[{key:"origin",get:function(){return this._origin}},{key:"controller",get:function(){return this._controller}},{key:"triggerResetter",get:function(){return this._triggerResetter}},{key:"clipOverrides",get:function(){return this._clipOverrides}},{key:"additive",get:function(){var t=this._additiveFlagStack;return t[t.length-1]}},{key:"stashView",get:function(){return c(this._stashView),this._stashView}},{key:"motionSyncManager",get:function(){return c(this._motionSyncManager),this._motionSyncManager}}]),t}(),Xl=new wr,Jl=function(){function t(){this._namedCurves=new Map}var e=t.prototype;return e.names=function(){return this._namedCurves.keys()},e.has=function(t){return this._namedCurves.has(t)},e.get=function(t){var e;return null!==(e=this._namedCurves.get(t))&&void 0!==e?e:0},e.set=function(t,e){this._namedCurves.set(t,e)},t}();!function(t){t[t.TRANSFORM_COUNT=1]="TRANSFORM_COUNT",t[t.TRANSFORM_ORDER=2]="TRANSFORM_ORDER",t[t.AUXILIARY_CURVE_COUNT=4]="AUXILIARY_CURVE_COUNT"}(ql||(ql={}));var Kl=function(t){return void 0===t&&(t=!1),function(e,n,r){var i=r.value;i&&(r.value=function(){c(this._bindStarted===t,t?"The operation is invalid since bind has not been started.":"The operation is invalid since bind has already been started.");for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return i.call.apply(i,[this].concat(n))})}},$l=(Ul=Kl(!0),Fl=Kl(!0),Vl=Kl(!0),Gl=Kl(!0),Wl=Kl(!0),zl=Kl(!1),jl=Kl(!0),Hl=function(){function t(t,e){this._origin=void 0,this._auxiliaryCurveRegistry=void 0,this._auxiliaryCurveRecords=[],this._transformRecords=[],this._parentTable=[],this._bindStarted=!1,this._transformCountBeforeBind=-1,this._auxiliaryCurveCountBeforeBind=-1,this._origin=t,this._auxiliaryCurveRegistry=e}var e=t.prototype;return e.getOrCreateTransformBinding=function(t){for(var e=this._origin,n=0,r=!1,i=t;i;i=i.parent){if(i===e){r=!0;break}++n}if(!r)return null;var o=this._getOrCreateTransformBinding(t);if(t!==e){--n,c(n>=0);for(var a=t.parent;a!==e;a=a.parent)c(a),this._getOrCreateTransformBinding(a),--n,c(n>=0)}return c(0===n),o},e._getOrCreateTransformBinding=function(t){var e=this._transformRecords,n=e.findIndex((function(e){return e.node===t}));if(n>=0){var r=e[n];return++r.refCount,r.handle}for(var i=0,o=function(t){var n=e.findIndex((function(e){return e.node===t}));if(n>=0)return i=n+1,1},a=t.parent;a&&!o(a);a=a.parent);for(var s=i;s<e.length;++s)++e[s].handle.index;var u=new tc(new bc(this,i),t);return e.splice(i,0,u),u.handle},e.getOrCreateAuxiliaryCurveBinding=function(t){var e=this._auxiliaryCurveRecords,n=e.findIndex((function(e){return e.name===t}));if(n>=0){var r=e[n];return++r.refCount,r.handle}var i=e.length,o=new ec(new Cc(this,i),t);return e.push(o),o.handle},e.createEvaluationContext=function(){return c(!this._bindStarted),new Ac(this.transformCount,this.auxiliaryCurveCount,this._parentTable.slice(),this._origin)},e.resetPoseStashAllocator=function(t){c(!this._bindStarted),t._reset(this.transformCount,this.auxiliaryCurveCount)},e.createTransformFilter=function(t){for(var e,n=this._origin,r=[],i=u(this._transformRecords);!(e=i()).done;){var o=e.value,a=o.node,s=o.handle,l=c(n,a);if(void 0===l)d(a.getPathInHierarchy()+" is not a child of "+n.getPathInHierarchy());else if(t.isExcluded(l))continue;r.push(s.index)}return r.sort(),new Dr(r);function c(t,e){for(var n=[],r=e;r;r=r.parent){if(r===t)return n.join("/");n.unshift(r.name)}}},e.fetchDefaultTransforms=function(t){var e=this._transformRecords.length;c(t.length===e);for(var n=0;n<e;++n){var r=this._transformRecords[n].defaultTransform;t.setTransform(n,r)}},e.apply=function(t){var e=t.transforms,n=t.auxiliaryCurves,r=this._transformRecords.length;c(e.length===r);for(var i=0;i<r;++i){var o=e.getTransform(i,Xl);this._transformRecords[i].node.setRTS(o.rotation,o.position,o.scale)}for(var a=this._auxiliaryCurveRecords.length,s=0;s<a;++s){var u=this._auxiliaryCurveRecords[s].name,l=n[s];this._auxiliaryCurveRegistry.set(u,l)}},e._destroyTransformHandle=function(t){c(t>=0&&t<this._transformRecords.length,"Invalid transform handle.");var e=this._transformRecords[t];c(e.refCount>0,"Something work wrong: refCount mismatch."),--e.refCount},e._destroyAuxiliaryCurveHandle=function(t){c(t>=0&&t<this._auxiliaryCurveRecords.length,"Invalid auxiliary value handle.");var e=this._auxiliaryCurveRecords[t];c(e.refCount>0,"Something work wrong: refCount mismatch."),--e.refCount},e.startBind=function(){this._bindStarted=!0,this._transformCountBeforeBind=this._transformRecords.length,this._auxiliaryCurveCountBeforeBind=this._auxiliaryCurveRecords.length},e.endBind=function(){var t=this._transformRecords,e=this._auxiliaryCurveRecords,n=0;if(nc(t),t.length!==this._transformCountBeforeBind){n|=ql.TRANSFORM_COUNT;for(var r=t.length,i=0;i<r;++i)t[i].order=i}else{for(var o=t.length,a=!1,s=0;s<o;++s){var u=t[s];u.order!==s&&(a=!0,u.order=s)}a&&(n|=ql.TRANSFORM_ORDER)}nc(e),e.length!==this._auxiliaryCurveCountBeforeBind&&(n|=ql.AUXILIARY_CURVE_COUNT);var l=this._parentTable,h=this._origin;l.length=t.length;for(var f=function(){var e=t[p].node;if(e===h)return l[p]=-1,1;var n=e.parent;if(n===h){var r=t.findIndex((function(t){return t.node===n}));l[p]=r>=0?r:-1}else{var i=t.findIndex((function(t){return t.node===n}));c(i>=0,"Parent node is not bound!"),c(i<p),l[p]=i}},p=0;p<t.length;++p)f();return this._bindStarted=!1,t.forEach((function(t,e,n){c(t.handle.index===e,"Bad transform handle."),c(t.order===e,"Bad transform order field.");for(var r=function(t){var r=n.findIndex((function(e){return e.node===t}));r>=0&&c(r<e,"Bad transform order.")},i=t.node.parent;i;i=i.parent)r(i)})),this._transformCountBeforeBind=-1,this._auxiliaryCurveCountBeforeBind=-1,n},n(t,[{key:"transformCount",get:function(){return this._transformRecords.length}},{key:"auxiliaryCurveCount",get:function(){return this._auxiliaryCurveRecords.length}},{key:"auxiliaryCurveRegistry",get:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){return this._auxiliaryCurveRegistry}))}]),t}(),s(Hl.prototype,"getOrCreateTransformBinding",[Ul],Object.getOwnPropertyDescriptor(Hl.prototype,"getOrCreateTransformBinding"),Hl.prototype),s(Hl.prototype,"_getOrCreateTransformBinding",[Fl],Object.getOwnPropertyDescriptor(Hl.prototype,"_getOrCreateTransformBinding"),Hl.prototype),s(Hl.prototype,"getOrCreateAuxiliaryCurveBinding",[Vl],Object.getOwnPropertyDescriptor(Hl.prototype,"getOrCreateAuxiliaryCurveBinding"),Hl.prototype),s(Hl.prototype,"_destroyTransformHandle",[Gl],Object.getOwnPropertyDescriptor(Hl.prototype,"_destroyTransformHandle"),Hl.prototype),s(Hl.prototype,"_destroyAuxiliaryCurveHandle",[Wl],Object.getOwnPropertyDescriptor(Hl.prototype,"_destroyAuxiliaryCurveHandle"),Hl.prototype),s(Hl.prototype,"startBind",[zl],Object.getOwnPropertyDescriptor(Hl.prototype,"startBind"),Hl.prototype),s(Hl.prototype,"endBind",[jl],Object.getOwnPropertyDescriptor(Hl.prototype,"endBind"),Hl.prototype),Hl),tc=function(t,e){this.order=-1,this.refCount=1,this.handle=void 0,this.node=void 0,this.defaultTransform=void 0,this.handle=t,this.node=e;var n=new wr;n.position=e.position,n.rotation=e.rotation,n.scale=e.scale,this.defaultTransform=n},ec=function(t,e){this.refCount=1,this.handle=void 0,this.name=void 0,this.handle=t,this.name=e};function nc(t){var e=xl(t,(function(t){return c(t.refCount>=0),t.refCount>0}));if(c(e<=t.length),e!==t.length){for(var n=0;n<e;++n)t[n].handle.index=n;t.slice(e).forEach((function(t){return t.refCount=-1})),t.splice(e,t.length-e)}}var rc,ic,oc,ac,sc,uc,lc,cc,hc,fc,pc,dc,vc,_c,yc,gc=Symbol("[[DefaultTransforms]]"),mc=function(){function t(t){this._layoutMaintainer=t}return t.prototype.createTransformFilter=function(t){return this._layoutMaintainer.createTransformFilter(t)},n(t,[{key:"transformCount",get:function(){return this._layoutMaintainer.transformCount}}]),t}(),Ec=new wr,Tc=new wr,Ac=function(){function t(t,e,n,r){this[gc]=void 0,this._poseAllocator=void 0,this._parentTable=void 0,this._componentNode=void 0,this._cacheComponentToWorldTransform=new wr,c(t===n.length),c(n.every((function(t,e){return t<0||t<e}))),this._poseAllocator=new Pl(t,e),this._parentTable=n,this._componentNode=r,this[gc]=new ml(t)}var e=t.prototype;return e.destroy=function(){this._poseAllocator.destroy()},e.pushDefaultedPose=function(){var t=this._poseAllocator.push();return t.transforms.set(this[gc]),t._poseTransformSpace=xr.LOCAL,t.auxiliaryCurves.fill(0),t},e.pushDefaultedPoseInComponentSpace=function(){var t=this.pushDefaultedPose();return this._poseTransformsSpaceLocalToComponent(t),t},e.pushZeroDeltaPose=function(){var t=this._poseAllocator.push();return t.transforms.fill(Lr),t._poseTransformSpace=xr.LOCAL,t.auxiliaryCurves.fill(0),t},e.pushDuplicatedPose=function(t){var e=this._poseAllocator.push();return e.transforms.set(t.transforms),e._poseTransformSpace=t._poseTransformSpace,e.auxiliaryCurves.set(t.auxiliaryCurves),e},e.popPose=function(){this._poseAllocator.pop()},e._isStackTopPose_debugging=function(t){return t===this._poseAllocator.top},e._poseTransformsSpaceLocalToComponent=function(t){for(var e=t.transforms,n=e.length,r=0;r<n;++r){var i=this._parentTable[r];if(!(i<0)){var o=e.getTransform(r,Ec),a=e.getTransform(i,Tc);wr.multiply(o,a,o),e.setTransform(r,o)}}t._poseTransformSpace=xr.COMPONENT},e._poseTransformsSpaceComponentToLocal=function(t){for(var e=t.transforms,n=e.length-1;n>=0;--n){var r=this._parentTable[n];if(!(r<0)){var i=e.getTransform(n,Ec),o=e.getTransform(r,Tc);wr.calculateRelative(i,i,o),e.setTransform(n,i)}}t._poseTransformSpace=xr.LOCAL},e._convertPoseSpaceTransformToTargetSpace=function(t,e,n,r){var i=n._poseTransformSpace;switch(e){default:c(!1);break;case Nl.WORLD:i===xr.COMPONENT?wr.multiply(t,this._getComponentToWorldTransform(),t):(c(i===xr.LOCAL),wr.multiply(t,this._getLocalToWorldTransform(Tc,n,r),t));break;case Nl.COMPONENT:i===xr.COMPONENT||(c(i===xr.LOCAL),wr.multiply(t,this._getLocalToComponentTransform(Tc,n,r),t));break;case Nl.PARENT:if(i===xr.COMPONENT){var o=this._parentTable[r];if(o>=0){var a=n.transforms.getTransform(o,Tc),s=wr.invert(a,a);wr.multiply(t,s,t)}}else c(i===xr.LOCAL);break;case Nl.LOCAL:c(i===xr.COMPONENT||i===xr.LOCAL);var u=n.transforms.getTransform(r,Tc),l=wr.invert(u,u);wr.multiply(t,l,t)}return t},e._convertTransformToPoseTransformSpace=function(t,e,n,r){var i=n._poseTransformSpace;switch(e){default:c(!1);break;case Nl.WORLD:if(i===xr.COMPONENT){var o=wr.invert(Tc,this._getComponentToWorldTransform());wr.multiply(t,o,t)}else{c(i===xr.LOCAL);var a=this._getLocalToWorldTransform(Tc,n,r),s=wr.invert(a,a);wr.multiply(t,s,t)}break;case Nl.COMPONENT:if(i===xr.COMPONENT);else{c(i===xr.LOCAL);var u=this._getLocalToComponentTransform(Tc,n,r),l=wr.invert(u,u);wr.multiply(t,l,t)}break;case Nl.PARENT:if(i===xr.COMPONENT){var h=this._parentTable[r];if(h>=0){var f=n.transforms.getTransform(h,Tc);wr.multiply(t,f,t)}}break;case Nl.LOCAL:c(i===xr.COMPONENT||i===xr.LOCAL);var p=n.transforms.getTransform(r,Tc);wr.multiply(t,p,t)}return t},e._getComponentToWorldTransform=function(){var t=this._cacheComponentToWorldTransform,e=this._componentNode;return t.position=e.worldPosition,t.rotation=e.worldRotation,t.scale=e.worldScale,t},e._getLocalToComponentTransform=function(t,e,n){var r=this._parentTable;wr.setIdentity(t);for(var i=r[n];i>=0;i=r[i]){var o=e.transforms.getTransform(i,Ec);wr.multiply(t,o,t)}return t},e._getLocalToWorldTransform=function(t,e,n){return this._getLocalToComponentTransform(t,e,n),wr.multiply(t,this._getComponentToWorldTransform(),t),t},n(t,[{key:"allocatedPoseCount",get:function(){return this._poseAllocator.allocatedCount}},{key:"parentTable",get:function(){return this._parentTable}},{key:"_stackSize_debugging",get:function(){return this._poseAllocator.allocatedCount}}]),t}(),bc=function(){function t(t,e){this.index=-1,this._host=void 0,this._host=t,this.index=e}return t.prototype.destroy=function(){this._host._destroyTransformHandle(this.index)},t}(),Cc=function(){function t(t,e){this.index=-1,this._host=void 0,this._host=t,this.index=e}return t.prototype.destroy=function(){this._host._destroyAuxiliaryCurveHandle(this.index)},t}(),Sc=function(){function t(){this._context={deltaTime:0,indicativeWeight:0}}var e=t.prototype;return e.generate=function(t,e){return this._context.deltaTime=t,this._context.indicativeWeight=e,this._context},e.forkSubWeight=function(t,e){this._context.deltaTime=t.deltaTime,this._context.indicativeWeight=t.indicativeWeight*e},t}(),wc=function(){function t(){this._allocator=null}var e=t.prototype;return e._reset=function(t,e){this._allocator=new Ll(t,e)},e.allocatePose=function(){return c(this._allocator),this._allocator.allocatePose()},e.destroyPose=function(t){return c(this._allocator),this._allocator.destroyPose(t)},n(t,[{key:"allocatedPoseCount",get:function(){return c(this._allocator),this._allocator.allocatedCount}}]),t}(),Pc=P(tt+"MotionSyncInfo")((ic=function(){this.group=oc&&oc()},oc=O(ic.prototype,"group",[I],(function(){return""})),rc=ic))||rc;function Oc(t){return{listEntries:function(){return[{arg:{type:"clip-motion"},menu:"i18n:ENGINE.animation_graph.pose_graph_node_sub_menus.play_or_sample_clip_motion"},{arg:{type:"animation-blend-1d"},menu:"i18n:ENGINE.animation_graph.pose_graph_node_sub_menus.play_or_sample_animation_blend_1d"},{arg:{type:"animation-blend-2d"},menu:"i18n:ENGINE.animation_graph.pose_graph_node_sub_menus.play_or_sample_animation_blend_2d"}]},create:function(e){var n=null;switch(e.type){case"clip-motion":n=new xa;break;case"animation-blend-1d":n=new es;break;case"animation-blend-2d":n=new Ns}return t(n)}}}var Nc=1e-5,Ic=(ac=P(tt+"PoseNodePlayMotion"),sc=lr(gu),uc=cr(Oc((function(t){var e=new Ic;return e.motion=t,e}))),lc=fr({themeColor:"#227F9B"}),cc=ui({type:er.FLOAT}),hc=ui({type:er.FLOAT}),ac(fc=sc(fc=uc(fc=lc((pc=function(t){function r(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).motion=dc&&dc(),e.syncInfo=vc&&vc(),l(e,"startTime",_c,m(e)),l(e,"speedMultiplier",yc,m(e)),e._workspace=null,e._runtimeSyncRecord=void 0,e}e(r,t);var i=r.prototype;return i.bind=function(t){var e=this.motion;if(e){var n=e[Do](t,!1);n&&(this._workspace=new xc(n,n.createPort()),this.syncInfo.group&&(this._runtimeSyncRecord=t.motionSyncManager.register(this.syncInfo)))}},i.settle=function(){},i.reenter=function(){if(this._workspace){var t=this._runtimeSyncRecord,e=this._workspace.motionEval.duration;this._forceEvaluateEvaluation();var n=e<Nc?0:Y(this.startTime/e);t?t.notifyRenter(n):this._workspace.normalizedTime=n,this._workspace.lastIndicativeWeight=0}},i.doUpdate=function(t){if(this._workspace){var e=t.deltaTime,n=this._runtimeSyncRecord,r=this._workspace.motionEval.duration,i=0;r>Nc&&(i=e*this.speedMultiplier/r),n?n.notifyUpdate(i,t.indicativeWeight):this._workspace.normalizedTime+=i,this._workspace.lastIndicativeWeight=t.indicativeWeight}},i.doEvaluate=function(t){if(this._workspace){var e=this._runtimeSyncRecord?this._runtimeSyncRecord.getSyncedEnterTime():this._workspace.normalizedTime;return this._workspace.motionEvalPort.evaluate(e,t)}return t.pushDefaultedPose()},n(r,[{key:"lastIndicativeWeight",get:function(){var t,e;return null!==(t=null==(e=this._workspace)?void 0:e.lastIndicativeWeight)&&void 0!==t?t:0}},{key:"elapsedMotionTime",get:function(){var t,e;return null!==(t=null==(e=this._workspace)?void 0:e.normalizedTime)&&void 0!==t?t:0}}]),r}(oi),dc=O(pc.prototype,"motion",[I],(function(){return new xa})),vc=O(pc.prototype,"syncInfo",[I],(function(){return new Pc})),_c=s(pc.prototype,"startTime",[I,cc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),yc=s(pc.prototype,"speedMultiplier",[I,hc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),fc=pc))||fc)||fc)||fc)||fc),xc=function(t,e){this.normalizedTime=0,this.lastIndicativeWeight=0,this.motionEval=t,this.motionEvalPort=e};function kc(t){return t instanceof oi||t instanceof ai}var Rc=function(){function t(t,e){this._rootPoseNode=t,this._countingPlayMotionNodes=e}var e=t.prototype;return e.bind=function(t){var e;null==(e=this._rootPoseNode)||e.bind(t)},e.settle=function(t){var e;null==(e=this._rootPoseNode)||e.settle(t)},e.reenter=function(){var t;null==(t=this._rootPoseNode)||t.reenter()},e.update=function(t){var e;null==(e=this._rootPoseNode)||e.update(t)},e.evaluate=function(t){var e,n;return null!==(e=null==(n=this._rootPoseNode)?void 0:n.evaluate(t,Zr.LOCAL))&&void 0!==e?e:null},e.countMotionTime=function(){var t=this._countingPlayMotionNodes;if(!t)return c(!1,'Should not call countMotionTime() on this pose graph since "mayCountMotionTime" was not passed to instantiatePoseGraph()'),0;for(var e=0,n=Number.NEGATIVE_INFINITY,r=0;r<t.length;++r){var i=t[r],o=i.elapsedMotionTime,a=i.lastIndicativeWeight;a>n&&(n=a,e=o)}return e},t}();function Lc(t,e,n){void 0===n&&(n=!1);var r=t.outputNode,i=t.getShell(r);c(i);var o=i.getBindings();if(c(o.length<2),0===o.length)return new Rc(void 0,n?[]:void 0);var a=o[0];c(0===a.outputIndex),c(a.producer instanceof oi);var s=new Map,u=Mc(t,a.producer,s,e);return c(u instanceof oi),new Rc(u,n?Array.from(s.values()).filter((function(t){return t instanceof Ic})):void 0)}function Mc(t,e,n,r){var o=t.getShell(e);c(o,"Want to instantiate an unbound graph?");var a=n.get(e);if(a)return a;var s=zt(e);"__callOnAfterDeserializeRecursive"in s&&s.__callOnAfterDeserializeRecursive(),s instanceof ai&&s.link(r);for(var l,h=s,f=[],p=u(o.getBindings());!(l=p()).done;){var d=l.value,v=d.producer,_=d.outputIndex,y=d.inputPath;if(kc(v)){var g=Mc(t,v,n,r);if(g instanceof oi)c(h instanceof oi),Uc(h,y,g,_);else{var m=Wc(h,y,g,_);m&&f.push(m)}}else i("There's a input bound to a node with unrecognized type.")}var E,T=new Dc(f);return h instanceof oi?(h._setDependencyEvaluation(T),E=h):E=new Bc(h,T),n.set(e,E),E}var Dc=function(){function t(t){this._bindingEvaluations=void 0,this._bindingEvaluations=t}return t.prototype.evaluate=function(){for(var t,e=this._bindingEvaluations,n=u(e);!(t=n()).done;)t.value.evaluate()},t}(),Bc=function(){function t(t,e){this._outputs=void 0,this._node=t,this._dependency=e,this._outputs=new Array(t.outputCount)}var e=t.prototype;return e.getDefaultOutput=function(){return this.getOutput(0)},e.getOutput=function(t){return this._outputs[t]},e.evaluate=function(){var t=this._node;this._dependency.evaluate(),t.selfEvaluate(this._outputs)},n(t,[{key:"node",get:function(){return this._node}},{key:"outputCount",get:function(){return this._outputs.length}}]),t}();function Uc(t,e,n,r){var o=e[0],a=e[1],s=void 0===a?-1:a;if(o in t)if(0===r){var u=t[o];if(s<0)return null!==u?void i("Invalid binding: consumer node's input "+o+" should be leaved as evaluation before evaluation."):void(t[o]=n);Array.isArray(u)?s>=u.length?i("Invalid binding: consumer node's input "+o+" have length "+u.length+" but the binding specified "+s):null===u[s]?u[s]=n:i("Invalid binding: consumer node's input "+o+"["+s+"] should be leaved as null before evaluation"):i("Invalid binding: consumer node's input "+o+" should be an array.")}else i("Node "+n.toString()+" does not have specified output "+r+".");else i("Invalid binding: consumer node has no property "+o)}var Fc,Vc=function(){function t(t,e,n,r){this._consumerNode=t,this._consumerPropertyKey=e,this._producerRecord=n,this._producerOutputIndex=r}return t.prototype.evaluate=function(){this._producerRecord.evaluate(),this._consumerNode[this._consumerPropertyKey]=this._producerRecord.getOutput(this._producerOutputIndex)},t}(),Gc=function(){function t(t,e,n,r,i){this._consumerNode=t,this._consumerPropertyKey=e,this._consumerElementIndex=n,this._producerRecord=r,this._producerOutputIndex=i}return t.prototype.evaluate=function(){this._producerRecord.evaluate(),this._consumerNode[this._consumerPropertyKey][this._consumerElementIndex]=this._producerRecord.getOutput(this._producerOutputIndex)},t}();function Wc(t,e,n,r){var o=e[0],a=e[1],s=void 0===a?-1:a;if(o in t){var u=t[o];if(s<0)return new Vc(t,o,n,r);if(Array.isArray(u)){if(!(s>=u.length))return new Gc(t,o,s,n,r);i("Invalid binding: consumer node's input "+o+" have length "+u.length+" but the binding specified "+s)}else i("Invalid binding: consumer node's input "+o+" should be an array.")}else i("Invalid binding: consumer node has no property "+o)}var zc=function(){function t(t,e,n){this.passthroughWeight=1,this._motionStates=[],this._proceduralPoseStates=[],this._topLevelEntry=void 0,this._topLevelExit=void 0,this._currentNode=void 0,this._pendingTransitionPath=[],this._activatedTransitions=[],this._activatedTransitionPool=Eh.createPool(4),this._updateContextGenerator=new Sc,this._conditionEvaluationContext=new mh,this._additive=!1,this._additive=n.additive,this.name=e,this._controller=n.controller;var r=this._addStateMachine(t,null,n,e),i=r.entry,o=r.exit;this._topLevelEntry=i,this._topLevelExit=o,this._currentNode=i,i.increaseActiveReference(),this._resetTrigger=n.triggerResetter}var e=t.prototype;return e.settle=function(t){for(var e=this._proceduralPoseStates,n=e.length,r=0;r<n;++r)e[r].settle(t)},e.reenter=function(){for(var t,e=u(this._activatedTransitions);!(t=e()).done;){var n=t.value;n.destination.decreaseActiveReference(),this._activatedTransitionPool.free(n)}this._activatedTransitions.length=0,this._topLevelEntry.increaseActiveReference(),this._currentNode.decreaseActiveReference(),this._currentNode=this._topLevelEntry},e.update=function(t){c(!this.exited),this._loopMatchTransitions(),this._resetStateTickFlagsAndWeights(),this._updateActivatedTransitions(t.deltaTime),this._commitStateUpdates(t)},e.evaluate=function(t){return this._sample(t)||this._pushNullishPose(t)},e.getCurrentStateStatus=function(){var t=this._currentNode;return t.kind===Hc.animation||t.kind===Hc.procedural?t.getStatus():null},e.getCurrentClipStatuses=function(){var t=this._currentNode;return t.kind===Hc.animation?t.getClipStatuses(t.absoluteWeight):Yc},e.getCurrentTransition=function(t){var e=this._activatedTransitions;if(0===e.length)return!1;var n=e[e.length-1],r=1===e.length?this._currentNode:e[e.length-2].destination,i=n.getAbsoluteDuration(r);return t.duration=i,t.time=n.normalizedElapsedTime*i,!0},e.getNextStateStatus=function(){var t=this._activatedTransitions;if(0===t.length)return null;var e=t[t.length-1].destination;switch(e.kind){default:break;case Hc.procedural:case Hc.animation:return e.getStatus()}return null},e.getNextClipStatuses=function(){var t,e=this._activatedTransitions;if(0===e.length)return Yc;var n=e[e.length-1],r=n.destination;return r.kind===Hc.animation&&null!==(t=r.getClipStatuses(n.destination.absoluteWeight))&&void 0!==t?t:Yc},e.overrideClips=function(t){for(var e=this._motionStates,n=e.length,r=0;r<n;++r)e[r].overrideClips(t)},e._addStateMachine=function(t,e,n,r){var i,o,a,s=this,l=Array.from(t.states()),h=l.map((function(e){if(e instanceof Vn){var r=new Kc(e,n);return s._motionStates.push(r),r}if(e===t.entryState)return i=new _h(e,Hc.entry,e.name);if(e===t.exitState)return a=new _h(e,Hc.exit,e.name);if(e===t.anyState)return o=new _h(e,Hc.any,e.name);if(e instanceof Co)return new yh(e);if(e instanceof Po){var u=new gh(e,n);return s._proceduralPoseStates.push(u),u}return c(e instanceof xo),null}));T(i,"Entry node is missing"),T(a,"Exit node is missing"),T(o,"Any node is missing");for(var f={components:null,parent:e,entry:i,exit:a,any:o},p=0;p<l.length;++p){var d=h[p];d&&(d.stateMachine=f)}for(var v,_=l.map((function(t){if(t instanceof xo){var e=s._addStateMachine(t.stateMachine,f,n,r+"/"+t.name);return e.components=new Jc(t),e}return null})),y=u(h);!(v=y()).done;){var g=v.value;g&&g.setPrefix_debug(r+"/")}for(var m=0;m<l.length;++m){var E=l[m],A=t.getOutgoings(E),b=void 0;if(E instanceof xo){var C=_[m];T(C),b=C.exit}else{var S=h[m];T(S),b=S}for(var w,P=function(){var t,e=w.value,r=e.to,i=l.findIndex((function(t){return t===e.to}));if(i<0&&c(!1,"Bad animation data"),r instanceof xo){var o=_[i];T(o),t=o.entry}else{var a=h[i];T(a),t=a instanceof Kc?a.entry:a}var s={conditions:e.conditions.map((function(t){return t[Do](n)})),to:t,triggers:void 0,duration:0,normalizedDuration:!1,destinationStart:0,relativeDestinationStart:!1,exitCondition:0,exitConditionEnabled:!1,activated:!1,startEventBinding:void 0,endEventBinding:void 0};(Ao(e)||e instanceof So||e instanceof No)&&(s.duration=e.duration,s.destinationStart=e.destinationStart,s.relativeDestinationStart=e.relativeDestinationStart,e.startEventBinding.isBound&&(s.startEventBinding=e.startEventBinding),e.endEventBinding.isBound&&(s.endEventBinding=e.endEventBinding),Ao(e)&&(s.normalizedDuration=e.relativeDuration,s.exitConditionEnabled=e.exitConditionEnabled,s.exitCondition=e.exitCondition)),s.conditions.forEach((function(t,n){var r,i=e.conditions[n];i instanceof cl&&i.trigger&&(null!==(r=s.triggers)&&void 0!==r?r:s.triggers=[]).push(i.trigger)})),b.addTransition(s)},O=u(A);!(w=O()).done;)P()}return f},e._loopMatchTransitions=function(){var t=this._pendingTransitionPath,e=this._activatedTransitions;c(0===t.length);for(var n=0===e.length?this._currentNode:e[e.length-1].destination,r=0;;++r){if(r>=16){for(var i="",o=e[e.length-1].destination,s=-1,u=e.length-2;u>=0;--u)if(e[u].destination===o){s=u;break}i=this._currentNode.name+" --\x3e ... --\x3e ",i+=""+(s<0?e.slice(-16):e.slice(s)).map((function(t){return t.destination.name})).join(" --\x3e "),a(14e3,16,i);break}var l=this._matchNextTransition(n);if(!l)break;var h=l.to,f=n;if(n=h,jc(h)){if(h===f)break;this._activateTransition(t,l),t.length=0}else t.push(l)}t.length=0},e._resetStateTickFlagsAndWeights=function(){var t=this._currentNode,e=this._activatedTransitions;t.resetTickFlagsAndWeight();for(var n=0;n<e.length;++n)e[n].destination.resetTickFlagsAndWeight()},e._commitStateUpdates=function(t){var e=this._currentNode,n=this._activatedTransitions;this._updateContextGenerator,this._commitStateUpdate(e,t);for(var r=0;r<n.length;++r){var i=n[r].destination;this._commitStateUpdate(i,t)}},e._commitStateUpdate=function(t,e){var n=this._updateContextGenerator;if(!t.testTickFlag(qc.UPDATED))if(t.setTickFlag(qc.UPDATED),t.kind===Hc.animation)t.update(e.deltaTime,this._controller);else if(t.kind===Hc.procedural){var r=n.generate(e.deltaTime,e.indicativeWeight*t.absoluteWeight);t.update(r)}},e._sample=function(t){var e,n=this._currentNode,r=this._activatedTransitions,i=1,o=null,a=0;if(n.kind===Hc.animation)o=null!==(e=n.evaluate(t))&&void 0!==e?e:this._pushNullishPose(t);else if(n.kind===Hc.procedural){var s;o=null!==(s=n.evaluate(t))&&void 0!==s?s:this._pushNullishPose(t)}else i-=n.absoluteWeight,o=null;o&&(a=n.absoluteWeight),n.setTickFlag(qc.EVALUATED);for(var u=0;u<r.length;++u){var l=r[u].destination;if(!l.testTickFlag(qc.EVALUATED)){l.setTickFlag(qc.EVALUATED);var c,h=l.absoluteWeight,f=void 0;l.kind===Hc.empty?(i-=h,f=null):f=null!==(c=l.evaluate(t))&&void 0!==c?c:this._pushNullishPose(t),f&&(o&&(a+=h)?(Br(o,f,h/a),t.popPose()):o=f)}}return this.passthroughWeight=i,o},e._pushNullishPose=function(t){return this._additive?t.pushZeroDeltaPose():t.pushDefaultedPose()},e._matchNextTransition=function(t){var e=this._matchTransition(t,t);if(e)return e;if(t.kind===Hc.animation||t.kind===Hc.procedural){var n=this._matchAnyScoped(t);if(n)return n}return null},e._matchAnyScoped=function(t){for(var e=t.stateMachine;null!==e;e=e.parent){var n=this._matchTransition(e.any,t);if(n)return n}return null},e._matchTransition=function(t,e){c(t===e||t.kind===Hc.any);var n=this._conditionEvaluationContext;n.set(e);for(var r=t.outgoingTransitions,i=r.length,o=0;o<i;++o){var a=r[o];if(!a.activated){var s=a.conditions,u=s.length;if(0===u){if(t.kind===Hc.entry||t.kind===Hc.exit)return n.unset(),a;if(!a.exitConditionEnabled)continue}if(e.kind===Hc.animation&&a.exitConditionEnabled){var l=e.duration*a.exitCondition;if(e.time<l)break}for(var h=!0,f=0;f<u;++f)if(!s[f].eval(this._conditionEvaluationContext)){h=!1;break}if(h)return n.unset(),a}}return n.unset(),null},e._activateTransition=function(t,e){var n=e.to;c(jc(n));var r=this._activatedTransitionPool.alloc();r.reset(t,e),this._activatedTransitions.push(r);for(var i=r.path.length,o=0;o<i;++o){var a=r.path[o];this._resetTriggersOnTransition(a)}for(var s=0;s<r.path.length;++s){var u=r.path[s];this._callEnterMethods(u.to)}c(this._activatedTransitions.length>0);var l=1===this._activatedTransitions.length?this._currentNode:this._activatedTransitions[this._activatedTransitions.length-2].destination;l instanceof Xc&&l.transitionOutEventBinding&&this._emit(l.transitionOutEventBinding),e.startEventBinding&&this._emit(e.startEventBinding),n instanceof Xc&&n.transitionInEventBinding&&this._emit(n.transitionInEventBinding)},e._updateActivatedTransitions=function(t){for(var e=this._activatedTransitions,n=e.length-1,r=1,i=n;n>=0;--n){var o=e[n],a=0===n?this._currentNode:e[n-1].destination;if(o.update(t,a),o.done){this._dropActivatedTransitions(i);break}var s=o.normalizedElapsedTime*r;o.destination.increaseAbsoluteWeight(s),r*=1-o.normalizedElapsedTime,i=n-1}this._currentNode.increaseAbsoluteWeight(r)},e._dropActivatedTransitions=function(t){var e=this._activatedTransitions,n=this._activatedTransitionPool;c(t>=0&&t<e.length);var r=t+1,i=e[t],o=i.destination;c(0!==i.path.length);var a=i.path[i.path.length-1];a.endEventBinding&&this._emit(a.endEventBinding),this._callExitMethods(this._currentNode);for(var s=0;s<=t;++s){var u=e[s];s!==t&&u.destination.decreaseActiveReference();for(var l=s===t?u.path.length-1:u.path.length,h=0;h<l;++h){var f=u.path[h];this._callExitMethods(f.to)}n.free(u)}if(t===e.length-1)e.length=0;else{for(var p=t+1;p<e.length;++p)e[p-r]=e[p];e.length-=r}this._currentNode.decreaseActiveReference(),this._currentNode=o},e._resetTriggersOnTransition=function(t){var e=t.triggers;if(e)for(var n=e.length,r=0;r<n;++r){var i=e[r];this._resetTrigger(i)}},e._resetTrigger=function(t){(0,this._triggerReset)(t)},e._callEnterMethods=function(t){var e,n=this._controller;switch(t.kind){default:break;case Hc.animation:t.components.callMotionStateEnterMethods(n,t.getStatus());break;case Hc.entry:null==(e=t.stateMachine.components)||e.callStateMachineEnterMethods(n)}},e._callExitMethods=function(t){var e,n=this._controller;switch(t.kind){default:break;case Hc.animation:t.components.callMotionStateExitMethods(n,t.getStatus());break;case Hc.exit:null==(e=t.stateMachine.components)||e.callStateMachineExitMethods(n)}},e._emit=function(t){t.emit(this._controller.node)},n(t,[{key:"exited",get:function(){return this._currentNode===this._topLevelExit}}]),t}();function jc(t){return t.kind===Hc.animation||t.kind===Hc.empty||t.kind===Hc.procedural}var Hc,Qc={next:function(){return{done:!0,value:void 0}}},Yc=((Fc={})[Symbol.iterator]=function(){return Qc},Fc);!function(t){t[t.entry=0]="entry",t[t.exit=1]="exit",t[t.any=2]="any",t[t.animation=3]="animation",t[t.empty=4]="empty",t[t.procedural=5]="procedural"}(Hc||(Hc={}));var qc,Zc=function(){function t(t){this.name=void 0,this.outgoingTransitions=[],this._activeReferenceCount=0,this._tickFlags=0,this._absoluteWeight=0,this.name=t.name}var e=t.prototype;return e.setPrefix_debug=function(t){this.__DEBUG_ID__=""+t+this.name},e.addTransition=function(t){this.outgoingTransitions.push(t)},e.increaseActiveReference=function(){0===this._activeReferenceCount&&(this._absoluteWeight=0,this._tickFlags=0),++this._activeReferenceCount},e.decreaseActiveReference=function(){this._checkActivated(),--this._activeReferenceCount},e.resetTickFlagsAndWeight=function(){this._checkActivated(),this._absoluteWeight=0,this._tickFlags=0},e.increaseAbsoluteWeight=function(t){this._absoluteWeight+=t},e.testTickFlag=function(t){return this._checkActivated(),!!(this._tickFlags&t)},e.setTickFlag=function(t){this._checkActivated(),c(!this.testTickFlag(t),"Can not set "+qc[t]+" since it has been set!"),this._tickFlags|=t},e._checkActivated=function(){c(this._activeReferenceCount>0,"The state has not been activated")},n(t,[{key:"absoluteWeight",get:function(){return this._absoluteWeight}},{key:"activeReferenceCount",get:function(){return this._activeReferenceCount}}]),t}(),Xc=function(t){function n(e){var n;return(n=t.call(this,e)||this).transitionInEventBinding=void 0,n.transitionOutEventBinding=void 0,e.transitionInEventBinding.isBound&&(n.transitionInEventBinding=e.transitionInEventBinding),e.transitionOutEventBinding.isBound&&(n.transitionOutEventBinding=e.transitionOutEventBinding),n}return e(n,t),n}(Zc);!function(t){t[t.UPDATED=1]="UPDATED",t[t.EVALUATED=2]="EVALUATED"}(qc||(qc={}));var Jc=function(){function t(t){this._components=t.instantiateComponents()}var e=t.prototype;return e.callMotionStateEnterMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateEnter",t,e)},e.callMotionStateUpdateMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateUpdate",t,e)},e.callMotionStateExitMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateExit",t,e)},e.callStateMachineEnterMethods=function(t){this._callStateMachineCallbackIfNonDefault("onStateMachineEnter",t)},e.callStateMachineExitMethods=function(t){this._callStateMachineCallbackIfNonDefault("onStateMachineExit",t)},e._callMotionStateCallbackIfNonDefault=function(t,e,n){for(var r=this._components,i=r.length,o=0;o<i;++o){var a=r[o];a[t]!==fl.prototype[t]&&a[t](e,n)}},e._callStateMachineCallbackIfNonDefault=function(t,e){for(var n=this._components,r=n.length,i=0;i<r;++i){var o=n[i];o[t]!==fl.prototype[t]&&o[t](e)}},t}(),Kc=function(){function t(t,e){var n,r;this._source=null,this._baseSpeed=1,this._speed=1,this._publicState=void 0,this._privateState=void 0;var i=t.name;if(this._baseSpeed=t.speed,this._setSpeedMultiplier(1),t.speedMultiplierEnabled&&t.speedMultiplier){var o=t.speedMultiplier,a=e.getVar(o);if(Qa(a,o)){Ya(a.type,xe.FLOAT,o),a.bind(this._setSpeedMultiplier,this);var s=a.value;this._setSpeedMultiplier(s)}}var u=null!==(n=null==(r=t.motion)?void 0:r[Do](e,!1))&&void 0!==n?n:null;u&&Object.defineProperty(u,"__DEBUG_ID__",{value:i}),this._source=u,this._publicState=new $c(this,t,null==u?void 0:u.createPort()),this._privateState=new $c(this,t,null==u?void 0:u.createPort()),this.components=new Jc(t)}var e=t.prototype;return e.setPrefix_debug=function(t){this._publicState.setPrefix_debug(t),this._privateState.setPrefix_debug(t)},e.addTransition=function(t){t.to===this._publicState?this._publicState.addTransition(C({},t,{to:this._privateState})):this._publicState.addTransition(t),this._privateState.addTransition(t)},e.getClipStatuses=function(t){var e,n=this._source;return n?((e={})[Symbol.iterator]=function(){return n.getClipStatuses(t)},e):Yc},e.overrideClips=function(t){var e;null==(e=this._source)||e.overrideClips(t)},e._setSpeedMultiplier=function(t){this._speed=this._baseSpeed*t},n(t,[{key:"duration",get:function(){var t,e;return null!==(t=null==(e=this._source)?void 0:e.duration)&&void 0!==t?t:0}},{key:"speed",get:function(){return this._speed}},{key:"entry",get:function(){return this._publicState}},{key:"stateMachine",get:function(){return this._stateMachine},set:function(t){this._stateMachine=t,this._publicState.stateMachine=t,this._privateState.stateMachine=t}}]),t}(),$c=function(t){function r(e,n,r){var i;return(i=t.call(this,n)||this).kind=Hc.animation,i._container=void 0,i._progress=0,i._port=void 0,i._statusCache={progress:0},i._container=e,i._port=r,i}e(r,t);var i=r.prototype;return i.reenter=function(t){var e;this._progress=t,null==(e=this._port)||e.reenter()},i.getStatus=function(){var t=this._statusCache;return t.__DEBUG_ID__=this.name,t.progress=eh(this._progress),t},i.getClipStatuses=function(t){return this._container.getClipStatuses(t)},i.update=function(t,e){this._progress=th(this._progress,this.duration,t*this._container.speed),this._container.components.callMotionStateUpdateMethods(e,this.getStatus())},i.evaluate=function(t){var e,n;return null!==(e=null==(n=this._port)?void 0:n.evaluate(this._progress,t))&&void 0!==e?e:null},n(r,[{key:"duration",get:function(){return this._container.duration}},{key:"components",get:function(){return this._container.components}},{key:"normalizedTime",get:function(){return this._progress}},{key:"time",get:function(){return this._progress*this._container.duration}}]),r}(Xc);function th(t,e,n){return 0===e?0:t+n/e}function eh(t){var e=t-Math.trunc(t);return e>=0?e:1+e}var nh,rh,ih,oh,ah,sh,uh,lh,ch,hh,fh,ph,dh,vh,_h=function(t){function n(e,n){var r;return(r=t.call(this,e)||this).kind=void 0,r.kind=n,r}return e(n,t),n}(Zc),yh=function(t){function n(e){var n;return(n=t.call(this,e)||this).kind=Hc.empty,n}return e(n,t),n}(Zc),gh=function(t){function n(e,n){var r;(r=t.call(this,e)||this).kind=Hc.procedural,r.elapsedTime=0,r.statusCache={progress:0},r._instantiatedPoseGraph=void 0,r._statusCache={progress:0},r._elapsedTime=0;var i=Lc(e.graph,n,!0);return i.bind(n),r._instantiatedPoseGraph=i,r._statusCache.__DEBUG_ID__=e.name,r._statusCache.progress=0,r}e(n,t);var r=n.prototype;return r.settle=function(t){this._instantiatedPoseGraph.settle(t)},r.reenter=function(){this._statusCache.progress=0,this._instantiatedPoseGraph.reenter()},r.update=function(t){this._elapsedTime+=t.deltaTime,this._instantiatedPoseGraph.update(t)},r.evaluate=function(t){var e;return null!==(e=this._instantiatedPoseGraph.evaluate(t))&&void 0!==e?e:null},r.getStatus=function(){return this._statusCache.progress=eh(this._elapsedTime),this._statusCache},r.countMotionTime=function(){return this._instantiatedPoseGraph.countMotionTime()},n}(Xc),mh=function(){function t(){this.sourceStateWeight=0,this._sourceState=void 0}var e=t.prototype;return e.set=function(t){this._sourceState=t,jc(t)?(c(t.activeReferenceCount),this.sourceStateWeight=t.absoluteWeight):this.sourceStateWeight=0},e.unset=function(){this._sourceState=void 0,this.sourceStateWeight=0},n(t,[{key:"sourceStateMotionTimeNormalized",get:function(){var t=this._sourceState;switch(c(t&&(t.kind===Hc.animation||t.kind===Hc.procedural)&&t.activeReferenceCount,"State motion time is only defined on activated motion states and procedural pose states."),t.kind){case Hc.animation:return t.normalizedTime;case Hc.procedural:return t.countMotionTime();default:return 0}}}]),t}(),Eh=function(){function t(){this.normalizedElapsedTime=0,this.path=[],this._durationMultiplier=1}var e=t.prototype;return e.getAbsoluteDuration=function(t){return this._getAbsoluteDurationUnscaled(t)*this._durationMultiplier},e.update=function(t,e){if(jc(e)){var n=this.getAbsoluteDuration(e),r=0;if(n<=0)r=0,this.normalizedElapsedTime=1;else{var i=this.normalizedElapsedTime*n,o=n-i;c(o>=0),r=Math.min(o,t);var a=Y((i+r)/n);this.normalizedElapsedTime=a,c(a>=0&&a<=1)}}else this.normalizedElapsedTime=1},t.createPool=function(e){return new b((function(){return new t}),e,(function(t){t.normalizedElapsedTime=Number.NaN}))},e.reset=function(t,e){var n=e.to;c(jc(n)),this.normalizedElapsedTime=0,this.destination=n,this.path=[].concat(t,[e]);var r=n.activeReferenceCount;if(n.increaseActiveReference(),0===r)if(n.kind===Hc.animation){var i=this.path[0],o=i.destinationStart,a=i.relativeDestinationStart?o:0===n.duration?0:o/n.duration;n.reenter(a)}else n.kind===Hc.procedural&&n.reenter();c(n.activeReferenceCount>0),this._durationMultiplier=1-n.absoluteWeight},e._getAbsoluteDurationUnscaled=function(t){c(0!==this.path.length);var e=this.path[0],n=e.duration;return e.normalizedDuration?(t.kind===Hc.animation?t.duration:1)*n:n},n(t,[{key:"done",get:function(){return j(this.normalizedElapsedTime,1,1e-6)}}]),t}();P(tt+"PoseNodeStateMachine")(nh=lr(gu)(nh=fr({themeColor:"#CCCCCC",inline:!0})((rh=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).name=ih&&ih(),e.stateMachine=oh&&oh(),e._stateMachineEval=void 0,e}e(n,t);var r=n.prototype;return r.__callOnAfterDeserializeRecursive=function(){this.stateMachine._allowEmptyStates=!1,this.stateMachine.__callOnAfterDeserializeRecursive()},r.bind=function(t){c(!this._stateMachineEval),this._stateMachineEval=new zc(this.stateMachine,"",t)},r.settle=function(t){var e;null==(e=this._stateMachineEval)||e.settle(t)},r.reenter=function(){var t;null==(t=this._stateMachineEval)||t.reenter()},r.doUpdate=function(t){var e=this._stateMachineEval;c(e),e.update(t),c(e.passthroughWeight>.99999)},r.doEvaluate=function(t){var e=this._stateMachineEval;c(e);var n=e.evaluate(t);return c(e.passthroughWeight>.99999),n},n}(oi),ih=O(rh.prototype,"name",[I],(function(){return""})),oh=O(rh.prototype,"stateMachine",[I],(function(){return new Io(!1)})),nh=rh))||nh)||nh);var Th,Ah,bh,Ch,Sh,wh,Ph,Oh,Nh,Ih,xh,kh,Rh,Lh,Mh,Dh,Bh,Uh,Fh,Vh,Gh,Wh,zh,jh,Hh,Qh,Yh,qh,Zh,Xh,Jh=(ah=P(tt+"PoseNodeSampleMotion"),sh=lr(gu),uh=cr(Oc((function(t){var e=new Jh;return e.motion=t,e}))),lh=fr({themeColor:"#D97721"}),ch=ui({type:er.FLOAT}),ah(hh=sh(hh=uh(hh=lh((fh=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).motion=ph&&ph(),l(e,"time",dh,m(e)),e.useNormalizedTime=vh&&vh(),e._workspace=null,e}e(n,t);var r=n.prototype;return r.bind=function(t){var e=this.motion;if(e){var n=e[Do](t,!0);if(n){var r=new Kh(n,n.createPort());this._workspace=r}}},r.settle=function(){},r.reenter=function(){},r.doUpdate=function(){},r.doEvaluate=function(t){var e=this._workspace;if(!e)return t.pushDefaultedPose();var n=this.time,r=this.useNormalizedTime?n:n/e.motionEval.duration;return e.motionEvalPort.evaluate(Y(r),t)},n}(oi),ph=O(fh.prototype,"motion",[I],(function(){return new xa})),dh=s(fh.prototype,"time",[I,ch],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vh=O(fh.prototype,"useNormalizedTime",[I],(function(){return!1})),hh=fh))||hh)||hh)||hh)||hh),Kh=function(t,e){this.motionEval=t,this.motionEvalPort=e};function $h(t){return t<1e-5}Th=P(tt+"PoseNodeAdditivelyBlend"),Ah=lr(mu),bh=fr({themeColor:"#72A869"}),Ch=ui({type:er.POSE}),Sh=ui({type:er.POSE}),wh=ui({type:er.FLOAT}),Th(Ph=Ah(Ph=bh((Oh=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r))||this,l(e,"basePose",Nh,m(e)),l(e,"additivePose",Ih,m(e)),l(e,"ratio",xh,m(e)),e}e(n,t);var r=n.prototype;return r.bind=function(t){var e,n;null==(e=this.basePose)||e.bind(t),t._pushAdditiveFlag(!0),null==(n=this.additivePose)||n.bind(t),t._popAdditiveFlag()},r.settle=function(t){var e,n;null==(e=this.basePose)||e.settle(t),null==(n=this.additivePose)||n.settle(t)},r.reenter=function(){var t,e;null==(t=this.basePose)||t.reenter(),null==(e=this.additivePose)||e.reenter()},r.doUpdate=function(t){var e,n;null==(e=this.basePose)||e.update(t),null==(n=this.additivePose)||n.update(t)},r.doEvaluate=function(t){var e,n,r=null!==(e=null==(n=this.basePose)?void 0:n.evaluate(t,Zr.LOCAL))&&void 0!==e?e:t.pushDefaultedPose();return this.additivePose?(Yr(r,this.additivePose.evaluate(t,Zr.LOCAL),this.ratio),t.popPose(),r):r},n}(oi),Nh=s(Oh.prototype,"basePose",[I,Ch],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ih=s(Oh.prototype,"additivePose",[I,Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xh=s(Oh.prototype,"ratio",[I,wh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ph=Oh))||Ph)||Ph),kh=P(tt+"PoseNodeBlendInProportion"),Rh=lr(mu),Lh=fr({themeColor:"#72A869"}),Mh=ui({type:er.POSE,arraySyncGroup:"blend-item"}),Dh=ui({type:er.FLOAT,arraySyncGroup:"blend-item",arraySyncGroupFollower:!0}),kh(Bh=Rh(Bh=Lh((Uh=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r))||this,l(e,"poses",Fh,m(e)),l(e,"proportions",Vh,m(e)),e._updateContextGenerator=new Sc,e}e(n,t);var r=n.prototype;return r.bind=function(t){for(var e,n=u(this.poses);!(e=n()).done;){var r=e.value;null==r||r.bind(t)}},r.settle=function(t){for(var e,n=u(this.poses);!(e=n()).done;){var r=e.value;null==r||r.settle(t)}},r.reenter=function(){for(var t,e=u(this.poses);!(t=e()).done;){var n=t.value;null==n||n.reenter()}},r.doUpdate=function(t){for(var e=this._updateContextGenerator,n=this.poses.length,r=0;r<n;++r){var i,o=this.proportions[r];if(!$h(o)){var a=e.generate(t.deltaTime,t.indicativeWeight*o);null==(i=this.poses[r])||i.update(a)}}},r.doEvaluate=function(t){for(var e=this.poses.length,n=0,r=null,i=0;i<e;++i){var o,a=this.proportions[i];if(!$h(a)){var s=null==(o=this.poses[i])?void 0:o.evaluate(t,Zr.LOCAL);s&&(n+=a,r?(n&&Br(r,s,a/n),t.popPose()):r=s)}}return r||t.pushDefaultedPose()},n}(oi),Fh=s(Uh.prototype,"poses",[I,Mh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vh=s(Uh.prototype,"proportions",[I,Dh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bh=Uh))||Bh)||Bh);var tf,ef,nf,rf,of,af,sf,uf,lf=(Gh=P(tt+"PoseNodeBlendTwoPoseBase"),Wh=hr(!0),zh=ui({type:er.POSE}),jh=ui({type:er.POSE}),Hh=ui({type:er.FLOAT}),Gh(Qh=Wh((Yh=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r))||this,l(e,"pose0",qh,m(e)),l(e,"pose1",Zh,m(e)),l(e,"ratio",Xh,m(e)),e._updateContextGenerator=new Sc,e}e(n,t);var r=n.prototype;return r.bind=function(t){var e,n;null==(e=this.pose0)||e.bind(t),null==(n=this.pose1)||n.bind(t)},r.settle=function(t){var e,n;null==(e=this.pose0)||e.settle(t),null==(n=this.pose1)||n.settle(t)},r.reenter=function(){var t,e;null==(t=this.pose0)||t.reenter(),null==(e=this.pose1)||e.reenter()},r.doUpdate=function(t){var e=this.pose0,n=this.pose1,r=this._updateContextGenerator,i=this.ratio,o=r.generate(t.deltaTime,t.indicativeWeight*(1-i));null==e||e.update(o);var a=r.generate(t.deltaTime,t.indicativeWeight*i);null==n||n.update(a)},r.doEvaluate=function(t){var e,r,i,o,a=Zr.LOCAL;if(!this.pose0||!this.pose1)return n.evaluateDefaultPose(t,a);var s=null!==(e=null==(r=this.pose0)?void 0:r.evaluate(t,a))&&void 0!==e?e:n.evaluateDefaultPose(t,a),u=null!==(i=null==(o=this.pose1)?void 0:o.evaluate(t,a))&&void 0!==i?i:n.evaluateDefaultPose(t,a);return this.doBlend(s,u,this.ratio),t.popPose(),s},n}(oi),qh=s(Yh.prototype,"pose0",[I,zh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zh=s(Yh.prototype,"pose1",[I,jh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xh=s(Yh.prototype,"ratio",[I,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Qh=Yh))||Qh)||Qh);P(tt+"PoseNodeBlendTwoPose")(tf=lr(mu)(tf=fr({themeColor:"#72A869"})(tf=function(t){function n(){return t.apply(this,arguments)||this}return e(n,t),n.prototype.doBlend=function(t,e,n){return Br(t,e,n)},n}(lf))||tf)||tf),ef=P(tt+"PoseNodeFilteringBlend"),nf=lr(mu),rf=fr({themeColor:"#72A869"}),of=W(du),ef(af=nf(af=rf((sf=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).mask=uf&&uf(),e._transformFilter=void 0,e}e(n,t);var r=n.prototype;return r.settle=function(e){if(t.prototype.settle.call(this,e),this.mask){var n=e.createTransformFilter(this.mask);this._transformFilter=n}},r.doBlend=function(t,e,n){Br(t,e,n,this._transformFilter)},n}(lf),uf=O(sf.prototype,"mask",[I,of],(function(){return null})),af=sf))||af)||af);var cf,hf,ff,pf,df,vf,_f,yf,gf,mf,Ef,Tf,Af,bf,Cf,Sf,wf,Pf,Of,Nf,If,xf,kf,Rf,Lf,Mf,Df,Bf,Uf,Ff,Vf,Gf,Wf=gu+"/i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes_choose/",zf=1e-5,jf=P(tt+"PoseNodeChoosePoseBase")(cf=hr()((hf=function(t){function n(e){var n;return void 0===e&&(e=0),(n=t.call(this)||this)._poses=ff&&ff(),n._fadeInDurations=pf&&pf(),n._updateContextGenerator=new Sc,n._evaluationRecord=void 0,n._poses.length=e,n._poses.fill(null),n._fadeInDurations.length=e,n._fadeInDurations.fill(0),n}e(n,t);var r=n.prototype;return r.bind=function(t){for(var e,n=u(this._poses);!(e=n()).done;){var r=e.value;null==r||r.bind(t)}var i=new Hf(this._poses.length,this.getChosenIndex());this._evaluationRecord=i},r.settle=function(t){for(var e,n=u(this._poses);!(e=n()).done;){var r=e.value;null==r||r.settle(t)}},r.reenter=function(){for(var t,e=u(this._poses);!(t=e()).done;){var n=t.value;null==n||n.reenter()}},r.doUpdate=function(t){var e=this._poses,n=this._evaluationRecord;if(c(n),n.update(t.deltaTime,this.getChosenIndex(),this._fadeInDurations),!n.allWeightsAreZero()){var r=e.length,i=n.items;c(i.length===r);for(var o=0;o<r;++o){var a=i[o].weight;if(!$h(a)){var s=e[o],u=this._updateContextGenerator.generate(t.deltaTime,t.indicativeWeight*a);null==s||s.update(u)}}}},r.doEvaluate=function(t){var e=this._poses,r=this._evaluationRecord;c(r);var i=Zr.LOCAL,o=e.length,a=r.items;c(a.length===e.length);var s=null;if(!r.allWeightsAreZero())for(var u=0,l=0;l<o;++l){var h,f=r.items[l].weight;if(!$h(f)){var p=null==(h=e[l])?void 0:h.evaluate(t,Zr.LOCAL);p&&(u+=f,s?(u&&Br(s,p,f/u),t.popPose()):s=p)}}return s||n.evaluateDefaultPose(t,i)},r.getChosenIndex=function(){return 0},n}(oi),ff=O(hf.prototype,"_poses",[I],(function(){return[]})),pf=O(hf.prototype,"_fadeInDurations",[I],(function(){return[]})),cf=hf))||cf)||cf,Hf=function(){function t(t,e){this._items=void 0,this._chosenPoseIndex=-1,this._elapsedTransitionTime=0,this._blendingDuration=0;var n=Array.from({length:t},(function(){return new Qf}));e>=0&&e<t&&(n[e].selfSourceWeight=1,n[e].selfTargetWeight=1,n[e].weight=1),this._items=n}var e=t.prototype;return e.allWeightsAreZero=function(){return this._chosenPoseIndex<0},e.update=function(t,e,n){if(c(t>=0),this._checkAlternation(e,n),!(this._chosenPoseIndex<0)){var r=this._elapsedTransitionTime,i=this._blendingDuration,o=this._items;if(!(r>=i)){var a=o.length,s=0,u=0;t>i-r?(this._elapsedTransitionTime=i,u=1):(this._elapsedTransitionTime+=t,u=this._elapsedTransitionTime/i),c(u>=0&&u<=1);for(var l=0;l<a;++l){var h=o[l],f=U(h.selfSourceWeight,h.selfTargetWeight,u);s+=f,h.weight=f}if($h(s))c(o.every((function(t){return 0===t.weight})));else for(var p=0;p<a;++p)o[p].weight/=s}}},e._checkAlternation=function(t,e){var n=this._items,r=this._chosenPoseIndex,i=n.length;if(i&&t!==r&&!(t<0||t>=i)){var o=Math.max(e[t],0);if(o<zf)for(var a=0;a<i;++a){var s=n[a];a===t?(s.selfSourceWeight=1,s.selfTargetWeight=1,s.weight=1):(s.selfSourceWeight=0,s.selfTargetWeight=0,s.weight=0)}else for(var u=this._blendingDuration<zf?1:this._elapsedTransitionTime/this._blendingDuration,l=0;l<i;++l){var c=n[l];c.selfSourceWeight=U(c.selfSourceWeight,c.selfTargetWeight,u),c.selfTargetWeight=l===t?1:0}this._chosenPoseIndex=t,this._elapsedTransitionTime=0,this._blendingDuration=o}},n(t,[{key:"items",get:function(){return this._items}}]),t}(),Qf=function(){this.selfSourceWeight=0,this.selfTargetWeight=0,this.weight=0};df=P(tt+"PoseNodeChoosePoseByBoolean"),vf=lr(Wf),_f=fr({themeColor:"#D07979"}),yf=ui({type:er.POSE}),gf=ui({type:er.POSE}),mf=ui({type:er.FLOAT}),Ef=ui({type:er.FLOAT}),Tf=ui({type:er.BOOLEAN}),df(Af=vf(Af=_f((bf=function(t){function r(){var e;return e=t.call(this,2)||this,l(e,"choice",Cf,m(e)),e}return e(r,t),r.prototype.getChosenIndex=function(){return this.choice?0:1},n(r,[{key:"truePose",get:function(){return this._poses[0]},set:function(t){this._poses[0]=t}},{key:"falsePose",get:function(){return this._poses[1]},set:function(t){this._poses[1]=t}},{key:"trueFadeInDuration",get:function(){return this._fadeInDurations[0]},set:function(t){this._fadeInDurations[0]=t}},{key:"falseFadeInDuration",get:function(){return this._fadeInDurations[1]},set:function(t){this._fadeInDurations[1]=t}}]),r}(jf),s(bf.prototype,"truePose",[yf],Object.getOwnPropertyDescriptor(bf.prototype,"truePose"),bf.prototype),s(bf.prototype,"falsePose",[gf],Object.getOwnPropertyDescriptor(bf.prototype,"falsePose"),bf.prototype),s(bf.prototype,"trueFadeInDuration",[mf],Object.getOwnPropertyDescriptor(bf.prototype,"trueFadeInDuration"),bf.prototype),s(bf.prototype,"falseFadeInDuration",[Ef],Object.getOwnPropertyDescriptor(bf.prototype,"falseFadeInDuration"),bf.prototype),Cf=s(bf.prototype,"choice",[I,Tf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Af=bf))||Af)||Af),Sf=P(tt+"PoseNodeChoosePoseByIndex"),wf=lr(Wf),Pf=fr({themeColor:"#D07979"}),Of=ui({type:er.POSE,arraySyncGroup:"choose-item"}),Nf=ui({type:er.FLOAT,arraySyncGroup:"choose-item",arraySyncGroupFollower:!0}),If=ui({type:er.INTEGER}),Sf(xf=wf(xf=Pf((kf=function(t){function r(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r))||this,l(e,"choice",Rf,m(e)),e}return e(r,t),r.prototype.getChosenIndex=function(){return this.choice},n(r,[{key:"poses",get:function(){return this._poses},set:function(t){this._poses=t}},{key:"fadeInDurations",get:function(){return this._fadeInDurations},set:function(t){this._fadeInDurations=t}}]),r}(jf),s(kf.prototype,"poses",[Of],Object.getOwnPropertyDescriptor(kf.prototype,"poses"),kf.prototype),s(kf.prototype,"fadeInDurations",[Nf],Object.getOwnPropertyDescriptor(kf.prototype,"fadeInDurations"),kf.prototype),Rf=s(kf.prototype,"choice",[I,If],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xf=kf))||xf)||xf),function(t){t[t.VALUE=0]="VALUE",t[t.AUXILIARY_CURVE=1]="AUXILIARY_CURVE"}(Gf||(Gf={})),y(Gf);var Yf,qf,Zf,Xf,Jf,Kf,$f=(Lf=P(tt+"IntensitySpecification"),Mf=W(Gf),Lf((Bf=function(){function t(){this.type=Uf&&Uf(),this.value=Ff&&Ff(),this.auxiliaryCurveName=Vf&&Vf(),this._handle=void 0}var e=t.prototype;return e.bind=function(t){if(this.type===Gf.AUXILIARY_CURVE&&this.auxiliaryCurveName){var e=t.bindAuxiliaryCurve(this.auxiliaryCurveName);this._handle=e}},e.evaluate=function(t){return this.type===Gf.AUXILIARY_CURVE&&this._handle?t.auxiliaryCurves[this._handle.index]:this.value},t}(),Uf=O(Bf.prototype,"type",[Mf,I],(function(){return Gf.VALUE})),Ff=O(Bf.prototype,"value",[I],(function(){return 1})),Vf=O(Bf.prototype,"auxiliaryCurveName",[I],(function(){return""})),Df=Bf))||Df),tp=function(){this.transformIndex=-1,this.transform=new wr},ep=function(){function t(){this._pool=new b((function(){return new tp}),3),this._array=new S(3),this._debugLastTransformIndex=-1}var e=t.prototype;return e.push=function(t,e){c(t>this._debugLastTransformIndex,"Unexpected transform modification order"),this._debugLastTransformIndex=t;var n=this._pool.alloc();n.transformIndex=t,wr.copy(n.transform,e),this._array.push(n)},e.clear=function(){for(var t=this._array.length,e=0;e<t;++e){var n=this._array.get(e);c(n),this._pool.free(n)}this._array.clear(),this._debugLastTransformIndex=-1},n(t,[{key:"length",get:function(){return this._array.length}},{key:"array",get:function(){return this._array.array}}]),t}(),np=function(){function t(t){this._transformFlags=[],this._transformFlags=new Array(t)}var e=t.prototype;return e.clear=function(){this._transformFlags.fill(!1)},e.test=function(t){return this._transformFlags[t]},e.set=function(t){this._transformFlags[t]=!0},e.unset=function(t){this._transformFlags[t]=!1},t}(),rp=new wr,ip=new wr;function op(t,e,n,r){var i=n.length;if(0!==i){for(var o=-1,a=0;a<i;++a){var s=n.array[a].transformIndex;c(s>o),o=s}if(e._poseTransformSpace!==xr.LOCAL){c(e._poseTransformSpace===xr.COMPONENT),r.clear();for(var u=n.array[0].transformIndex,l=u,h=0;h<i;++h){var f=n.array[h].transformIndex;r.set(f),l=f}for(var p=u;p<e.transforms.length;++p){var d=t.parentTable[p];d<0||r.test(d)&&(r.set(p),l=p)}for(var v=l;v>=u;--v)if(r.test(v)){var _=t.parentTable[v];if(_>=0){var y=e.transforms.getTransform(v,rp),g=e.transforms.getTransform(_,ip);wr.calculateRelative(y,y,g),e.transforms.setTransform(v,y)}}for(var m=0;m<i;++m){var E=n.array[m],T=E.transformIndex,A=E.transform;e.transforms.setTransform(T,A),r.unset(T)}for(var b=u;b<=l;++b)if(r.test(b)){var C=t.parentTable[b];c(C>=0);var S=e.transforms.getTransform(b,rp),w=e.transforms.getTransform(C,ip);wr.multiply(S,w,S),e.transforms.setTransform(b,S)}}else for(var P=0;P<i;++P){var O=n.array[P],N=O.transformIndex,I=O.transform;e.transforms.setTransform(N,I)}}}var ap,sp,up,lp,cp,hp,fp,pp,dp,vp,_p,yp,gp,mp,Ep,Tp,Ap,bp,Cp,Sp=(Yf=P(tt+"PoseNodeModifyPoseBase"),qf=hr(),Zf=ui({type:er.POSE}),Yf(Xf=qf((Jf=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r))||this,l(e,"pose",Kf,m(e)),e._modificationQueue=new ep,e._spaceFlagTable=new np(0),e}e(n,t);var r=n.prototype;return r.settle=function(t){var e;null==(e=this.pose)||e.settle(t),this._spaceFlagTable=new np(t.transformCount)},r.reenter=function(){var t;null==(t=this.pose)||t.reenter()},r.bind=function(t){var e;null==(e=this.pose)||e.bind(t)},r.doUpdate=function(t){var e;null==(e=this.pose)||e.update(t)},r.doEvaluate=function(t){var e,n,r=this.getPoseTransformSpaceRequirement(),i=null!==(e=null==(n=this.pose)?void 0:n.evaluate(t,r))&&void 0!==e?e:oi.evaluateDefaultPose(t,r),o=this._modificationQueue;return c(0===o.length),this.modifyPose(t,i,o),op(t,i,o,this._spaceFlagTable),o.clear(),i},n}(oi),Kf=s(Jf.prototype,"pose",[I,Zf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xf=Jf))||Xf)||Xf);!function(t){t[t.LEAVE_UNCHANGED=0]="LEAVE_UNCHANGED",t[t.REPLACE=1]="REPLACE",t[t.ADD=2]="ADD"}(Cp||(Cp={})),y(Cp);var wp=1e-5,Pp=new wr;ap=P(tt+"PoseNodeApplyTransform"),sp=lr(gu),up=fr({themeColor:"#72A869"}),lp=W(Cp),cp=ui({type:er.VEC3}),hp=W(Cp),fp=ui({type:er.QUAT}),pp=W(Nl),dp=ui({type:er.FLOAT}),ap(vp=sp(vp=up((_p=function(t){function r(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).node=yp&&yp(),e.positionOperation=gp&&gp(),l(e,"position",mp,m(e)),e.rotationOperation=Ep&&Ep(),l(e,"rotation",Tp,m(e)),e.intensity=Ap&&Ap(),e.transformSpace=bp&&bp(),e._transformHandle=null,e}e(r,t);var i=r.prototype;return i.bind=function(e){var n=this.node;if(t.prototype.bind.call(this,e),n){var r=e.bindTransformByName(n);r?(this._transformHandle=r,this.intensity.bind(e)):d("Failed to bind transform "+n)}},i.getPoseTransformSpaceRequirement=function(){return Zr.NO},i.modifyPose=function(t,e,n){var r=this._transformHandle;if(!r)return e;var i=this.intensity.evaluate(e);if(i<wp)return e;var o=j(i,1,wp),a=r.index,s=e.transforms.getTransform(a,Pp),u=this.rotationOperation;if(u!==Cp.LEAVE_UNCHANGED){var l=this.rotation,c=this.transformSpace;switch(t._convertPoseSpaceTransformToTargetSpace(s,c,e,a),u){default:case Cp.REPLACE:jp(s,l,i,o);break;case Cp.ADD:Hp(s,l,i,o)}t._convertTransformToPoseTransformSpace(s,c,e,a)}var h=this.positionOperation;if(h!==Cp.LEAVE_UNCHANGED){var f=this.position,p=this.transformSpace;switch(t._convertPoseSpaceTransformToTargetSpace(s,p,e,a),h){default:case Cp.REPLACE:Gp(s,f,i,o);break;case Cp.ADD:Wp(s,f,i,o)}t._convertTransformToPoseTransformSpace(s,p,e,a)}return n.push(a,s),e},n(r,[{key:"intensityValue",get:function(){return this.intensity.value},set:function(t){this.intensity.value=t}}]),r}(Sp),yp=O(_p.prototype,"node",[I],(function(){return""})),gp=O(_p.prototype,"positionOperation",[I,lp],(function(){return Cp.LEAVE_UNCHANGED})),mp=s(_p.prototype,"position",[I,cp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new R}}),Ep=O(_p.prototype,"rotationOperation",[I,hp],(function(){return Cp.LEAVE_UNCHANGED})),Tp=s(_p.prototype,"rotation",[I,fp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new L}}),Ap=O(_p.prototype,"intensity",[I],(function(){return new $f})),bp=O(_p.prototype,"transformSpace",[I,pp],(function(){return Nl.WORLD})),s(_p.prototype,"intensityValue",[dp],Object.getOwnPropertyDescriptor(_p.prototype,"intensityValue"),_p.prototype),vp=_p))||vp)||vp);var Op,Np,Ip,xp,kp,Rp,Lp,Mp,Dp,Bp,Up,Fp,Vp=(Op=new R,Np=new R,{replace:function(t,e,n,r){if(r)t.position=e;else{var i=R.copy(Op,t.position);R.lerp(i,i,e,n),t.position=i}},add:function(t,e,n,r){var i=Np;r?R.copy(i,e):R.slerp(i,R.ZERO,e,n),R.add(i,t.position,i),t.position=i}}),Gp=Vp.replace,Wp=Vp.add,zp=function(){var t=new L,e=new L;return{replace:function(e,n,r,i){if(i)e.rotation=n;else{var o=L.copy(t,e.rotation);L.slerp(o,o,n,r),e.rotation=o}},add:function(n,r,i,o){var a=L.copy(t,n.rotation),s=e;o?L.copy(s,r):L.slerp(s,L.IDENTITY,r,i),L.multiply(s,s,a),n.rotation=s}}}(),jp=zp.replace,Hp=zp.add,Qp=new wr;!function(t){t[t.LOCAL=0]="LOCAL",t[t.COMPONENT=1]="COMPONENT"}(Fp||(Fp={})),y(Fp),Ip=P(tt+"PoseNodeCopyTransform"),xp=lr(gu),kp=fr({themeColor:"#72A869"}),Rp=W(Fp),Ip(Lp=xp(Lp=kp((Mp=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).sourceNodeName=Dp&&Dp(),e.targetNodeName=Bp&&Bp(),e.space=Up&&Up(),e._workspace=void 0,e}e(n,t);var r=n.prototype;return r.bind=function(e){t.prototype.bind.call(this,e);var n=e.bindTransformByName(this.sourceNodeName),r=e.bindTransformByName(this.targetNodeName);if(!n||!r)return null==n||n.destroy(),void(null==r||r.destroy());this._workspace=new rd(n,r)},r.modifyPose=function(t,e){var n=this._workspace;if(n){var r=n.hSource.index,i=n.hTarget.index,o=e.transforms.getTransform(r,Qp);e.transforms.setTransform(i,o)}},r.getPoseTransformSpaceRequirement=function(){return this.space===Fp.COMPONENT?Zr.COMPONENT:Zr.LOCAL},n}(Sp),Dp=O(Mp.prototype,"sourceNodeName",[I],(function(){return""})),Bp=O(Mp.prototype,"targetNodeName",[I],(function(){return""})),Up=O(Mp.prototype,"space",[I,Rp],(function(){return Fp.COMPONENT})),Lp=Mp))||Lp)||Lp);var Yp,qp,Zp,Xp,Jp,Kp,$p,td,ed,nd,rd=function(t,e){this.hSource=t,this.hTarget=e};!function(t){t[t.LEAVE_UNCHANGED=0]="LEAVE_UNCHANGED",t[t.REPLACE=1]="REPLACE",t[t.ADD=2]="ADD"}(nd||(nd={})),y(nd),Yp=P(tt+"PoseNodeSetAuxiliaryCurve"),qp=lr(gu),Zp=ui({type:er.FLOAT}),Xp=W(nd),Yp(Jp=qp((Kp=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).curveName=$p&&$p(),l(e,"curveValue",td,m(e)),e.flag=ed&&ed(),e._handle=void 0,e}e(n,t);var r=n.prototype;return r.bind=function(e){t.prototype.bind.call(this,e),this.curveName&&(this._handle=e.bindAuxiliaryCurve(this.curveName))},r.getPoseTransformSpaceRequirement=function(){return Zr.NO},r.modifyPose=function(t,e){var n=this._handle;if(n)switch(this.flag){case nd.REPLACE:e.auxiliaryCurves[n.index]=this.curveValue;break;case nd.ADD:e.auxiliaryCurves[n.index]+=this.curveValue;case nd.LEAVE_UNCHANGED:}},n}(Sp),$p=O(Kp.prototype,"curveName",[I],(function(){return""})),td=s(Kp.prototype,"curveValue",[I,Zp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ed=O(Kp.prototype,"flag",[I,Xp],(function(){return nd.REPLACE})),Jp=Kp))||Jp);var id=function(){function t(){this._node=void 0,this._meshRenderer=void 0;var t=new Bt;K.director.getScene().addChild(t);var e,n=t.addComponent(Qt);n.material=((e=new It).reset({effectName:"builtin-unlit",states:{primitive:Wt.LINE_LIST},defines:{USE_VERTEX_COLOR:!0}}),e),this._node=t,this._meshRenderer=n}return t.prototype.draw=function(t,e,n){var r=q.RED,i=q.BLUE,o=[t.x,t.y,t.z,e.x,e.y,e.z,e.x,e.y,e.z,n.x,n.y,n.z],a=[r.x,r.y,r.z,r.w,r.x,r.y,r.z,r.w,i.x,i.y,i.z,i.w,i.x,i.y,i.z,i.w],s=Ht({positions:o,colors:a,primitiveMode:Wt.LINE_LIST});this._meshRenderer.mesh=s},t}(),od=new WeakMap;function ad(t,e,n,r){if("object"==typeof t&&t){var i=od.get(t);i||(i=new id,od.set(t,i)),i.draw(e,n,r)}}var sd,ud,ld,cd,hd,fd,pd,dd,vd,_d,yd,gd,md,Ed,Td,Ad,bd,Cd,Sd,wd,Pd,Od,Nd,Id,xd=function(){function t(){this._a=new R}var e=t.prototype;return e.reset=function(t,e,n){R.copy(this._a,t),this._dAB=R.distance(t,e),this._dBC=R.distance(e,n)},e.check=function(t,e,n){var r=.001,i=R.distance(t,e),o=R.distance(e,n);return!!j(R.distance(t,this._a),0,r)&&!!j(i,this._dAB,r)&&!!j(o,this._dBC,r)},t}(),kd=function(){var t,e,n=new L,r=new R,i=new R,o=new R,a=(t=new R,e=new R,function(n,r,i,o,a){return L.rotationTo(n,R.subtract(t,i,r).normalize(),R.subtract(e,a,o).normalize())});return function(t,e,s,u,l,c){var h=R.copy(r,null!=l?l:e.position),f=t.position,p=e.position,d=s.position;s.rotation,void 0!==typeof c&&ad(c,f,p,d);var v=i,_=o;Rd(f,p,d,u,h,v,_);var y=a(n,f,p,f,v);L.multiply(y,y,t.rotation),t.rotation=y;var g=a(n,p,d,v,_);L.multiply(g,g,e.rotation),e.rotation=g,e.position=v,s.position=_}}(),Rd=(sd=new R,ud=new R,ld=new R,cd=new xd,function(t,e,n,r,i,o,a){var s=cd?(null==cd||cd.reset(t,e,n),function(){return cd.check(t,o,a)}):void 0,u=R.distance(t,e),l=R.distance(e,n),c=R.distance(t,r),h=R.subtract(sd,r,t);h.normalize();var f=u+l;if(c>=f)return R.scaleAndAdd(o,t,h,u),R.scaleAndAdd(a,t,h,f),void(null==s||s());R.copy(a,r);var p=V((u*u+c*c-l*l)/(2*u*c),-1,1),d=R.subtract(ud,i,t),v=R.projectOnPlane(ld,d,h);v.normalize();var _=u*p,y=u*u-_*_,g=Math.sqrt(y);R.scaleAndAdd(o,t,h,_),R.scaleAndAdd(o,o,v,g),null==s||s()}),Ld=gu+"/i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes_ik/",Md=new wr,Dd=new wr,Bd=new wr,Ud=new R,Fd=new R,Vd=new wr;!function(t){t[t.NONE=0]="NONE",t[t.VALUE=1]="VALUE",t[t.BONE=2]="BONE"}(Id||(Id={})),y(Id);var Gd=(hd=P(tt+"PoseNodeTwoBoneIKSolver.TargetSpecification"),fd=W(Id),pd=W(Nl),hd((vd=function(){function t(t){this.type=_d&&_d(),this.targetPosition=yd&&yd(),this.targetPositionSpace=gd&&gd(),this.targetBone=md&&md(),this._sourceBoneHandle=void 0,this._targetBoneHandle=void 0,void 0!==t&&(this.type=t)}var e=t.prototype;return e.bind=function(t,e){var n;this._sourceBoneHandle=e,this.type===Id.BONE&&this.targetBone&&(this._targetBoneHandle=null!==(n=t.bindTransformByName(this.targetBone))&&void 0!==n?n:void 0)},e.evaluate=function(t,e,n){if(c(this._sourceBoneHandle),this._targetBoneHandle)e.transforms.getPosition(this._targetBoneHandle.index,t);else if(this.type===Id.NONE)e.transforms.getPosition(this._sourceBoneHandle.index,t);else{var r=wr.setIdentity(Vd);r.position=this.targetPosition,n._convertTransformToPoseTransformSpace(r,this.targetPositionSpace,e,this._sourceBoneHandle.index),R.copy(t,r.position)}return t},t}(),_d=O(vd.prototype,"type",[I,fd],(function(){return Id.VALUE})),yd=O(vd.prototype,"targetPosition",[I],(function(){return new R})),gd=O(vd.prototype,"targetPositionSpace",[I,pd],(function(){return Nl.WORLD})),md=O(vd.prototype,"targetBone",[I],(function(){return""})),dd=vd))||dd);Ed=P(tt+"PoseNodeTwoBoneIKSolver"),Td=lr(Ld),Ad=ui({type:er.VEC3}),bd=ui({type:er.VEC3}),Ed(Cd=Td((Sd=function(t){function r(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).debug=wd&&wd(),e.endEffectorBoneName=Pd&&Pd(),e.endEffectorTarget=Od&&Od(),e.poleTarget=Nd&&Nd(),e._workspace=void 0,e}e(r,t);var i=r.prototype;return i.bind=function(e){if(t.prototype.bind.call(this,e),this.endEffectorBoneName){var n=e.getParentBoneNameByName(this.endEffectorBoneName),r=n?e.getParentBoneNameByName(n):"";if(n&&r){var i=e.bindTransformByName(this.endEffectorBoneName),o=e.bindTransformByName(n),a=e.bindTransformByName(r);i&&o&&a?(this.endEffectorTarget.bind(e,i),this.poleTarget.bind(e,o),this._workspace=new Jd(i,o,a)):(null==i||i.destroy(),null==o||o.destroy(),null==a||a.destroy())}}},i.getPoseTransformSpaceRequirement=function(){return Zr.COMPONENT},i.modifyPose=function(t,e,n){var r=this._workspace;if(r){var i=r.hRoot.index,o=r.hMiddle.index,a=r.hEndEffector.index,s=e.transforms.getTransform(i,Md),u=e.transforms.getTransform(o,Dd),l=e.transforms.getTransform(a,Bd),c=this.endEffectorTarget.evaluate(Ud,e,t),h=this.poleTarget.evaluate(Fd,e,t);kd(s,u,l,c,h,this.debug?this:void 0),n.push(i,s),n.push(o,u),n.push(a,l)}},n(r,[{key:"endEffectorTargetPosition",get:function(){return this.endEffectorTarget.targetPosition},set:function(t){R.copy(this.endEffectorTarget.targetPosition,t)}},{key:"poleTargetPosition",get:function(){return this.poleTarget.targetPosition},set:function(t){R.copy(this.poleTarget.targetPosition,t)}}]),r}(Sp),wd=O(Sd.prototype,"debug",[I],(function(){return!1})),Pd=O(Sd.prototype,"endEffectorBoneName",[I],(function(){return""})),Od=O(Sd.prototype,"endEffectorTarget",[I],(function(){return new Gd(Id.VALUE)})),s(Sd.prototype,"endEffectorTargetPosition",[Ad],Object.getOwnPropertyDescriptor(Sd.prototype,"endEffectorTargetPosition"),Sd.prototype),Nd=O(Sd.prototype,"poleTarget",[I],(function(){return new Gd(Id.NONE)})),s(Sd.prototype,"poleTargetPosition",[bd],Object.getOwnPropertyDescriptor(Sd.prototype,"poleTargetPosition"),Sd.prototype),Cd=Sd))||Cd);var Wd,zd,jd,Hd,Qd,Yd,qd,Zd,Xd,Jd=function(t,e,n){this.hEndEffector=t,this.hMiddle=e,this.hRoot=n},Kd={listEntries:function(t){for(var e,n=[],r=u(t.animationGraph.variables);!(e=r()).done;){var i=e.value,o=i[0],a=i[1].type;if(a!==xe.TRIGGER){var s=void 0;switch(a){default:break;case xe.FLOAT:s=er.FLOAT;break;case xe.INTEGER:s=er.INTEGER;break;case xe.BOOLEAN:s=er.BOOLEAN;break;case xe.VEC3_experimental:s=er.VEC3;break;case xe.QUAT_experimental:s=er.QUAT}void 0!==s&&n.push({arg:{name:o,type:s},menu:o})}}return n},create:function(t){var e;switch(t.type){default:throw new Error("Bad create node arg: "+er[t.type]);case er.FLOAT:e=new tv;break;case er.INTEGER:e=new ev;break;case er.BOOLEAN:e=new nv;break;case er.VEC3:e=new rv;break;case er.QUAT:e=new iv}return e.variableName=t.name,e}},$d=P(tt+"PVNodeGetVariableBase")(Wd=cr(Kd)((zd=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).variableName=jd&&jd(),e._varInstance=void 0,e}return e(n,t),n.prototype.link=function(t){this._varInstance=t.getVar(this.variableName)},n}(si),jd=O(zd.prototype,"variableName",[I],(function(){return""})),Wd=zd))||Wd)||Wd,tv=P(tt+"PVNodeGetVariableFloat")(Hd=hr()(Hd=fr({inline:!0,themeColor:"#8471CF"})(Hd=function(t){function n(){return t.call(this,er.FLOAT)||this}return e(n,t),n.prototype.selfEvaluateDefaultOutput=function(){var t;return null==(t=this._varInstance)?void 0:t.value},n}($d))||Hd)||Hd)||Hd,ev=P(tt+"PVNodeGetVariableInteger")(Qd=hr()(Qd=fr({inline:!0,themeColor:"#2A90DC"})(Qd=function(t){function n(){return t.call(this,er.INTEGER)||this}return e(n,t),n.prototype.selfEvaluateDefaultOutput=function(){var t;return null==(t=this._varInstance)?void 0:t.value},n}($d))||Qd)||Qd)||Qd,nv=P(tt+"PVNodeGetVariableBoolean")(Yd=hr()(Yd=fr({inline:!0,themeColor:"#D07979"})(Yd=function(t){function n(){return t.call(this,er.BOOLEAN)||this}return e(n,t),n.prototype.selfEvaluateDefaultOutput=function(){var t;return null==(t=this._varInstance)?void 0:t.value},n}($d))||Yd)||Yd)||Yd,rv=P(tt+"PVNodeGetVariableVec3")(qd=hr()(qd=fr({inline:!0,themeColor:"#D97721"})(qd=function(t){function n(){return t.call(this,er.VEC3)||this}return e(n,t),n.prototype.selfEvaluateDefaultOutput=function(){var t;return null==(t=this._varInstance)?void 0:t.value},n}($d))||qd)||qd)||qd,iv=P(tt+"PVNodeGetVariableQuat")(Zd=hr()(Zd=fr({inline:!0,themeColor:"#B169C4"})(Zd=function(t){function n(){return t.call(this,er.QUAT)||this}return e(n,t),n.prototype.selfEvaluateDefaultOutput=function(){var t;return null==(t=this._varInstance)?void 0:t.value},n}($d))||Zd)||Zd)||Zd,ov=function(){function t(){this._groups=[]}var e=t.prototype;return e.register=function(t){var e=t.group,n=this._groups.find((function(t){return t.name===e}));return n||(n=new av(e),this._groups.push(n)),n.addMember()},e.sync=function(){for(var t,e=u(this._groups);!(t=e()).done;)t.value.sync()},t}(),av=function(){function t(t){this._lastLeader=void 0,this._records=[],this.name=t}var e=t.prototype;return e.addMember=function(){var t=new sv;return this._records.push(t),t},e.sync=function(){var t=this._records,e=t.length;c(e>0);var n=this._lastLeader;if(this._lastLeader=void 0,!t.every((function(t){return!t.active}))){t.sort((function(t,e){var n=t.active?t.weight:-1;return(e.active?e.weight:-1)-n}));var r=t.findIndex((function(t){return!t.active}));c((r<0?[]:t.slice(r)).every((function(t){return!t.active})));var i=0,o=t[0].weight;if(t[i]!==n)for(var a=0;a<e;++a){var s=t[a];if(!s.active||!j(s.weight,o,1e-6))break;if(s===n){i=a;break}}c(t[i].active),this._lastLeader=t[i];for(var u=t[i].normalizedTime,l=0;l<e;++l){var h=t[l];if(!h.active)break;h.normalizedTime=u,h.reset()}}},t}(),sv=function(){function t(){this.normalizedTime=0,this.weight=0,this.active=!1}var e=t.prototype;return e.notifyRenter=function(t){this.reset(),this.normalizedTime=t},e.notifyUpdate=function(t,e){this.normalizedTime+=t,this.active?this.weight+=e:(this.active=!0,this.weight=e)},e.reset=function(){this.active=!1,this.weight=0},e.getSyncedEnterTime=function(){return this.normalizedTime},t}();!function(t){t[t.UNINITIALIZED=0]="UNINITIALIZED",t[t.UNSETTLED=1]="UNSETTLED",t[t.SETTLED=2]="SETTLED",t[t.UP_TO_DATE=3]="UP_TO_DATE",t[t.OUTDATED=4]="OUTDATED",t[t.UPDATING=5]="UPDATING",t[t.UPDATED=6]="UPDATED",t[t.EVALUATING=7]="EVALUATING",t[t.EVALUATED=8]="EVALUATED"}(Xd||(Xd={}));var uv,lv,cv,hv,fv,pv,dv=function(){function t(t){this._state=Xd.UNINITIALIZED,this._instantiatedPoseGraph=void 0,this._maxRequestedUpdateTime=0,this._evaluationCache=null,this._updateContextGenerator=new Sc,this._allocator=t}var e=t.prototype;return e.set=function(t,e){c(this._state===Xd.UNINITIALIZED,"The stash has already been set.");var n=Lc(t.graph,e);n.bind(e),this._instantiatedPoseGraph=n,this._state=Xd.UNSETTLED},e.settle=function(t){c(this._state===Xd.UNSETTLED||this._state===Xd.SETTLED),c(this._instantiatedPoseGraph),this._instantiatedPoseGraph.settle(t),this._state=Xd.SETTLED},e.reset=function(){switch(this._state){case Xd.SETTLED:case Xd.OUTDATED:break;case Xd.UP_TO_DATE:this._state=Xd.OUTDATED;break;case Xd.UPDATED:case Xd.EVALUATED:this._evaluationCache&&(this._allocator.destroyPose(this._evaluationCache),this._evaluationCache=null),this._maxRequestedUpdateTime=0,this._state=Xd.UP_TO_DATE;break;case Xd.UNINITIALIZED:default:c(!1,"Unexpected stash state")}},e.reenter=function(){switch(this._state){default:c(!1,"Unexpected stash state "+this._state+" when reenter().");break;case Xd.UP_TO_DATE:case Xd.UPDATED:break;case Xd.SETTLED:case Xd.OUTDATED:this._state=Xd.UP_TO_DATE,c(this._instantiatedPoseGraph),this._instantiatedPoseGraph.reenter()}},e.requestUpdate=function(t){var e=t.deltaTime;if(c(this._state===Xd.OUTDATED||this._state===Xd.UP_TO_DATE||this._state===Xd.UPDATING||this._state===Xd.UPDATED),c(this._instantiatedPoseGraph),this._state!==Xd.UPDATING){var n=Math.max(0,e-this._maxRequestedUpdateTime);if(this._state===Xd.UPDATED)return j(n,0,1e-8)?void 0:void d("Arrived here indicates a violent of PR #14990. Please report the BUG.");this._state=Xd.UPDATING,this._maxRequestedUpdateTime=Math.max(e,this._maxRequestedUpdateTime);var r=this._updateContextGenerator.generate(n,t.indicativeWeight);this._instantiatedPoseGraph.update(r),this._state=Xd.UPDATED}},e.evaluate=function(t){switch(this._state){default:c(!1,"Unexpected stash state "+this._state+" when evaluate().");break;case Xd.EVALUATING:this._state=Xd.EVALUATED;break;case Xd.EVALUATED:break;case Xd.UPDATED:var e;c(!this._evaluationCache),this._state=Xd.EVALUATING;var n=null==(e=this._instantiatedPoseGraph)?void 0:e.evaluate(t);if(this._state=Xd.EVALUATED,n){var r=this._allocator.allocatePose();r.transforms.set(n.transforms),r.auxiliaryCurves.set(n.auxiliaryCurves),this._evaluationCache=r,t.popPose()}this._state=Xd.EVALUATED}return c(this._state===Xd.EVALUATED),c(this._instantiatedPoseGraph),this._evaluationCache?t.pushDuplicatedPose(this._evaluationCache):null},t}(),vv=function(){function t(t){this._allocator=void 0,this._stashEvaluations={},this._allocator=t}var e=t.prototype;return e.bindStash=function(t){return this._stashEvaluations[t]},e.getStash=function(t){return this._stashEvaluations[t]},e.addStash=function(t){this._stashEvaluations[t]=new dv(this._allocator)},e.setStash=function(t,e,n){c(t in this._stashEvaluations),this._stashEvaluations[t].set(e,n)},e.reset=function(){for(var t in this._stashEvaluations)this._stashEvaluations[t].reset()},e.settle=function(t){for(var e in this._stashEvaluations)this._stashEvaluations[e].settle(t)},t}(),_v=function(t){function r(e,n,r){var i;(i=t.call(this)||this)._layerRecords=void 0;var o=e.layers.map((function(t){return new yv(t,n,r)}));return i._layerRecords=o,i}e(r,t);var i=r.prototype;return i.reenter=function(){},i.bind=function(){},i.settle=function(t){for(var e=this._layerRecords,n=e.length,r=0;r<n;++r)e[r].settle(t)},i.getLayerWeight=function(t){return c(t>=0&&t<this._layerRecords.length,"Invalid layer index"),this._layerRecords[t].weight},i.setLayerWeight=function(t,e){c(t>=0&&t<this._layerRecords.length,"Invalid layer index"),this._layerRecords[t].weight=e},i.getLayerTopLevelStateMachineEvaluation=function(t){return this._layerRecords[t].stateMachineEvaluation},i.overrideClips=function(t){for(var e=this._layerRecords,n=e.length,r=0;r<n;++r){var i=e[r];t._pushAdditiveFlag(i.additive),i.stateMachineEvaluation.overrideClips(t),t._popAdditiveFlag()}},i.doUpdate=function(t){for(var e=this._layerRecords,n=e.length,r=0;r<n;++r)e[r].update(t)},i.doEvaluate=function(t){for(var e=t.pushDefaultedPose(),n=this._layerRecords,r=n.length,i=0;i<r;++i){var o=n[i],a=o.stateMachineEvaluation.evaluate(t),s=o.weight*o.stateMachineEvaluation.passthroughWeight,u=o.transformFilter;o.additive?Yr(e,a,s,u):Br(e,a,s,u),t.popPose(),o.postEvaluate()}return e},n(r,[{key:"layerCount",get:function(){return this._layerRecords.length}}]),r}(oi),yv=function(){function t(t,e,n){var r;this.additive=!1,this.weight=0,this._topLevelStateMachineEval=void 0,this._stashManager=void 0,this._motionSyncManager=void 0,this._mask=void 0,this.transformFilter=void 0;for(var i,o=new vv(n),a=u(t.stashes());!(i=a()).done;){var s=i.value,l=s[0];s[1],o.addStash(l)}this._stashManager=o;var c=new ov;this._motionSyncManager=c,e._setLayerWideContextProperties(o,c);for(var h,f=u(t.stashes());!(h=f()).done;){var p=h.value,d=p[0],v=p[1];o.setStash(d,v,e)}this.weight=t.weight;var _=this.additive=t.additive;this._mask=null!==(r=t.mask)&&void 0!==r?r:void 0,e._pushAdditiveFlag(_),this._topLevelStateMachineEval=new zc(t.stateMachine,t.name,e),e._popAdditiveFlag(),e._unsetLayerWideContextProperties()}var e=t.prototype;return e.settle=function(t){this._mask&&(this.transformFilter=t.createTransformFilter(this._mask)),this._stashManager.settle(t),this._topLevelStateMachineEval.settle(t)},e.update=function(t){this.stateMachineEvaluation.update(t),this._motionSyncManager.sync()},e.postEvaluate=function(){this._stashManager.reset()},n(t,[{key:"stateMachineEvaluation",get:function(){return this._topLevelStateMachineEval}}]),t}(),gv=function(){function t(t,e,n,r){if(this._currentTransitionCache={duration:0,time:0},this._rootPoseNode=void 0,this._varInstances={},this._hasAutoTrigger=!1,this._auxiliaryCurveRegistry=new Jl,this._poseLayoutMaintainer=void 0,this._bindingContext=void 0,this._settleContext=void 0,this._rootUpdateContextGenerator=new Sc,t.layers.length>=32)throw new Error("Max layer count exceeds. Allowed: 32, actual: "+t.layers.length);for(var i,o=u(t.variables);!(i=o()).done;){var a=i.value,s=a[0],l=a[1][Ye]();this._varInstances[s]=l,l instanceof on&&l.resetMode===Qe.NEXT_FRAME_OR_AFTER_CONSUMED&&(this._hasAutoTrigger=!0)}var c=new $l(e,this._auxiliaryCurveRegistry);this._poseLayoutMaintainer=c;var h=new Zl(e,c,this._varInstances,n);h._setClipOverrides(null!=r?r:void 0),this._bindingContext=h;var f=new mc(c);this._settleContext=f,c.startBind();var p=new wc;this._poseStashAllocator=p,this._rootPoseNode=new _v(t,h,p),this._root=e,this._initializeContexts()}var e=t.prototype;return e.destroy=function(){this._evaluationContext.destroy()},e._destroyAfterException_debugging=function(){var t=this._evaluationContext._stackSize_debugging;if(0!==t)for(var e=0;e<t;++e)this._evaluationContext.popPose();this._evaluationContext.destroy()},e.update=function(t){var e=this._evaluationContext,n=this._poseLayoutMaintainer,r=this._rootUpdateContextGenerator,i=this._rootPoseNode,o=r.generate(t,1);i.update(o);var a=i.evaluate(e,Zr.LOCAL);if(this._hasAutoTrigger){var s=this._varInstances;for(var u in s){var l=s[u];l instanceof on&&l.resetMode===Qe.NEXT_FRAME_OR_AFTER_CONSUMED&&(l.value=!1)}}n.apply(a),e.popPose(),c(0===e.allocatedPoseCount,"Pose leaked."),c(0===this._poseStashAllocator.allocatedPoseCount,"Pose leaked.")},e.getVariables=function(){return Object.entries(this._varInstances)},e.getCurrentStateStatus=function(t){return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getCurrentStateStatus()},e.getCurrentClipStatuses=function(t){return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getCurrentClipStatuses()},e.getCurrentTransition=function(t){var e=this._currentTransitionCache;return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getCurrentTransition(e)?e:null},e.getNextStateStatus=function(t){return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getNextStateStatus()},e.getNextClipStatuses=function(t){return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getNextClipStatuses()},e.getValue=function(t){var e=this._varInstances[t];return e?e.value:void 0},e.setValue=function(t,e){var n=this._varInstances[t];n&&(n.value=e)},e.getLayerWeight=function(t){return this._rootPoseNode.getLayerWeight(t)},e.setLayerWeight=function(t,e){this._rootPoseNode.setLayerWeight(t,e)},e.overrideClips=function(t){this._poseLayoutMaintainer.startBind(),this._bindingContext._setClipOverrides(t),this._rootPoseNode.overrideClips(this._bindingContext),this._updateAfterPossiblePoseLayoutChange()},e.getAuxiliaryCurveValue=function(t){return this._auxiliaryCurveRegistry.get(t)},e._initializeContexts=function(){var t=this._poseLayoutMaintainer;t.endBind(),this._createOrUpdateTransformFilters();var e=t.createEvaluationContext();this._evaluationContext=e,t.fetchDefaultTransforms(e[gc]),t.resetPoseStashAllocator(this._poseStashAllocator)},e._updateAfterPossiblePoseLayoutChange=function(){var t=this._poseLayoutMaintainer,e=t.endBind();if(0!==e){(e&ql.TRANSFORM_COUNT||e&ql.TRANSFORM_ORDER)&&this._createOrUpdateTransformFilters();var n=!1;if(e&ql.TRANSFORM_COUNT||e&ql.AUXILIARY_CURVE_COUNT){var r=t.createEvaluationContext();this._evaluationContext.destroy(),this._evaluationContext=r,n=!0,t.resetPoseStashAllocator(this._poseStashAllocator)}(n||e&ql.TRANSFORM_COUNT||e&ql.TRANSFORM_ORDER)&&t.fetchDefaultTransforms(this._evaluationContext[gc])}},e._createOrUpdateTransformFilters=function(){this._rootPoseNode.settle(this._settleContext)},n(t,[{key:"layerCount",get:function(){return this._rootPoseNode.layerCount}}]),t}(),mv=W,Ev=I,Tv=Z,Av=(uv=P("cc.animation.AnimationController"),lv=mv(Wn),cv=Tv("graph"),uv((fv=function(t){function r(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this)._graph=pv&&pv(),e._graphEval=null,e}e(r,t);var o=r.prototype;return o.__preload=function(){var t=this.graph;if(t){var e,n=null;if(t instanceof _u){if(!t.original)return;e=t.original,n=t.clipOverrides}else c(t instanceof Mo),e=t;var r=new gv(e,this.node,this,n);this._graphEval=r}},o.onDestroy=function(){var t;null==(t=this._graphEval)||t.destroy()},o.update=function(t){var e;null==(e=this._graphEval)||e.update(t)},o.getVariables=function(){var t=this._graphEval;return T(t),t.getVariables()},o.setValue=function(t,e){return this.setValue_experimental(t,e)},o.setValue_experimental=function(t,e){var n=this._graphEval;T(n),n.setValue(t,e)},o.getValue=function(t){var e=this.getValue_experimental(t);return"object"==typeof e?void i('Obtaining variable "'+t+'" is not of primitive type, which is currently supported experimentally and should be explicitly obtained through this.getValue_experimental()'):e},o.getValue_experimental=function(t){var e=this._graphEval;return T(e),e.getValue(t)},o.getCurrentStateStatus=function(t){var e=this._graphEval;return T(e),e.getCurrentStateStatus(t)},o.getCurrentClipStatuses=function(t){var e=this._graphEval;return T(e),e.getCurrentClipStatuses(t)},o.getCurrentTransition=function(t){var e=this._graphEval;return T(e),e.getCurrentTransition(t)},o.getNextStateStatus=function(t){var e=this._graphEval;return T(e),e.getNextStateStatus(t)},o.getNextClipStatuses=function(t){var e=this._graphEval;return T(e),e.getNextClipStatuses(t)},o.getLayerWeight=function(t){var e=this._graphEval;return T(e),e.getLayerWeight(t)},o.setLayerWeight=function(t,e){var n=this._graphEval;return T(n),n.setLayerWeight(t,e)},o.overrideClips_experimental=function(t){var e=this._graphEval;T(e),e.overrideClips(t)},o.getAuxiliaryCurveValue_experimental=function(t){var e=this._graphEval;return e?e.getAuxiliaryCurveValue(t):0},n(r,[{key:"graph",get:function(){return this._graph},set:function(t){this._graph=t}},{key:"layerCount",get:function(){var t,e;return null!==(t=null==(e=this._graphEval)?void 0:e.layerCount)&&void 0!==t?t:0}}]),r}(Ft),s(fv.prototype,"graph",[lv],Object.getOwnPropertyDescriptor(fv.prototype,"graph"),fv.prototype),pv=O(fv.prototype,"_graph",[Ev,cv],(function(){return null})),hv=fv))||hv);t("animation",Object.freeze({__proto__:null,AnimationController:Av,ColorTrack:dt,ComponentPath:vt,CubicSplineNumberValue:_t,CubicSplineQuatValue:yt,CubicSplineVec2Value:gt,CubicSplineVec3Value:mt,CubicSplineVec4Value:Et,HierarchyPath:Tt,MorphWeightValueProxy:ke,MorphWeightsAllValueProxy:Le,MorphWeightsValueProxy:Re,ObjectTrack:At,QuatTrack:bt,RealTrack:Ct,SizeTrack:St,StateMachineComponent:fl,Track:it,TrackPath:wt,UniformProxyFactory:Ne,get VariableType(){return xe},VectorTrack:Pt,isCustomPath:Ot,isPropertyPath:Nt}));var bv,Cv=function(){function t(){this._nodeBlendStates=new Map}var e=t.prototype;return e.createWriter=function(t,e,n,r){var i=this.ref(t,e);return new Sv(t,e,i,n,r)},e.destroyWriter=function(t){var e=t;this.deRef(e.node,e.property)},e.ref=function(t,e){var n=this._nodeBlendStates.get(t);return n||(n=this.createNodeBlendState(),this._nodeBlendStates.set(t,n)),n.refProperty(t,e)},e.deRef=function(t,e){var n=this._nodeBlendStates.get(t);n&&(n.deRefProperty(e),n.empty&&this._nodeBlendStates.delete(t))},e.apply=function(){this._nodeBlendStates.forEach((function(t,e){t.apply(e)}))},t}(),Sv=function(){function t(t,e,n,r,i){this._node=t,this._property=e,this._propertyBlendState=n,this._host=r,this._constants=i}var e=t.prototype;return e.getValue=function(){return this._node[this._property]},e.setValue=function(t){var e=this._propertyBlendState,n=this._host.weight;e.blend(t,n)},n(t,[{key:"node",get:function(){return this._node}},{key:"property",get:function(){return this._property}}]),t}();!function(t){t[t.POSITION=1]="POSITION",t[t.ROTATION=2]="ROTATION",t[t.SCALE=4]="SCALE",t[t.EULER_ANGLES=8]="EULER_ANGLES"}(bv||(bv={})),bv.POSITION,bv.ROTATION,bv.SCALE,bv.EULER_ANGLES;var wv,Pv,Ov=function(){function t(){this.refCount=0,this.accumulatedWeight=0,this.result=new R}var e=t.prototype;return e.blend=function(t,e){this.accumulatedWeight=kv(this.result,this.result,this.accumulatedWeight,t,e)},e.reset=function(){this.accumulatedWeight=0,R.zero(this.result)},t}(),Nv=function(){function t(){this.refCount=0,this.accumulatedWeight=0,this.result=new L}var e=t.prototype;return e.blend=function(t,e){this.accumulatedWeight=Rv(this.result,this.result,this.accumulatedWeight,t,e)},e.reset=function(){this.accumulatedWeight=0,L.identity(this.result)},t}(),Iv=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var r=n.prototype;return r.apply=function(e){var n=this._properties,r=n.position,i=n.scale,o=n.rotation,a=n.eulerAngles;r&&r.accumulatedWeight&&(this._transformApplyFlags|=bv.POSITION,r.accumulatedWeight<1&&r.blend(e.position,1-r.accumulatedWeight)),i&&i.accumulatedWeight&&(this._transformApplyFlags|=bv.SCALE,i.accumulatedWeight<1&&i.blend(e.scale,1-i.accumulatedWeight)),a&&a.accumulatedWeight&&(this._transformApplyFlags|=bv.EULER_ANGLES,a.accumulatedWeight<1&&a.blend(e.eulerAngles,1-a.accumulatedWeight)),o&&o.accumulatedWeight&&(this._transformApplyFlags|=bv.ROTATION,o.accumulatedWeight<1&&o.blend(e.rotation,1-o.accumulatedWeight)),t.prototype.apply.call(this,e),null==r||r.reset(),null==i||i.reset(),null==o||o.reset(),null==a||a.reset()},r._createVec3BlendState=function(){return new Ov},r._createQuatBlendState=function(){return new Nv},n}(function(){function t(){this._transformApplyFlags=0,this._properties={}}var e=t.prototype;return e.refProperty=function(t,e){var n,r,i,o=this._properties;switch(e){default:case"position":case"scale":case"eulerAngles":i=null!==(n=o[e])&&void 0!==n?n:o[e]=this._createVec3BlendState(t[e]);break;case"rotation":i=null!==(r=o[e])&&void 0!==r?r:o[e]=this._createQuatBlendState(t.rotation)}return++i.refCount,i},e.deRefProperty=function(t){var e=this._properties,n=e[t];n&&(--n.refCount,n.refCount>0||delete e[t])},e.apply=function(t){var e,n,r,i=this._transformApplyFlags,o=this._properties,a=o.position,s=o.scale,u=o.rotation,l=o.eulerAngles;i&&(a&&i&bv.POSITION&&(e=a.result),s&&i&bv.SCALE&&(n=s.result),l&&i&bv.EULER_ANGLES&&(r=l.result),u&&i&bv.ROTATION&&(r=u.result),(r||e||n)&&t.setRTS(r,e,n),this._transformApplyFlags=0)},n(t,[{key:"empty",get:function(){var t=this._properties;return!(t.position||t.rotation||t.eulerAngles||t.scale)}}]),t}()),xv=function(t){function n(){return t.apply(this,arguments)||this}return e(n,t),n.prototype.createNodeBlendState=function(){return new Iv},n}(Cv);function kv(t,e,n,r,i){var o=n+i;if(1!==i||n){if(o){var a=i/o;R.lerp(t,t,r,a)}}else R.copy(t,r);return o}function Rv(t,e,n,r,i){var o=n+i;if(1!==i||n){if(o){var a=i/o;L.slerp(t,e,r,a)}}else L.copy(t,r);return o}var Lv=t("AnimationManager",P((Pv=function(t){function i(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this)._anims=new w([]),e._crossFades=new w([]),e._delayEvents=[],e._blendStateBuffer=new xv,e._sockets=[],e}e(i,t);var o=i.prototype;return o.addCrossFade=function(t){-1===this._crossFades.array.indexOf(t)&&this._crossFades.push(t)},o.removeCrossFade=function(t){var e=this._crossFades.array.indexOf(t);e>=0?this._crossFades.fastRemoveAt(e):r(3907)},o.update=function(t){var e=this._delayEvents,n=this._crossFades,r=this._sockets,i=n.array;for(n.i=0;n.i<i.length;++n.i)i[n.i].update(t);var o=this._anims,a=o.array;for(o.i=0;o.i<a.length;++o.i){var s=a[o.i];s.isMotionless||s.update(t)}this._blendStateBuffer.apply();for(var u=Yt.getTotalFrames(),l=0,c=r.length;l<c;l++){var h=r[l],f=h.target,p=h.transform;f.matrix=Zt(p,u)}for(var d=0,v=e.length;d<v;d++){var _=e[d];_.fn.apply(_.thisArg,_.args)}e.length=0},o.destruct=function(){},o.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)},o.removeAnimation=function(t){var e=this._anims.array.indexOf(t);e>=0?this._anims.fastRemoveAt(e):r(3907)},o.pushDelayEvent=function(t,e,n){this._delayEvents.push({fn:t,thisArg:e,args:n})},o.addSockets=function(t,e){for(var n=this,r=function(){var r=e[i];if(n._sockets.find((function(t){return t.target===r.target})))return 1;var o=t.getChildByPath(r.path),a=r.target&&o&&Jt(o,t);a&&n._sockets.push({target:r.target,transform:a})},i=0;i<e.length;++i)r()},o.removeSockets=function(t,e){for(var n=0;n<e.length;++n)for(var r=e[n],i=0;i<this._sockets.length;++i){var o=this._sockets[i];if(o.target===r.target){Xt(o.transform.node),this._sockets[i]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},n(i,[{key:"blendState",get:function(){return this._blendStateBuffer}},{key:"animationStates",get:function(){return this._anims.array}}]),i}(J),Pv.ID="animation",wv=Pv))||wv);Yt.on(qt.INIT,(function(){var t=new Lv;Yt.registerSystem(Lv.ID,t,X.HIGH)})),$.AnimationManager=Lv}}}));
//# sourceMappingURL=animation.js.map
