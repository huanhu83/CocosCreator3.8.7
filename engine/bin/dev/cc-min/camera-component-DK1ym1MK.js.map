{"version":3,"file":"camera-component-DK1ym1MK.js","sources":["../../../cocos/misc/camera-component.ts","../../../cocos/rendering/post-process/components/post-process.ts"],"sourcesContent":["/*\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { EDITOR_NOT_IN_PREVIEW } from 'internal:constants';\r\nimport { ccclass, help, executeInEditMode, menu, tooltip, displayOrder, type, serializable, visible, range, rangeMin } from 'cc.decorator';\r\nimport { RenderTexture } from '../asset/assets/render-texture';\r\nimport { UITransform } from '../2d/framework';\r\nimport { Component } from '../scene-graph';\r\nimport { Color, Rect, toRadian, Vec3, cclegacy, geometry, Enum } from '../core';\r\nimport { CAMERA_DEFAULT_MASK } from '../rendering/define';\r\nimport { scene } from '../render-scene';\r\nimport { SkyBoxFlagValue, CameraProjection, CameraFOVAxis, CameraAperture, CameraISO, CameraShutter,\r\n    CameraType, TrackingType } from '../render-scene/scene/camera';\r\nimport { Node } from '../scene-graph/node';\r\nimport { Layers } from '../scene-graph/layers';\r\nimport { TransformBit } from '../scene-graph/node-enum';\r\nimport { RenderWindow } from '../render-scene/core/render-window';\r\nimport { ClearFlagBit } from '../gfx';\r\nimport { PostProcess } from '../rendering/post-process/components/post-process';\r\nimport { property } from '../core/data/class-decorator';\r\nimport type { Ray } from '../core/geometry';\r\nimport type { View } from '../ui/view';\r\nimport type { Root } from '../root';\r\n\r\nconst _temp_vec3_1 = new Vec3();\r\n\r\nconst ProjectionType = Enum(CameraProjection);\r\nconst FOVAxis = Enum(CameraFOVAxis);\r\nconst Aperture = Enum(CameraAperture);\r\nconst Shutter = Enum(CameraShutter);\r\nconst ISO = Enum(CameraISO);\r\n\r\n/**\r\n * @en Clear screen flag enumeration of the camera.\r\n * @zh 相机的清屏标记枚举。\r\n */\r\nexport const ClearFlag = Enum({\r\n    /**\r\n     * @en Clear the screen with [[SceneGlobals.skybox]], will clear the depth and stencil buffer at the same time.\r\n     * @zh 使用指定天空盒 [[SceneGlobals.skybox]] 清屏，会同时清理深度和蒙版缓冲。\r\n     */\r\n    SKYBOX: SkyBoxFlagValue.VALUE | ClearFlagBit.DEPTH_STENCIL,\r\n    /**\r\n     * @en Clear the screen with the given [[Camera.clearColor]], will clear the depth and stencil buffer at the same time.\r\n     * @zh 使用指定的相机清屏颜色 [[Camera.clearColor]] 来清屏，会同时清理将深度和蒙版缓冲。\r\n     */\r\n    SOLID_COLOR: ClearFlagBit.ALL,\r\n    /**\r\n     * @en Only clear the depth and stencil buffer while keeping the color buffer intact. Often used in UI camera.\r\n     * @zh 只清理深度和蒙版缓冲，同时保留颜色缓冲不变。常用于 UI 相机。\r\n     */\r\n    DEPTH_ONLY: ClearFlagBit.DEPTH_STENCIL,\r\n    /**\r\n     * @en Don't clear anything and continue rendering.\r\n     * @zh 不清理任何内容就开始渲染，适合多 Camera 叠加渲染。\r\n     */\r\n    DONT_CLEAR: ClearFlagBit.NONE,\r\n});\r\n\r\n/**\r\n * @internal\r\n */\r\nexport declare namespace Camera {\r\n    export type ProjectionType = EnumAlias<typeof ProjectionType>;\r\n    export type FOVAxis = EnumAlias<typeof FOVAxis>;\r\n    export type ClearFlag = EnumAlias<typeof ClearFlag>;\r\n    export type Aperture = EnumAlias<typeof Aperture>;\r\n    export type Shutter = EnumAlias<typeof Shutter>;\r\n    export type ISO = EnumAlias<typeof ISO>;\r\n}\r\n\r\nexport enum CameraEvent {\r\n    TARGET_TEXTURE_CHANGE = 'tex-change',\r\n}\r\n\r\n/**\r\n * @en The Camera Component.\r\n * @zh 相机组件。\r\n */\r\n@ccclass('cc.Camera')\r\n@help('i18n:cc.Camera')\r\n@menu('Rendering/Camera')\r\n@executeInEditMode\r\nexport class Camera extends Component {\r\n    /**\r\n     * @en The projection type enumeration of the camera.\r\n     * @zh 相机的投影类型枚举。\r\n     */\r\n    public static ProjectionType = ProjectionType;\r\n    /**\r\n     * @en The axis type of the fov\r\n     * @zh FOV 的轴向枚举\r\n     */\r\n    public static FOVAxis = FOVAxis;\r\n    /**\r\n     * @en The clear flag enumeration of the camera.\r\n     * @zh 相机的清除标志位枚举。\r\n     */\r\n    public static ClearFlag = ClearFlag;\r\n    /**\r\n     * @en The aperture value's enumeration of the camera.\r\n     * @zh 相机的光圈值枚举。\r\n     */\r\n    public static Aperture = Aperture;\r\n    /**\r\n     * @en The shutter value's enumeration of the camera.\r\n     * @zh 相机的快门值枚举。\r\n     */\r\n    public static Shutter = Shutter;\r\n    /**\r\n     * @en The ISO value's enumeration of the camera.\r\n     * @zh 相机的感光度值枚举。\r\n     */\r\n    public static ISO = ISO;\r\n    /**\r\n     * @en The event for target texture changing.\r\n     * @zh 目标贴图修改的事件。\r\n     */\r\n    public static TARGET_TEXTURE_CHANGE = CameraEvent.TARGET_TEXTURE_CHANGE;\r\n\r\n    @serializable\r\n    protected _projection = ProjectionType.PERSPECTIVE;\r\n    @serializable\r\n    protected _priority = 0;\r\n    @serializable\r\n    protected _fov = 45;\r\n    @serializable\r\n    protected _fovAxis = FOVAxis.VERTICAL;\r\n    @serializable\r\n    protected _orthoHeight = 10;\r\n    @serializable\r\n    protected _near = 1;\r\n    @serializable\r\n    protected _far = 1000;\r\n    @serializable\r\n    protected _color = new Color('#333333');\r\n    @serializable\r\n    protected _depth = 1;\r\n    @serializable\r\n    protected _stencil = 0;\r\n    @serializable\r\n    protected _clearFlags = ClearFlag.SOLID_COLOR;\r\n    @serializable\r\n    protected _rect = new Rect(0, 0, 1, 1);\r\n    @serializable\r\n    protected _aperture = Aperture.F16_0;\r\n    @serializable\r\n    protected _shutter = Shutter.D125;\r\n    @serializable\r\n    protected _iso = ISO.ISO100;\r\n    @serializable\r\n    protected _screenScale = 1;\r\n    @serializable\r\n    protected _visibility = CAMERA_DEFAULT_MASK;\r\n    @serializable\r\n    protected _targetTexture: RenderTexture | null = null;\r\n    @serializable\r\n    protected _postProcess: PostProcess | null = null;\r\n    @serializable\r\n    protected _usePostProcess = false;\r\n\r\n    protected _camera: scene.Camera | null = null;\r\n    protected _inEditorMode = false;\r\n    protected _flows: string[] | undefined = undefined;\r\n    @serializable\r\n    protected _cameraType: CameraType = CameraType.DEFAULT;\r\n    @serializable\r\n    protected _trackingType: TrackingType = TrackingType.NO_TRACKING;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * @en The render camera representation.\r\n     * @zh 渲染场景中的相机对象。\r\n     */\r\n    get camera (): scene.Camera {\r\n        return this._camera!;\r\n    }\r\n\r\n    /**\r\n     * @en Render priority of the camera. Cameras with higher depth are rendered after cameras with lower depth.\r\n     * @zh 相机的渲染优先级，值越小越优先渲染。\r\n     */\r\n    @displayOrder(0)\r\n    @range([0, 65535, 1])\r\n    @tooltip('i18n:camera.priority')\r\n    get priority (): number {\r\n        return this._priority;\r\n    }\r\n\r\n    set priority (val) {\r\n        this._priority = val;\r\n        if (this._camera) {\r\n            this._camera.priority = val;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en Visibility mask, declaring a set of node layers that will be visible to this camera.\r\n     * @zh 可见性掩码，声明在当前相机中可见的节点层级集合。\r\n     */\r\n    @type(Layers.BitMask)\r\n    @displayOrder(1)\r\n    @tooltip('i18n:camera.visibility')\r\n    get visibility (): number {\r\n        return this._visibility;\r\n    }\r\n\r\n    set visibility (val) {\r\n        this._visibility = val;\r\n        if (this._camera) {\r\n            this._camera.visibility = val;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en Clearing flags of the camera, specifies which part of the framebuffer will be actually cleared every frame.\r\n     * @zh 相机的缓冲清除标志位，指定帧缓冲的哪部分要每帧清除。\r\n     */\r\n    @type(ClearFlag)\r\n    @displayOrder(2)\r\n    @tooltip('i18n:camera.clear_flags')\r\n    get clearFlags (): ClearFlagBit {\r\n        return this._clearFlags;\r\n    }\r\n\r\n    set clearFlags (val) {\r\n        this._clearFlags = val;\r\n        if (this._camera) { this._camera.clearFlag = val; }\r\n    }\r\n\r\n    /**\r\n     * @en Clearing color of the camera.\r\n     * @zh 相机的颜色缓冲默认值。\r\n     */\r\n    @displayOrder(3)\r\n    @tooltip('i18n:camera.color')\r\n    // @constget\r\n    get clearColor (): Readonly<Color> {\r\n        return this._color;\r\n    }\r\n\r\n    set clearColor (val) {\r\n        this._color.set(val);\r\n        if (this._camera) {\r\n            this._camera.clearColor = this._color;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en Clearing depth of the camera.\r\n     * @zh 相机的深度缓冲默认值。\r\n     */\r\n    @displayOrder(4)\r\n    @tooltip('i18n:camera.depth')\r\n    get clearDepth (): number {\r\n        return this._depth;\r\n    }\r\n\r\n    set clearDepth (val) {\r\n        this._depth = val;\r\n        if (this._camera) { this._camera.clearDepth = val; }\r\n    }\r\n\r\n    /**\r\n     * @en Clearing stencil of the camera.\r\n     * @zh 相机的模板缓冲默认值。\r\n     */\r\n    @displayOrder(5)\r\n    @tooltip('i18n:camera.stencil')\r\n    get clearStencil (): number {\r\n        return this._stencil;\r\n    }\r\n\r\n    set clearStencil (val) {\r\n        this._stencil = val;\r\n        if (this._camera) { this._camera.clearStencil = val; }\r\n    }\r\n\r\n    /**\r\n     * @en Projection type of the camera.\r\n     * @zh 相机的投影类型。\r\n     */\r\n    @type(ProjectionType)\r\n    @displayOrder(6)\r\n    @tooltip('i18n:camera.projection')\r\n    get projection (): CameraProjection {\r\n        return this._projection;\r\n    }\r\n\r\n    set projection (val) {\r\n        this._projection = val;\r\n        if (this._camera) { this._camera.projectionType = val; }\r\n    }\r\n\r\n    /**\r\n     * @en The axis on which the FOV would be fixed regardless of screen aspect changes.\r\n     * @zh 指定视角的固定轴向，在此轴上不会跟随屏幕长宽比例变化。\r\n     */\r\n    @type(FOVAxis)\r\n    @displayOrder(7)\r\n    @visible(function visible (this: Camera): boolean {\r\n        return this._projection === ProjectionType.PERSPECTIVE;\r\n    })\r\n    @tooltip('i18n:camera.fov_axis')\r\n    get fovAxis (): CameraFOVAxis {\r\n        return this._fovAxis;\r\n    }\r\n\r\n    set fovAxis (val) {\r\n        if (val === this._fovAxis) { return; }\r\n        this._fovAxis = val;\r\n        if (this._camera) {\r\n            this._camera.fovAxis = val;\r\n            if (val === CameraFOVAxis.VERTICAL) { this.fov = this._fov * this._camera.aspect; } else { this.fov = this._fov / this._camera.aspect; }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en Field of view of the camera.\r\n     * @zh 相机的视角大小。\r\n     */\r\n    @displayOrder(8)\r\n    @visible(function (this: Camera): boolean {\r\n        return this._projection === ProjectionType.PERSPECTIVE;\r\n    })\r\n    @range([1, 180, 1])\r\n    @tooltip('i18n:camera.fov')\r\n    get fov (): number {\r\n        return this._fov;\r\n    }\r\n\r\n    set fov (val) {\r\n        this._fov = val;\r\n        if (this._camera) { this._camera.fov = toRadian(val); }\r\n    }\r\n\r\n    /**\r\n     * @en Viewport height in orthographic mode.\r\n     * @zh 正交模式下的相机视角高度。\r\n     */\r\n    @displayOrder(9)\r\n    @visible(function visible (this: Camera): boolean {\r\n        return this._projection === ProjectionType.ORTHO;\r\n    })\r\n    @rangeMin(1e-6)\r\n    @tooltip('i18n:camera.ortho_height')\r\n    get orthoHeight (): number {\r\n        return this._orthoHeight;\r\n    }\r\n\r\n    set orthoHeight (val) {\r\n        this._orthoHeight = val;\r\n        if (this._camera) { this._camera.orthoHeight = val; }\r\n    }\r\n\r\n    /**\r\n     * @en Near clipping distance of the camera, should be as large as possible within acceptable range.\r\n     * @zh 相机的近裁剪距离，应在可接受范围内尽量取最大。\r\n     */\r\n    @displayOrder(10)\r\n    @rangeMin(0)\r\n    @tooltip('i18n:camera.near')\r\n    get near (): number {\r\n        return this._near;\r\n    }\r\n\r\n    set near (val) {\r\n        this._near = val;\r\n        if (this._camera) { this._camera.nearClip = val; }\r\n    }\r\n\r\n    /**\r\n     * @en Far clipping distance of the camera, should be as small as possible within acceptable range.\r\n     * @zh 相机的远裁剪距离，应在可接受范围内尽量取最小。\r\n     */\r\n    @displayOrder(11)\r\n    @rangeMin(function (this: Camera): number {\r\n        return this._near + 0.001;\r\n    })\r\n    @tooltip('i18n:camera.far')\r\n    get far (): number {\r\n        return this._far;\r\n    }\r\n\r\n    set far (val) {\r\n        this._far = val;\r\n        if (this._camera) { this._camera.farClip = val; }\r\n    }\r\n\r\n    /**\r\n     * @en Camera aperture, controls the exposure parameter.\r\n     * @zh 相机光圈，影响相机的曝光参数。\r\n     */\r\n    @type(Aperture)\r\n    @displayOrder(12)\r\n    @tooltip('i18n:camera.aperture')\r\n    get aperture (): CameraAperture {\r\n        return this._aperture;\r\n    }\r\n\r\n    set aperture (val) {\r\n        this._aperture = val;\r\n        if (this._camera) { this._camera.aperture = val; }\r\n    }\r\n\r\n    /**\r\n     * @en Camera shutter, controls the exposure parameter.\r\n     * @zh 相机快门，影响相机的曝光参数。\r\n     */\r\n    @type(Shutter)\r\n    @displayOrder(13)\r\n    @tooltip('i18n:camera.shutter')\r\n    get shutter (): CameraShutter {\r\n        return this._shutter;\r\n    }\r\n\r\n    set shutter (val) {\r\n        this._shutter = val;\r\n        if (this._camera) { this._camera.shutter = val; }\r\n    }\r\n\r\n    /**\r\n     * @en Camera ISO, controls the exposure parameter.\r\n     * @zh 相机感光度，影响相机的曝光参数。\r\n     */\r\n    @type(ISO)\r\n    @displayOrder(14)\r\n    @tooltip('i18n:camera.ISO')\r\n    get iso (): CameraISO {\r\n        return this._iso;\r\n    }\r\n\r\n    set iso (val) {\r\n        this._iso = val;\r\n        if (this._camera) { this._camera.iso = val; }\r\n    }\r\n\r\n    /**\r\n     * @en Screen viewport of the camera wrt. the sceen size.\r\n     * @zh 此相机最终渲染到屏幕上的视口位置和大小。\r\n     */\r\n    @displayOrder(15)\r\n    @tooltip('i18n:camera.rect')\r\n    get rect (): Rect {\r\n        return this._rect;\r\n    }\r\n\r\n    set rect (val) {\r\n        this._rect = val;\r\n        if (this._camera) { this._camera.setViewportInOrientedSpace(val); }\r\n    }\r\n\r\n    /**\r\n     * @en Output render texture of the camera. Default to null, which outputs directly to screen.\r\n     * @zh 指定此相机的渲染输出目标贴图，默认为空，直接渲染到屏幕。\r\n     */\r\n    @type(RenderTexture)\r\n    @displayOrder(16)\r\n    @tooltip('i18n:camera.target_texture')\r\n    get targetTexture (): RenderTexture | null {\r\n        return this._targetTexture;\r\n    }\r\n\r\n    set targetTexture (value) {\r\n        if (this._targetTexture === value) {\r\n            return;\r\n        }\r\n\r\n        const old = this._targetTexture;\r\n        this._targetTexture = value;\r\n        this._checkTargetTextureEvent(old);\r\n        this._updateTargetTexture();\r\n\r\n        if (!value && this._camera) {\r\n            this._camera.changeTargetWindow(EDITOR_NOT_IN_PREVIEW ? (cclegacy.director.root as Root).tempWindow : null);\r\n            this._camera.isWindowSize = true;\r\n        }\r\n        this.node.emit(CameraEvent.TARGET_TEXTURE_CHANGE, this);\r\n    }\r\n\r\n    @tooltip('i18n:camera.use_postprocess')\r\n    @property\r\n    get usePostProcess (): boolean {\r\n        return this._usePostProcess;\r\n    }\r\n    set usePostProcess (v) {\r\n        this._usePostProcess = v;\r\n        if (this._camera) {\r\n            this._camera.usePostProcess = v;\r\n        }\r\n    }\r\n\r\n    @tooltip('i18n:camera.postprocess')\r\n    @type(PostProcess)\r\n    get postProcess (): PostProcess | null {\r\n        return this._postProcess;\r\n    }\r\n    set postProcess (v) {\r\n        this._postProcess = v;\r\n        if (this._camera) {\r\n            this._camera.postProcess = v;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en Scale of the internal buffer size,\r\n     * set to 1 to keep the same with the canvas size.\r\n     * @zh 相机内部缓冲尺寸的缩放值, 1 为与 canvas 尺寸相同。\r\n     */\r\n    get screenScale (): number {\r\n        return this._screenScale;\r\n    }\r\n\r\n    set screenScale (val) {\r\n        this._screenScale = val;\r\n        if (this._camera) { this._camera.screenScale = val; }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    get inEditorMode (): boolean {\r\n        return this._inEditorMode;\r\n    }\r\n\r\n    set inEditorMode (value) {\r\n        this._inEditorMode = value;\r\n        if (this._camera) {\r\n            const root = cclegacy.director.root as Root;\r\n            this._camera.changeTargetWindow(value ? root && root.mainWindow : root && root.tempWindow);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    get cameraType (): CameraType {\r\n        return this._cameraType;\r\n    }\r\n\r\n    set cameraType (val) {\r\n        if (this._cameraType === val) {\r\n            return;\r\n        }\r\n        this._cameraType = val;\r\n        if (this.camera) {\r\n            this.camera.cameraType = val;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    get trackingType (): TrackingType {\r\n        return this._trackingType;\r\n    }\r\n\r\n    set trackingType (val) {\r\n        if (this._trackingType === val) {\r\n            return;\r\n        }\r\n        this._trackingType = val;\r\n        if (this.camera) {\r\n            this.camera.trackingType = val;\r\n        }\r\n    }\r\n\r\n    public onLoad (): void {\r\n        this._createCamera();\r\n    }\r\n\r\n    public onEnable (): void {\r\n        this.node.hasChangedFlags |= TransformBit.POSITION; // trigger camera matrix update\r\n        if (this._camera) {\r\n            this._attachToScene();\r\n        }\r\n    }\r\n\r\n    public onDisable (): void {\r\n        if (this._camera) {\r\n            this._detachFromScene();\r\n        }\r\n    }\r\n\r\n    public onDestroy (): void {\r\n        if (this._camera) {\r\n            this._camera.destroy();\r\n            this._camera = null;\r\n        }\r\n\r\n        if (this._targetTexture) {\r\n            this._targetTexture.off('resize');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en Convert a screen space (left-bottom origin) point to a ray.\r\n     * @zh 将一个屏幕空间（左下角为原点）坐标转换为射线。\r\n     * @param x The x axis position on screen.\r\n     * @param y The y axis position on screen.\r\n     * @param out The output ray object.\r\n     * @returns Return the output ray object.\r\n     */\r\n    public screenPointToRay (x: number, y: number, out?: geometry.Ray): Ray {\r\n        if (!out) { out = geometry.Ray.create(); }\r\n        if (this._camera) { this._camera.screenPointToRay(out, x, y); }\r\n        return out;\r\n    }\r\n\r\n    /**\r\n     * @en Convert a world position to a screen space (left-bottom origin) position.\r\n     * @zh 将一个世界空间坐标转换为屏幕空间（左下角为原点）坐标。\r\n     * @param worldPos The position in world space coordinates\r\n     * @param out The output position in screen space coordinates.\r\n     * @returns Return the output position object.\r\n     */\r\n    public worldToScreen (worldPos: Vec3 | Readonly<Vec3>, out?: Vec3): Vec3 {\r\n        if (!out) { out = new Vec3(); }\r\n        if (this._camera) { this._camera.worldToScreen(out, worldPos); }\r\n        return out;\r\n    }\r\n\r\n    /**\r\n     * @en Convert a screen space (left-bottom origin) position to a world space position.\r\n     * @zh 将一个屏幕空间（左下角为原点）转换为世界空间坐标。\r\n     * @param screenPos The position in screen space coordinates\r\n     * @param out The output position in world space coordinates\r\n     * @returns Return the output position object.\r\n     */\r\n    public screenToWorld (screenPos: Vec3, out?: Vec3): Vec3 {\r\n        if (!out) { out = this.node.getWorldPosition(); }\r\n        if (this._camera) { this._camera.screenToWorld(out, screenPos); }\r\n        return out;\r\n    }\r\n\r\n    /**\r\n     * @en Convert a 3D world position to the local coordinates system of the given UI node.\r\n     * The converted position will be related to the given UI node under local space.\r\n     * @zh 将一个 3D 空间世界坐标转换到指定的 UI 本地节点坐标系下。转换后的位置是指定 UI 节点坐标系下的局部偏移。\r\n     * @param wpos @en The world position to convert @zh 需要转换的世界坐标\r\n     * @param uiNode @en The UI node coordinates in which the world position will be convert to @zh 用于同步位置的 UI 节点\r\n     * @param out @en Return the corresponding position of the given world position in the UI node's local coordinates @zh 返回传入的世界坐标在 UI 节点本地坐标系下的局部坐标\r\n     *\r\n     * @example\r\n     * ```ts\r\n     * this.convertToUINode(target.worldPosition, uiNode.parent, out);\r\n     * uiNode.position = out;\r\n     * ```\r\n     */\r\n    public convertToUINode (wpos: Vec3 | Readonly<Vec3>, uiNode: Node, out?: Vec3): Vec3 {\r\n        if (!out) {\r\n            out = new Vec3();\r\n        }\r\n        if (!this._camera) { return out; }\r\n\r\n        this.worldToScreen(wpos, _temp_vec3_1);\r\n        const cmp = uiNode.getComponent('cc.UITransform') as UITransform;\r\n        const view = cclegacy.view as View;\r\n        const designSize = view.getVisibleSize();\r\n        const xoffset = _temp_vec3_1.x - this._camera.width * 0.5;\r\n        const yoffset = _temp_vec3_1.y - this._camera.height * 0.5;\r\n        _temp_vec3_1.x = xoffset / view.getScaleX() + designSize.width * 0.5;\r\n        _temp_vec3_1.y = yoffset / view.getScaleY() + designSize.height * 0.5;\r\n\r\n        if (cmp) {\r\n            cmp.convertToNodeSpaceAR(_temp_vec3_1, out);\r\n        }\r\n\r\n        return out;\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _createCamera (): void {\r\n        if (!this._camera) {\r\n            this._camera = (cclegacy.director.root as Root).createCamera();\r\n            this._camera.initialize({\r\n                name: this.node.name,\r\n                node: this.node,\r\n                projection: this._projection,\r\n                window: this._inEditorMode ? cclegacy.director.root && cclegacy.director.root.mainWindow\r\n                    : cclegacy.director.root && cclegacy.director.root.tempWindow,\r\n                priority: this._priority,\r\n                cameraType: this.cameraType,\r\n                trackingType: this.trackingType,\r\n            });\r\n\r\n            this._camera.setViewportInOrientedSpace(this._rect);\r\n            this._camera.fovAxis = this._fovAxis;\r\n            this._camera.fov = toRadian(this._fov);\r\n            this._camera.orthoHeight = this._orthoHeight;\r\n            this._camera.nearClip = this._near;\r\n            this._camera.farClip = this._far;\r\n            this._camera.clearColor = this._color;\r\n            this._camera.clearDepth = this._depth;\r\n            this._camera.clearStencil = this._stencil;\r\n            this._camera.clearFlag = this._clearFlags;\r\n            this._camera.visibility = this._visibility;\r\n            this._camera.aperture = this._aperture;\r\n            this._camera.shutter = this._shutter;\r\n            this._camera.iso = this._iso;\r\n            this._camera.postProcess = this._postProcess;\r\n            this._camera.usePostProcess = this._usePostProcess;\r\n            this._camera.update();\r\n        }\r\n\r\n        this._updateTargetTexture();\r\n    }\r\n\r\n    protected _attachToScene (): void {\r\n        if (!this.node.scene || !this._camera) {\r\n            return;\r\n        }\r\n        if (this._camera && this._camera.scene) {\r\n            this._camera.scene.removeCamera(this._camera);\r\n        }\r\n        const rs = this._getRenderScene();\r\n        rs.addCamera(this._camera);\r\n    }\r\n\r\n    protected _detachFromScene (): void {\r\n        if (this._camera && this._camera.scene) {\r\n            this._camera.scene.removeCamera(this._camera);\r\n        }\r\n    }\r\n\r\n    protected _checkTargetTextureEvent (old: RenderTexture | null): void {\r\n        if (old) {\r\n            old.off('resize');\r\n        }\r\n\r\n        if (this._targetTexture) {\r\n            this._targetTexture.on('resize', (window: RenderWindow) => {\r\n                if (this._camera) {\r\n                    this._camera.setFixedSize(window.width, window.height);\r\n                }\r\n            }, this);\r\n        }\r\n    }\r\n\r\n    protected _updateTargetTexture (): void {\r\n        if (!this._camera) {\r\n            return;\r\n        }\r\n\r\n        if (this._targetTexture) {\r\n            const window = this._targetTexture.window;\r\n            this._camera.changeTargetWindow(window);\r\n            this._camera.setFixedSize(window!.width, window!.height);\r\n        }\r\n    }\r\n}\r\n\r\ncclegacy.Camera = Camera;\r\n","import { EDITOR } from 'internal:constants';\r\nimport { property, serializable } from '../../../core/data/class-decorator';\r\nimport { ccclass, disallowMultiple, executeInEditMode, help, range, slide, tooltip } from '../../../core/data/decorators';\r\nimport { Component } from '../../../scene-graph';\r\nimport { PostProcessSetting } from './post-process-setting';\r\n\r\n@ccclass('cc.PostProcess')\r\n@help('cc.PostProcess')\r\n@disallowMultiple\r\n@executeInEditMode\r\nexport class PostProcess extends Component {\r\n    static all: PostProcess[] = [];\r\n\r\n    @tooltip('i18n:postprocess.global')\r\n    @property\r\n    @serializable\r\n    global = true;\r\n\r\n    @serializable\r\n    protected _shadingScale = 1;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    @tooltip('i18n:postprocess.shadingScale')\r\n    @slide\r\n    @range([0.01, 4, 0.01])\r\n    @property\r\n    get shadingScale (): number {\r\n        return this._shadingScale;\r\n    }\r\n    set shadingScale (v) {\r\n        this._shadingScale = v;\r\n        if (EDITOR) {\r\n            setTimeout(() => {\r\n                globalThis.cce.Engine.repaintInEditMode();\r\n            }, 50);\r\n        }\r\n    }\r\n\r\n    @tooltip('i18n:postprocess.enableShadingScaleInEditor')\r\n    @property\r\n    @serializable\r\n    enableShadingScaleInEditor = false;\r\n\r\n    settings: Map<typeof PostProcessSetting, PostProcessSetting> = new Map();\r\n\r\n    addSetting (setting: PostProcessSetting): void {\r\n        this.settings.set(setting.constructor as typeof PostProcessSetting, setting);\r\n    }\r\n    removeSetting (setting: PostProcessSetting): void {\r\n        this.settings.delete(setting.constructor as typeof PostProcessSetting);\r\n    }\r\n\r\n    getSetting (ctor: typeof PostProcessSetting): PostProcessSetting | undefined {\r\n        return this.settings.get(ctor);\r\n    }\r\n\r\n    onEnable (): void {\r\n        PostProcess.all.push(this);\r\n    }\r\n    onDisable (): void {\r\n        const idx = PostProcess.all.indexOf(this);\r\n        if (idx !== -1) {\r\n            PostProcess.all.splice(idx, 1);\r\n        }\r\n    }\r\n}\r\n"],"names":["CameraEvent","PostProcess","ccclass","disallowMultiple","_class3","_Component","_this","call","this","global","_initializer","_shadingScale","_initializer2","enableShadingScaleInEditor","_initializer3","settings","Map","_inheritsLoose","_proto","prototype","addSetting","setting","set","constructor","removeSetting","getSetting","ctor","get","onEnable","all","push","onDisable","idx","indexOf","splice","_createClass","key","v","Component","property","_class2","serializable","_applyDecoratedInitializer","_applyDecoratedDescriptor","Object","getOwnPropertyDescriptor","_class","_temp_vec3_1","Vec3","ProjectionType","Enum","CameraProjection","FOVAxis","CameraFOVAxis","Aperture","CameraAperture","Shutter","CameraShutter","ISO","CameraISO","ClearFlag","SKYBOX","SkyBoxFlagValue","VALUE","ClearFlagBit","DEPTH_STENCIL","SOLID_COLOR","ALL","DEPTH_ONLY","DONT_CLEAR","NONE","exports","Camera","type","Layers","BitMask","_dec4","_dec5","_dec6","RenderTexture","_dec","_projection","_priority","_fov","_fovAxis","_initializer4","_orthoHeight","_initializer5","_near","_initializer6","_far","_initializer7","_color","_initializer8","_depth","_initializer9","_stencil","_initializer10","_clearFlags","_initializer11","_rect","_initializer12","_aperture","_initializer13","_shutter","_initializer14","_iso","_initializer15","_screenScale","_initializer16","_visibility","_initializer17","_targetTexture","_initializer18","_postProcess","_initializer19","_usePostProcess","_initializer20","_camera","_inEditorMode","_flows","undefined","_cameraType","_initializer21","_trackingType","_initializer22","onLoad","_createCamera","node","hasChangedFlags","TransformBit","POSITION","_attachToScene","_detachFromScene","onDestroy","destroy","off","screenPointToRay","x","y","out","geometry","create","worldToScreen","worldPos","screenToWorld","screenPos","getWorldPosition","convertToUINode","wpos","uiNode","cmp","getComponent","view","cclegacy","designSize","getVisibleSize","xoffset","width","yoffset","height","getScaleX","getScaleY","convertToNodeSpaceAR","director","root","createCamera","initialize","name","projection","window","mainWindow","tempWindow","priority","cameraType","trackingType","setViewportInOrientedSpace","fovAxis","fov","toRadian","orthoHeight","nearClip","farClip","clearColor","clearDepth","clearStencil","clearFlag","visibility","aperture","shutter","iso","postProcess","usePostProcess","update","_updateTargetTexture","scene","removeCamera","_getRenderScene","addCamera","_checkTargetTextureEvent","old","_this2","on","setFixedSize","changeTargetWindow","val","projectionType","VERTICAL","aspect","value","isWindowSize","emit","TARGET_TEXTURE_CHANGE","screenScale","camera","PERSPECTIVE","Color","Rect","F16_0","D125","ISO100","CAMERA_DEFAULT_MASK","CameraType","DEFAULT","TrackingType","NO_TRACKING","_dec2","_dec3","_dec7","_dec8","_dec9","_dec10"],"mappings":"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"}