System.register(["./index-BcjqSS2q.js","./director-D6Xf3-Ej.js","./gc-object-BD6DANSw.js","./_virtual_internal_constants-CVZmBipG.js","./scene-D5fG1En6.js","./prefab-CJahvMeV.js","./device-manager-BCOP-4pU.js","./buffer-barrier-CZBuOw0V.js","./pipeline-state-manager-C4BAah3w.js","./debug-view-zRQBd5E1.js","./global-exports-ZavlJGEN.js","./node-event-BDYemSfE.js","./deprecated-BaebfHhU.js"],(function(e,t){"use strict";var i,n,s,r,a,o,h,l,u,c,d,g,_,m,p,f,T,E,v,w,S,R,y,I,b,P,A,N,x,F,D,M,C,L,O,z,B,H,k,X,V,W,U,j,G,q,Y,J,Q,Z,K,$,ee,te,ie,ne,se,re,ae,oe,he,le,ue,ce,de,ge,_e,me;return{setters:[function(e){i=e.z,n=e.D,s=e.O,r=e.J,a=e.A,o=e.V,h=e.l,l=e.x,u=e.S,c=e.M,d=e.n,g=e.P,_=e.U,m=e.m,p=e.q,f=e.i,T=e.r},function(e){E=e.d,v=e.X,w=e.D,S=e.a},function(e){R=e.a,y=e.l,I=e.z,b=e.X,P=e._,A=e.s,N=e.S,x=e.h,F=e.H,D=e.Y,M=e.Z,C=e.$,L=e.a0,O=e.a1,z=e.G,B=e.T,H=e.a2,k=e.n},function(e){X=e.a},function(e){V=e.b,W=e.k,U=e.d},function(e){j=e.i},function(e){G=e.d,q=e.L},function(e){Y=e.ab,J=e.ac,Q=e.B,Z=e.b,K=e.M,$=e.A,ee=e.F,te=e.I,ie=e.ad,ne=e.ae,se=e.T,re=e.d,ae=e.e,oe=e.f},function(e){he=e.P,le=e.S,ue=e.k,ce=e.L},null,function(e){de=e.c,ge=e.a,_e=e.l,me=e.e},null,null],execute:function(){var pe,fe=function(){function e(){var e=this;this._stHandle=0,this._onTick=null,this._targetFrameRate=60,this._frameTime=0,this._startTime=0,this._isPlaying=!1,this._frameCount=0,this._callback=null,this._rAF=void 0,this._cAF=void 0,this._handleRAF=function(){var t=performance.now(),i=t-e._startTime,n=Math.floor(i/e._frameTime);n<0&&(e._startTime=t,e._frameCount=0),n<e._frameCount?e._stHandle=e._rAF.call(window,e._handleRAF):(e._frameCount=n+1,e._callback&&e._callback())},this._frameTime=1e3/this._targetFrameRate,this._rAF=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,this._cAF=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.ocancelAnimationFrame}var t=e.prototype;return t.start=function(){var e,t=this;if(!this._isPlaying){var i=void 0===this._rAF||(null==(e=globalThis.__globalXR)?void 0:e.isWebXR);this._startTime=performance.now(),this._stHandle=this._stTime((function e(){i&&(t._startTime=performance.now()),t._isPlaying&&(t._stHandle=t._stTime(e)),t._onTick&&t._onTick()})),this._isPlaying=!0,this._frameCount=0}},t.stop=function(){this._isPlaying&&(this._ctTime(this._stHandle),this._stHandle=0,this._isPlaying=!1,this._frameCount=0)},t._stTime=function(e){var t;if(void 0===this._rAF||null!=(t=globalThis.__globalXR)&&t.isWebXR){var i=performance.now(),n=Math.max(0,i-this._startTime),s=Math.max(0,this._frameTime-n);return setTimeout(e,s)}return this._callback=e,this._rAF.call(window,this._handleRAF)},t._ctTime=function(e){var t;void 0===this._cAF||null!=(t=globalThis.__globalXR)&&t.isWebXR?clearTimeout(e):e&&this._cAF.call(window,e)},R(e,[{key:"targetFrameRate",get:function(){return this._targetFrameRate},set:function(e){this._targetFrameRate!==e&&(y(e>0),this._targetFrameRate=e,this._frameTime=1e3/this._targetFrameRate,this._isPlaying&&(this.stop(),this.start()))}},{key:"onTick",get:function(){return this._onTick},set:function(e){this._onTick=e}}]),e}(),Te=i(),Ee=((pe={})[I.ORIENTATION_AUTO]=b.AUTO,pe[I.ORIENTATION_LANDSCAPE]=b.LANDSCAPE,pe[I.ORIENTATION_PORTRAIT]=b.PORTRAIT,pe),ve=e("V",function(e){function t(){var t;(t=e.call(this)||this)._designResolutionSize=i(0,0),t._scaleX=1,t._scaleY=1,t._viewportRect=l(),t._visibleRect=l(),t._autoFullScreen=!1,t._retinaEnabled=!1,t._resizeCallback=null;var n=we,s=Se;return t._rpExactFit=new xe(n.EQUAL_TO_FRAME,s.EXACT_FIT),t._rpShowAll=new xe(n.EQUAL_TO_FRAME,s.SHOW_ALL),t._rpNoBorder=new xe(n.EQUAL_TO_FRAME,s.NO_BORDER),t._rpFixedHeight=new xe(n.EQUAL_TO_FRAME,s.FIXED_HEIGHT),t._rpFixedWidth=new xe(n.EQUAL_TO_FRAME,s.FIXED_WIDTH),t._resolutionPolicy=t._rpShowAll,t}P(t,e);var h=t.prototype;return h.init=function(){var e=n.windowSize,t=e.width,i=e.height;this._designResolutionSize.width=t,this._designResolutionSize.height=i,this._viewportRect.width=t,this._viewportRect.height=i,this._visibleRect.width=t,this._visibleRect.height=i,Te.width=this._visibleRect.width,Te.height=this._visibleRect.height,s.init(this._visibleRect),this.resizeWithBrowserSize(!0);var r=A.querySettings(N.SCREEN,"designResolution");r&&this.setDesignResolutionSize(Number(r.width),Number(r.height),r.policy||xe.FIXED_HEIGHT),n.on("window-resize",this._updateAdaptResult,this),n.on("fullscreen-change",this._updateAdaptResult,this)},h.resizeWithBrowserSize=function(e){r.handleResizeEvent=e},h.setResizeCallback=function(e){"function"!=typeof e&&null!=e||(this._resizeCallback=e)},h.setOrientation=function(e){r.orientation=Ee[e]},h.adjustViewportMeta=function(){},h.enableRetina=function(e){this._retinaEnabled=!!e},h.isRetinaEnabled=function(){return this._retinaEnabled},h.enableAutoFullScreen=function(e){e!==this._autoFullScreen&&(this._autoFullScreen=e,e&&n.requestFullScreen().catch((function(){})))},h.isAutoFullScreenEnabled=function(){return this._autoFullScreen},h.setCanvasSize=function(e,t){r.resolutionScale=1;var i=r.devicePixelRatio,s=new a(e*i,t*i);n.windowSize=s},h.getCanvasSize=function(){return n.windowSize},h.getFrameSize=function(){var e=r.devicePixelRatio,t=n.windowSize;return t.width/=e,t.height/=e,t},h.setFrameSize=function(e,t){var i=r.devicePixelRatio;n.windowSize=new a(e*i,t*i)},h.getVisibleSize=function(){return new a(this._visibleRect.width,this._visibleRect.height)},h.getVisibleSizeInPixel=function(){return new a(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},h.getVisibleOrigin=function(){return new o(this._visibleRect.x,this._visibleRect.y)},h.getVisibleOriginInPixel=function(){return new o(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},h.getResolutionPolicy=function(){return this._resolutionPolicy},h._updateResolutionPolicy=function(e){if(e instanceof xe)this._resolutionPolicy=e;else{var t=xe;e===t.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),e===t.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),e===t.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),e===t.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),e===t.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},h.setResolutionPolicy=function(e){this._updateResolutionPolicy(e);var t=Fe.getDesignResolutionSize();Fe.setDesignResolutionSize(t.width,t.height,e)},h.setDesignResolutionSize=function(e,t,i){if(e>0&&t>0){this._updateResolutionPolicy(i);var n=this._resolutionPolicy;n&&n.preApply(this),this._designResolutionSize.width=e,this._designResolutionSize.height=t;var r=n.apply(this,this._designResolutionSize);if(r.scale&&2===r.scale.length&&(this._scaleX=r.scale[0],this._scaleY=r.scale[1]),r.viewport){var a=this._viewportRect,o=this._visibleRect,h=r.viewport;a.x=h.x,a.y=h.y,a.width=h.width,a.height=h.height,o.x=0,o.y=0,o.width=h.width/this._scaleX,o.height=h.height/this._scaleY}n.postApply(this),Te.width=this._visibleRect.width,Te.height=this._visibleRect.height,s.init(this._visibleRect),this.emit("design-resolution-changed")}else x(2200)},h.getDesignResolutionSize=function(){return new a(this._designResolutionSize.width,this._designResolutionSize.height)},h.setRealPixelResolution=function(e,t,i){document.documentElement.style.width=e+"px",document.body.style.width=e+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(e,t,i)},h.getViewportRect=function(){return this._viewportRect},h.getScaleX=function(){return this._scaleX},h.getScaleY=function(){return this._scaleY},h.getDevicePixelRatio=function(){return r.devicePixelRatio},h.convertToLocationInView=function(e,t,i,s){void 0===s&&(s=new o);var a=r.devicePixelRatio*(e-i.left),h=r.devicePixelRatio*(i.top+i.height-t);return r.isFrameRotated?(s.x=n.windowSize.width-h,s.y=a):(s.x=a,s.y=h),s},h._convertToUISpace=function(e){var t=this._viewportRect;e.x=(e.x-t.x)/this._scaleX,e.y=(e.y-t.y)/this._scaleY},h._updateAdaptResult=function(e,t,i){de.director.root.resize(e,t,void 0===i||0===i?1:i);var n=this._designResolutionSize,s=n.width,r=n.height;e>0&&t>0?this.setDesignResolutionSize(s,r,this._resolutionPolicy):F(!1,"_updateAdaptResult Invalid size."),this.emit("canvas-resize"),this._resizeCallback&&this._resizeCallback()},t}(D(u)));ve.instance=void 0;var we=function(){function e(){this.name="ContainerStrategy"}var t=e.prototype;return t.preApply=function(){},t.apply=function(){},t.postApply=function(){},t._setupCanvas=function(){var e=de.game.canvas;if(e){var t=n.windowSize;e.width!==t.width&&(e.width=t.width),e.height!==t.height&&(e.height=t.height)}},e}();we.EQUAL_TO_FRAME=void 0,we.PROPORTION_TO_FRAME=void 0;var Se=function(){function e(){this.name="ContentStrategy",this._result={scale:[1,1],viewport:null},this._strategy=xe.UNKNOWN}var t=e.prototype;return t.preApply=function(){},t.apply=function(){return{scale:[1,1]}},t.postApply=function(){},t._buildResult=function(e,t,i,n,s,r){Math.abs(e-i)<2&&(i=e),Math.abs(t-n)<2&&(n=t);var a=new h(Math.round((e-i)/2),Math.round((t-n)/2),i,n),o=this._result;return o.scale=[s,r],o.viewport=a,o},R(e,[{key:"strategy",get:function(){return this._strategy}}]),e}(),Re=function(e){function t(){var t;return(t=e.call(this)||this).name="EqualToFrame",t}return P(t,e),t.prototype.apply=function(){r.isProportionalToFrame=!1,this._setupCanvas()},t}(we),ye=function(e){function t(){var t;return(t=e.call(this)||this).name="ProportionalToFrame",t}return P(t,e),t.prototype.apply=function(){r.isProportionalToFrame=!0,this._setupCanvas()},t}(we);we.EQUAL_TO_FRAME=new Re,we.PROPORTION_TO_FRAME=new ye;var Ie=function(e){function t(){var t;return(t=e.call(this)||this).name="ExactFit",t._strategy=xe.EXACT_FIT,t}return P(t,e),t.prototype.apply=function(e,t){var i=n.windowSize,s=i.width,r=i.height,a=s/t.width,o=r/t.height;return this._buildResult(s,r,s,r,a,o)},t}(Se),be=function(e){function t(){var t;return(t=e.call(this)||this).name="ShowAll",t._strategy=xe.SHOW_ALL,t}return P(t,e),t.prototype.apply=function(e,t){var i,s,r=n.windowSize,a=r.width,o=r.height,h=t.width,l=t.height,u=a/h,c=o/l,d=0;return u<c?(i=a,s=l*(d=u)):(i=h*(d=c),s=o),this._buildResult(a,o,i,s,d,d)},t}(Se),Pe=function(e){function t(){var t;return(t=e.call(this)||this).name="NoBorder",t._strategy=xe.NO_BORDER,t}return P(t,e),t.prototype.apply=function(e,t){var i,s,r,a=n.windowSize,o=a.width,h=a.height,l=t.width,u=t.height,c=o/l,d=h/u;return c<d?(s=l*(i=d),r=h):(s=o,r=u*(i=c)),this._buildResult(o,h,s,r,i,i)},t}(Se),Ae=function(e){function t(){var t;return(t=e.call(this)||this).name="FixedHeight",t._strategy=xe.FIXED_HEIGHT,t}return P(t,e),t.prototype.apply=function(e,t){var i=n.windowSize,s=i.width,r=i.height,a=r/t.height,o=s,h=r;return this._buildResult(s,r,o,h,a,a)},t}(Se),Ne=function(e){function t(){var t;return(t=e.call(this)||this).name="FixedWidth",t._strategy=xe.FIXED_WIDTH,t}return P(t,e),t.prototype.apply=function(e,t){var i=n.windowSize,s=i.width,r=i.height,a=s/t.width,o=s,h=r;return this._buildResult(s,r,o,h,a,a)},t}(Se),xe=e("R",function(){function e(e,t){this.name="ResolutionPolicy",this._containerStrategy=e,this._contentStrategy=t}var t=e.prototype;return t.preApply=function(e){this._contentStrategy.preApply(e)},t.apply=function(e,t){return this._containerStrategy.apply(e,t),this._contentStrategy.apply(e,t)},t.postApply=function(e){this._contentStrategy.postApply(e)},t.setContainerStrategy=function(e){this._containerStrategy=e},t.setContentStrategy=function(e){this._contentStrategy=e},t.getContentStrategy=function(){return this._contentStrategy},R(e,[{key:"canvasSize",get:function(){return n.windowSize}}]),e}());xe.EXACT_FIT=0,xe.NO_BORDER=1,xe.SHOW_ALL=2,xe.FIXED_HEIGHT=3,xe.FIXED_WIDTH=4,xe.UNKNOWN=5,xe.ContainerStrategy=we,xe.ContentStrategy=Se,de.ResolutionPolicy=xe,Se.EXACT_FIT=new Ie,Se.SHOW_ALL=new be,Se.NO_BORDER=new Pe,Se.FIXED_HEIGHT=new Ae,Se.FIXED_WIDTH=new Ne;var Fe=e("v",ve.instance=de.view=new ve);E.registerSystem("view",Fe,0),de.winSize=Te;var De=new o;function Me(e,t,i,n){e.setProperty(t,i,n)}var Ce=function(){var e=t.prototype;function t(){this.settings=void 0,this._curTime=0,this.device=void 0,this.swapchain=void 0,this.shader=void 0,this.sampler=void 0,this.cmdBuff=void 0,this.quadAssmebler=void 0,this.vertexBuffers=void 0,this.indicesBuffers=void 0,this.renderArea=void 0,this.clearColors=void 0,this.projection=void 0,this.isMobile=!1,this.bgMat=void 0,this.bgImage=void 0,this.bgTexture=void 0,this.logoMat=void 0,this.logoImage=void 0,this.logoTexture=void 0,this.watermarkMat=void 0,this.watermarkTexture=void 0,this.bgWidth=1920,this.bgHeight=1080,this.logoWidthTemp=140,this.logoHeightTemp=200,this.logoWidth=0,this.logoHeight=0,this.logoXTrans=.5,this.logoYTrans=1/6+2.5/6,this.textSize=24,this.textHeight=24,this.textXTrans=.5,this.textYExtraTrans=32,this.textExpandSize=4,this.scaleSize=1}return e.init=function(){var e,t,i,n,s,r,a,o=this,h=xe.SHOW_ALL,l=A.querySettings(N.SCREEN,"designResolution");if(null!==l&&(h=l.policy),this.settings={policy:null!==(e=h)&&void 0!==e?e:xe.SHOW_ALL,displayRatio:null!==(t=A.querySettings(N.SPLASH_SCREEN,"displayRatio"))&&void 0!==t?t:.4,totalTime:null!==(i=A.querySettings(N.SPLASH_SCREEN,"totalTime"))&&void 0!==i?i:3e3,watermarkLocation:null!==(n=A.querySettings(N.SPLASH_SCREEN,"watermarkLocation"))&&void 0!==n?n:"default",autoFit:null===(s=A.querySettings(N.SPLASH_SCREEN,"autoFit"))||void 0===s||s,logo:null!==(r=A.querySettings(N.SPLASH_SCREEN,"logo"))&&void 0!==r?r:void 0,background:null!==(a=A.querySettings(N.SPLASH_SCREEN,"background"))&&void 0!==a?a:void 0},this._curTime=0,!(this.settings.totalTime<=0||void 0===this.settings.logo||void 0===this.settings.background)){this.device=de.director.root.device,this.swapchain=de.director.root.mainWindow.swapchain,this.preInit(),this.initLayout(),"default"===this.settings.logo.type&&this.initWaterMark();var u=Promise.resolve(),c=Promise.resolve();return"custom"===this.settings.background.type&&(u=new Promise((function(e,t){o.bgImage=new ge.Image,o.bgImage.onload=function(){o.initBG(),e()},o.bgImage.onerror=function(){t()},o.bgImage.src=o.settings.background.base64}))),"none"!==this.settings.logo.type&&(c=new Promise((function(e,t){o.logoImage=new ge.Image,o.logoImage.onload=function(){o.initLogo(),e()},o.logoImage.onerror=function(){t()},o.logoImage.src=o.settings.logo.base64}))),Promise.all([u,c])}return this.settings.totalTime=0,Promise.resolve([])},e.preInit=function(){var e,t=null==(e=this.settings.background)?void 0:e.color;this.clearColors=t?[new Y(t.x,t.y,t.z,t.w)]:[new Y(0,0,0,1)];var i=this.device,n=this.swapchain,s=i.capabilities;this.renderArea=new J(0,0,n.width,n.height),this.cmdBuff=i.commandBuffer;var r=new Float32Array([.5,.5,1,0,-.5,.5,0,0,.5,-.5,1,1,-.5,-.5,0,1]),a=4*Float32Array.BYTES_PER_ELEMENT,o=4*a;this.vertexBuffers=i.createBuffer(new Q(Z.VERTEX|Z.TRANSFER_DST,K.DEVICE,o,a)),this.vertexBuffers.update(r);var h=new Uint16Array([0,1,2,1,3,2]),l=Uint16Array.BYTES_PER_ELEMENT,u=6*l;this.indicesBuffers=i.createBuffer(new Q(Z.INDEX|Z.TRANSFER_DST,K.DEVICE,u,l)),this.indicesBuffers.update(h);var g=[new $("a_position",ee.RG32F),new $("a_texCoord",ee.RG32F)],_=new te(g,[this.vertexBuffers],this.indicesBuffers);this.quadAssmebler=i.createInputAssembler(_),this.projection=new c,c.ortho(this.projection,-1,1,-1,1,-1,1,s.clipSpaceMinZ,s.clipSpaceSignY,n.surfaceTransform),this.isMobile=d.isMobile},e.initLayout=function(){this.isMobile?(this.bgWidth=812,this.bgHeight=375,this.logoWidthTemp=70,this.logoHeightTemp=100,this.textSize=12,this.textHeight=this.textSize+this.textExpandSize,this.textXTrans=.5,this.textYExtraTrans=16):(this.bgWidth=1920,this.bgHeight=1080,this.logoWidthTemp=140,this.logoHeightTemp=200,this.textSize=24,this.textHeight=this.textSize+this.textExpandSize,this.textXTrans=.5,this.textYExtraTrans=32),this.logoXTrans=.5,this.logoYTrans=1/6+2.5/6,this.initScale()},e.initScale=function(){var e=this.swapchain.width,t=this.swapchain.height,i=this.isMobile?375:1080,n=this.isMobile?812:1920;if(e>t){var s=n;n=i,i=s}this.scaleSize=e/t>16/9?t/n:e/i},e.update=function(e){var t=this.settings,i=this.device,n=this.swapchain,s=i.capabilities;c.ortho(this.projection,-1,1,-1,1,-1,1,s.clipSpaceMinZ,s.clipSpaceSignY,n.surfaceTransform);var r=n.width,a=n.height;this.initScale(),this._curTime+=1e3*e;var o=g(this._curTime/t.totalTime),h=_(o),l=1,u=1,d=this.bgImage;if("custom"===t.background.type){t.policy===xe.FIXED_WIDTH?(l=r,u=r/d.width*d.height):t.policy===xe.FIXED_HEIGHT?(l=a/d.height*d.width,u=a):t.policy===xe.SHOW_ALL?d.width/this.bgHeight>r/a?(l=r,u=r/d.width*d.height):(l=a/d.height*d.width,u=a):t.policy===xe.NO_BORDER?d.width/d.height>r/a?(l=a/d.height*d.width,u=a):(l=r,u=r/d.width*d.height):(l=r,u=a);var m=this.bgMat;Me(m,"resolution",De.set(r,a),0),Me(m,"scale",De.set(l,u),0),Me(m,"translate",De.set(.5*r,.5*a),0),Me(m,"percent",1),Me(m,"u_projection",this.projection),m.passes[0].update()}var p=a*this.logoYTrans;if("none"!==this.settings.logo.type){u=.185*a*t.displayRatio,l=this.logoWidth*(.185*a/this.logoHeight)*t.displayRatio;var f=this.logoMat;Me(f,"resolution",De.set(r,a),0),Me(f,"scale",De.set(l,u),0),Me(f,"translate",De.set(r*this.logoXTrans,p),0),Me(f,"percent",h),Me(f,"u_projection",this.projection),f.passes[0].update()}if("default"===this.settings.logo.type&&this.watermarkMat){var T=this.watermarkTexture.width,E=this.watermarkTexture.height;l=T,u=E;var v=p-(.5*this.logoHeight*t.displayRatio+this.textYExtraTrans)*this.scaleSize-.5*E,w=this.watermarkMat;Me(w,"resolution",De.set(r,a),0),Me(w,"scale",De.set(l,u),0),Me(w,"translate",De.set(r*this.textXTrans,v),0),Me(w,"percent",h),Me(w,"u_projection",this.projection),w.passes[0].update()}this.frame()},e.initBG=function(){var e=this.device;this.bgMat=new V,this.bgMat.initialize({effectName:"util/splash-screen"});var t=new ie;t.addressU=ne.CLAMP,t.addressV=ne.CLAMP,t.addressW=ne.CLAMP,this.sampler=e.getSampler(t),this.bgTexture=e.createTexture(new se(re.TEX2D,ae.SAMPLED|ae.TRANSFER_DST,ee.RGBA8,this.bgImage.width,this.bgImage.height));var i=this.bgMat.passes[0],n=i.getBinding("mainTexture");i.bindTexture(n,this.bgTexture),this.shader=i.getShaderVariant();var s=i.descriptorSet;s.bindSampler(n,this.sampler),s.update();var r=new oe,a=r.texExtent;a.width=this.bgImage.width,a.height=this.bgImage.height,a.depth=1,e.copyTexImagesToTexture([this.bgImage],this.bgTexture,[r])},e.initLogo=function(){var e=this.device;this.logoMat=new V,this.logoMat.initialize({effectName:"util/splash-screen"});var t=new ie;t.addressU=ne.CLAMP,t.addressV=ne.CLAMP,t.addressW=ne.CLAMP,this.sampler=e.getSampler(t),this.logoTexture=e.createTexture(new se(re.TEX2D,ae.SAMPLED|ae.TRANSFER_DST,ee.RGBA8,this.logoImage.width,this.logoImage.height));var i=this.logoMat.passes[0],n=i.getBinding("mainTexture");i.bindTexture(n,this.logoTexture),this.shader=i.getShaderVariant();var s=i.descriptorSet;s.bindSampler(n,this.sampler),s.update();var r=new oe,a=r.texExtent;a.width=this.logoImage.width,a.height=this.logoImage.height,a.depth=1,e.copyTexImagesToTexture([this.logoImage],this.logoTexture,[r]);var o=this.logoImage.width/this.logoImage.height;o<1?(this.logoWidth=this.logoWidthTemp,this.logoHeight=this.logoWidthTemp/o):(this.logoWidth=this.logoHeightTemp*o,this.logoHeight=this.logoHeightTemp)},e.initWaterMark=function(){var e=ge.document.createElement("canvas");e.height=this.textHeight*this.scaleSize,e.style.width=""+e.width,e.style.height=""+e.height;var t="Created with Cocos",i=e.getContext("2d");i.font=this.textSize*this.scaleSize+"px Arial",i.textBaseline="top",i.textAlign="center",i.fillStyle="#707070";var n=i.measureText(t).width+10;e.width=n,i.font=this.textSize*this.scaleSize+"px Arial",i.textBaseline="top",i.textAlign="center",i.fillStyle="#707070",i.fillText(t,e.width/2,0);var s=new oe,r=s.texExtent;r.width=e.width,r.height=e.height,r.depth=1,this.watermarkTexture=this.device.createTexture(new se(re.TEX2D,ae.SAMPLED|ae.TRANSFER_DST,ee.RGBA8,e.width,e.height)),this.device.copyTexImagesToTexture([e],this.watermarkTexture,[s]),this.watermarkMat=new V,this.watermarkMat.initialize({effectName:"util/splash-screen"});var a=this.watermarkMat.passes[0],o=a.getBinding("mainTexture");a.bindTexture(o,this.watermarkTexture),a.descriptorSet.update()},e.frame=function(){var e=this.device,t=this.swapchain,i=this.projection,n=this.bgMat,s=this.logoMat,r=this.watermarkMat,a=this.settings,o=this.quadAssmebler,h=e.capabilities;if(!d.isXR||xr.entry.isRenderAllowable())for(var l=d.isXR?2:1,u=0;u<l;u++){if(d.isXR){xr.entry.renderLoopStart(u);var g=xr.entry.getEyeFov(u),_=1,p=1;u===v.LEFT?_=Math.abs(Math.tan(g[0]))/Math.abs(Math.tan(g[1])):u===v.RIGHT&&(p=Math.abs(Math.tan(g[1]))/Math.abs(Math.tan(g[0]))),c.ortho(i,-_,p,-1,1,-1,1,h.clipSpaceMinZ,h.clipSpaceSignY,t.surfaceTransform),i.m00=m[t.surfaceTransform][0],i.m05=m[t.surfaceTransform][3]*h.clipSpaceSignY,"custom"===a.background.type&&(Me(n,"u_projection",i),n.passes[0].update()),"none"!==a.logo.type&&(Me(s,"u_projection",i),s.passes[0].update()),"default"===a.logo.type&&r&&(Me(r,"u_projection",i),r.passes[0].update())}e.enableAutoBarrier(!0),e.acquire([t]);var f=this.cmdBuff,T=de.director.root.mainWindow.framebuffer,E=this.renderArea;if(E.width=t.width,E.height=t.height,f.begin(),f.beginRenderPass(T.renderPass,T,E,this.clearColors,1,0),de.director.root.pipeline,"custom"===a.background.type){var w=n.passes[0],S=he.getOrCreatePipelineState(e,w,this.shader,T.renderPass,o);f.bindPipelineState(S),f.bindDescriptorSet(le.MATERIAL,w.descriptorSet),f.bindInputAssembler(o),f.draw(o)}if("none"!==a.logo.type){var R=s.passes[0],y=he.getOrCreatePipelineState(e,R,this.shader,T.renderPass,o);f.bindPipelineState(y),f.bindDescriptorSet(le.MATERIAL,R.descriptorSet),f.bindInputAssembler(o),f.draw(o)}if("default"===a.logo.type&&r){var I=this.watermarkMat.passes[0],b=he.getOrCreatePipelineState(e,I,this.shader,T.renderPass,o);f.bindPipelineState(b),f.bindDescriptorSet(le.MATERIAL,I.descriptorSet),f.bindInputAssembler(o),f.draw(o)}f.endRenderPass(),f.end(),e.flushCommands([f]),e.queue.submit([f]),e.present(),e.enableAutoBarrier(!_e.rendering),d.isXR&&xr.entry.renderLoopEnd(u)}},e.destroy=function(){this.device=null,this.swapchain=null,this.clearColors=null,this.bgImage&&(this.bgImage.destroy&&this.bgImage.destroy(),this.bgImage=null),this.bgMat&&(this.bgMat.destroy(),this.bgMat=null),this.bgTexture&&(this.bgTexture.destroy(),this.bgTexture=null),this.logoImage&&(this.logoImage.destroy&&this.logoImage.destroy(),this.logoImage=null),this.logoMat&&(this.logoMat.destroy(),this.logoMat=null),this.logoTexture&&(this.logoTexture.destroy(),this.logoTexture=null),this.renderArea=null,this.cmdBuff=null,this.shader=null,this.quadAssmebler&&(this.quadAssmebler.destroy(),this.quadAssmebler=null),this.vertexBuffers&&(this.vertexBuffers.destroy(),this.vertexBuffers=null),this.indicesBuffers&&(this.indicesBuffers.destroy(),this.indicesBuffers=null),this.sampler=null,this.watermarkMat&&(this.watermarkMat.destroy(),this.watermarkMat=null),this.watermarkTexture&&(this.watermarkTexture.destroy(),this.watermarkTexture=null),this.settings=null},t.createInstance=function(){return t._ins=new t,t._ins},t.releaseInstance=function(){t._ins&&(t._ins.destroy(),t._ins=null)},R(t,[{key:"isFinished",get:function(){return this._curTime>=this.settings.totalTime}},{key:"curTime",get:function(){return this._curTime},set:function(e){this._curTime=e}}],[{key:"instance",get:function(){return t._ins}}]),t}();Ce._ins=null,de.internal.SplashScreen=Ce;var Le=new(function(){function e(){this._data=null}return e.prototype.init=function(e){var t=this;return void 0===e&&(e=""),_e.rendering&&_e.rendering.enableEffectImport&&e?new Promise((function(i,n){var s=new XMLHttpRequest;s.open("GET",e),s.responseType="arraybuffer",s.onload=function(){t._data=s.response,i()},s.onerror=function(){n(new Error("request effect settings failed!"))},s.send(null)})):Promise.resolve()},R(e,[{key:"data",get:function(){return this._data}}]),e}());_e.effectSettings=Le;var Oe=A.querySettings.bind(A),ze=e("G",function(e){function i(){var t;return(t=e.call(this)||this).frame=null,t.container=null,t.canvas=null,t.renderType=-1,t.eventTargetOn=e.prototype.on,t.eventTargetOnce=e.prototype.once,t.config={},t.onStart=null,t.frameTime=1e3/60,t._isCloning=!1,t._inited=!1,t._engineInited=!1,t._rendererInitialized=!1,t._paused=!0,t._pausedByEngine=!1,t._frameRate=60,t._pacer=null,t._initTime=0,t._startTime=0,t._deltaTime=0,t._useFixedDeltaTime=!1,t._shouldLoadLaunchScene=!0,t.onPreBaseInitDelegate=new H,t.onPostBaseInitDelegate=new H,t.onPreInfrastructureInitDelegate=new H,t.onPostInfrastructureInitDelegate=new H,t.onPreSubsystemInitDelegate=new H,t.onPostSubsystemInitDelegate=new H,t.onPreProjectInitDelegate=new H,t.onPostProjectInitDelegate=new H,t}P(i,e);var s=i.prototype;return s.setFrameRate=function(e){this.frameRate=e},s.getFrameRate=function(){return this.frameRate},s.step=function(){E.tick(this._calculateDT(!0))},s.pauseByEngine=function(){this._paused||(this._pausedByEngine=!0,this.pause())},s.resumeByEngine=function(){this._pausedByEngine&&(this.resume(),this._pausedByEngine=!1)},s.pause=function(){var e;this._paused||(this._paused=!0,null==(e=this._pacer)||e.stop(),this.emit(i.EVENT_PAUSE))},s.resume=function(){var e;this._paused&&(j._clearEvents(),this._paused=!1,null==(e=this._pacer)||e.start(),this.emit(i.EVENT_RESUME))},s.isPaused=function(){return this._paused},s.restart=function(){var e=this;return new Promise((function(e){E.once(w.END_FRAME,(function(){return e()}))})).then((function(){E.reset(),de.Object._deferredDestroy(),e.pause(),e.resume(),e._shouldLoadLaunchScene=!0})).then((function(){return Ce.createInstance().init()})).then((function(){e._safeEmit(i.EVENT_RESTART)}))},s.end=function(){M.close()},s.on=function(e,t,i,n){return this.canRegisterEvent(e)&&t.call(i),this.eventTargetOn(e,t,i,n)},s.once=function(e,t,i){return this.canRegisterEvent(e)?t.call(i):this.eventTargetOnce(e,t,i)},s.canRegisterEvent=function(e){return this._engineInited&&e===i.EVENT_ENGINE_INITED||this._inited&&e===i.EVENT_GAME_INITED||this._rendererInitialized&&e===i.EVENT_RENDERER_INITED},s.init=function(e){var s=this;return this._compatibleWithOldParams(e),Promise.resolve().then((function(){return s.emit(i.EVENT_PRE_BASE_INIT),s.onPreBaseInitDelegate.dispatch()})).then((function(){console.time("Init Base");var t=e.debugMode||C.NONE;L(t)})).then((function(){return d.init()})).then((function(){s._initEvents()})).then((function(){return A.init(e.settingsPath,e.overrideSettings)})).then((function(){return console.timeEnd("Init Base"),s.emit(i.EVENT_POST_BASE_INIT),s.onPostBaseInitDelegate.dispatch()})).then((function(){return s.emit(i.EVENT_PRE_INFRASTRUCTURE_INIT),s.onPreInfrastructureInitDelegate.dispatch()})).then((function(){console.time("Init Infrastructure"),I.init(),s._initXR();var e={frame:document.querySelector("#GameDiv"),container:document.querySelector("#Cocos3dGameContainer"),canvas:document.querySelector("#GameCanvas")};return s.canvas=e.canvas,s.frame=e.frame,s.container=e.container,n.init(),O.init(),G.init(s.canvas,ue)})).then((function(){if(Oe(N.RENDERING,"customPipeline")){if(!de.rendering)return void x(12109);I.CUSTOM_PIPELINE_NAME||(I.CUSTOM_PIPELINE_NAME="Builtin")}else de.rendering=void 0;W.init(),U.init(),ce.init(),s.initPacer(),console.timeEnd("Init Infrastructure")})).then((function(){return s.emit(i.EVENT_POST_INFRASTRUCTURE_INIT),s.onPostInfrastructureInitDelegate.dispatch()})).then((function(){return s.emit(i.EVENT_PRE_SUBSYSTEM_INIT),s.onPreSubsystemInitDelegate.dispatch()})).then((function(){return Le.init(Oe(N.RENDERING,"effectSettingsPath"))})).then((function(){if(de.rendering&&de.rendering.enableEffectImport)if(Oe(N.RENDERING,"renderMode")!==q.HEADLESS){var e=Le.data;null!==e?de.rendering.init(G.gfxDevice,e):x(1102)}else de.rendering.init(G.gfxDevice,null)})).then((function(){var e=Oe(N.SCRIPTING,"scriptPackages");return e?Promise.all(e.map((function(e){return t.import(e)}))):Promise.resolve([])})).then((function(){return console.time("Init SubSystem"),E.init(),U.loadBuiltinAssets()})).then((function(){return console.timeEnd("Init SubSystem"),s.emit(i.EVENT_POST_SUBSYSTEM_INIT),s.onPostSubsystemInitDelegate.dispatch()})).then((function(){z("Cocos Creator v"+me),s.emit(i.EVENT_ENGINE_INITED),s._engineInited=!0})).then((function(){return s.emit(i.EVENT_PRE_PROJECT_INIT),s.onPreProjectInitDelegate.dispatch()})).then((function(){console.time("Init Project");var e=Oe(N.PLUGINS,"jsList"),t=Promise.resolve();return e&&e.forEach((function(e){t=t.then((function(){return t="src/"+e,new Promise((function(e,i){var n;function s(e){e.filename===t&&(n=e.error)}window.addEventListener("error",s);var r=document.createElement("script");r.charset="utf-8",r.async=!0,r.crossOrigin="anonymous",r.addEventListener("error",(function(){window.removeEventListener("error",s),i(Error("Error loading "+t))})),r.addEventListener("load",(function(){window.removeEventListener("error",s),document.head.removeChild(r),n?i(n):e()})),r.src=t.replace("#","%23"),document.head.appendChild(r)}));var t}))})),t})).then((function(){return s._loadProjectBundles()})).then((function(){return s._loadCCEScripts()})).then((function(){return s._setupRenderPipeline()})).then((function(){return s._loadPreloadAssets()})).then((function(){return U.compileBuiltinMaterial(),Ce.createInstance().init()})).then((function(){return console.timeEnd("Init Project"),s.emit(i.EVENT_POST_PROJECT_INIT),s.onPostProjectInitDelegate.dispatch()})).then((function(){s._inited=!0,s._safeEmit(i.EVENT_GAME_INITED)}))},s._initXR=function(){var e;if(void 0===globalThis.__globalXR&&(globalThis.__globalXR={}),globalThis.__globalXR.webxrCompatible=null!==(e=Oe(N.XR,"webxrCompatible"))&&void 0!==e&&e,d.isXR){var t,i;xr.entry=xr.XrEntry.getInstance();var n=null!==(t=Oe(N.RENDERING,"msaa"))&&void 0!==t?t:1,s=null!==(i=Oe(N.RENDERING,"renderingScale"))&&void 0!==i?i:1;xr.entry.setMultisamplesRTT(n),xr.entry.setRenderingScale(s)}},s._compatibleWithOldParams=function(e){var t=e.overrideSettings=e.overrideSettings||{};"showFPS"in e&&(t.profiling=t.profiling||{},t.profiling.showFPS=e.showFPS),"frameRate"in e&&(t.screen=t.screen||{},t.screen.frameRate=e.frameRate),"renderMode"in e&&(t.rendering=t.rendering||{},t.rendering.renderMode=e.renderMode),"renderPipeline"in e&&(t.rendering=t.rendering||{},t.rendering.renderPipeline=e.renderPipeline),"assetOptions"in e&&(t.assets=t.assets||{},Object.assign(t.assets,e.assetOptions)),"customJointTextureLayouts"in e&&(t.animation=t.animation||{},t.animation.customJointTextureLayouts=e.customJointTextureLayouts),"physics"in e&&(t.physics=t.physics||{},Object.assign(t.physics,e.physics)),"orientation"in e&&(t.screen=t.screen||{},t.screen.orientation=e.orientation),"exactFitScreen"in e&&(t.screen=t.screen||{},t.screen.exactFitScreen=e.exactFitScreen)},s._loadPreloadAssets=function(){var e=Oe(N.ASSETS,"preloadAssets");return e?Promise.all(e.map((function(e){return new Promise((function(t,i){W.loadAny(e,(function(e){e?i(e):t()}))}))}))):Promise.resolve([])},s._loadCCEScripts=function(){return new Promise((function(e){e()}))},s._loadProjectBundles=function(){var e=Oe(N.ASSETS,"preloadBundles");return e?Promise.all(e.map((function(e){var t=e.bundle,i=e.version;return new Promise((function(e,n){var s={};i&&(s.version=i),W.loadBundle(t,s,(function(t){t?n(t):e()}))}))}))):Promise.resolve([])},s.run=function(e){e&&(this.onStart=e),this._inited&&!X&&this.resume()},s._calculateDT=function(e){if(this._useFixedDeltaTime=e,e)return this._startTime=performance.now(),this.frameTime/1e3;var t=performance.now();return this._deltaTime=t>this._startTime?(t-this._startTime)/1e3:0,this._deltaTime>i.DEBUG_DT_THRESHOLD&&(this._deltaTime=this.frameTime/1e3),this._startTime=t,this._deltaTime},s._updateCallback=function(){var e=this;if(this._inited)if(Ce.instance&&!Ce.instance.isFinished)Ce.instance.update(this._calculateDT(!1));else if(this._shouldLoadLaunchScene){Ce.releaseInstance(),this._shouldLoadLaunchScene=!1;var t,i=Oe(N.LAUNCH,"launchScene");i?E.loadScene(i,(function(){B(1103,i),e._initTime=performance.now(),E.startAnimation(),null==e.onStart||e.onStart()})):(this._initTime=performance.now(),E.startAnimation(),null==(t=this.onStart)||t.call(this))}else E.tick(this._calculateDT(!1))},s.initPacer=function(){var e,t=null!==(e=Oe(N.SCREEN,"frameRate"))&&void 0!==e?e:60;F("number"==typeof t),this._pacer=new fe,this._pacer.onTick=this._updateCallback.bind(this),this.frameRate=t},s._initEvents=function(){M.on("show",this._onShow,this),M.on("hide",this._onHide,this),M.on("close",this._onClose,this)},s._onHide=function(){this.emit(i.EVENT_HIDE),this.pauseByEngine()},s._onShow=function(){this.emit(i.EVENT_SHOW),this.resumeByEngine()},s._onClose=function(){this.emit(i.EVENT_CLOSE),M.exit()},s.addPersistRootNode=function(e){E.addPersistRootNode(e)},s.removePersistRootNode=function(e){E.removePersistRootNode(e)},s.isPersistRootNode=function(e){return E.isPersistRootNode(e)},s._setupRenderPipeline=function(){var e=Oe(N.RENDERING,"customPipeline");return this._setRenderPipeline(!!e)},s._setRenderPipeline=function(e){E.root.setRenderPipeline(e)?(this._rendererInitialized=!0,this._safeEmit(i.EVENT_RENDERER_INITED)):x(1222)},s._safeEmit=function(e){this.emit(e)},R(i,[{key:"inited",get:function(){return this._inited}},{key:"frameRate",get:function(){return this._frameRate},set:function(e){"number"!=typeof e&&(e=parseInt(e,10),Number.isNaN(e)&&(e=60)),this._frameRate=e,this.frameTime=1e3/e,this._pacer&&(this._pacer.targetFrameRate=this._frameRate)}},{key:"deltaTime",get:function(){return this._useFixedDeltaTime?this.frameTime/1e3:this._deltaTime}},{key:"totalTime",get:function(){return performance.now()-this._initTime}},{key:"frameStartTime",get:function(){return this._startTime}}]),i}(k));ze.EVENT_HIDE="game_on_hide",ze.EVENT_SHOW="game_on_show",ze.EVENT_LOW_MEMORY="game_on_low_memory",ze.EVENT_GAME_INITED="game_inited",ze.EVENT_ENGINE_INITED="engine_inited",ze.EVENT_RENDERER_INITED="renderer_inited",ze.EVENT_PRE_BASE_INIT="pre_base_init",ze.EVENT_POST_BASE_INIT="post_base_init",ze.EVENT_PRE_INFRASTRUCTURE_INIT="pre_infrastructure_init",ze.EVENT_POST_INFRASTRUCTURE_INIT="post_infrastructure_init",ze.EVENT_PRE_SUBSYSTEM_INIT="pre_subsystem_init",ze.EVENT_POST_SUBSYSTEM_INIT="post_subsystem_init",ze.EVENT_PRE_PROJECT_INIT="pre_project_init",ze.EVENT_POST_PROJECT_INIT="post_project_init",ze.EVENT_RESTART="game_on_restart",ze.EVENT_PAUSE="game_on_pause",ze.EVENT_RESUME="game_on_resume",ze.EVENT_CLOSE="game_on_close",ze.RENDER_TYPE_CANVAS=0,ze.RENDER_TYPE_WEBGL=1,ze.RENDER_TYPE_OPENGL=2,ze.RENDER_TYPE_HEADLESS=3,ze.DEBUG_DT_THRESHOLD=1,de.Game=ze;var Be=e("g",de.game=new ze);p(S.prototype,"director",[{name:"calculateDeltaTime"},{name:"getDeltaTime",suggest:"Use game.deltaTime instead"},{name:"getTotalTime",suggest:"Use game.totalTime instead"},{name:"getCurrentTime",suggest:"Use game.frameStartTime instead"}]),f(S.prototype,"director",[{name:"setAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getRunningScene",suggest:"please use getScene instead"},{name:"setDepthTest",suggest:"please use camera API instead"},{name:"setClearColor",suggest:"please use camera API instead"},{name:"getWinSize",suggest:"please use view.getVisibleSize instead"},{name:"getWinSizeInPixels"},{name:"purgeCachedData",suggest:"please use assetManager.releaseAll instead"},{name:"convertToGL"},{name:"convertToUI"}]),T(E,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(e){var t;return W.main?null==(t=W.main.getSceneInfo(e))?void 0:t.uuid:""}}]),p(Be,"game",[{name:"collisionMatrix"},{name:"groupList"}]),T(Be,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var e=[];return W.main&&W.main.config.scenes.forEach((function(t){e.push(t)})),e}}])}}}));
//# sourceMappingURL=deprecated-gv6rCJsk.js.map
