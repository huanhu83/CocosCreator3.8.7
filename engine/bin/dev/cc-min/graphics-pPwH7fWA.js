System.register(["./gc-object-BD6DANSw.js","./index-BcjqSS2q.js","./_virtual_internal_constants-CVZmBipG.js","./global-exports-ZavlJGEN.js","./scene-D5fG1En6.js","./node-event-BDYemSfE.js","./deprecated-BaebfHhU.js","./ui-renderer-BG8n0rhU.js","./director-D6Xf3-Ej.js","./debug-view-zRQBd5E1.js","./device-manager-BCOP-4pU.js","./buffer-barrier-CZBuOw0V.js","./deprecated-BfPl6EQ2.js"],(function(t){"use strict";var i,e,s,n,o,r,h,l,a,c,u,p,f,d,m,_,v,T,g,b,C,y,E,R,D,M,L,P,x,O,S,U,N,A;return{setters:[function(t){i=t.r,e=t._,s=t.w,n=t.a,o=t.b,r=t.U},function(t){h=t.V,l=t.C,a=t.c,c=t.t,u=t.I,p=t.a,f=t.j,d=t.s},null,function(t){m=t.c},function(t){_=t.d},null,function(t){v=t.M},function(t){T=t.M,g=t.v,b=t.g,C=t.a,y=t.R,E=t.b,R=t.U,D=t.I},function(t){M=t.d},function(t){L=t.g},function(t){P=t.d},function(t){x=t.A,O=t.F,S=t.B,U=t.b,N=t.M,A=t.P},null],execute:function(){var I,w,B;t("a",I),function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE"}(I||t("a",I={})),i(I),t("L",w),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER"}(w||t("L",w={})),i(w),t("b",B),function(t){t[t.PT_CORNER=1]="PT_CORNER",t[t.PT_LEFT=2]="PT_LEFT",t[t.PT_BEVEL=4]="PT_BEVEL",t[t.PT_INNERBEVEL=8]="PT_INNERBEVEL"}(B||t("b",B={})),i(B);var k=Math.PI,j=Math.min,z=Math.max,F=Math.cos,V=Math.sin,J=Math.abs,W=Math.sign,Y=.5522847493;function G(t,i,e,s,n,o,r){var h,l,a=0,c=0,u=0,p=0,f=0,d=0,m=0,_=0,v=0,T=0,g=0,b=0,C=0,y=0;if(c=o-n,r=r||!1)if(J(c)>=2*k)c=2*k;else for(;c<0;)c+=2*k;else if(J(c)>=2*k)c=2*-k;else for(;c>0;)c-=2*k;for(l=0|z(1,j(J(c)/(.5*k)+.5,5)),u=J(4/3*(1-F(h=c/l/2))/V(h)),r||(u=-u),y=0;y<=l;y++)d=i+(p=F(a=n+c*(y/l)))*s,m=e+(f=V(a))*s,_=-f*s*u,v=p*s*u,0===y?t.moveTo(d,m):t.bezierCurveTo(T+b,g+C,d-_,m-v,d,m),T=d,g=m,b=_,C=v}function X(t,i,e,s,n){t.moveTo(i-s,e),t.bezierCurveTo(i-s,e+n*Y,i-s*Y,e+n,i,e+n),t.bezierCurveTo(i+s*Y,e+n,i+s,e+n*Y,i+s,e),t.bezierCurveTo(i+s,e-n*Y,i+s*Y,e-n,i,e-n),t.bezierCurveTo(i-s*Y,e-n,i-s,e-n*Y,i-s,e),t.close()}function q(t,i,e,s,n,o){if(o<.1)t.rect(i,e,s,n);else{var r=j(o,.5*J(s))*W(s),h=j(o,.5*J(n))*W(n);t.moveTo(i,e+h),t.lineTo(i,e+n-h),t.bezierCurveTo(i,e+n-h*(1-Y),i+r*(1-Y),e+n,i+r,e+n),t.lineTo(i+s-r,e+n),t.bezierCurveTo(i+s-r*(1-Y),e+n,i+s,e+n-h*(1-Y),i+s,e+n-h),t.lineTo(i+s,e+h),t.bezierCurveTo(i+s,e+h*(1-Y),i+s-r*(1-Y),e,i+s-r,e),t.lineTo(i+r,e),t.bezierCurveTo(i+r*(1-Y),e,i,e+h*(1-Y),i,e+h),t.close()}}function H(t,i,e,s,n,o,r,h,l,a,c){var u,p,f,d,m,_,v,T,g,b,C,y,E,R,D,M;a>10||(m=.5*(o+h),_=.5*(r+l),v=.5*((u=.5*(i+s))+(f=.5*(s+o))),T=.5*((p=.5*(e+n))+(d=.5*(n+r))),((D=J((s-h)*(R=l-e)-(n-l)*(E=h-i)))+(M=J((o-h)*R-(r-l)*E)))*(D+M)<t.tessTol*(E*E+R*R)?t.addPoint(h,l,0===c?c|B.PT_BEVEL:c):(H(t,i,e,u,p,v,T,C=.5*(v+(g=.5*(f+m))),y=.5*(T+(b=.5*(d+_))),a+1,0),H(t,C,y,g,b,m,_,h,l,a+1,c)))}var K,Q,Z,$,tt,it,et,st,nt,ot,rt,ht,lt,at=t("P",function(t){function i(i,e){var s;return(s=t.call(this,i,e)||this).dx=0,s.dy=0,s.dmx=0,s.dmy=0,s.flags=0,s.len=0,s}return e(i,t),i.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},i}(h)),ct=function(){function t(){this.closed=!1,this.bevel=0,this.complex=!0,this.points=[]}return t.prototype.reset=function(){this.closed=!1,this.bevel=0,this.complex=!0,this.points.length=0},t}(),ut=function(){function t(t){this.dataOffset=0,this.updatePathOffset=!1,this.pathLength=0,this.pathOffset=0,this.paths=[],this.tessTol=.25,this.distTol=.01,this.fillColor=l.WHITE.clone(),this.lineCap=I.BUTT,this.strokeColor=l.BLACK.clone(),this.lineJoin=w.MITER,this.lineWidth=0,this.pointsOffset=0,this._commandX=0,this._commandY=0,this._points=[],this._renderDataList=[],this._curPath=null,this._comp=t}var i=t.prototype;return i.moveTo=function(t,i){this.updatePathOffset&&(this.pathOffset=this.pathLength,this.updatePathOffset=!1),this._addPath(),this.addPoint(t,i,B.PT_CORNER),this._commandX=t,this._commandY=i},i.lineTo=function(t,i){this.addPoint(t,i,B.PT_CORNER),this._commandX=t,this._commandY=i},i.bezierCurveTo=function(t,i,e,s,n,o){var r=this._curPath,h=r.points[r.points.length-1];h&&(h.x!==t||h.y!==i||e!==n||s!==o?(H(this,h.x,h.y,t,i,e,s,n,o,0,B.PT_CORNER),this._commandX=n,this._commandY=o):this.lineTo(n,o))},i.quadraticCurveTo=function(t,i,e,s){var n=this._commandX,o=this._commandY;this.bezierCurveTo(n+2/3*(t-n),o+2/3*(i-o),e+2/3*(t-e),s+2/3*(i-s),e,s)},i.arc=function(t,i,e,s,n,o){G(this,t,i,e,s,n,o)},i.ellipse=function(t,i,e,s){X(this,t,i,e,s),this._curPath.complex=!1},i.circle=function(t,i,e){X(this,t,i,e,e),this._curPath.complex=!1},i.rect=function(t,i,e,s){this.moveTo(t,i),this.lineTo(t+e,i),this.lineTo(t+e,i+s),this.lineTo(t,i+s),this.close(),this._curPath.complex=!1},i.roundRect=function(t,i,e,s,n){q(this,t,i,e,s,n),this._curPath.complex=!1},i.clear=function(){this.pathLength=0,this.pathOffset=0,this.pointsOffset=0,this.dataOffset=0,this._curPath=null,this.paths.length=0,this._points.length=0;for(var t=this._renderDataList,i=0,e=t.length;i<e;i++){var s=t[i];s&&T.remove(s)}this._renderDataList.length=0},i.close=function(){this._curPath.closed=!0},i.requestRenderData=function(){var t=T.add();return this._renderDataList.push(t),t},i.getRenderDataList=function(){return 0===this._renderDataList.length&&this.requestRenderData(),this._renderDataList},i.addPoint=function(t,i,e){var s=this._curPath;if(s){var n=this._points,o=s.points,r=n[this.pointsOffset++];r?(r.x=t,r.y=i):(r=new at(t,i),n.push(r)),r.flags=e,o.push(r)}},i._addPath=function(){var t=this.pathLength,i=this.paths[t];return i?i.reset():(i=new ct,this.paths.push(i)),this.pathLength++,this._curPath=i,i},t}(),pt=g.concat([new x("a_dist",O.R32F)]),ft=b(pt),dt=C(pt),mt=t("G",(K=a("cc.Graphics"),Q=f(110),Z=c(w),$=c(I),K(tt=Q((lt=function(t){function i(){var i;return(i=t.call(this)||this).impl=null,i.model=null,i._lineWidth=et&&et(),i._strokeColor=st&&st(),i._lineJoin=nt&&nt(),i._lineCap=ot&&ot(),i._fillColor=rt&&rt(),i._miterLimit=ht&&ht(),i._isDrawing=!1,i._isNeedUploadData=!0,i._graphicsUseSubMeshes=[],i._instanceMaterialType=D.ADD_COLOR,i.impl=new ut(r(i)),i}e(i,t);var o=i.prototype;return o.onRestore=function(){this.impl||this._flushAssembler()},o.onLoad=function(){t.prototype.onLoad.call(this),this.model=M.root.createModel(v),this.model.node=this.model.transform=this.node,this._flushAssembler()},o.onEnable=function(){t.prototype.onEnable.call(this),this._updateMtlForGraphics()},o.onDestroy=function(){this._sceneGetter=null,this.model&&(M.root.destroyModel(this.model),this.model=null);var i=this._graphicsUseSubMeshes.length;if(i>0){for(var e=0;e<i;++e)this._graphicsUseSubMeshes[e].destroy();this._graphicsUseSubMeshes.length=0}this.impl&&(this._isDrawing=!1,this.impl.clear(),this.impl=null),t.prototype.onDestroy.call(this)},o.moveTo=function(t,i){this.impl&&this.impl.moveTo(t,i)},o.lineTo=function(t,i){this.impl&&this.impl.lineTo(t,i)},o.bezierCurveTo=function(t,i,e,s,n,o){this.impl&&this.impl.bezierCurveTo(t,i,e,s,n,o)},o.quadraticCurveTo=function(t,i,e,s){this.impl&&this.impl.quadraticCurveTo(t,i,e,s)},o.arc=function(t,i,e,s,n,o){this.impl&&this.impl.arc(t,i,e,s,n,o)},o.ellipse=function(t,i,e,s){this.impl&&this.impl.ellipse(t,i,e,s)},o.circle=function(t,i,e){this.impl&&this.impl.circle(t,i,e)},o.rect=function(t,i,e,s){this.impl&&this.impl.rect(t,i,e,s)},o.roundRect=function(t,i,e,s,n){this.impl&&this.impl.roundRect(t,i,e,s,n)},o.fillRect=function(t,i,e,s){this.rect(t,i,e,s),this.fill()},o.clear=function(){if(this.impl){if(this.impl.clear(),this._isDrawing=!1,this.model)for(var t=0;t<this.model.subModels.length;t++){var i=this.model.subModels[t].inputAssembler;i.indexCount=0,i.vertexCount=0}this._markForUpdateRenderData()}},o.close=function(){this.impl&&this.impl.close()},o.stroke=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.stroke(this)},o.fill=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.fill(this)},o._updateMtlForGraphics=function(){var t;this._customMaterial?t=this.getMaterialInstance(0):(t=_.get("ui-graphics-material"),this.setSharedMaterial(t,0),(t=this.getMaterialInstance(0)).recompileShaders({USE_LOCAL:!0}))},o.activeSubModel=function(t){if(this.model){if(this.model.subModels.length<=t){var i=P.gfxDevice,e=i.createBuffer(new S(U.VERTEX|U.TRANSFER_DST,N.DEVICE,65535*dt,dt)),n=i.createBuffer(new S(U.INDEX|U.TRANSFER_DST,N.DEVICE,131070*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),o=new L([e],pt,A.TRIANGLE_LIST,n);o.subMeshIdx=0,this.model.initSubModel(t,o,this.getMaterialInstance(0)),this._graphicsUseSubMeshes.push(o)}}else s(4500,this.node.name)},o._uploadData=function(){var t=this.impl;if(t){var i=t&&t.getRenderDataList();if(!(i.length<=0)&&this.model){for(var e=this.model.subModels,s=0;s<i.length;s++){var n=i[s],o=e[s].inputAssembler;if(n.lastFilledVertex!==n.vertexStart){var r=new Float32Array(n.vData.buffer,0,n.vertexStart*ft);o.vertexBuffers[0].update(r),o.vertexCount=n.vertexStart;var h=new Uint16Array(n.iData.buffer,0,n.indexStart);o.indexBuffer.update(h),o.indexCount=n.indexStart,n.lastFilledVertex=n.vertexStart,n.lastFilledIndex=n.indexStart}}this._isNeedUploadData=!1}}},o._render=function(t){if(this.getMaterialInstance(0)){if(this._isNeedUploadData){if(this.impl){var i=this.impl.getRenderDataList(),e=this.model.subModels.length;if(i.length>e)for(var s=e;s<i.length;s++)this.activeSubModel(s)}this._uploadData()}t.commitModel(this,this.model,this.getMaterialInstance(0))}},o._flushAssembler=function(){var t=i.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t)},o._canRender=function(){return!!t.prototype._canRender.call(this)&&!!this.model&&this._isDrawing},o.updateRenderer=function(){t.prototype.updateRenderer.call(this)},o.createRenderEntity=function(){return new y(E.DYNAMIC)},n(i,[{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.impl&&(this.impl.lineWidth=t)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this.impl&&(this.impl.lineJoin=t)}},{key:"lineCap",get:function(){return this._lineCap},set:function(t){this._lineCap=t,this.impl&&(this.impl.lineCap=t)}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(t){this.impl&&(this._strokeColor.set(t),this.impl.strokeColor=this._strokeColor)}},{key:"fillColor",get:function(){return this._fillColor},set:function(t){this.impl&&(this._fillColor.set(t),this.impl.fillColor=this._fillColor)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit=t}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"graphicsNativeProxy",get:function(){return this._graphicsNativeProxy}}]),i}(R),lt.LineJoin=w,lt.LineCap=I,o((it=lt).prototype,"lineJoin",[Z],Object.getOwnPropertyDescriptor(it.prototype,"lineJoin"),it.prototype),o(it.prototype,"lineCap",[$],Object.getOwnPropertyDescriptor(it.prototype,"lineCap"),it.prototype),o(it.prototype,"color",[u],Object.getOwnPropertyDescriptor(it.prototype,"color"),it.prototype),et=p(it.prototype,"_lineWidth",[d],(function(){return 1})),st=p(it.prototype,"_strokeColor",[d],(function(){return l.BLACK.clone()})),nt=p(it.prototype,"_lineJoin",[d],(function(){return w.MITER})),ot=p(it.prototype,"_lineCap",[d],(function(){return I.BUTT})),rt=p(it.prototype,"_fillColor",[d],(function(){return l.WHITE.clone()})),ht=p(it.prototype,"_miterLimit",[d],(function(){return 10})),tt=it))||tt)||tt));m.Graphics=mt}}}));
//# sourceMappingURL=graphics-pPwH7fWA.js.map
