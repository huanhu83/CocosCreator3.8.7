System.register(["./gc-object-BD6DANSw.js","./index-BcjqSS2q.js","./_virtual_internal_constants-CVZmBipG.js","./global-exports-ZavlJGEN.js","./graphics-pPwH7fWA.js","./ui-renderer-BG8n0rhU.js","./scene-D5fG1En6.js","./sprite-8ksyG6DL.js","./prefab-CJahvMeV.js","./pipeline-state-manager-C4BAah3w.js","./node-event-BDYemSfE.js","./deprecated-BaebfHhU.js","./device-manager-BCOP-4pU.js","./buffer-barrier-CZBuOw0V.js","./debug-view-zRQBd5E1.js","./director-D6Xf3-Ej.js","./deprecated-BfPl6EQ2.js","./deprecated-gv6rCJsk.js","./renderer-DVTO-7-w.js","./sorting-layers-sC9IxUEk.js","./touch-Ch03mDFP.js","./sprite-frame-CT0e6iHI.js","./create-mesh-CgNcAxLl.js","./mesh-BsaPYlYJ.js","./wasm-web-DpHjq6qw.js","./zlib.min-CyXMsivM.js"],(function(t){"use strict";var e,s,i,n,r,o,a,h,u,p,l,c,_,d,m,C,f,g,y,E,b,R,S;return{setters:[function(t){e=t.r,s=t._,i=t.w,n=t.a,r=t.b,o=t.h},function(t){a=t.M,h=t.V,u=t.c,p=t.t,l=t.C,c=t.f,_=t.a,d=t.j,m=t.b,C=t.s},null,function(t){f=t.c},function(t){g=t.G},function(t){y=t.S},function(t){E=t.aH},function(t){b=t.S},null,null,function(t){R=t.N,S=t.C},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var T,I,v,M,L,P,j,N,G,H,A,k=new a,D=new h,x=new a,w=[];function V(t,e,s){w.length=0;for(var i=2*Math.PI/s,n=0;n<s;++n)w.push(new c(e.x*Math.cos(i*n)+t.x,e.y*Math.sin(i*n)+t.y,0));return w}t("MaskType",A),function(t){t[t.GRAPHICS_RECT=0]="GRAPHICS_RECT",t[t.GRAPHICS_ELLIPSE=1]="GRAPHICS_ELLIPSE",t[t.GRAPHICS_STENCIL=2]="GRAPHICS_STENCIL",t[t.SPRITE_STENCIL=3]="SPRITE_STENCIL"}(A||t("MaskType",A={})),e(A);var U=t("Mask",(T=u("cc.Mask"),I=d(110),v=p(A),T(M=I((H=function(t){function e(){var e;return(e=t.call(this)||this)._type=P&&P(),e._inverted=j&&j(),e._segments=N&&N(),e._alphaThreshold=G&&G(),e._sprite=null,e._graphics=null,e._stencilStage=y.DISABLED,e}s(e,t);var r=e.prototype;return r.onLoad=function(){this._changeRenderType()},r.onEnable=function(){this._changeRenderType(),this._updateGraphics(),this._enableRender(),this.node.on(R.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(R.SIZE_CHANGED,this._nodeStateChange,this)},r.onRestore=function(){this._changeRenderType(),this._updateGraphics()},r.onDisable=function(){this._disableRender(),this.node.off(R.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(R.SIZE_CHANGED,this._nodeStateChange,this)},r.onDestroy=function(){this._removeMaskNode()},r.isHit=function(t){var e=this.node._getUITransformComp(),s=e.contentSize,i=s.width,n=s.height,r=D;this.node.getWorldMatrix(k),a.invert(x,k),h.transformMat4(r,t,x);var o=e.anchorPoint;r.x+=o.x*i,r.y+=o.y*n;var u=!1;if(this.type===A.GRAPHICS_RECT||this.type===A.GRAPHICS_STENCIL||this.type===A.SPRITE_STENCIL)u=r.x>=0&&r.y>=0&&r.x<=i&&r.y<=n;else if(this.type===A.GRAPHICS_ELLIPSE){var p=i/2,l=n/2,c=r.x-.5*i,_=r.y-.5*n;u=c*c/(p*p)+_*_/(l*l)<1}return this._inverted&&(u=!u),u},r._nodeStateChange=function(){this._updateGraphics()},r._changeRenderType=function(){this._type!==A.SPRITE_STENCIL?this._createGraphics():this._createSprite()},r._createSprite=function(){if(!this._sprite){var t=this._sprite=this.node.getComponent(b);if(!t){var e=this.node;t=this._sprite=e.addComponent(b)}}this._sprite.stencilStage=this.inverted?y.ENTER_LEVEL_INVERTED:y.ENTER_LEVEL,this._sprite.updateMaterial()},r._createGraphics=function(){if(!this._graphics){var t=this._graphics=this.node.getComponent(g);if(!t){var e=this.node;t=this._graphics=e.addComponent(g)}t.lineWidth=1;var s=l.WHITE.clone();s.a=0,t.fillColor=s}this._graphics.stencilStage=this.inverted?y.ENTER_LEVEL_INVERTED:y.ENTER_LEVEL},r._updateGraphics=function(){if(this._graphics&&(this._type===A.GRAPHICS_RECT||this._type===A.GRAPHICS_ELLIPSE)){var t=this.node._getUITransformComp(),e=this._graphics;e.clear();var s=t.contentSize,i=s.width,n=s.height,r=t.anchorPoint,o=-i*r.x,a=-n*r.y;if(this._type===A.GRAPHICS_RECT)e.rect(o,a,i,n);else if(this._type===A.GRAPHICS_ELLIPSE){for(var h=V(new c(o+i/2,a+n/2,0),new c(i/2,n/2,0),this._segments),u=0;u<h.length;++u){var p=h[u];0===u?e.moveTo(p.x,p.y):e.lineTo(p.x,p.y)}e.close()}e.fill()}},r._enableRender=function(){this.subComp&&(this.subComp.enabled=!0)},r._disableRender=function(){this.subComp&&(this.subComp.stencilStage=y.DISABLED,this.subComp.updateMaterial(),this.node.activeInHierarchy&&(this.subComp.enabled=!1))},r._removeMaskNode=function(){this._sprite&&(this._sprite=null),this._graphics&&(this._graphics=null)},r.markForUpdateRenderData=function(t){void 0===t&&(t=!0),i(9007),this.subComp&&this.subComp._markForUpdateRenderData(t)},r.requestRenderData=function(){i(9007)},r.destroyRenderData=function(){i(9007)},r.updateRenderer=function(){i(9007),this.subComp&&this.subComp.updateRenderer()},r.fillBuffers=function(){i(9007)},r.postUpdateAssembler=function(){i(9007)},r.setNodeDirty=function(){i(9007),this.subComp&&this.subComp.setNodeDirty()},r.setTextureDirty=function(){i(9007),this.subComp&&this.subComp.setTextureDirty()},r.getMaterial=function(t){return i(9007),this.subComp?this.subComp.getSharedMaterial(t):null},r.setMaterial=function(t,e){i(9007),this.subComp&&this.subComp.setMaterial(t,e)},r.getMaterialInstance=function(t){return i(9007),this.subComp?this.subComp.getMaterialInstance(t):null},r.setMaterialInstance=function(t,e){i(9007),this.subComp&&this.subComp.setMaterialInstance(t,e)},r.getRenderMaterial=function(t){return i(9007),this.subComp?this.subComp.getRenderMaterial(t):null},n(e,[{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this._type!==A.SPRITE_STENCIL?(this._sprite&&(this.node.removeComponent(b),this._sprite._destroyImmediate(),this._sprite=null),this._changeRenderType(),this._updateGraphics()):(this._graphics&&(this._graphics.clear(),this.node.removeComponent(g),this._graphics._destroyImmediate(),this._graphics=null),this._changeRenderType()))}},{key:"inverted",get:function(){return this._inverted},set:function(t){this._inverted=t,this.subComp.stencilStage=this.inverted?y.ENTER_LEVEL_INVERTED:y.ENTER_LEVEL}},{key:"segments",get:function(){return this._segments},set:function(t){this._segments!==t&&(this._segments=m(t,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._sprite?this._sprite.spriteFrame:null},set:function(t){this._sprite?this._sprite.spriteFrame=t:o(16307)}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(t){this._alphaThreshold!==t&&(this._alphaThreshold=t,this.type===A.SPRITE_STENCIL&&this._sprite&&this._sprite.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"subComp",get:function(){return this._graphics||this._sprite}},{key:"customMaterial",get:function(){return i(9007),this.subComp?this.subComp.customMaterial:null},set:function(t){i(9007),this.subComp&&(this.subComp.customMaterial=t)}},{key:"color",get:function(){return i(9007),this.subComp?this.subComp.color:null},set:function(t){i(9007),this.subComp&&t&&(this.subComp.color=t)}},{key:"sharedMaterial",get:function(){return i(9007),this.subComp?this.subComp.sharedMaterial:null}},{key:"sharedMaterials",get:function(){return i(9007),this.subComp?this.subComp.sharedMaterials:null},set:function(t){i(9007),this.subComp&&t&&(this.subComp.sharedMaterials=t)}},{key:"material",get:function(){return i(9007),this.subComp?this.subComp.material:null},set:function(t){i(9007),this.subComp&&(this.subComp.material=t)}},{key:"materials",get:function(){return i(9007),this.subComp?this.subComp.materials:[null]},set:function(t){i(9007),this.subComp&&(this.subComp.materials=t)}}]),e}(S),H.Type=A,r((L=H).prototype,"type",[v],Object.getOwnPropertyDescriptor(L.prototype,"type"),L.prototype),P=_(L.prototype,"_type",[C],(function(){return A.GRAPHICS_RECT})),j=_(L.prototype,"_inverted",[C],(function(){return!1})),N=_(L.prototype,"_segments",[C],(function(){return 64})),G=_(L.prototype,"_alphaThreshold",[C],(function(){return.1})),M=L))||M)||M));E._maskComp=U,f.Mask=U}}}));
//# sourceMappingURL=mask.js.map
