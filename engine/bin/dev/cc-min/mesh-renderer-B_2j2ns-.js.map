{"version":3,"file":"mesh-renderer-B_2j2ns-.js","sources":["../../../cocos/3d/models/morph-model.ts","../../../cocos/3d/framework/mesh-renderer.ts"],"sourcesContent":["/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { Model } from '../../render-scene/scene/model';\r\nimport { MorphRenderingInstance } from '../assets/morph-rendering';\r\nimport { Material } from '../../asset/assets/material';\r\nimport { RenderingSubMesh } from '../../asset/assets/rendering-sub-mesh';\r\nimport { DescriptorSet } from '../../gfx';\r\nimport { IMacroPatch } from '../../render-scene';\r\n\r\n/**\r\n * @en\r\n * The model that support morph target rendering.\r\n * @zh\r\n * 支持渲染蒙皮形变的模型。\r\n */\r\nexport class MorphModel extends Model {\r\n    private _morphRenderingInstance: MorphRenderingInstance | null = null;\r\n    private _usedMaterials = new Set<Material>();\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * @en Acquire the material's macro patches for the given sub model.\r\n     * @zh 获取指定子模型的材质宏组合。\r\n     * @param subModelIndex @en The index for the requested sub model. @zh 子模型的序号。\r\n     * @returns @en The macro patches. @zh 材质宏组合\r\n     */\r\n    public getMacroPatches (subModelIndex: number): IMacroPatch[] | null {\r\n        const superMacroPatches = super.getMacroPatches(subModelIndex);\r\n        if (this._morphRenderingInstance) {\r\n            const morphInstanceMacroPatches = this._morphRenderingInstance.requiredPatches(subModelIndex);\r\n            if (morphInstanceMacroPatches) {\r\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-return\r\n                return morphInstanceMacroPatches.concat(superMacroPatches ?? []);\r\n            }\r\n        }\r\n        return superMacroPatches;\r\n    }\r\n\r\n    /**\r\n     * @en Initialize a sub model with the sub mesh data and the material.\r\n     * @zh 用子网格数据和材质初始化一个子模型。\r\n     * @param idx @en The index of the sub model @zh 子模型的序号\r\n     * @param subMeshData @en The sub mesh data to be set @zh 需要设置的子网格\r\n     * @param mat sub material\r\n     */\r\n    public initSubModel (subModelIndex: number, subMeshData: RenderingSubMesh, material: Material): void {\r\n        return super.initSubModel(\r\n            subModelIndex,\r\n            subMeshData,\r\n            this._launderMaterial(material),\r\n        );\r\n    }\r\n\r\n    public destroy (): void {\r\n        super.destroy();\r\n        this._morphRenderingInstance = null;\r\n    }\r\n\r\n    /**\r\n     * @en Sets the material for a given sub model.\r\n     * @zh 给指定的子模型设置材质。\r\n     * @param subModelIndex @en The index of the sub model @zh 子模型的序号\r\n     * @param material @en The material to be set @zh 需要设置的材质\r\n     * @returns void\r\n     */\r\n    public setSubModelMaterial (subModelIndex: number, material: Material): void {\r\n        return super.setSubModelMaterial(subModelIndex, this._launderMaterial(material));\r\n    }\r\n\r\n    /**\r\n     * Sets morph rendering instance for the model, it's managed by the MeshRenderer\r\n     * @internal\r\n     */\r\n    public setMorphRendering (morphRendering: MorphRenderingInstance): void {\r\n        this._morphRenderingInstance = morphRendering;\r\n    }\r\n\r\n    protected _updateLocalDescriptors (submodelIdx: number, descriptorSet: DescriptorSet): void {\r\n        super._updateLocalDescriptors(submodelIdx, descriptorSet);\r\n\r\n        if (this._morphRenderingInstance) {\r\n            this._morphRenderingInstance.adaptPipelineState(submodelIdx, descriptorSet);\r\n        }\r\n    }\r\n\r\n    private _launderMaterial (material: Material): Material {\r\n        return material;\r\n        // if (this._usedMaterials.has(material)) {\r\n        //     return new MaterialInstance({\r\n        //         parent: material,\r\n        //     });\r\n        // } else {\r\n        //     this._usedMaterials.add(material);\r\n        //     return material;\r\n        // }\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos2d-x.org\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\nimport { JSB } from 'internal:constants';\r\nimport { displayOrder, group, range } from 'cc.decorator';\r\nimport { Texture2D, TextureCube } from '../../asset/assets';\r\nimport { Material } from '../../asset/assets/material';\r\nimport { Mesh } from '../assets/mesh';\r\nimport { Vec4, Enum, cclegacy, CCBoolean, CCFloat, assertIsTrue, _decorator, CCInteger, EventTarget, warnID } from '../../core';\r\nimport { scene } from '../../render-scene';\r\nimport { MorphModel } from '../models/morph-model';\r\nimport { Root } from '../../root';\r\nimport { MobilityMode, TransformBit } from '../../scene-graph/node-enum';\r\nimport { ModelRenderer } from '../../misc/model-renderer';\r\nimport { MorphRenderingInstance } from '../assets/morph-rendering';\r\nimport { NodeEventType } from '../../scene-graph/node-event';\r\nimport { Texture } from '../../gfx';\r\nimport { builtinResMgr } from '../../asset/asset-manager/builtin-res-mgr';\r\nimport { settings, SettingsCategory } from '../../core/settings';\r\nimport { ReflectionProbeType } from '../reflection-probe/reflection-probe-enum';\r\nimport { getPhaseID } from '../../rendering/pass-phase';\r\nimport { SubModel } from '../../render-scene/scene';\r\nimport { isEnableEffect } from '../../rendering/define';\r\nimport type { Model } from '../../render-scene/scene';\r\nimport type { ReflectionProbeManager } from '../reflection-probe';\r\nimport { getPipelineSceneData } from '../../rendering/pipeline-scene-data-utils';\r\n\r\nconst { ccclass, help, executeInEditMode, executionOrder, menu, visible, type,\r\n    formerlySerializedAs, serializable, editable, disallowAnimation } = _decorator;\r\n\r\nlet _phaseID = getPhaseID('specular-pass');\r\nfunction getSkinPassIndex (subModel: SubModel): number {\r\n    const passes = subModel.passes;\r\n    const r = cclegacy.rendering;\r\n    if (isEnableEffect()) _phaseID = r.getPhaseID(r.getPassID('specular-pass'), 'default');\r\n    for (let k = 0; k < passes.length; k++) {\r\n        if (((!r || !r.enableEffectImport) && passes[k].phase === _phaseID)\r\n            || (isEnableEffect() && passes[k].phaseID === _phaseID)) {\r\n            return k;\r\n        }\r\n    }\r\n    return -1;\r\n}\r\n\r\n/**\r\n * @en Shadow projection mode.\r\n * @zh 阴影投射方式。\r\n */\r\nconst ModelShadowCastingMode = Enum({\r\n    /**\r\n     * @en Disable shadow projection.\r\n     * @zh 不投射阴影。\r\n     */\r\n    OFF: 0,\r\n    /**\r\n     * @en Enable shadow projection.\r\n     * @zh 开启阴影投射。\r\n     */\r\n    ON: 1,\r\n});\r\n\r\n/**\r\n * @en Shadow receive mode.\r\n * @zh 阴影接收方式。\r\n */\r\nconst ModelShadowReceivingMode = Enum({\r\n    /**\r\n     * @en Disable shadow receiving.\r\n     * @zh 不接收阴影。\r\n     */\r\n    OFF: 0,\r\n    /**\r\n     * @en Enable shadow receiving.\r\n     * @zh 开启阴影投射。\r\n     */\r\n    ON: 1,\r\n});\r\n\r\nenum ModelBakeSettingsEvent {\r\n    /**\r\n     * @en The event which will be triggered when the useLightProbe is changed.\r\n     * @zh useLightProbe属性修改时触发的事件\r\n     */\r\n    USE_LIGHT_PROBE_CHANGED = 'use_light_probe_changed',\r\n\r\n    /**\r\n     * @en The event which will be triggered when the reflectionProbe is changed.\r\n     * @zh reflectionProbe 属性修改时触发的事件\r\n     */\r\n    REFLECTION_PROBE_CHANGED = 'reflection_probe_changed',\r\n\r\n    /**\r\n     * @en The event which will be triggered when the bakeToReflectionProbe is changed.\r\n     * @zh bakeToReflectionProbe 属性修改时触发的事件\r\n     */\r\n    BAKE_TO_REFLECTION_PROBE_CHANGED = 'bake_to_reflection_probe_changed',\r\n}\r\n\r\n/**\r\n * @en Model's bake settings.\r\n * @zh 模型烘焙设置\r\n */\r\n@ccclass('cc.ModelBakeSettings')\r\nclass ModelBakeSettings extends EventTarget {\r\n    /**\r\n     * @en The event which will be triggered when the useLightProbe is changed.\r\n     * @zh useLightProbe属性修改时触发的事件\r\n     */\r\n    public static readonly USE_LIGHT_PROBE_CHANGED = ModelBakeSettingsEvent.USE_LIGHT_PROBE_CHANGED;\r\n\r\n    /**\r\n     * @en The event which will be triggered when the reflectionProbe is changed.\r\n     * @zh reflectionProbe 属性修改时触发的事件\r\n     */\r\n    public static readonly REFLECTION_PROBE_CHANGED = ModelBakeSettingsEvent.REFLECTION_PROBE_CHANGED;\r\n\r\n    /**\r\n     * @en The event which will be triggered when the bakeToReflectionProbe is changed.\r\n     * @zh bakeToReflectionProbe 属性修改时触发的事件\r\n     */\r\n    public static readonly BAKE_TO_REFLECTION_PROBE_CHANGED = ModelBakeSettingsEvent.BAKE_TO_REFLECTION_PROBE_CHANGED;\r\n\r\n    @serializable\r\n    public texture: Texture2D|null = null;\r\n    @serializable\r\n    public uvParam: Vec4 = new Vec4();\r\n    @serializable\r\n    protected _bakeable = false;\r\n    @serializable\r\n    protected _castShadow = false;\r\n    @formerlySerializedAs('_recieveShadow')\r\n    protected _receiveShadow = false;\r\n    @serializable\r\n    protected _lightmapSize = 64;\r\n\r\n    @serializable\r\n    protected _useLightProbe = false;\r\n    @serializable\r\n    protected _bakeToLightProbe = true;\r\n\r\n    @serializable\r\n    protected _reflectionProbeType = ReflectionProbeType.NONE;\r\n    @serializable\r\n    protected _bakeToReflectionProbe = true;\r\n\r\n    public probeCubemap: TextureCube | null = null;\r\n    public probeBlendCubemap: TextureCube | null = null;\r\n    public probePlanarmap: Texture | null = null;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * @en Whether the model is static and bake-able with light map.\r\n     * Notice: the model's vertex data must have the second UV attribute to enable light map baking.\r\n     * @zh 模型是否是静态的并可以烘培光照贴图。\r\n     * 注意：模型顶点数据必须包含第二套 UV 属性来支持光照贴图烘焙。\r\n     */\r\n    @group({ id: 'LightMap', name: 'i18n:ENGINE.classes.cc.ModelBakeSettings.groups.LightMap.displayName', displayOrder: 0, style: 'section' })\r\n    @editable\r\n    get bakeable (): boolean {\r\n        return this._bakeable;\r\n    }\r\n\r\n    set bakeable (val) {\r\n        this._bakeable = val;\r\n    }\r\n\r\n    /**\r\n     * @en Whether to cast shadow in light map baking.\r\n     * @zh 在光照贴图烘焙中是否投射阴影。\r\n     */\r\n    @group({ id: 'LightMap', name: 'i18n:ENGINE.classes.cc.ModelBakeSettings.groups.LightMap.displayName' })\r\n    @editable\r\n    get castShadow (): boolean {\r\n        return this._castShadow;\r\n    }\r\n\r\n    set castShadow (val) {\r\n        this._castShadow = val;\r\n    }\r\n\r\n    /**\r\n     * @en Whether to receive shadow in light map baking.\r\n     * @zh 在光照贴图烘焙中是否接受阴影。\r\n     */\r\n    @group({ id: 'LightMap', name: 'i18n:ENGINE.classes.cc.ModelBakeSettings.groups.LightMap.displayName' })\r\n    @editable\r\n    get receiveShadow (): boolean {\r\n        return this._receiveShadow;\r\n    }\r\n\r\n    set receiveShadow (val) {\r\n        this._receiveShadow = val;\r\n    }\r\n\r\n    /**\r\n     * @en The lightmap size.\r\n     * @zh 光照图大小。\r\n     */\r\n    @group({ id: 'LightMap', name: 'i18n:ENGINE.classes.cc.ModelBakeSettings.groups.LightMap.displayName' })\r\n    @editable\r\n    @type(CCInteger)\r\n    @range([0, 1024])\r\n    get lightmapSize (): number {\r\n        return this._lightmapSize;\r\n    }\r\n\r\n    set lightmapSize (val) {\r\n        this._lightmapSize = val;\r\n    }\r\n\r\n    /**\r\n     * @en Whether to use light probe which provides indirect light to dynamic objects.\r\n     * @zh 模型是否使用光照探针，光照探针为动态物体提供间接光。\r\n     */\r\n    @group({ id: 'LightProbe', name: 'i18n:ENGINE.classes.cc.ModelBakeSettings.groups.LightProbe.displayName', displayOrder: 1, style: 'section' })\r\n    @editable\r\n    @type(CCBoolean)\r\n    get useLightProbe (): boolean {\r\n        return this._useLightProbe;\r\n    }\r\n\r\n    set useLightProbe (val) {\r\n        this._useLightProbe = val;\r\n        this.emit(ModelBakeSettingsEvent.USE_LIGHT_PROBE_CHANGED);\r\n    }\r\n\r\n    /**\r\n     * @en Whether the model is used to calculate light probe\r\n     * @zh 模型是否用于计算光照探针\r\n     */\r\n    @group({ id: 'LightProbe', name: 'i18n:ENGINE.classes.cc.ModelBakeSettings.groups.LightProbe.displayName' })\r\n    @editable\r\n    @type(CCBoolean)\r\n    get bakeToLightProbe (): boolean {\r\n        return this._bakeToLightProbe;\r\n    }\r\n\r\n    set bakeToLightProbe (val) {\r\n        this._bakeToLightProbe = val;\r\n    }\r\n\r\n    /**\r\n     * @en Used to set whether to use the reflection probe or set probe's type.\r\n     * @zh 用于设置是否使用反射探针或者设置反射探针的类型。\r\n     */\r\n    @group({\r\n        id: 'ReflectionProbe',\r\n        name: 'i18n:ENGINE.classes.cc.ModelBakeSettings.groups.ReflectionProbe.displayName',\r\n        displayOrder: 2,\r\n        style: 'section',\r\n    })\r\n    @type(Enum(ReflectionProbeType))\r\n    get reflectionProbe (): ReflectionProbeType {\r\n        return this._reflectionProbeType;\r\n    }\r\n\r\n    set reflectionProbe (val) {\r\n        this._reflectionProbeType = val;\r\n        this.emit(ModelBakeSettingsEvent.REFLECTION_PROBE_CHANGED);\r\n    }\r\n\r\n    /**\r\n     * @en Whether the model can be render by the reflection probe\r\n     * @zh 模型是否能被反射探针渲染\r\n     */\r\n    @group({ id: 'ReflectionProbe', name: 'i18n:ENGINE.classes.cc.ModelBakeSettings.groups.ReflectionProbe.displayName' })\r\n    @type(CCBoolean)\r\n    get bakeToReflectionProbe (): boolean {\r\n        return this._bakeToReflectionProbe;\r\n    }\r\n\r\n    set bakeToReflectionProbe (val) {\r\n        this._bakeToReflectionProbe = val;\r\n        this.emit(ModelBakeSettingsEvent.BAKE_TO_REFLECTION_PROBE_CHANGED);\r\n    }\r\n}\r\n\r\n/**\r\n * @en Mesh renderer component for general 3d model rendering, it generates and link to a Model in the render scene.\r\n * It supports real time lighting and shadow, baked light map, and morph rendering.\r\n * @zh 用于通用模型渲染的网格渲染器组件，会创建并关联一个渲染场景中的模型对象。\r\n * 该组件支持实时光照和阴影，预烘焙光照贴图和形变网格渲染。\r\n */\r\n@ccclass('cc.MeshRenderer')\r\n@help('i18n:cc.MeshRenderer')\r\n@executionOrder(100)\r\n@menu('Mesh/MeshRenderer')\r\n@executeInEditMode\r\nexport class MeshRenderer extends ModelRenderer {\r\n    /**\r\n     * @en Shadow projection mode enumeration.\r\n     * @zh 阴影投射方式枚举。\r\n     */\r\n    public static ShadowCastingMode = ModelShadowCastingMode;\r\n    /**\r\n     * @en Shadow receive mode enumeration.\r\n     * @zh 阴影接收方式枚举。\r\n     */\r\n    public static ShadowReceivingMode = ModelShadowReceivingMode;\r\n\r\n    /**\r\n     * @en The settings for GI baking, it was called lightmapSettings before\r\n     * @zh 全局光照烘焙的配置，以前名称为lightmapSettings\r\n     */\r\n    @serializable\r\n    @editable\r\n    @disallowAnimation\r\n    @displayOrder(3)\r\n    public bakeSettings = new ModelBakeSettings();\r\n\r\n    @serializable\r\n    protected _mesh: Mesh | null = null;\r\n\r\n    @serializable\r\n    protected _shadowCastingMode = ModelShadowCastingMode.OFF;\r\n\r\n    @serializable\r\n    protected _shadowReceivingMode = ModelShadowReceivingMode.ON;\r\n\r\n    @serializable\r\n    protected _shadowBias = 0;\r\n\r\n    @serializable\r\n    protected _shadowNormalBias = 0;\r\n\r\n    @serializable\r\n    protected _reflectionProbeId = -1;\r\n\r\n    @serializable\r\n    protected _reflectionProbeBlendId = -1;\r\n\r\n    @serializable\r\n    protected _reflectionProbeBlendWeight = 0;\r\n\r\n    @serializable\r\n    protected _enabledGlobalStandardSkinObject = false;\r\n\r\n    protected _reflectionProbeDataMap: Texture2D | null = null;\r\n\r\n    // @serializable\r\n    private _subMeshShapesWeights: number[][] = [];\r\n\r\n    /**\r\n     * @en Local shadow bias for real time lighting.\r\n     * @zh 实时光照下模型局部的阴影偏移。\r\n     */\r\n    @type(CCFloat)\r\n    @group({\r\n        id: 'DynamicShadow',\r\n        name: 'i18n:ENGINE.classes.cc.MeshRenderer.groups.DynamicShadow.displayName',\r\n        displayOrder: 2,\r\n        style: 'section',\r\n    })\r\n    @disallowAnimation\r\n    get shadowBias (): number {\r\n        return this._shadowBias;\r\n    }\r\n\r\n    set shadowBias (val) {\r\n        this._shadowBias = val;\r\n        this._updateShadowBias();\r\n        this._onUpdateLocalShadowBiasAndProbeId();\r\n    }\r\n\r\n    /**\r\n   * @en local shadow normal bias for real time lighting.\r\n   * @zh 实时光照下模型局部的阴影法线偏移。\r\n   */\r\n    @type(CCFloat)\r\n    @group({ id: 'DynamicShadow', name: 'i18n:ENGINE.classes.cc.MeshRenderer.groups.DynamicShadow.displayName' })\r\n    @disallowAnimation\r\n    get shadowNormalBias (): number {\r\n        return this._shadowNormalBias;\r\n    }\r\n\r\n    set shadowNormalBias (val) {\r\n        this._shadowNormalBias = val;\r\n        this._updateShadowNormalBias();\r\n        this._onUpdateLocalShadowBiasAndProbeId();\r\n    }\r\n\r\n    /**\r\n     * @en Shadow projection mode.\r\n     * @zh 实时光照下阴影投射方式。\r\n     */\r\n    @type(ModelShadowCastingMode)\r\n    @group({ id: 'DynamicShadow', name: 'i18n:ENGINE.classes.cc.MeshRenderer.groups.DynamicShadow.displayName' })\r\n    @disallowAnimation\r\n    @visible(false)\r\n    get shadowCastingMode (): number {\r\n        return this._shadowCastingMode;\r\n    }\r\n\r\n    set shadowCastingMode (val) {\r\n        this._shadowCastingMode = val;\r\n        this._updateCastShadow();\r\n    }\r\n\r\n    @group({ id: 'DynamicShadow', name: 'i18n:ENGINE.classes.cc.MeshRenderer.groups.DynamicShadow.displayName' })\r\n    @disallowAnimation\r\n    get shadowCastingModeForInspector (): boolean {\r\n        return this.shadowCastingMode === ModelShadowCastingMode.ON;\r\n    }\r\n    set shadowCastingModeForInspector (val) {\r\n        this.shadowCastingMode = val === true ? ModelShadowCastingMode.ON : ModelShadowCastingMode.OFF;\r\n    }\r\n\r\n    /**\r\n     * @en Is received direction Light.\r\n     * @zh 是否接收平行光光照。\r\n     * @param visibility @en direction light visibility. @zh 方向光的可见性。\r\n     */\r\n    public onUpdateReceiveDirLight (visibility: number, forceClose = false): void {\r\n        if (!this._model) { return; }\r\n        if (forceClose) {\r\n            this._model.receiveDirLight = false;\r\n            return;\r\n        }\r\n        if (this.node && ((visibility & this.node.layer) === this.node.layer)\r\n        || (visibility & this._model.visFlags)) {\r\n            this._model.receiveDirLight = true;\r\n        } else {\r\n            this._model.receiveDirLight = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en receive shadow.\r\n     * @zh 实时光照下是否接受阴影。\r\n     */\r\n    @type(ModelShadowReceivingMode)\r\n    @visible(false)\r\n    get receiveShadow (): number {\r\n        return this._shadowReceivingMode;\r\n    }\r\n    set receiveShadow (val) {\r\n        this._shadowReceivingMode = val;\r\n        this._updateReceiveShadow();\r\n    }\r\n\r\n    @group({ id: 'DynamicShadow', name: 'i18n:ENGINE.classes.cc.MeshRenderer.groups.DynamicShadow.displayName' })\r\n    @disallowAnimation\r\n    get receiveShadowForInspector (): boolean {\r\n        return this._shadowReceivingMode === ModelShadowReceivingMode.ON;\r\n    }\r\n    set receiveShadowForInspector (val: boolean) {\r\n        this._shadowReceivingMode = val === true ? ModelShadowReceivingMode.ON : ModelShadowReceivingMode.OFF;\r\n        this._updateReceiveShadow();\r\n    }\r\n\r\n    /**\r\n     * @en Gets or sets the mesh of the model.\r\n     * Note, when set, all morph targets' weights would be reset to zero.\r\n     * @zh 获取或设置模型的网格数据。\r\n     * 注意，设置时，所有形变目标的权重都将归零。\r\n     */\r\n    @type(Mesh)\r\n    @displayOrder(1)\r\n    get mesh (): Mesh | null {\r\n        return this._mesh;\r\n    }\r\n\r\n    set mesh (val) {\r\n        const old = this._mesh;\r\n        const mesh = this._mesh = val;\r\n        mesh?.initialize();\r\n        this._initSubMeshShapesWeights();\r\n        this._watchMorphInMesh();\r\n        this._onMeshChanged(old);\r\n        this._updateModels();\r\n        if (this.enabledInHierarchy) {\r\n            this._attachToScene();\r\n        }\r\n        this._updateCastShadow();\r\n        this._updateReceiveShadow();\r\n        this._updateUseLightProbe();\r\n        this._updateUseReflectionProbe();\r\n        this._updateReceiveDirLight();\r\n    }\r\n\r\n    /**\r\n     * @en Gets the model in [[RenderScene]].\r\n     * @zh 获取渲染场景 [[RenderScene]] 中对应的模型。\r\n     */\r\n    get model (): Model | null {\r\n        return this._model;\r\n    }\r\n\r\n    /**\r\n     * @en Whether to enable morph rendering.\r\n     * @zh 是否启用形变网格渲染。\r\n     */\r\n    // eslint-disable-next-line func-names\r\n    @visible(function (this: MeshRenderer) {\r\n        return !!(\r\n            this.mesh\r\n            && this.mesh.struct.morph\r\n            && this.mesh.struct.morph.subMeshMorphs.some((subMeshMorph) => !!subMeshMorph)\r\n        );\r\n    })\r\n    @disallowAnimation\r\n    get enableMorph (): boolean {\r\n        return this._enableMorph;\r\n    }\r\n\r\n    set enableMorph (value) {\r\n        this._enableMorph = value;\r\n    }\r\n\r\n    /**\r\n     * @en Set the Separable-SSS skin standard model component.\r\n     * @zh 设置是否是全局的4s标准模型组件\r\n     */\r\n    @type(CCBoolean)\r\n    @disallowAnimation\r\n    get isGlobalStandardSkinObject (): boolean {\r\n        return this._enabledGlobalStandardSkinObject;\r\n    }\r\n\r\n    set isGlobalStandardSkinObject (val) {\r\n        getPipelineSceneData().standardSkinMeshRenderer = val ? this : null;\r\n        this._enabledGlobalStandardSkinObject = val;\r\n    }\r\n\r\n    /**\r\n     * @engineInternal\r\n     * @mangle\r\n     */\r\n    public clearGlobalStandardSkinObjectFlag (): void {\r\n        this._enabledGlobalStandardSkinObject = false;\r\n    }\r\n\r\n    protected _modelType: typeof scene.Model = scene.Model;\r\n\r\n    protected _model: scene.Model | null = null;\r\n\r\n    private _morphInstance: MorphRenderingInstance | null = null;\r\n\r\n    @serializable\r\n    private _enableMorph = true;\r\n\r\n    constructor () {\r\n        super();\r\n\r\n        const highQualityMode = settings.querySettings(SettingsCategory.RENDERING, 'highQualityMode');\r\n        if (highQualityMode) {\r\n            this._shadowCastingMode = ModelShadowCastingMode.ON;\r\n            this.bakeSettings.castShadow = true;\r\n            this.bakeSettings.receiveShadow = true;\r\n        }\r\n    }\r\n\r\n    public onLoad (): void {\r\n        if (this._mesh) { this._mesh.initialize(); }\r\n        if (!this._validateShapeWeights()) {\r\n            this._initSubMeshShapesWeights();\r\n        }\r\n        this._watchMorphInMesh();\r\n        this._updateModels();\r\n        this._updateCastShadow();\r\n        this._updateReceiveShadow();\r\n        this._updateShadowBias();\r\n        this._updateShadowNormalBias();\r\n        this._updateUseLightProbe();\r\n        this._updateBakeToReflectionProbe();\r\n        this._updateUseReflectionProbe();\r\n        this._updateReceiveDirLight();\r\n        this._updateStandardSkin();\r\n    }\r\n\r\n    // Redo, Undo, Prefab restore, etc.\r\n    public onRestore (): void {\r\n        this._updateModels();\r\n        if (this.enabledInHierarchy) {\r\n            this._attachToScene();\r\n        }\r\n        this._updateCastShadow();\r\n        this._updateReceiveShadow();\r\n        this._updateShadowBias();\r\n        this._updateShadowNormalBias();\r\n        this._updateUseLightProbe();\r\n        this._updateBakeToReflectionProbe();\r\n        this._updateUseReflectionProbe();\r\n        this._updateReceiveDirLight();\r\n        this._updateStandardSkin();\r\n    }\r\n\r\n    public onEnable (): void {\r\n        super.onEnable();\r\n        this.node.on(NodeEventType.MOBILITY_CHANGED, this.onMobilityChanged, this);\r\n        this.node.on(NodeEventType.LIGHT_PROBE_BAKING_CHANGED, this.onLightProbeBakingChanged, this);\r\n        this.bakeSettings.on(ModelBakeSettingsEvent.USE_LIGHT_PROBE_CHANGED, this.onUseLightProbeChanged, this);\r\n        this.bakeSettings.on(ModelBakeSettingsEvent.REFLECTION_PROBE_CHANGED, this.onReflectionProbeChanged, this);\r\n        this.bakeSettings.on(ModelBakeSettingsEvent.BAKE_TO_REFLECTION_PROBE_CHANGED, this.onBakeToReflectionProbeChanged, this);\r\n\r\n        if (!this._model) {\r\n            this._updateModels();\r\n        }\r\n        this._model!.onGlobalPipelineStateChanged();\r\n        this._updateCastShadow();\r\n        this._updateReceiveShadow();\r\n        this._updateShadowBias();\r\n        this._updateShadowNormalBias();\r\n        this._updateBakeToReflectionProbe();\r\n        this._updateUseReflectionProbe();\r\n        this._onUpdateLocalShadowBiasAndProbeId();\r\n        this._updateUseLightProbe();\r\n        this._updateReceiveDirLight();\r\n        this._onUpdateReflectionProbeDataMap();\r\n        this._onUpdateLocalReflectionProbeData();\r\n        this._updateStandardSkin();\r\n        this._attachToScene();\r\n    }\r\n\r\n    public onDisable (): void {\r\n        if (this._model) {\r\n            this._detachFromScene();\r\n        }\r\n        this.node.off(NodeEventType.MOBILITY_CHANGED, this.onMobilityChanged, this);\r\n        this.node.off(NodeEventType.LIGHT_PROBE_BAKING_CHANGED, this.onLightProbeBakingChanged, this);\r\n        this.bakeSettings.off(ModelBakeSettingsEvent.USE_LIGHT_PROBE_CHANGED, this.onUseLightProbeChanged, this);\r\n        this.bakeSettings.off(ModelBakeSettingsEvent.REFLECTION_PROBE_CHANGED, this.onReflectionProbeChanged, this);\r\n        this.bakeSettings.off(ModelBakeSettingsEvent.BAKE_TO_REFLECTION_PROBE_CHANGED, this.onBakeToReflectionProbeChanged, this);\r\n    }\r\n\r\n    public onDestroy (): void {\r\n        if (this._model) {\r\n            (cclegacy.director.root as Root).destroyModel(this._model);\r\n            this._model = null;\r\n            this._models.length = 0;\r\n        }\r\n        if (this._morphInstance) {\r\n            this._morphInstance.destroy();\r\n        }\r\n    }\r\n\r\n    public onGeometryChanged (): void {\r\n        if (this._model && this._mesh) {\r\n            const meshStruct = this._mesh.struct;\r\n            this._model.createBoundingShape(meshStruct.minPosition, meshStruct.maxPosition);\r\n            this._model.updateWorldBound();\r\n            this._model.onGeometryChanged();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @zh 获取子网格指定形变目标的权重。\r\n     * @en Gets the weight at specified morph target of the specified sub mesh.\r\n     * @param subMeshIndex Index to the sub mesh.\r\n     * @param shapeIndex Index to the morph target of the sub mesh.\r\n     * @returns The weight.\r\n     */\r\n    public getWeight (subMeshIndex: number, shapeIndex: number): number {\r\n        const { _subMeshShapesWeights: subMeshShapesWeights } = this;\r\n        assertIsTrue(subMeshIndex < subMeshShapesWeights.length);\r\n        const shapeWeights = this._subMeshShapesWeights[subMeshIndex];\r\n        assertIsTrue(shapeIndex < shapeWeights.length);\r\n        return shapeWeights[shapeIndex];\r\n    }\r\n\r\n    /**\r\n     * @zh\r\n     * 设置子网格所有形变目标的权重。\r\n     * `subMeshIndex` 是无效索引或 `weights` 的长度不匹配子网格的形变目标数量时，此方法不会生效。\r\n     * @en\r\n     * Sets weights of each morph target of the specified sub mesh.\r\n     * If takes no effect if `subMeshIndex` is out of bounds or if `weights` has a different length with morph targets count of the sub mesh.\r\n     * @param weights The weights.\r\n     * @param subMeshIndex Index to the sub mesh.\r\n     */\r\n    public setWeights (weights: number[], subMeshIndex: number): void {\r\n        const { _subMeshShapesWeights: subMeshShapesWeights } = this;\r\n        if (subMeshIndex >= subMeshShapesWeights.length) {\r\n            return;\r\n        }\r\n        const shapeWeights = subMeshShapesWeights[subMeshIndex];\r\n        if (shapeWeights.length !== weights.length) {\r\n            return;\r\n        }\r\n        subMeshShapesWeights[subMeshIndex] = weights.slice(0);\r\n        this._uploadSubMeshShapesWeights(subMeshIndex);\r\n    }\r\n\r\n    /**\r\n     * @zh\r\n     * 设置子网格指定外形的权重。\r\n     * `subMeshIndex` 或 `shapeIndex` 是无效索引时，此方法不会生效。\r\n     * @en\r\n     * Sets the weight at specified shape of specified sub mesh.\r\n     * If takes no effect if\r\n     * `subMeshIndex` or `shapeIndex` out of bounds.\r\n     * @param weight The weight.\r\n     * @param subMeshIndex Index to the sub mesh.\r\n     * @param shapeIndex Index to the shape of the sub mesh.\r\n     */\r\n    public setWeight (weight: number, subMeshIndex: number, shapeIndex: number): void {\r\n        const { _subMeshShapesWeights: subMeshShapesWeights } = this;\r\n        if (subMeshIndex >= subMeshShapesWeights.length) {\r\n            return;\r\n        }\r\n        const shapeWeights = subMeshShapesWeights[subMeshIndex];\r\n        if (shapeIndex >= shapeWeights.length) {\r\n            return;\r\n        }\r\n        shapeWeights[shapeIndex] = weight;\r\n        this._uploadSubMeshShapesWeights(subMeshIndex);\r\n    }\r\n\r\n    public setInstancedAttribute (name: string, value: ArrayLike<number>): void {\r\n        if (!this.model) {\r\n            return;\r\n        }\r\n\r\n        if (JSB) {\r\n            (this.model as any)._setInstancedAttribute(name, value);\r\n        } else {\r\n            const subModels = this.model.subModels;\r\n            for (let i = 0; i < subModels.length; i++) {\r\n                const subModel = subModels[i];\r\n                const { attributes, views } = subModel.instancedAttributeBlock;\r\n                for (let i = 0; i < attributes.length; i++) {\r\n                    if (attributes[i].name === name) {\r\n                        views[i].set(value);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _updateLightmap (lightmap: Texture2D|null, uOff: number, vOff: number, scale: number, lum: number): void {\r\n        this.bakeSettings.texture = lightmap;\r\n        this.bakeSettings.uvParam.x = uOff;\r\n        this.bakeSettings.uvParam.y = vOff;\r\n        this.bakeSettings.uvParam.z = scale;\r\n        this.bakeSettings.uvParam.w = lum;\r\n\r\n        this._onUpdateLightingmap();\r\n        this._updateReceiveDirLight();\r\n    }\r\n\r\n    /**\r\n     * @zh\r\n     * 更新反射探针烘焙的cubemap。\r\n     * @en\r\n     * Updat cubemap baked with reflection probes.\r\n     * @param cubeMap baked cubemap.\r\n     * @param useDefaultTexture if the reflection probe has not been baked, is the skybox used instead.\r\n     */\r\n    public updateProbeCubemap (cubeMap: TextureCube | null): void {\r\n        if (this.bakeSettings.probeCubemap && this.bakeSettings.probeCubemap === cubeMap) {\r\n            return;\r\n        }\r\n        this.bakeSettings.probeCubemap = cubeMap;\r\n        if (this.model !== null) {\r\n            this.model.updateReflectionProbeCubemap(this.bakeSettings.probeCubemap);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @zh\r\n     * 更新用于混合的反射探针烘焙的cubemap。\r\n     * @en\r\n     * Updat cubemap baked with reflection probes for blending.\r\n     * @param cubeMap baked cubemap.\r\n     */\r\n    public updateProbeBlendCubemap (cubeMap: TextureCube | null): void {\r\n        if (this.bakeSettings.probeBlendCubemap && this.bakeSettings.probeBlendCubemap === cubeMap) {\r\n            return;\r\n        }\r\n        this.bakeSettings.probeBlendCubemap = cubeMap;\r\n        if (this.model !== null) {\r\n            this.model.updateReflectionProbeBlendCubemap(this.bakeSettings.probeBlendCubemap);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @zh\r\n     * 更新平面反射渲染纹理。\r\n     * @en\r\n     * Update the reflection rendering texture.\r\n     * @param planarMap render texture.\r\n     */\r\n    public updateProbePlanarMap (planarMap: Texture | null): void {\r\n        if (this.bakeSettings.probePlanarmap === planarMap) {\r\n            return;\r\n        }\r\n        this.bakeSettings.probePlanarmap = planarMap;\r\n        if (this.model !== null) {\r\n            this.model.updateReflectionProbePlanarMap(this.bakeSettings.probePlanarmap);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @zh\r\n     * 更新反射探针的数据贴图。\r\n     * @en\r\n     * Update the data mapping of the reflection probe.\r\n     * @param dataMap data mapping with data saved all reflection probe data.\r\n     */\r\n    public updateReflectionProbeDataMap (dataMap: Texture2D | null): void {\r\n        this._reflectionProbeDataMap = dataMap;\r\n        if (this.model !== null) {\r\n            this.model.updateReflectionProbeDataMap(dataMap);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @zh\r\n     * 更新反射探针的id。\r\n     * @en\r\n     * Update the id of the reflection probe.\r\n     * @param probeId probe id.\r\n     */\r\n    public updateReflectionProbeId (probeId: number): void {\r\n        this._reflectionProbeId = probeId;\r\n        if (this.model) {\r\n            this.model.reflectionProbeId = probeId;\r\n        }\r\n        this._onUpdateLocalShadowBiasAndProbeId();\r\n    }\r\n\r\n    /**\r\n     * @zh\r\n     * 更新用于混合的反射探针的id。\r\n     * @en\r\n     * Update the id of the reflection probe used for blending.\r\n     * @param blendProbeId probe id of blend.\r\n     */\r\n    public updateReflectionProbeBlendId (blendProbeId: number): void {\r\n        this._reflectionProbeBlendId = blendProbeId;\r\n        if (this.model) {\r\n            this.model.reflectionProbeBlendId = blendProbeId;\r\n        }\r\n        this._onUpdateLocalShadowBiasAndProbeId();\r\n    }\r\n\r\n    /**\r\n     * @zh\r\n     * 更新混合权重。\r\n     * @en\r\n     * Update blending weight.\r\n     * @param weight blending weight.\r\n     */\r\n    public updateReflectionProbeBlendWeight (weight: number): void {\r\n        this._reflectionProbeBlendWeight = weight;\r\n        if (this.model) {\r\n            this.model.reflectionProbeBlendWeight = weight;\r\n        }\r\n        this._onUpdateLocalReflectionProbeData();\r\n    }\r\n\r\n    protected _updateReflectionProbeTexture (): void {\r\n        if (!this.model) return;\r\n\r\n        const bakeSettings = this.bakeSettings;\r\n\r\n        const reflectionProbe = bakeSettings.reflectionProbe;\r\n        const probeBlendCubemap = bakeSettings.probeBlendCubemap;\r\n        const probePlanarMap = bakeSettings.probePlanarmap;\r\n        const probeCubeMap = bakeSettings.probeCubemap;\r\n\r\n        if (reflectionProbe === ReflectionProbeType.BAKED_CUBEMAP) {\r\n            this.model.updateReflectionProbeCubemap(probeCubeMap);\r\n            this.model.updateReflectionProbePlanarMap(null);\r\n            this.model.updateReflectionProbeBlendCubemap(null);\r\n        } else if (reflectionProbe === ReflectionProbeType.BLEND_PROBES\r\n            || reflectionProbe === ReflectionProbeType.BLEND_PROBES_AND_SKYBOX) {\r\n            this.model.updateReflectionProbeCubemap(probeCubeMap);\r\n            this.model.updateReflectionProbeBlendCubemap(probeBlendCubemap);\r\n            this.model.updateReflectionProbePlanarMap(null);\r\n        } else if (reflectionProbe === ReflectionProbeType.PLANAR_REFLECTION) {\r\n            this.model.updateReflectionProbePlanarMap(probePlanarMap);\r\n            this.model.updateReflectionProbeCubemap(null);\r\n            this.model.updateReflectionProbeBlendCubemap(null);\r\n        } else {\r\n            this.model.updateReflectionProbeCubemap(null);\r\n            this.model.updateReflectionProbePlanarMap(null);\r\n            this.model.updateReflectionProbeBlendCubemap(null);\r\n        }\r\n    }\r\n\r\n    protected _updateModels (): void {\r\n        if (!this.enabledInHierarchy) {\r\n            return;\r\n        }\r\n\r\n        const model = this._model;\r\n        if (model) {\r\n            model.destroy();\r\n            model.initialize();\r\n            model.node = model.transform = this.node;\r\n        } else {\r\n            this._createModel();\r\n        }\r\n\r\n        if (this._model) {\r\n            if (this._mesh) {\r\n                const meshStruct = this._mesh.struct;\r\n                this._model.createBoundingShape(meshStruct.minPosition, meshStruct.maxPosition);\r\n                this._model.updateWorldBound();\r\n            }\r\n            // Initialize lighting map before model initializing\r\n            // because the lighting map will influence the model's shader\r\n            this._model.initLightingmap(this.bakeSettings.texture, this.bakeSettings.uvParam);\r\n            this._updateUseLightProbe();\r\n            this._updateUseReflectionProbeType();\r\n            this._updateModelParams();\r\n            this._onUpdateLightingmap();\r\n            this._onUpdateLocalShadowBiasAndProbeId();\r\n            this._updateUseReflectionProbe();\r\n            this._updateReceiveDirLight();\r\n            this._onUpdateReflectionProbeDataMap();\r\n            this._onUpdateLocalReflectionProbeData();\r\n        }\r\n    }\r\n\r\n    protected _updateReceiveDirLight (): void {\r\n        if (!this._model) { return; }\r\n        const scene = this.node.scene;\r\n        if (!scene || !scene.renderScene) { return; }\r\n        const mainLight = scene.renderScene.mainLight;\r\n        if (!mainLight) { return; }\r\n        const visibility = mainLight.visibility;\r\n        if (!mainLight.node) { return; }\r\n\r\n        if (mainLight.node.mobility === MobilityMode.Static) {\r\n            const sceneGlobals = this.node.scene.globals;\r\n            const lightProbeInfoData = sceneGlobals.lightProbeInfo.data;\r\n            let forceClose = false;\r\n            if (this.bakeSettings.texture && !sceneGlobals.disableLightmap) {\r\n                forceClose = true;\r\n            }\r\n            if (lightProbeInfoData && lightProbeInfoData.hasCoefficients() && this._model.useLightProbe) {\r\n                forceClose = true;\r\n            }\r\n\r\n            this.onUpdateReceiveDirLight(visibility, forceClose);\r\n        } else {\r\n            this.onUpdateReceiveDirLight(visibility);\r\n        }\r\n    }\r\n\r\n    protected _createModel (): void {\r\n        const preferMorphOverPlain = !!this._morphInstance;\r\n        // Note we only change to use `MorphModel` if\r\n        // we are required to render morph and the `this._modelType` is exactly the basic `Model`.\r\n        // We do this since the `this._modelType` might be changed in classes derived from `Model`.\r\n        // We shall not overwrite it.\r\n        // Please notice that we do not enforce that\r\n        // derived classes should use a morph-able model type(i.e. model type derived from `MorphModel`).\r\n        // So we should take care of the edge case.\r\n        const modelType = (preferMorphOverPlain && this._modelType === scene.Model) ? MorphModel : this._modelType;\r\n        const model = this._model = (cclegacy.director.root as Root).createModel(modelType);\r\n        model.visFlags = this.visibility;\r\n        model.node = model.transform = this.node;\r\n        this._models.length = 0;\r\n        this._models.push(model);\r\n        if (this._morphInstance && model instanceof MorphModel) {\r\n            model.setMorphRendering(this._morphInstance);\r\n        }\r\n    }\r\n\r\n    protected _attachToScene (): void {\r\n        if (!this.node.scene || !this._model) {\r\n            return;\r\n        }\r\n        const renderScene = this._getRenderScene();\r\n        if (this._model.scene !== null) {\r\n            this._detachFromScene();\r\n        }\r\n        renderScene.addModel(this._model);\r\n    }\r\n\r\n    /**\r\n     * @engineInternal\r\n     * @mangle\r\n     */\r\n    public _detachFromScene (): void {\r\n        if (this._model && this._model.scene) {\r\n            this._model.scene.removeModel(this._model);\r\n        }\r\n    }\r\n\r\n    protected _updateModelParams (): void {\r\n        if (!this._mesh || !this._model) { return; }\r\n        this.node.hasChangedFlags |= TransformBit.POSITION;\r\n        this._model.transform.hasChangedFlags |= TransformBit.POSITION;\r\n        this._model.isDynamicBatching = this._isBatchingEnabled();\r\n        const meshCount = this._mesh ? this._mesh.renderingSubMeshes.length : 0;\r\n        const renderingMesh = this._mesh.renderingSubMeshes;\r\n        if (renderingMesh) {\r\n            for (let i = 0; i < meshCount; ++i) {\r\n                let material = this.getRenderMaterial(i);\r\n                if (material && !material.isValid) {\r\n                    material = null;\r\n                }\r\n                const subMeshData = renderingMesh[i];\r\n                if (subMeshData) {\r\n                    this._model.initSubModel(i, subMeshData, material || this._getBuiltinMaterial());\r\n                }\r\n            }\r\n        }\r\n        this._model.enabled = true;\r\n    }\r\n\r\n    protected _onUpdateLightingmap (): void {\r\n        if (this.model !== null) {\r\n            this.model.updateLightingmap(this.bakeSettings.texture, this.bakeSettings.uvParam);\r\n        }\r\n\r\n        this.setInstancedAttribute('a_lightingMapUVParam', [\r\n            this.bakeSettings.uvParam.x,\r\n            this.bakeSettings.uvParam.y,\r\n            this.bakeSettings.uvParam.z,\r\n            this.bakeSettings.uvParam.w,\r\n        ]);\r\n    }\r\n\r\n    protected _onUpdateLocalShadowBiasAndProbeId (): void {\r\n        if (this.model !== null) {\r\n            this.model.updateLocalShadowBias();\r\n            this.model.updateReflectionProbeId();\r\n        }\r\n\r\n        this.setInstancedAttribute('a_localShadowBiasAndProbeId', [\r\n            this._shadowBias,\r\n            this._shadowNormalBias,\r\n            this._reflectionProbeId,\r\n            this._reflectionProbeBlendId,\r\n        ]);\r\n    }\r\n\r\n    protected _onUpdateLocalReflectionProbeData (): void {\r\n        if (this.bakeSettings.reflectionProbe === ReflectionProbeType.BAKED_CUBEMAP\r\n            || this.bakeSettings.reflectionProbe === ReflectionProbeType.BLEND_PROBES\r\n            || this.bakeSettings.reflectionProbe === ReflectionProbeType.BLEND_PROBES_AND_SKYBOX) {\r\n            if (this.model !== null) {\r\n                this.model.updateReflectionProbeId();\r\n            }\r\n\r\n            this.setInstancedAttribute('a_reflectionProbeData', [\r\n                this._reflectionProbeBlendWeight,\r\n                0.0,\r\n                0.0,\r\n                0.0,\r\n            ]);\r\n        }\r\n    }\r\n\r\n    protected _onUpdateReflectionProbeDataMap (): void {\r\n        if (this.model !== null) {\r\n            this.model.updateReflectionProbeDataMap(this._reflectionProbeDataMap);\r\n        }\r\n    }\r\n\r\n    protected _onMaterialModified (idx: number, material: Material | null): void {\r\n        if (!this._model || !this._model.inited) { return; }\r\n        this._onRebuildPSO(idx, material || this._getBuiltinMaterial());\r\n        this._updateStandardSkin();\r\n    }\r\n\r\n    /**\r\n     * @engineInternal\r\n     */\r\n    public override _onRebuildPSO (idx: number, material: Material): void {\r\n        if (!this._model || !this._model.inited) { return; }\r\n        this._model.isDynamicBatching = this._isBatchingEnabled();\r\n        this._model.setSubModelMaterial(idx, material);\r\n        this._onUpdateLightingmap();\r\n        this._onUpdateLocalShadowBiasAndProbeId();\r\n        this._updateReflectionProbeTexture();\r\n        this._onUpdateReflectionProbeDataMap();\r\n        this._onUpdateLocalReflectionProbeData();\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n    protected _onMeshChanged (old: Mesh | null): void {\r\n    }\r\n\r\n    protected _clearMaterials (): void {\r\n        if (!this._model) { return; }\r\n        const subModels = this._model.subModels;\r\n        for (let i = 0; i < subModels.length; ++i) {\r\n            this._onMaterialModified(i, null);\r\n        }\r\n    }\r\n\r\n    protected _getBuiltinMaterial (): Material {\r\n        // classic ugly pink indicating missing material\r\n        return builtinResMgr.get<Material>('missing-material');\r\n    }\r\n\r\n    protected _onVisibilityChange (val: number): void {\r\n        if (!this._model) { return; }\r\n        this._model.visFlags = val;\r\n    }\r\n\r\n    protected _updateShadowBias (): void {\r\n        if (!this._model) { return; }\r\n        this._model.shadowBias = this._shadowBias;\r\n    }\r\n\r\n    protected _updateShadowNormalBias (): void {\r\n        if (!this._model) { return; }\r\n        this._model.shadowNormalBias = this._shadowNormalBias;\r\n    }\r\n\r\n    protected _updateCastShadow (): void {\r\n        if (!this._model) { return; }\r\n        if (this._shadowCastingMode === ModelShadowCastingMode.OFF) {\r\n            this._model.castShadow = false;\r\n        } else {\r\n            assertIsTrue(\r\n                this._shadowCastingMode === ModelShadowCastingMode.ON,\r\n                `ShadowCastingMode ${this._shadowCastingMode} is not supported.`,\r\n            );\r\n            this._model.castShadow = true;\r\n        }\r\n    }\r\n\r\n    protected _updateReceiveShadow (): void {\r\n        if (!this._model) { return; }\r\n        if (this._shadowReceivingMode === ModelShadowReceivingMode.OFF) {\r\n            this._model.receiveShadow = false;\r\n        } else {\r\n            this._model.receiveShadow = true;\r\n        }\r\n    }\r\n\r\n    protected onMobilityChanged (): void {\r\n        this._updateUseLightProbe();\r\n        this._updateReceiveDirLight();\r\n    }\r\n\r\n    protected onLightProbeBakingChanged (): void {\r\n        this._updateReceiveDirLight();\r\n    }\r\n\r\n    protected onUseLightProbeChanged (): void {\r\n        this._updateUseLightProbe();\r\n    }\r\n\r\n    protected onReflectionProbeChanged (): void {\r\n        this._updateUseReflectionProbe();\r\n        this._onUpdateLocalShadowBiasAndProbeId();\r\n        const reflectionProbeManager = cclegacy.internal.reflectionProbeManager as ReflectionProbeManager;\r\n        const model = this._model!;\r\n        if (this.bakeSettings.reflectionProbe === ReflectionProbeType.BAKED_CUBEMAP\r\n            || this.bakeSettings.reflectionProbe === ReflectionProbeType.BLEND_PROBES\r\n            || this.bakeSettings.reflectionProbe === ReflectionProbeType.BLEND_PROBES_AND_SKYBOX) {\r\n            reflectionProbeManager.selectReflectionProbe(model);\r\n            if (!reflectionProbeManager.getUsedReflectionProbe(model, false)) {\r\n                warnID(16302);\r\n            }\r\n        } else if (this.bakeSettings.reflectionProbe === ReflectionProbeType.PLANAR_REFLECTION) {\r\n            reflectionProbeManager.selectPlanarReflectionProbe(model);\r\n            if (!reflectionProbeManager.getUsedReflectionProbe(model, true)) {\r\n                warnID(16302);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onBakeToReflectionProbeChanged (): void {\r\n        this._updateBakeToReflectionProbe();\r\n    }\r\n\r\n    protected _updateUseLightProbe (): void {\r\n        if (!this._model) { return; }\r\n        const node = this.node;\r\n        if (this._mesh && node && node.mobility === MobilityMode.Movable && this.bakeSettings.useLightProbe) {\r\n            this._model.useLightProbe = true;\r\n        } else {\r\n            this._model.useLightProbe = false;\r\n        }\r\n    }\r\n\r\n    protected _isBatchingEnabled (): boolean {\r\n        for (let i = 0; i < this._materials.length; ++i) {\r\n            const mat = this._materials[i];\r\n            if (!mat) { continue; }\r\n            for (let p = 0; p < mat.passes.length; ++p) {\r\n                const pass = mat.passes[p];\r\n                if (pass.batchingScheme) { return true; }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    protected _updateUseReflectionProbe (): void {\r\n        if (!this._model) return;\r\n        this._model.reflectionProbeType = this.bakeSettings.reflectionProbe;\r\n        this._updateReflectionProbeTexture();\r\n    }\r\n\r\n    protected _updateUseReflectionProbeType (): void {\r\n        if (!this._model) return;\r\n        this._model.reflectionProbeType = this.bakeSettings.reflectionProbe;\r\n    }\r\n\r\n    protected _updateBakeToReflectionProbe (): void {\r\n        if (!this._model) { return; }\r\n        this._model.bakeToReflectionProbe = this.bakeSettings.bakeToReflectionProbe;\r\n    }\r\n\r\n    private _watchMorphInMesh (): void {\r\n        if (this._morphInstance) {\r\n            this._morphInstance.destroy();\r\n            this._morphInstance = null;\r\n        }\r\n\r\n        if (!this._enableMorph) {\r\n            return;\r\n        }\r\n\r\n        if (!this._mesh\r\n            || !this._mesh.struct.morph\r\n            || !this._mesh.morphRendering) {\r\n            return;\r\n        }\r\n\r\n        this._morphInstance = this._mesh.morphRendering.createInstance();\r\n        const nSubMeshes = this._mesh.struct.primitives.length;\r\n        for (let iSubMesh = 0; iSubMesh < nSubMeshes; ++iSubMesh) {\r\n            this._uploadSubMeshShapesWeights(iSubMesh);\r\n        }\r\n\r\n        if (this._model && this._model instanceof MorphModel) {\r\n            this._model.setMorphRendering(this._morphInstance);\r\n        }\r\n    }\r\n\r\n    private _initSubMeshShapesWeights (): void {\r\n        const { _mesh: mesh } = this;\r\n\r\n        this._subMeshShapesWeights.length = 0;\r\n\r\n        if (!mesh) {\r\n            return;\r\n        }\r\n\r\n        const morph = mesh.struct.morph;\r\n        if (!morph) {\r\n            return;\r\n        }\r\n\r\n        const commonWeights = morph.weights;\r\n        this._subMeshShapesWeights = morph.subMeshMorphs.map((subMeshMorph) => {\r\n            if (!subMeshMorph) {\r\n                return [];\r\n            } else if (subMeshMorph.weights) {\r\n                return subMeshMorph.weights.slice(0);\r\n            } else if (commonWeights) {\r\n                assertIsTrue(commonWeights.length === subMeshMorph.targets.length);\r\n                return commonWeights.slice(0);\r\n            } else {\r\n                return new Array<number>(subMeshMorph.targets.length).fill(0.0);\r\n            }\r\n        });\r\n    }\r\n\r\n    private _validateShapeWeights (): boolean {\r\n        const {\r\n            _mesh: mesh,\r\n            _subMeshShapesWeights: subMeshShapesWeights,\r\n        } = this;\r\n\r\n        if (!mesh || !mesh.struct.morph) {\r\n            return subMeshShapesWeights.length === 0;\r\n        }\r\n\r\n        const { morph } = mesh.struct;\r\n        if (morph.subMeshMorphs.length !== subMeshShapesWeights.length) {\r\n            return false;\r\n        }\r\n\r\n        return subMeshShapesWeights.every(\r\n            ({ length: shapeCount }, subMeshIndex) => (morph.subMeshMorphs[subMeshIndex]?.targets.length ?? 0) === shapeCount,\r\n        );\r\n    }\r\n\r\n    private _uploadSubMeshShapesWeights (subMeshIndex: number): void {\r\n        this._morphInstance?.setWeights(subMeshIndex, this._subMeshShapesWeights[subMeshIndex]);\r\n    }\r\n\r\n    private _updateStandardSkin (): void {\r\n        const pipelineSceneData = getPipelineSceneData();\r\n        if (this._enabledGlobalStandardSkinObject) {\r\n            pipelineSceneData.standardSkinMeshRenderer = this;\r\n            pipelineSceneData.standardSkinModel = this.model;\r\n        }\r\n        if (!pipelineSceneData.skinMaterialModel && this._model) {\r\n            const subModels = this._model.subModels;\r\n            for (let j = 0; j < subModels.length; j++) {\r\n                const subModel = subModels[j];\r\n                const skinPassIdx = getSkinPassIndex(subModel);\r\n                if (skinPassIdx < 0) { continue; }\r\n                pipelineSceneData.skinMaterialModel = this._model;\r\n                return;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport declare namespace MeshRenderer {\r\n    /**\r\n     * @en Shadow projection mode.\r\n     * @zh 阴影投射方式。\r\n     */\r\n    export type ShadowCastingMode = EnumAlias<typeof ModelShadowCastingMode>;\r\n    /**\r\n     * @en Shadow receive mode.\r\n     * @zh 阴影接收方式。\r\n     */\r\n    export type ShadowReceivingMode = EnumAlias<typeof ModelShadowReceivingMode>;\r\n}\r\n"],"names":["MorphModel","exports","_Model","_this","call","this","_morphRenderingInstance","_usedMaterials","Set","_inheritsLoose","_proto","prototype","getMacroPatches","subModelIndex","superMacroPatches","morphInstanceMacroPatches","requiredPatches","concat","initSubModel","subMeshData","material","_launderMaterial","destroy","setSubModelMaterial","setMorphRendering","morphRendering","_updateLocalDescriptors","submodelIdx","descriptorSet","adaptPipelineState","Model","ccclass","_decorator","executionOrder","type","formerlySerializedAs","serializable","_phaseID","getPhaseID","getSkinPassIndex","subModel","passes","r","cclegacy","rendering","isEnableEffect","getPassID","k","length","enableEffectImport","phase","phaseID","ModelBakeSettingsEvent","ModelShadowCastingMode","Enum","OFF","ON","ModelShadowReceivingMode","ModelBakeSettings","CCInteger","CCBoolean","ReflectionProbeType","_dec","_class3","_EventTarget","texture","_initializer","uvParam","_initializer2","_bakeable","_initializer3","_castShadow","_initializer4","_receiveShadow","_initializer5","_lightmapSize","_initializer6","_useLightProbe","_initializer7","_bakeToLightProbe","_initializer8","_reflectionProbeType","_initializer9","_bakeToReflectionProbe","_initializer10","probeCubemap","probeBlendCubemap","probePlanarmap","_createClass","key","get","set","val","emit","USE_LIGHT_PROBE_CHANGED","REFLECTION_PROBE_CHANGED","BAKE_TO_REFLECTION_PROBE_CHANGED","EventTarget","_class2","_applyDecoratedInitializer","Vec4","_dec2","NONE","_applyDecoratedDescriptor","_dec3","Object","getOwnPropertyDescriptor","_dec4","_dec5","_dec6","_dec7","_class","CCFloat","_dec11","_dec12","Mesh","_dec8","_class4","_dec9","_class6","_ModelRenderer","MeshRenderer","_this2","bakeSettings","_initializer11","_mesh","_initializer12","_shadowCastingMode","_initializer13","_shadowReceivingMode","_initializer14","_shadowBias","_initializer15","_shadowNormalBias","_initializer16","_reflectionProbeId","_initializer17","_reflectionProbeBlendId","_initializer18","_reflectionProbeBlendWeight","_initializer19","_enabledGlobalStandardSkinObject","_initializer20","_reflectionProbeDataMap","_subMeshShapesWeights","_modelType","scene","_model","_morphInstance","_enableMorph","_initializer21","settings","querySettings","SettingsCategory","RENDERING","castShadow","receiveShadow","onUpdateReceiveDirLight","visibility","forceClose","receiveDirLight","node","layer","visFlags","clearGlobalStandardSkinObjectFlag","onLoad","initialize","_validateShapeWeights","_initSubMeshShapesWeights","_watchMorphInMesh","_updateModels","_updateCastShadow","_updateReceiveShadow","_updateShadowBias","_updateShadowNormalBias","_updateUseLightProbe","_updateBakeToReflectionProbe","_updateUseReflectionProbe","_updateReceiveDirLight","_updateStandardSkin","onRestore","enabledInHierarchy","_attachToScene","onEnable","on","NodeEventType","MOBILITY_CHANGED","onMobilityChanged","LIGHT_PROBE_BAKING_CHANGED","onLightProbeBakingChanged","onUseLightProbeChanged","onReflectionProbeChanged","onBakeToReflectionProbeChanged","onGlobalPipelineStateChanged","_onUpdateLocalShadowBiasAndProbeId","_onUpdateReflectionProbeDataMap","_onUpdateLocalReflectionProbeData","onDisable","_detachFromScene","off","onDestroy","director","root","destroyModel","_models","onGeometryChanged","meshStruct","struct","createBoundingShape","minPosition","maxPosition","updateWorldBound","getWeight","subMeshIndex","shapeIndex","subMeshShapesWeights","assertIsTrue","shapeWeights","setWeights","weights","slice","_uploadSubMeshShapesWeights","setWeight","weight","setInstancedAttribute","name","value","model","subModels","i","instancedAttributeBlock","attributes","views","_updateLightmap","lightmap","uOff","vOff","scale","lum","x","y","z","w","_onUpdateLightingmap","updateProbeCubemap","cubeMap","updateReflectionProbeCubemap","updateProbeBlendCubemap","updateReflectionProbeBlendCubemap","updateProbePlanarMap","planarMap","updateReflectionProbePlanarMap","updateReflectionProbeDataMap","dataMap","updateReflectionProbeId","probeId","reflectionProbeId","updateReflectionProbeBlendId","blendProbeId","reflectionProbeBlendId","updateReflectionProbeBlendWeight","reflectionProbeBlendWeight","_updateReflectionProbeTexture","reflectionProbe","probePlanarMap","probeCubeMap","BAKED_CUBEMAP","BLEND_PROBES","BLEND_PROBES_AND_SKYBOX","PLANAR_REFLECTION","transform","_createModel","initLightingmap","_updateUseReflectionProbeType","_updateModelParams","renderScene","mainLight","mobility","MobilityMode","Static","sceneGlobals","globals","lightProbeInfoData","lightProbeInfo","data","disableLightmap","hasCoefficients","useLightProbe","modelType","createModel","push","_getRenderScene","addModel","removeModel","hasChangedFlags","TransformBit","POSITION","isDynamicBatching","_isBatchingEnabled","meshCount","renderingSubMeshes","renderingMesh","getRenderMaterial","isValid","_getBuiltinMaterial","enabled","updateLightingmap","updateLocalShadowBias","_onMaterialModified","idx","inited","_onRebuildPSO","_onMeshChanged","_clearMaterials","builtinResMgr","_onVisibilityChange","shadowBias","shadowNormalBias","reflectionProbeManager","internal","selectReflectionProbe","getUsedReflectionProbe","warnID","selectPlanarReflectionProbe","Movable","_materials","mat","p","batchingScheme","reflectionProbeType","bakeToReflectionProbe","morph","createInstance","nSubMeshes","primitives","iSubMesh","mesh","commonWeights","subMeshMorphs","map","subMeshMorph","targets","Array","fill","every","_morph$subMeshMorphs$","_morph$subMeshMorphs$2","shapeCount","_this$_morphInstance","pipelineSceneData","getPipelineSceneData","standardSkinMeshRenderer","standardSkinModel","skinMaterialModel","j","shadowCastingMode","old","ModelRenderer","ShadowCastingMode","ShadowReceivingMode","_class5","_dec10","_dec13","_dec14","_dec15"],"mappings":"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"}