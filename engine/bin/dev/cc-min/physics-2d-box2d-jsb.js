System.register(["./physics-2d-framework-S9Sh01v2.js","./gc-object-BD6DANSw.js","./_virtual_internal_constants-CVZmBipG.js","./index-BcjqSS2q.js","./prefab-CJahvMeV.js","./scene-D5fG1En6.js","./pipeline-state-manager-C4BAah3w.js","./node-event-BDYemSfE.js","./deprecated-gv6rCJsk.js","./director-D6Xf3-Ej.js","./collision-matrix-DvJE_i6G.js","./global-exports-ZavlJGEN.js","./touch-Ch03mDFP.js","./device-manager-BCOP-4pU.js","./buffer-barrier-CZBuOw0V.js","./debug-view-zRQBd5E1.js","./deprecated-BaebfHhU.js"],(function(){"use strict";var t,i,n,e,o,r,s,a,l,c,h,u,d,_,y,f,p,b,g,x,m,v,w,S,A,j,C,D,T,P,B,F;return{setters:[function(c){t=c.a,i=c.b,n=c.P,e=c.c,o=c.C,r=c.d,s=c.R,a=c.e,l=c.s},function(t){c=t._,h=t.au,u=t.K,d=t.h,_=t.a,y=t.T},null,function(t){f=t.V,p=t.C,b=t.f,g=t.Y,x=t.Q,m=t.h,v=t.a5,w=t.a4,S=t.l},function(t){A=t.f},function(t){j=t.N},function(t){C=t.L},function(t){D=t.N},function(t){T=t.g,P=t.G},function(t){B=t.d},function(t){F=t.P},null,null,null,null,null,null],execute:function(){var M={ContactListener:function(){},QueryCallback:function(){},Draw:function(){},Vec2:function(){},RayCastCallback:function(){},BodyDef:function(){},AABB:function(){},Filter:function(){},Transform:function(){},Color:function(){}};globalThis.b2jsb=M;var L=function(t){function i(){for(var i,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(i=t.call.apply(t,[this].concat(e))||this)._contactFixtures=[],i._BeginContact=null,i._EndContact=null,i._PreSolve=null,i._PostSolve=null,i}c(i,t);var n=i.prototype;return n.setBeginContact=function(t){this._BeginContact=t},n.setEndContact=function(t){this._EndContact=t},n.setPreSolve=function(t){this._PreSolve=t},n.setPostSolve=function(t){this._PostSolve=t},n.BeginContact=function(t){if(this._BeginContact){var i=t.GetFixtureA(),n=t.GetFixtureB(),e=this._contactFixtures;t._shouldReport=!1,-1===e.indexOf(i)&&-1===e.indexOf(n)||(t._shouldReport=!0,this._BeginContact(t))}},n.EndContact=function(t){this._EndContact&&t._shouldReport&&(t._shouldReport=!1,this._EndContact(t))},n.PreSolve=function(t,i){this._PreSolve&&t._shouldReport&&this._PreSolve(t,i)},n.PostSolve=function(t,i){this._PostSolve&&t._shouldReport&&this._PostSolve(t,i)},n.registerContactFixture=function(t){this._contactFixtures.push(t)},n.unregisterContactFixture=function(t){h(this._contactFixtures,t)},i}(b2jsb.ContactListener);globalThis.b2jsb=M;var k=function(t){function i(){for(var i,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(i=t.call.apply(t,[this].concat(e))||this)._point=new b2jsb.Vec2,i._isPoint=!1,i._fixtures=[],i}c(i,t);var n=i.prototype;return n.init=function(t){this.initWithThis(this),t?(this._isPoint=!0,this._point.x=t.x,this._point.y=t.y):this._isPoint=!1,this._fixtures.length=0},n.ReportFixture=function(t){return this._isPoint?t.TestPoint(this._point)&&this._fixtures.push(t):this._fixtures.push(t),!0},n.getFixture=function(){return this._fixtures[0]},n.getFixtures=function(){return this._fixtures},i}(b2jsb.QueryCallback);globalThis.b2jsb=M;var G=function(i){function n(){for(var n,e=arguments.length,o=new Array(e),r=0;r<e;r++)o[r]=arguments[r];return(n=i.call.apply(i,[this].concat(o))||this)._type=t.Closest,n._fixtures=[],n._points=[],n._normals=[],n._fractions=[],n._mask=4294967295,n}c(n,i);var e=n.prototype;return e.init=function(t,n){i.prototype.initWithThis.call(this,this),this._type=t,this._mask=n,this._fixtures.length=0,this._points.length=0,this._normals.length=0,this._fractions.length=0},e.ReportFixture=function(i,n,e,o){return i.GetFilterData().categoryBits&this._mask?this._type===t.Closest?(this._fixtures[0]=i,this._points[0]=new f(n.x,n.y),this._normals[0]=new f(e.x,e.y),this._fractions[0]=o,o):(this._fixtures.push(i),this._points.push(new f(n.x,n.y)),this._normals.push(new f(e.x,e.y)),this._fractions.push(o),this._type===t.Any?0:this._type>=t.All?1:o):0},e.getFixtures=function(){return this._fixtures},e.getPoints=function(){return this._points},e.getNormals=function(){return this._normals},e.getFractions=function(){return this._fractions},n}(b2jsb.RayCastCallback),R=[],I=[new f,new f],V={normal:{x:0,y:0},points:[{x:0,y:0},{x:0,y:0}],separations:[0,0]},E={points:[],separations:[],normal:new f},O=function(){this.localPoint=new f,this.normalImpulse=0,this.tangentImpulse=0},q=[new O,new O],J={type:0,localPoint:new f,localNormal:new f,points:[]},W={normalImpulses:[],tangentImpulses:[]},z=function(){function t(){this.colliderA=null,this.colliderB=null,this.disabled=!1,this.disabledOnce=!1,this._impulse=null,this._inverted=!1,this._b2contact=null}t.get=function(i){var n=R.pop();return n||(n=new t),n.init(i),n},t.put=function(t){var i=t.m_userData;i&&(R.push(i),i.reset())};var e=t.prototype;return e._setImpulse=function(t){this._impulse=t},e.init=function(t){this.colliderA=t.GetFixtureA().m_userData.collider,this.colliderB=t.GetFixtureB().m_userData.collider,this.disabled=!1,this.disabledOnce=!1,this._impulse=null,this._inverted=!1,this._b2contact=t,t.m_userData=this},e.reset=function(){this.setTangentSpeed(0),this.resetFriction(),this.resetRestitution(),this.colliderA=null,this.colliderB=null,this.disabled=!1,this._impulse=null,this._b2contact.m_userData=null,this._b2contact=null},e.getWorldManifold=function(){var t=E.points,n=E.separations,e=E.normal;this._b2contact.GetWorldManifold(V);var o=V.points,r=V.separations,s=this._b2contact.GetManifold().pointCount;t.length=n.length=s;for(var a=0;a<s;a++){var l=I[a];l.x=o[a].x*i,l.y=o[a].y*i,t[a]=l,n[a]=r[a]*i}return e.x=V.normal.x,e.y=V.normal.y,this._inverted&&(e.x*=-1,e.y*=-1),E},e.getManifold=function(){for(var t=J.points,n=J.localNormal,e=J.localPoint,o=this._b2contact.GetManifold(),r=o.points,s=t.length=o.pointCount,a=0;a<s;a++){var l=q[a],c=r[a];l.localPoint.x=c.localPoint.x*i,l.localPoint.y=c.localPoint.y*i,l.normalImpulse=c.normalImpulse*i,l.tangentImpulse=c.tangentImpulse,t[a]=l}return e.x=o.localPoint.x*i,e.y=o.localPoint.y*i,n.x=o.localNormal.x,n.y=o.localNormal.y,J.type=o.type,this._inverted&&(n.x*=-1,n.y*=-1),J},e.getImpulse=function(){var t=this._impulse;if(!t)return null;for(var n=W.normalImpulses,e=W.tangentImpulses,o=t.count,r=0;r<o;r++)n[r]=t.normalImpulses[r]*i,e[r]=t.tangentImpulses[r];return e.length=n.length=o,W},e.emit=function(t){var i,e,o=this.colliderA,r=this.colliderB,s=null==o||null==(i=o.body)?void 0:i.enabledContactListener,a=null==r||null==(e=r.body)?void 0:e.enabledContactListener;s&&o.emit(t,o,r,this),a&&r.emit(t,r,o,this),(s||a)&&n.instance.emit(t,o,r,this),(this.disabled||this.disabledOnce)&&(this.setEnabled(!1),this.disabledOnce=!1)},e.setEnabled=function(t){this._b2contact.SetEnabled(t)},e.isTouching=function(){return this._b2contact.IsTouching()},e.setTangentSpeed=function(t){this._b2contact.SetTangentSpeed(t)},e.getTangentSpeed=function(){return this._b2contact.GetTangentSpeed()},e.setFriction=function(t){this._b2contact.SetFriction(t)},e.getFriction=function(){return this._b2contact.GetFriction()},e.resetFriction=function(){return this._b2contact.ResetFriction()},e.setRestitution=function(t){this._b2contact.SetRestitution(t)},e.getRestitution=function(){return this._b2contact.GetRestitution()},e.resetRestitution=function(){return this._b2contact.ResetRestitution()},t}();globalThis.b2jsb=M;var N=new b2jsb.Vec2,H=new p,U=p.GREEN,Q=p.RED;b2jsb.Transform.MulXV=function(t,i,n){var e=t.q.c,o=t.q.s,r=i.x,s=i.y;return n.x=e*r-o*s+t.p.x,n.y=o*r+e*s+t.p.y,n};var X,Y=function(t){function n(i){var n;return(n=t.call(this)||this)._drawer=null,n._xf=new b2jsb.Transform,n._dxf=new b2jsb.Transform,n._drawer=i,n}c(n,t);var e=n.prototype;return e._DrawPolygon=function(t,n){for(var e=this._drawer,o=0;o<n;o++){b2jsb.Transform.MulXV(this._xf,t[o],N);var r=N.x*i,s=N.y*i;0===o?e.moveTo(r,s):e.lineTo(r,s)}e.close()},e.DrawPolygon=function(t,i,n){this._applyStrokeColor(n),this._DrawPolygon(t,i),this._drawer.stroke()},e.DrawSolidPolygon=function(t,i,n){this._applyFillColor(n),this._DrawPolygon(t,i),this._drawer.fill(),this._drawer.stroke()},e._DrawCircle=function(t,n){b2jsb.Transform.MulXV(this._xf,t,N),this._drawer.circle(N.x*i,N.y*i,n*i)},e.DrawCircle=function(t,i,n){this._applyStrokeColor(n),this._DrawCircle(t,i),this._drawer.stroke()},e.DrawSolidCircle=function(t,i,n,e){this._applyFillColor(e),this._DrawCircle(t,i),this._drawer.fill()},e.DrawSegment=function(t,n,e){var o=this._drawer;if(t.x===n.x&&t.y===n.y)return this._applyFillColor(e),this._DrawCircle(t,2/i),void o.fill();this._applyStrokeColor(e),b2jsb.Transform.MulXV(this._xf,t,N),o.moveTo(N.x*i,N.y*i),b2jsb.Transform.MulXV(this._xf,n,N),o.lineTo(N.x*i,N.y*i),o.stroke()},e.DrawTransform=function(t){var n=this._drawer;n.strokeColor=Q,N.x=N.y=0,b2jsb.Transform.MulXV(t,N,N),n.moveTo(N.x*i,N.y*i),N.x=1,N.y=0,b2jsb.Transform.MulXV(t,N,N),n.lineTo(N.x*i,N.y*i),n.stroke(),n.strokeColor=U,N.x=N.y=0,b2jsb.Transform.MulXV(t,N,N),n.moveTo(N.x*i,N.y*i),N.x=0,N.y=1,b2jsb.Transform.MulXV(t,N,N),n.lineTo(N.x*i,N.y*i),n.stroke()},e.DrawPoint=function(){},e.DrawParticles=function(){},e._applyStrokeColor=function(t){this._drawer.strokeColor=H.set(255*t.r,255*t.g,255*t.b,150)},e._applyFillColor=function(t){this._drawer.fillColor=H.set(255*t.r,255*t.g,255*t.b,150)},e.PushTransform=function(t){this._xf=t},e.PopTransform=function(){this._xf=this._dxf},n}(b2jsb.Draw);globalThis.b2jsb=M;var Z=new b,K=new f,$=new f,tt=new b2jsb.BodyDef,it=new b2jsb.AABB,nt=[],et=function(){function t(t,i,n,e){this.r=null!=t?t:0,this.g=null!=i?i:0,this.b=null!=n?n:0,this.a=null!=e?e:1}return t.prototype.Set=function(t,i,n,e){this.r=null!=t?t:0,this.g=null!=i?i:0,this.b=null!=n?n:0,this.a=null!=e?e:1},t}();b2jsb.Color=et;var ot=function(){function n(){this._world=void 0,this._bodies=[],this._animatedBodies=[],this._rotationAxis=new b,this._physicsGroundBody=void 0,this._contactListener=void 0,this._aabbQueryCallback=void 0,this._raycastQueryCallback=void 0,this._debugGraphics=null,this._b2DebugDrawer=null,this._debugDrawFlags=0,this._world=new b2jsb.World(new b2jsb.Vec2(0,-10));var t=new b2jsb.BodyDef;this._physicsGroundBody=this._world.CreateBody(t);var i=new L;i.initWithThis(i),i.setBeginContact(this._onBeginContact),i.setEndContact(this._onEndContact),i.setPreSolve(this._onPreSolve),i.setPostSolve(this._onPostSolve),this._world.SetContactListener(i),this._contactListener=i,this._aabbQueryCallback=new k,this._raycastQueryCallback=new G}var r=n.prototype;return r._checkDebugDrawValid=function(){if(!this._debugGraphics||!this._debugGraphics.isValid){var t=A("Canvas");if(!t){var i=B.getScene();if(!i)return;(t=new j("Canvas")).addComponent("cc.Canvas"),t.parent=i}var n=new j("PHYSICS_2D_DEBUG_DRAW");n.hideFlags|=u.Flags.DontSave,n.parent=t,n.worldPosition=b.ZERO,n.layer=C.Enum.UI_2D;try{this._debugGraphics=n.addComponent("cc.Graphics"),this._debugGraphics.lineWidth=3;var e=new Y(this._debugGraphics);e.initWithThis(e),this._b2DebugDrawer=e,this._world.SetDebugDraw(e);var o=this._debugGraphics.node.parent;this._debugGraphics.node.setSiblingIndex(o.children.length-1)}catch(t){d(4501,t.message),n.destroy(),n=null}}this._b2DebugDrawer&&this._b2DebugDrawer.SetFlags(this.debugDrawFlags)},r.setGravity=function(t){this._world.SetGravity(t)},r.setAllowSleep=function(){this._world.SetAllowSleeping(!0)},r.step=function(t,i,n){void 0===i&&(i=10),void 0===n&&(n=10);for(var e=this._animatedBodies,o=0,r=e.length;o<r;o++)e[o].animate(t);this._world.Step(t,i,n)},r.raycast=function(n,e,o,r){if(n.equals(e))return[];o=o||t.Closest,K.x=n.x/i,K.y=n.y/i,$.x=e.x/i,$.y=e.y/i;var s=this._raycastQueryCallback;s.init(o,r),this._world.RayCast(s,K,$);var a=s.getFixtures();if(a.length>0){for(var l=s.getPoints(),c=s.getNormals(),h=s.getFractions(),u=[],d=0,_=a.length;d<_;d++){var y=a[d],p=y.m_userData,b=p.collider;if(o===t.AllClosest){for(var g=void 0,x=0;x<u.length;x++)u[x].collider===b&&(g=u[x]);if(g){h[d]<g.fraction&&(g.fixtureIndex=p.getFixtureIndex(y),g.point.x=l[d].x*i,g.point.y=l[d].y*i,g.normal.x=c[d].x,g.normal.y=c[d].y,g.fraction=h[d]);continue}}u.push({collider:b,fixtureIndex:p.getFixtureIndex(y),point:new f(l[d].x*i,l[d].y*i),normal:new f(c[d].x,c[d].y),fraction:h[d]})}return u}return[]},r.syncPhysicsToScene=function(){for(var t=this._bodies,n=0,o=t.length;n<o;n++){var r=t[n],s=r.rigidBody;if(s.type!==e.Animated){var a=s.node;r.impl._GetTransformJSB(),Z.x=X[0]*i,Z.y=X[1]*i,Z.z=0;var l=g(X[2]);a.set2DTransform(Z.x,Z.y,l)}else r.resetVelocity()}},r.syncSceneToPhysics=function(){for(var t=this._bodies,i=0;i<t.length;i++)t[i].syncSceneToPhysics()},r.addBody=function(t){if(!this._bodies.includes(t)){var n=tt,o=t.rigidBody;n.allowSleep=o.allowSleep,n.gravityScale=o.gravityScale,n.linearDamping=o.linearDamping,n.angularDamping=o.angularDamping,n.fixedRotation=o.fixedRotation,n.bullet=o.bullet;var r=o.node,s=r.worldPosition;if(n.position={x:s.x/i,y:s.y/i},Z.z=x.getAxisAngle(this._rotationAxis,r.worldRotation),this._rotationAxis.z<0&&(Z.z=2*Math.PI-Z.z),n.angle=Z.z,n.awake=o.awakeOnLoad,o.type===e.Animated){n.type=e.Kinematic,this._animatedBodies.push(t);var a=n.position;t._animatedPos.set(a.x,a.y),t._animatedAngle=n.angle}else n.type=o.type;var l=o,c=l._linearVelocity;n.linearVelocity={x:c.x,y:c.y},n.angularVelocity=l._angularVelocity;var h=this._world.CreateBody(n);h.m_userData=t,t._imp=h,this._bodies.push(t)}},r.removeBody=function(t){this._bodies.includes(t)&&(t.impl&&(t.impl.m_userData=null,this._world.DestroyBody(t.impl),t._imp=null),h(this._bodies,t),t.rigidBody.type===e.Animated&&h(this._animatedBodies,t))},r.registerContactFixture=function(t){this._contactListener.registerContactFixture(t)},r.unregisterContactFixture=function(t){this._contactListener.unregisterContactFixture(t)},r.testPoint=function(t){var n=K.x=t.x/i,e=K.y=t.y/i,o=.2/i;it.lowerBound={x:n-o,y:e-o},it.upperBound={x:n+o,y:e+o};var r=this._aabbQueryCallback;r.init(K),this._world.QueryAABB(r,it);var s=r.getFixtures();nt.length=0;for(var a=0;a<s.length;a++){var l=s[a].m_userData.collider;nt.includes(l)||nt.push(l)}return nt},r.testAABB=function(t){it.lowerBound={x:t.xMin/i,y:t.yMin/i},it.upperBound={x:t.xMax/i,y:t.yMax/i};var n=this._aabbQueryCallback;n.init(),this._world.QueryAABB(n,it);var e=n.getFixtures();nt.length=0;for(var o=0;o<e.length;o++){var r=e[o].m_userData.collider;nt.includes(r)||nt.push(r)}return nt},r.drawDebug=function(){this._checkDebugDrawValid(),this._debugGraphics&&(this._debugGraphics.clear(),this._world.DrawDebugData())},r._onBeginContact=function(t){z.get(t).emit(o.BEGIN_CONTACT)},r._onEndContact=function(t){var i=t.m_userData;i&&(i.emit(o.END_CONTACT),z.put(t))},r._onPreSolve=function(t){var i=t.m_userData;i&&i.emit(o.PRE_SOLVE)},r._onPostSolve=function(t,i){var n=t.m_userData;n&&(n._setImpulse(i),n.emit(o.POST_SOLVE),n._setImpulse(null))},_(n,[{key:"impl",get:function(){return this._world}},{key:"groundBodyImpl",get:function(){return this._physicsGroundBody}},{key:"debugDrawFlags",get:function(){return this._debugDrawFlags},set:function(t){t||this._debugGraphics&&(this._debugGraphics.node.parent=null),this._debugDrawFlags=t}}]),n}(),rt=new b,st={x:0,y:0},at=function(){function t(){this._animatedPos=new f,this._animatedAngle=0,this._body=null,this._rigidBody=void 0,this._inited=!1}var o=t.prototype;return o.initialize=function(t){this._rigidBody=t,n.instance._callAfterStep(this,this._init)},o.onDestroy=function(){n.instance._callAfterStep(this,this._destroy)},o.onEnable=function(){this.setActive(!0)},o.onDisable=function(){this.setActive(!1)},o.nodeTransformChanged=function(t){if(!n.instance.stepping){if(t&j.TransformBit.SCALE)for(var o=this.rigidBody.getComponents(r),s=0;s<o.length;s++)o[s].apply();var a=this._rigidBody.type,l=this._body;if(l){var c=0,h=!1,u=!1;if(t&j.TransformBit.POSITION){h=!0;var d=this._rigidBody.node.worldPosition;st.x=d.x/i,st.y=d.y/i}if(t&j.TransformBit.ROTATION){u=!0;var _=this._rigidBody.node.worldRotation,y=rt;x.toEulerInYXZOrder(y,_),c=m(y.z)}if(h||u)if(a===e.Animated)h&&this._animatedPos.set(st.x,st.y),u&&(this._animatedAngle=c);else{var f=b2jsb._tempFloatArray;h&&u?(f[0]=st.x,f[1]=st.y,f[2]=c,l._SetTransformJSB()):h?(f[0]=st.x,f[1]=st.y,l._SetPositionJSB()):(f[0]=c,l._SetAngleJSB())}}}},o._init=function(){this._inited||(n.instance.physicsWorld.addBody(this),this.setActive(!1),this._inited=!0)},o._destroy=function(){this._inited&&(n.instance.physicsWorld.removeBody(this),this._inited=!1)},o.animate=function(t){var i=this._body;if(i){var n=i.GetPosition();i.SetAwake(!0);var e=1/t;st.x=(this._animatedPos.x-n.x)*e,st.y=(this._animatedPos.y-n.y)*e,i.SetLinearVelocity(st);var o=i.GetAngle()%v;o>Math.PI&&(o-=v);var r=(this._animatedAngle-o)*e;this._animatedAngle<-w&&o>w&&(r=(this._animatedAngle+v-o)*e),this._animatedAngle>w&&o<-w&&(r=(this._animatedAngle-v-o)*e),i.SetAngularVelocity(r)}},o.syncSceneToPhysics=function(){var t=this._rigidBody.node.hasChangedFlags;t&&this.nodeTransformChanged(t)},o.syncPositionToPhysics=function(t){void 0===t&&(t=!1);var n=this._body;if(n){var o=this._rigidBody.node.worldPosition,r=this._rigidBody.type,s=st;s.x=o.x/i,s.y=o.y/i,r===e.Animated&&t?this._animatedPos.set(s.x,s.y):n.SetTransform(s,n.GetAngle())}},o.syncRotationToPhysics=function(t){void 0===t&&(t=!1);var i=this._body;if(i){var n=this._rigidBody.node.worldRotation,o=rt;x.toEulerInYXZOrder(o,n);var r=m(o.z);this._rigidBody.type===e.Animated&&t?this._animatedAngle=r:i.SetTransform(i.GetPosition(),r)}},o.resetVelocity=function(){var t=this._body;t&&(st.x=0,st.y=0,t.SetLinearVelocity(st),t.SetAngularVelocity(0))},o.setType=function(t){this._body.SetType(t)},o.setLinearDamping=function(t){this._body.SetLinearDamping(t)},o.setAngularDamping=function(t){this._body.SetAngularDamping(t)},o.setGravityScale=function(t){this._body.SetGravityScale(t)},o.setFixedRotation=function(t){this._body.SetFixedRotation(t)},o.setAllowSleep=function(t){this._body.SetSleepingAllowed(t)},o.isActive=function(){return this._body.IsEnabled()},o.setActive=function(t){this._body.SetEnabled(t)},o.wakeUp=function(){this._body.SetAwake(!0)},o.sleep=function(){this._body.SetAwake(!1)},o.getMass=function(){return this._body.GetMass()},o.setLinearVelocity=function(t){this._body.SetLinearVelocity(t)},o.getLinearVelocity=function(t){var i=this._body.GetLinearVelocity();return t.x=i.x,t.y=i.y,t},o.getLinearVelocityFromWorldPoint=function(t,n){st.x=t.x/i,st.y=t.y/i;var e=this._body.GetLinearVelocityFromWorldPoint(st);return n.x=e.x,n.y=e.y,n.x*=i,n.y*=i,n},o.setAngularVelocity=function(t){this._body.SetAngularVelocity(t)},o.getAngularVelocity=function(){return this._body.GetAngularVelocity()},o.getLocalVector=function(t,n){n=n||new f,st.x=t.x/i,st.y=t.y/i;var e=this._body.GetLocalVector(st);return n.x=e.x,n.y=e.y,n.x*=i,n.y*=i,n},o.getWorldVector=function(t,n){st.x=t.x/i,st.y=t.y/i;var e=this._body.GetWorldVector(st);return n.x=e.x,n.y=e.y,n.x*=i,n.y*=i,n},o.getLocalPoint=function(t,n){n=n||new f,st.x=t.x/i,st.y=t.y/i;var e=this._body.GetLocalPoint(st);return n.x=e.x,n.y=e.y,n.x*=i,n.y*=i,n},o.getWorldPoint=function(t,n){n=n||new f,st.x=t.x/i,st.y=t.y/i;var e=this._body.GetWorldPoint(st);return n.x=e.x,n.y=e.y,n.x*=i,n.y*=i,n},o.getLocalCenter=function(t){t=t||new f;var n=this._body.GetLocalCenter();return t.x=n.x*i,t.y=n.y*i,t},o.getWorldCenter=function(t){t=t||new f;var n=this._body.GetWorldCenter();return t.x=n.x*i,t.y=n.y*i,t},o.getInertia=function(){return this._body.GetInertia()},o.applyForce=function(t,n,e){this._body&&(st.x=n.x/i,st.y=n.y/i,this._body.ApplyForce(t,st,e))},o.applyForceToCenter=function(t,i){this._body&&this._body.ApplyForceToCenter(t,i)},o.applyTorque=function(t,i){this._body&&this._body.ApplyTorque(t,i)},o.applyLinearImpulse=function(t,n,e){this._body&&(st.x=n.x/i,st.y=n.y/i,this._body.ApplyLinearImpulse(t,st,e))},o.applyLinearImpulseToCenter=function(t,i){this._body&&this._body.ApplyLinearImpulse(t,this._body.GetPosition(),i)},o.applyAngularImpulse=function(t,i){this._body&&this._body.ApplyAngularImpulse(t,i)},_(t,[{key:"impl",get:function(){return this._body}},{key:"_imp",set:function(t){this._body=t}},{key:"rigidBody",get:function(){return this._rigidBody}},{key:"isAwake",get:function(){return this._body.IsAwake()}},{key:"isSleeping",get:function(){return!this._body.IsAwake()}}]),t}(),lt=new b2jsb.Filter,ct={x:0,y:0},ht={x:0,y:0};function ut(t){var i=t.collider;return i.body?lt.categoryBits=i.group===F.DEFAULT?i.body.group:i.group:lt.categoryBits=i.group,lt.maskBits=n.instance.collisionMatrix[lt.categoryBits],lt}var dt=function(){function t(){this._shapes=[],this._fixtures=[],this._collider=null,this._body=null,this._inited=!1,this._rect=new S}var e=t.prototype;return e.initialize=function(t){this._collider=t},e.onLoad=function(){},e.onEnable=function(){n.instance._callAfterStep(this,this._init)},e.onDisable=function(){n.instance._callAfterStep(this,this._destroy)},e.start=function(){},e.onGroupChanged=function(){var t=ut(this);this._fixtures.forEach((function(i){i.SetFilterData(t)}))},e.apply=function(){this._destroy(),this.collider.enabledInHierarchy&&this._init()},e.getFixtureIndex=function(t){return this._fixtures.indexOf(t)},e._createShapes=function(){return[]},e._init=function(){if(!this._inited){var t=this.collider,i=t.node.worldScale,e=b.ZERO,o=t.getComponent(s);o&&o.impl&&o.impl.impl?this._body=o.impl.impl:(this._body=n.instance.physicsWorld.groundBodyImpl,e=t.node.worldPosition);for(var r=0===i.x&&0===i.y?[]:this._createShapes(i.x,i.y,e.x,e.y),a=ut(this),l=0;l<r.length;l++){var c=r[l],h=new b2jsb.FixtureDef;h.density=t.density,h.isSensor=t.sensor,h.friction=t.friction,h.restitution=t.restitution,h.shape=c,h.filter=a;var u=this._body.CreateFixture(h);u.m_userData=this,null!=o&&o.enabledContactListener&&n.instance.physicsWorld.registerContactFixture(u),this._shapes.push(c),this._fixtures.push(u)}this._inited=!0}},e._destroy=function(){if(this._inited){for(var t=this._fixtures,i=this._body,e=t.length-1;e>=0;e--){var o=t[e];o.m_userData=null,n.instance.physicsWorld.unregisterContactFixture(o),i&&i.DestroyFixture(o)}this._body=null,this._fixtures.length=0,this._shapes.length=0,this._inited=!1}},_(t,[{key:"impl",get:function(){return this._shapes}},{key:"collider",get:function(){return this._collider}},{key:"worldAABB",get:function(){for(var t=1e7,n=t,e=t,o=-t,r=-t,s=this._fixtures,a=0;a<s.length;a++)for(var l=s[a],c=l.GetShape().GetChildCount(),h=0;h<c;h++){var u=l.GetAABB(h).lowerBound;ct.x=u.x,ct.y=u.y;var d=l.GetAABB(h).upperBound;if(ht.x=d.x,ht.y=d.y,2===l.GetShape().m_type){var _=l.GetShape().m_radius;ct.x+=_,ct.y+=_,ht.x-=_,ht.y-=_}ct.x<n&&(n=ct.x),ct.y<e&&(e=ct.y),ht.x>o&&(o=ht.x),ht.y>r&&(r=ht.y)}n*=i,e*=i,o*=i,r*=i;var y=this._rect;return y.x=n,y.y=e,y.width=o-n,y.height=r-e,y}}]),t}(),_t=new S,yt=function(t){function n(){for(var i,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(i=t.call.apply(t,[this].concat(e))||this)._worldPoints=[new f,new f,new f,new f],i}return c(n,t),n.prototype._createShapes=function(t,n,e,o){t=Math.abs(t),n=Math.abs(n);var r=this.collider,s=r.size.width/2/i*t,a=r.size.height/2/i*n,l=(e+r.offset.x*t)/i,c=(o+r.offset.y*n)/i,h=new b2jsb.PolygonShape;return h.SetAsBox(s,a,new b2jsb.Vec2(l,c),0),[h]},_(n,[{key:"worldPoints",get:function(){var t=_t,i=this.collider,n=i.size,e=i.offset;t.x=e.x-n.width/2,t.y=e.y-n.height/2,t.width=n.width,t.height=n.height;var o=this._worldPoints,r=o[0],s=o[1],a=o[2],l=o[3];return t.transformMat4ToPoints(i.node.worldMatrix,r,s,a,l),o}}]),n}(dt),ft=function(t){function n(){for(var i,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(i=t.call.apply(t,[this].concat(e))||this)._worldPosition=new f,i}return c(n,t),n.prototype._createShapes=function(t,n,e,o){t=Math.abs(t),n=Math.abs(n);var r=this.collider,s=(e+r.offset.x*t)/i,a=(o+r.offset.y*n)/i,l=new b2jsb.CircleShape;return l.m_radius=r.radius/i*t,l.m_p={x:s,y:a},[l]},_(n,[{key:"worldRadius",get:function(){return this._shapes[0].m_radius*i}},{key:"worldPosition",get:function(){var t=this._shapes[0].m_p;return this._worldPosition.set(t.x*i,t.y*i)}}]),n}(dt),pt=function(t){function n(){for(var i,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(i=t.call.apply(t,[this].concat(e))||this)._worldPoints=[],i}return c(n,t),n.prototype._createShapes=function(t,n,e,o){var r=[],s=this.collider,l=s.points;l.length>0&&l[0].equals(l[l.length-1])&&(l.length-=1);var c=a(l);if(!c)return y(16408,s.node.name),r;for(var h=s.offset,u=0;u<c.length;u++){for(var d=c[u],_=null,f=[],p=null,b=0,g=d.length;b<g;b++){_||(_=new b2jsb.PolygonShape);var x=d[b],m=(e+(x.x+h.x)*t)/i,v=(o+(x.y+h.y)*n)/i,w=new b2jsb.Vec2(m,v);f.push(w),p||(p=w),f.length===b2jsb.maxPolygonVertices&&(_.Set(f,f.length),r.push(_),_=null,b<g-1&&(f=[p,f[f.length-1]]))}_&&(_.Set(f,f.length),r.push(_))}return r},_(n,[{key:"worldPoints",get:function(){for(var t=this.collider,i=t.points,n=this._worldPoints,e=t.node.worldMatrix,o=0;o<i.length;o++)n[o]||(n[o]=new f),f.transformMat4(n[o],i[o],e);return n.length=i.length,this._worldPoints}}]),n}(dt),bt=function(){function t(){this._b2joint=null,this._jointComp=null,this._body=null,this._inited=!1}var i=t.prototype;return i.initialize=function(t){this._jointComp=t},i.onEnable=function(){n.instance._callAfterStep(this,this._init)},i.onDisable=function(){n.instance._callAfterStep(this,this._destroy)},i.start=function(){n.instance._callAfterStep(this,this._init)},i.apply=function(){n.instance._callAfterStep(this,this._destroy),this.comp.enabledInHierarchy&&n.instance._callAfterStep(this,this._init)},i._init=function(){if(!this._inited){var t=this._jointComp;if(t.isValid){this._body=t.getComponent(s);var i=this._createJointDef();if(i){i.bodyA=this._body.impl.impl;var e=t.connectedBody;e&&!e.enabledInHierarchy||(i.bodyB=e?e.impl.impl:n.instance.physicsWorld.groundBodyImpl,i.collideConnected=t.collideConnected,this._b2joint=n.instance.physicsWorld.impl.CreateJoint(i),this._inited=!0)}}}},i._destroy=function(){this._inited&&(n.instance.physicsWorld.impl.DestroyJoint(this._b2joint),this._b2joint=null,this._inited=!1)},i._createJointDef=function(){return null},i.isValid=function(){return this._b2joint&&this._body&&this._body.impl&&this._jointComp},_(t,[{key:"impl",get:function(){return this._b2joint}},{key:"comp",get:function(){return this._jointComp}},{key:"body",get:function(){return this._body}}]),t}(),gt=new b2jsb.Vec2,xt=function(t){function e(){for(var i,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(i=t.call.apply(t,[this].concat(e))||this)._touchPoint=new f,i._isTouched=!1,i}c(e,t);var o=e.prototype;return o.setTarget=function(t){this._b2joint&&(gt.x=t.x/i,gt.y=t.y/i,this._b2joint.SetTarget(gt))},o.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetDampingRatio(t)},o.setFrequency=function(t){this._b2joint&&this._b2joint.SetFrequency(t)},o.setMaxForce=function(t){this._b2joint&&this._b2joint.SetMaxForce(t)},o._createJointDef=function(){var t=new b2jsb.MouseJointDef,n=this._jointComp;return t.target={x:this._touchPoint.x/i,y:this._touchPoint.y/i},t.maxForce=n.maxForce,t.dampingRatio=n.dampingRatio,t.frequencyHz=n.frequency,t},o.start=function(){},o.onEnable=function(){this._enableTouch(!0)},o.onDisable=function(){t.prototype.onDisable.call(this),this._enableTouch(!1)},o._enableTouch=function(t){var i=A("Canvas");if(i){var n=t?i.on:i.off;n.call(i,D.TOUCH_START,this.onTouchBegan,this),n.call(i,D.TOUCH_MOVE,this.onTouchMove,this),n.call(i,D.TOUCH_END,this.onTouchEnd,this),n.call(i,D.TOUCH_CANCEL,this.onTouchEnd,this)}},o.onTouchBegan=function(t){this._isTouched=!0;var i=this._touchPoint.set(t.getUILocation()),e=n.instance.physicsWorld.testPoint(i);if(!(e.length<=0)){var o=e[0].body;o.wakeUp();var r=this._jointComp;r.connectedBody=o,this._init(),this.setMaxForce(r.maxForce*o.getMass()),this.setTarget(i)}},o.onTouchMove=function(t){this._touchPoint=t.getUILocation()},o.onTouchEnd=function(){this._destroy(),this._isTouched=!1},o.update=function(){this._isTouched&&this.isValid()&&this.setTarget(this._touchPoint)},e}(bt),mt=function(t){function n(){return t.apply(this,arguments)||this}c(n,t);var e=n.prototype;return e.setMaxLength=function(t){this._b2joint&&this._b2joint.SetMaxLength(t)},e._createJointDef=function(){var t=this._jointComp,n=new b2jsb.RopeJointDef;return n.localAnchorA={x:t.anchor.x/i,y:t.anchor.y/i},n.localAnchorB={x:t.connectedAnchor.x/i,y:t.connectedAnchor.y/i},n.maxLength=t.maxLength/i,n},n}(bt),vt=function(t){function n(){return t.apply(this,arguments)||this}c(n,t);var e=n.prototype;return e.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetDampingRatio(t)},e.setFrequency=function(t){this._b2joint&&this._b2joint.SetFrequency(t)},e.setDistance=function(t){this._b2joint&&this._b2joint.SetLength(t)},e._createJointDef=function(){var t=this._jointComp,n=new b2jsb.DistanceJointDef;return n.localAnchorA={x:t.anchor.x/i,y:t.anchor.y/i},n.localAnchorB={x:t.connectedAnchor.x/i,y:t.connectedAnchor.y/i},n.length=t.distance/i,n.dampingRatio=t.dampingRatio,n.frequencyHz=t.frequency,n},n}(bt),wt=function(t){function n(){return t.apply(this,arguments)||this}c(n,t);var e=n.prototype;return e.setMaxForce=function(t){this._b2joint&&this._b2joint.SetMaxForce(t)},e.setAngularOffset=function(t){this._b2joint&&this._b2joint.SetAngularOffset(m(t))},e.setLinearOffset=function(t){this._b2joint&&this._b2joint.SetLinearOffset(new b2jsb.Vec2(t.x/i,t.y/i))},e.setCorrectionFactor=function(t){this._b2joint&&(this._b2joint.m_correctionFactor=t)},e.setMaxTorque=function(t){this._b2joint&&this._b2joint.SetMaxTorque(t)},e._createJointDef=function(){var t=this._jointComp,n=new b2jsb.MotorJointDef;return n.linearOffset={x:t.linearOffset.x/i,y:t.linearOffset.y/i},n.angularOffset=m(t.angularOffset),n.maxForce=t.maxForce,n.maxTorque=t.maxTorque,n.correctionFactor=t.correctionFactor,n},n}(bt),St=function(t){function n(){return t.apply(this,arguments)||this}c(n,t);var e=n.prototype;return e.enableLimit=function(t){this._b2joint&&this._b2joint.EnableLimit(t)},e.setLowerLimit=function(){this.updateLimits()},e.setUpperLimit=function(){this.updateLimits()},e.updateLimits=function(){if(this._b2joint){var t=this._jointComp;this._b2joint.SetLimits(t.lowerLimit/i,t.upperLimit/i)}},e.enableMotor=function(t){this._b2joint&&this._b2joint.EnableMotor(t)},e.setMaxMotorForce=function(t){this._b2joint&&this._b2joint.SetMaxMotorForce(t)},e.setMotorSpeed=function(t){this._b2joint&&this._b2joint.SetMotorSpeed(t)},e._createJointDef=function(){var t=this._jointComp,n=new b2jsb.PrismaticJointDef;n.localAnchorA={x:t.anchor.x/i,y:t.anchor.y/i},n.localAnchorB={x:t.connectedAnchor.x/i,y:t.connectedAnchor.y/i};var e=m(t.angle);return n.localAxisA={x:Math.cos(e),y:Math.sin(e)},n.referenceAngle=0,n.enableLimit=t.enableLimit,n.lowerTranslation=t.lowerLimit/i,n.upperTranslation=t.upperLimit/i,n.enableMotor=t.enableMotor,n.maxMotorForce=t.maxMotorForce,n.motorSpeed=t.motorSpeed,n},n}(bt),At=function(t){function n(){return t.apply(this,arguments)||this}c(n,t);var e=n.prototype;return e.setFrequency=function(t){this._b2joint&&this._b2joint.SetFrequency(t)},e.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetDampingRatio(t)},e._createJointDef=function(){var t=this._jointComp,n=new b2jsb.WeldJointDef;return n.localAnchorA={x:t.anchor.x/i,y:t.anchor.y/i},n.localAnchorB={x:t.connectedAnchor.x/i,y:t.connectedAnchor.y/i},n.referenceAngle=0,n.frequencyHz=t.frequency,n.dampingRatio=t.dampingRatio,n},n}(bt),jt=function(t){function n(){return t.apply(this,arguments)||this}c(n,t);var e=n.prototype;return e.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetSpringDampingRatio(t)},e.setFrequency=function(t){this._b2joint&&this._b2joint.SetSpringFrequencyHz(t)},e.enableMotor=function(t){this._b2joint&&this._b2joint.EnableMotor(t)},e.setMaxMotorTorque=function(t){this._b2joint&&this._b2joint.SetMaxMotorTorque(t)},e.setMotorSpeed=function(t){this._b2joint&&this._b2joint.SetMotorSpeed(t)},e._createJointDef=function(){var t=this._jointComp,n=new b2jsb.WheelJointDef;n.localAnchorA={x:t.anchor.x/i,y:t.anchor.y/i},n.localAnchorB={x:t.connectedAnchor.x/i,y:t.connectedAnchor.y/i};var e=m(t.angle);return n.localAxisA={x:Math.cos(e),y:Math.sin(e)},n.maxMotorTorque=t.maxMotorTorque,n.motorSpeed=m(t.motorSpeed),n.enableMotor=t.enableMotor,n.dampingRatio=t.dampingRatio,n.frequencyHz=t.frequency,n},n}(bt),Ct=function(t){function n(){return t.apply(this,arguments)||this}c(n,t);var e=n.prototype;return e.enableLimit=function(t){this._b2joint&&this._b2joint.EnableLimit(t)},e.setLowerAngle=function(){this.updateLimits()},e.setUpperAngle=function(){this.updateLimits()},e.updateLimits=function(){if(this._b2joint){var t=this._jointComp;this._b2joint.SetLimits(m(t.lowerAngle),m(t.upperAngle))}},e.enableMotor=function(t){this._b2joint&&this._b2joint.EnableMotor(t)},e.setMaxMotorTorque=function(t){this._b2joint&&this._b2joint.SetMaxMotorTorque(t)},e.setMotorSpeed=function(t){this._b2joint&&this._b2joint.SetMotorSpeed(t)},e._createJointDef=function(){var t=this._jointComp,n=new b2jsb.RevoluteJointDef;return n.localAnchorA={x:t.anchor.x/i,y:t.anchor.y/i},n.localAnchorB={x:t.connectedAnchor.x/i,y:t.connectedAnchor.y/i},n.enableMotor=t.enableMotor,n.maxMotorTorque=t.maxMotorTorque,n.motorSpeed=m(t.motorSpeed),n.enableLimit=t.enableLimit,n.lowerAngle=m(t.lowerAngle),n.upperAngle=m(t.upperAngle),n},n}(bt);T.once(P.EVENT_PRE_SUBSYSTEM_INIT,(function(){l.register("box2d-jsb",{PhysicsWorld:ot,RigidBody:at,BoxShape:yt,CircleShape:ft,PolygonShape:pt,MouseJoint:xt,DistanceJoint:mt,SpringJoint:vt,RelativeJoint:wt,SliderJoint:St,FixedJoint:At,WheelJoint:jt,HingeJoint:Ct})}))}}}));
//# sourceMappingURL=physics-2d-box2d-jsb.js.map
