System.register(["./_virtual_internal_constants-CVZmBipG.js","./physics-2d-framework-S9Sh01v2.js","./gc-object-BD6DANSw.js","./wasm-web-DpHjq6qw.js","./deprecated-gv6rCJsk.js","./director-D6Xf3-Ej.js","./index-BcjqSS2q.js","./sprite-renderer-CC0tdWTR.js","./ui-renderer-BG8n0rhU.js","./prefab-CJahvMeV.js","./scene-D5fG1En6.js","./pipeline-state-manager-C4BAah3w.js","./node-event-BDYemSfE.js","./collision-matrix-DvJE_i6G.js","./global-exports-ZavlJGEN.js","./device-manager-BCOP-4pU.js","./buffer-barrier-CZBuOw0V.js","./debug-view-zRQBd5E1.js","./deprecated-BaebfHhU.js","./camera-component-DK1ym1MK.js","./sprite-frame-CT0e6iHI.js","./create-mesh-CgNcAxLl.js","./mesh-BsaPYlYJ.js","./zlib.min-CyXMsivM.js","./deprecated-B2PZGYTz.js","./model-renderer-KnEZ5pPV.js","./renderer-DVTO-7-w.js","./sorting-layers-sC9IxUEk.js","./touch-Ch03mDFP.js"],(function(t,i){"use strict";var e,n,o,r,s,a,l,c,u,h,d,f,y,_,p,g,m,b,x,v,w,S,P,A,B,C,D,j,T,M,F,G,L,k,V,R,I,E;return{setters:[null,function(t){e=t.a,n=t.b,o=t.P,r=t.c,s=t.C,a=t.d,l=t.R,c=t.e,u=t.s},function(t){h=t.G,d=t.L,f=t.d,y=t.h,_=t.au,p=t.a,g=t.F,m=t._},function(t){b=t.e,x=t.i},function(t){v=t.g,w=t.G},function(t){S=t.d},function(t){P=t.n,A=t.V,B=t.C,C=t.f,D=t.Y,j=t.Q,T=t.a5,M=t.a4,F=t.h,G=t.l},function(t){L=t.C},null,function(t){k=t.f},function(t){V=t.N},function(t){R=t.L},function(t){I=t.N},function(t){E=t.P},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){t("loadWasmModuleBox2D",(function(){return Promise.resolve()}));var W={};function q(t){return t?t.$$.ptr:0}var J=new Map;function N(t,i,e){if(e){var n=J.get(t);n||(n=new Map,J.set(t,n)),n.set(e,i)}}function O(t,i){if(i){var e=J.get(t);e&&e.has(i)&&(e.delete(i),0===e.size&&J.delete(t))}}function z(t,i){var e=J.get(t);return null==e?void 0:e.get(i)}var H,U=new Map;function Q(t,i,e){if(e){var n=U.get(t);n||(n=new Map,U.set(t,n)),n.set(e,i)}}function Y(t,i){if(i){var e=U.get(t);e&&e.has(i)&&(e.delete(i),0===e.size&&U.delete(t))}}function X(t,i,e){e.x=t.q.c*i.x-t.q.s*i.y+t.p.x,e.y=t.q.s*i.x+t.q.c*i.y+t.p.y}v.onPostInfrastructureInitDelegate.add((function(){return b().then((function(){return P.hasFeature(P.Feature.WASM)?Promise.all([i.import("./box2d.release.wasm-DxtkoxeC.js").then((function(t){return t.b})),i.import("./box2d.release.wasm-BXZod5eD.js")]).then((function(t){return i=t[0].default,e=t[1].default,new Promise((function(t,n){var o=function(t){return"[box2d]: box2d wasm lib load failed: "+t};i({instantiateWasm:function(t,i){x(e,t).then((function(t){i(t.instance,t.module)})).catch((function(t){return n(o(t))}))}}).then((function(t){h("[box2d]:box2d wasm lib loaded."),W=t})).then(t).catch((function(t){return n(o(t))}))}));var i,e})):i.import("./box2d.release.asm-D6DRr2VU.js").then((function(t){return t.b})).then((function(t){return i=t.default,new Promise((function(t,e){var n=function(t){return"[box2d]: box2d asm lib load failed: "+t};i().then((function(t){h("[box2d]:box2d asm lib loaded."),W=t})).then(t).catch((function(t){return e(n(t))}))}));var i}))})).catch((function(t){d(t)}))}));var K,Z=function(){function t(){}return t.BeginContact=function(t){this._BeginContact&&this._BeginContact(t)},t.EndContact=function(t){this._EndContact&&this._EndContact(t)},t.PreSolve=function(t,i){this._PreSolve&&this._PreSolve(t,i)},t.PostSolve=function(t,i){this._PostSolve&&this._PostSolve(t,i)},t}();H=Z,Z._BeginContact=null,Z._EndContact=null,Z._PreSolve=null,Z._PostSolve=null,Z.callback={BeginContact:function(t){H.BeginContact(t)},EndContact:function(t){H.EndContact(t)},PreSolve:function(t,i){H.PreSolve(t,i)},PostSolve:function(t,i){H.PostSolve(t,i)}};var $,tt=function(){function t(){}return t.init=function(t){t?(this._isPoint=!0,this._point.x=t.x,this._point.y=t.y):this._isPoint=!1,this._fixtures.length=0},t.ReportFixture=function(t){return this._isPoint?W.FixtureTestPoint(t,this._point)&&this._fixtures.push(t):this._fixtures.push(t),!0},t.getFixture=function(){return this._fixtures[0]},t.getFixtures=function(){return this._fixtures},t}();K=tt,tt._point={x:0,y:0},tt._isPoint=!1,tt._fixtures=[],tt.callback={ReportFixture:function(t){return K.ReportFixture(t)}};var it=function(){function t(){}return t.init=function(i,e){t._type=i,t._mask=e,t._fixtures.length=0,t._points.length=0,t._normals.length=0,t._fractions.length=0},t.ReportFixture=function(i,n,o,r){return W.FixtureGetFilterData(i).categoryBits&t._mask?t._type===e.Closest?(t._fixtures[0]=i,t._points[0]=n,t._normals[0]=o,t._fractions[0]=r,r):(t._fixtures.push(i),t._points.push(new A(n.x,n.y)),t._normals.push(new A(o.x,o.y)),t._fractions.push(r),t._type===e.Any?0:t._type>=e.All?1:r):-1},t.getFixtures=function(){return t._fixtures},t.getPoints=function(){return t._points},t.getNormals=function(){return t._normals},t.getFractions=function(){return t._fractions},t}();$=it,it._type=e.Closest,it._fixtures=[],it._points=[],it._normals=[],it._fractions=[],it._mask=4294967295,it.callback={ReportFixture:function(t,i,e,n){return $.ReportFixture(t,i,e,n)}};var et,nt=[],ot=[new A,new A],rt={points:[],separations:[],normal:new A},st=function(){this.localPoint=new A,this.normalImpulse=0,this.tangentImpulse=0},at=[new st,new st],lt={type:0,localPoint:new A,localNormal:new A,points:[]},ct={normalImpulses:[],tangentImpulses:[]},ut=function(){function t(){this.colliderA=null,this.colliderB=null,this.disabled=!1,this.disabledOnce=!1,this._impulsePtr=0,this._inverted=!1,this._implPtr=0,this._b2WorldmanifoldPtr=0}t.get=function(i){var e=nt.pop();return e||(e=new t),e.init(i),e},t.put=function(t){var i=z(2,t);i&&(nt.push(i),i.reset())};var i=t.prototype;return i._setImpulse=function(t){this._impulsePtr=t},i.init=function(t){var i=W.ContactGetFixture(t);this.colliderA=z(0,i.x).collider,this.colliderB=z(0,i.y).collider,this.disabled=!1,this.disabledOnce=!1,this._impulsePtr=0,this._inverted=!1,this._implPtr=t,N(2,this,this._implPtr),this._b2WorldmanifoldPtr=W.WorldManifoldNew()},i.reset=function(){this.setTangentSpeed(0),this.resetFriction(),this.resetRestitution(),this.colliderA=null,this.colliderB=null,this.disabled=!1,this._impulsePtr=0,O(2,this._implPtr),this._implPtr=0,W.WorldManifoldDelete(this._b2WorldmanifoldPtr),this._b2WorldmanifoldPtr=0},i.getWorldManifold=function(){var t=rt.points,i=rt.separations,e=rt.normal;W.ContactGetWorldManifold(this._implPtr,this._b2WorldmanifoldPtr);var o=W.ContactGetManifold(this._implPtr),r=W.ManifoldGetPointCount(o);t.length=i.length=r;for(var s=0;s<r;s++){var a=ot[s];a.x=W.WorldManifoldGetPointValueX(this._b2WorldmanifoldPtr,s)*n,a.y=W.WorldManifoldGetPointValueY(this._b2WorldmanifoldPtr,s)*n,t[s]=a,i[s]=W.WorldManifoldGetSeparationValue(this._b2WorldmanifoldPtr,s)*n}return e.x=W.WorldManifoldGetNormalValueX(this._b2WorldmanifoldPtr),e.y=W.WorldManifoldGetNormalValueY(this._b2WorldmanifoldPtr),this._inverted&&(e.x*=-1,e.y*=-1),rt},i.getManifold=function(){for(var t=lt.points,i=lt.localNormal,e=lt.localPoint,o=W.ContactGetManifold(this._implPtr),r=t.length=W.ManifoldGetPointCount(o),s=0;s<r;s++){var a=at[s],l=W.ManifoldGetManifoldPointPtr(o,s);a.localPoint.x=W.ManifoldPointGetLocalPointX(l)*n,a.localPoint.y=W.ManifoldPointGetLocalPointY(l)*n,a.normalImpulse=W.ManifoldPointGetNormalImpulse(l)*n,a.tangentImpulse=W.ManifoldPointGetTangentImpulse(l),t[s]=a}return e.x=W.ManifoldGetLocalPointValueX(o)*n,e.y=W.ManifoldGetLocalPointValueY(o)*n,i.x=W.ManifoldGetLocalNormalValueX(o),i.y=W.ManifoldGetLocalNormalValueY(o),lt.type=W.ManifoldGetType(o),this._inverted&&(i.x*=-1,i.y*=-1),lt},i.getImpulse=function(){var t=this._impulsePtr;if(!t)return null;for(var i=ct.normalImpulses,e=ct.tangentImpulses,o=W.ContactImpulseGetCount(t),r=0;r<o;r++)i[r]=W.ContactImpulseGetNormalImpulse(t,r)*n,e[r]=W.ContactImpulseGetTangentImpulse(t,r);return e.length=i.length=o,ct},i.emit=function(t){var i,e,n=this.colliderA,r=this.colliderB,s=null==n||null==(i=n.body)?void 0:i.enabledContactListener,a=null==r||null==(e=r.body)?void 0:e.enabledContactListener;s&&n.emit(t,n,r,this),a&&r.emit(t,r,n,this),(s||a)&&o.instance.emit(t,n,r,this),(this.disabled||this.disabledOnce)&&(this.setEnabled(!1),this.disabledOnce=!1)},i.setEnabled=function(t){W.ContactSetEnabled(this._implPtr,t)},i.isTouching=function(){return W.ContactIsTouching(this._implPtr)},i.setTangentSpeed=function(t){W.ContactSetTangentSpeed(this._implPtr,t)},i.getTangentSpeed=function(){return W.ContactGetTangentSpeed(this._implPtr)},i.setFriction=function(t){W.ContactSetFriction(this._implPtr,t)},i.getFriction=function(){return W.ContactGetFriction(this._implPtr)},i.resetFriction=function(){W.ContactResetFriction(this._implPtr)},i.setRestitution=function(t){W.ContactSetRestitution(this._implPtr,t)},i.getRestitution=function(){return W.ContactGetRestitution(this._implPtr)},i.resetRestitution=function(){W.ContactResetRestitution(this._implPtr)},t}(),ht={x:0,y:0},dt={x:0,y:0},ft=new B,yt=B.GREEN,_t=B.RED,pt=function(){function t(){}t._DrawPolygon=function(i,e){for(var o=t._drawer,r=W.HEAPF32.subarray(i/4,i/4+2*e),s=0;s<e;s++){ht.x=r[2*s+0],ht.y=r[2*s+1],X(t._xf,ht,dt);var a=dt.x*n,l=dt.y*n;0===s?o.moveTo(a,l):o.lineTo(a,l)}o.close()},t.DrawPolygon=function(i,e,n){t._applyStrokeColor(n),t._DrawPolygon(i,e),t._drawer.stroke()},t.DrawSolidPolygon=function(i,e,n){t._applyFillColor(n),t._DrawPolygon(i,e),t._drawer.fill(),t._drawer.stroke()},t._DrawCircle=function(i,e){X(t._xf,i,dt),t._drawer.circle(dt.x*n,dt.y*n,e*n)},t.DrawCircle=function(i,e,n){t._applyStrokeColor(n),t._DrawCircle(i,e),t._drawer.stroke()},t.DrawSolidCircle=function(i,e,n,o){t._applyFillColor(o),t._DrawCircle(i,e),t._drawer.fill()},t.DrawSegment=function(i,e,o){var r=t._drawer;if(i.x===e.x&&i.y===e.y)return t._applyFillColor(o),t._DrawCircle(i,2/n),void r.fill();t._applyStrokeColor(o),X(t._xf,i,ht),r.moveTo(ht.x*n,ht.y*n),X(t._xf,e,ht),r.lineTo(ht.x*n,ht.y*n),r.stroke()},t.DrawTransform=function(i){var e=t._drawer;e.strokeColor=_t,ht.x=ht.y=0,X(i,ht,dt),e.moveTo(dt.x*n,dt.y*n),ht.x=1,ht.y=0,X(i,ht,dt),e.lineTo(dt.x*n,dt.y*n),e.stroke(),e.strokeColor=yt,ht.x=ht.y=0,X(i,ht,dt),e.moveTo(dt.x*n,dt.y*n),ht.x=0,ht.y=1,X(i,ht,dt),e.lineTo(dt.x*n,dt.y*n),e.stroke()},t.DrawPoint=function(){},t.DrawParticles=function(){},t._applyStrokeColor=function(i){t._drawer.strokeColor=ft.set(255*i.r,255*i.g,255*i.b,150)},t._applyFillColor=function(i){t._drawer.fillColor=ft.set(255*i.r,255*i.g,255*i.b,150)};var i=t.prototype;return i.PushTransform=function(i){t._xf=i},i.PopTransform=function(){t._xf=t._dxf},t}();et=pt,pt.callback={DrawPolygon:function(t,i,e){et.DrawPolygon(t,i,e)},DrawSolidPolygon:function(t,i,e){et.DrawSolidPolygon(t,i,e)},DrawCircle:function(t,i,e){et.DrawCircle(t,i,e)},DrawSolidCircle:function(t,i,e,n){et.DrawSolidCircle(t,i,e,n)},DrawSegment:function(t,i,e){et.DrawSegment(t,i,e)},DrawTransform:function(t){et.DrawTransform(t)},DrawPoint:function(t,i,e){et.DrawPoint(t,i,e)}},pt._drawer=null,pt._xf={p:{x:0,y:0},q:{s:0,c:1}},pt._dxf={p:{x:0,y:0},q:{s:0,c:1}};var gt=new C,mt=new A,bt=new A,xt=[],vt=function(){function t(){this._world=void 0,this._bodies=[],this._animatedBodies=[],this._rotationAxis=new C,this._physicsGroundBody=void 0,this._contactListener=void 0,this._aabbQueryCallback=void 0,this._raycastQueryCallback=void 0,this._temoBodyDef=void 0,this._tempB2AABB=void 0,this.tempB2FixtureDefPtr=void 0,this._debugGraphics=null,this._b2DebugDrawer=null,this._debugDrawFlags=0,this._world=new W.World({x:0,y:-10}),this._physicsGroundBody=this._world.CreateBody(new W.BodyDef),Z._BeginContact=this._onBeginContact,Z._EndContact=this._onEndContact,Z._PreSolve=this._onPreSolve,Z._PostSolve=this._onPostSolve,this._contactListener=W.ContactListener.implement(Z.callback),this._world.SetContactListener(this._contactListener),this._aabbQueryCallback=W.QueryCallback.implement(tt.callback),this._raycastQueryCallback=W.RayCastCallback.implement(it.callback),this._temoBodyDef=new W.BodyDef,this._tempB2AABB=new W.AABB,this.tempB2FixtureDefPtr=W.FixtureDefNew()}var i=t.prototype;return i._checkDebugDrawValid=function(){if(!this._debugGraphics||!this._debugGraphics.isValid){var t=k("Canvas");if(!t){var i=S.getScene();if(!i)return;(t=new V("Canvas")).addComponent(L),t.parent=i}var e=new V("PHYSICS_2D_DEBUG_DRAW");e.hideFlags|=f.DontSave,e.parent=t,e.worldPosition=C.ZERO,e.layer=R.Enum.UI_2D;try{this._debugGraphics=e.addComponent("cc.Graphics"),this._debugGraphics.lineWidth=3,pt._drawer=this._debugGraphics;var n=W.Draw.implement(pt.callback);this._b2DebugDrawer=n,this._world.SetDebugDraw(n)}catch(t){y(4501,t.message),e.destroy(),e=null}}if(this._debugGraphics){var o=this._debugGraphics.node.parent;this._debugGraphics.node.setSiblingIndex(o.children.length-1)}this._b2DebugDrawer&&this._b2DebugDrawer.SetFlags(this.debugDrawFlags)},i.setGravity=function(t){this._world.SetGravity(t)},i.setAllowSleep=function(){this._world.SetAllowSleeping(!0)},i.step=function(t,i,e){void 0===i&&(i=10),void 0===e&&(e=10);for(var n=this._animatedBodies,o=0,r=n.length;o<r;o++)n[o].animate(t);this._world.Step(t,i,e)},i.raycast=function(t,i,o,r){if(t.equals(i))return[];o=o||e.Closest,mt.x=t.x/n,mt.y=t.y/n,bt.x=i.x/n,bt.y=i.y/n,it.init(o,r),this._world.RayCast(this._raycastQueryCallback,mt,bt);var s=it.getFixtures();if(s.length>0){for(var a=it.getPoints(),l=it.getNormals(),c=it.getFractions(),u=[],h=0,d=s.length;h<d;h++){var f=s[h],y=z(0,f),_=y.collider;if(o===e.AllClosest){for(var p=void 0,g=0;g<u.length;g++)u[g].collider===_&&(p=u[g]);if(p){c[h]<p.fraction&&(p.fixtureIndex=y.getFixtureIndex(f),p.point.x=a[h].x*n,p.point.y=a[h].y*n,p.normal.x=l[h].x,p.normal.y=l[h].y,p.fraction=c[h]);continue}}u.push({collider:_,fixtureIndex:y.getFixtureIndex(f),point:new A(a[h].x*n,a[h].y*n),normal:new A(l[h].x,l[h].y),fraction:c[h]})}return u}return[]},i.syncPhysicsToScene=function(){for(var t=this._bodies,i=0,e=t.length;i<e;i++){var o=t[i],s=o.rigidBody;if(s.type!==r.Animated){var a=s.node,l=o.impl,c=l.GetPosition();gt.x=c.x*n,gt.y=c.y*n,gt.z=0,a.worldPosition=gt;var u=D(l.GetAngle());a.setWorldRotationFromEuler(0,0,u)}else o.resetVelocity()}},i.syncSceneToPhysics=function(){for(var t=this._bodies,i=0;i<t.length;i++)t[i].syncSceneToPhysics()},i.addBody=function(t){if(!this._bodies.includes(t)){var i=this._temoBodyDef,e=t.rigidBody;i.allowSleep=e.allowSleep,i.gravityScale=e.gravityScale,i.linearDamping=e.linearDamping,i.angularDamping=e.angularDamping,i.fixedRotation=e.fixedRotation,i.bullet=e.bullet;var o=e.node,s=o.worldPosition;if(i.position={x:s.x/n,y:s.y/n},gt.z=j.getAxisAngle(this._rotationAxis,o.worldRotation),this._rotationAxis.z<0&&(gt.z=2*Math.PI-gt.z),i.angle=gt.z,i.awake=e.awakeOnLoad,e.type===r.Animated)i.type=W.BodyType.b2_kinematicBody,this._animatedBodies.push(t),t._animatedPos.set(i.position.x,i.position.y),t._animatedAngle=i.angle;else switch(e.type){case r.Dynamic:i.type=W.BodyType.b2_dynamicBody;break;case r.Static:i.type=W.BodyType.b2_staticBody;break;case r.Kinematic:i.type=W.BodyType.b2_kinematicBody;break;default:i.type=W.BodyType.b2_staticBody}var a=e,l=a._linearVelocity;i.linearVelocity={x:l.x,y:l.y},i.angularVelocity=a._angularVelocity;var c=this._world.CreateBody(i);N(1,t,q(c)),Q(1,c,q(c)),t._imp=c,this._bodies.push(t)}},i.removeBody=function(t){this._bodies.includes(t)&&(t.impl&&(O(1,q(t.impl)),Y(1,q(t.impl)),this._world.DestroyBody(t.impl),t._imp=null),_(this._bodies,t),t.rigidBody.type===r.Animated&&_(this._animatedBodies,t))},i._updateBodyType=function(t){var i=this._animatedBodies;if(t.rigidBody.type!==r.Animated)_(i,t);else{if(i.includes(t))return;i.push(t)}},i.registerContactFixture=function(t){this._contactListener.registerContactFixture(t)},i.unregisterContactFixture=function(t){this._contactListener.unregisterContactFixture(t)},i.testPoint=function(t){var i=mt.x=t.x/n,e=mt.y=t.y/n,o=.2/n;this._tempB2AABB.lowerBound={x:i-o,y:e-o},this._tempB2AABB.upperBound={x:i+o,y:e+o};var r=this._aabbQueryCallback;tt.init(mt),this._world.QueryAABB(r,this._tempB2AABB);var s=tt.getFixtures();xt.length=0;for(var a=0;a<s.length;a++){var l=z(0,s[a]).collider;xt.includes(l)||xt.push(l)}return xt},i.testAABB=function(t){this._tempB2AABB.lowerBound={x:t.xMin/n,y:t.yMin/n},this._tempB2AABB.upperBound={x:t.xMax/n,y:t.yMax/n};var i=this._aabbQueryCallback;tt.init(),this._world.QueryAABB(i,this._tempB2AABB);var e=tt.getFixtures();xt.length=0;for(var o=0;o<e.length;o++){var r=z(0,e[o]).collider;xt.includes(r)||xt.push(r)}return xt},i.drawDebug=function(){this._checkDebugDrawValid(),this._debugGraphics&&(this._debugGraphics.clear(),this._world.DebugDraw())},i._onBeginContact=function(t){ut.get(t).emit(s.BEGIN_CONTACT)},i._onEndContact=function(t){var i=z(2,t);i&&(i.emit(s.END_CONTACT),ut.put(t))},i._onPreSolve=function(t){var i=z(2,t);i&&i.emit(s.PRE_SOLVE)},i._onPostSolve=function(t,i){var e=z(2,t);e&&(e._setImpulse(i),e.emit(s.POST_SOLVE),e._setImpulse(0))},p(t,[{key:"impl",get:function(){return this._world}},{key:"groundBodyImpl",get:function(){return this._physicsGroundBody}},{key:"debugDrawFlags",get:function(){return this._debugDrawFlags},set:function(t){t||this._debugGraphics&&(this._debugGraphics.node.parent=null),this._debugDrawFlags=t}}]),t}(),wt=new C,St={x:0,y:0},Pt={x:0,y:0},At=function(){function t(){this._animatedPos=new A,this._animatedAngle=0,this._body=null,this._rigidBody=void 0,this._inited=!1}var i=t.prototype;return i.initialize=function(t){this._rigidBody=t,o.instance._callAfterStep(this,this._init)},i.onDestroy=function(){o.instance._callAfterStep(this,this._destroy)},i.onEnable=function(){this.setActive(!0)},i.onDisable=function(){this.setActive(!1)},i.nodeTransformChanged=function(t){if(!o.instance.stepping){if(t&V.TransformBit.SCALE)for(var i=this.rigidBody.getComponents(a),e=0;e<i.length;e++)i[e].apply();t&V.TransformBit.POSITION&&this.syncPositionToPhysics(!0),t&V.TransformBit.ROTATION&&this.syncRotationToPhysics(!0)}},i._init=function(){this._inited||(o.instance.physicsWorld.addBody(this),this.setActive(!1),this._inited=!0)},i._destroy=function(){var t,i;if(this._inited){var e=null==(t=this.impl)?void 0:t.GetFixtureList();if(e)for(var n=z(0,e);n&&n.impl;){n.destroy(),n=z(0,W.FixtureGetNext(e))}var r=null==(i=this.impl)?void 0:i.GetJointList();if(r)for(var s=W.JointEdgeGetJoint(r),a=z(0,s);a;)a.destroy(),a=z(0,s=W.JointEdgeGetNext(r));o.instance.physicsWorld.removeBody(this),this._inited=!1}},i.animate=function(t){var i=this._body;if(i){var e=i.GetPosition();i.SetAwake(!0);var n=1/t;St.x=(this._animatedPos.x-e.x)*n,St.y=(this._animatedPos.y-e.y)*n,i.SetLinearVelocity(St);var o=i.GetAngle()%T;o>Math.PI&&(o-=T);var r=(this._animatedAngle-o)*n;this._animatedAngle<-M&&o>M&&(r=(this._animatedAngle+T-o)*n),this._animatedAngle>M&&o<-M&&(r=(this._animatedAngle-T-o)*n),i.SetAngularVelocity(r)}},i.syncSceneToPhysics=function(){var t=this._rigidBody.node.hasChangedFlags;t&&this.nodeTransformChanged(t)},i.syncPositionToPhysics=function(t){void 0===t&&(t=!1);var i=this._body;if(i){var e=this._rigidBody.node.worldPosition;Pt.x=e.x/n,Pt.y=e.y/n,this._rigidBody.type===r.Animated&&t?this._animatedPos.set(Pt.x,Pt.y):i.SetTransform(Pt,i.GetAngle())}},i.syncRotationToPhysics=function(t){void 0===t&&(t=!1);var i=this._body;if(i){var e=this._rigidBody.node.worldRotation,n=wt;j.toEulerInYXZOrder(n,e);var o=F(n.z);this._rigidBody.type===r.Animated&&t?this._animatedAngle=o:i.SetTransform(i.GetPosition(),o)}},i.resetVelocity=function(){var t=this._body;t&&(St.x=0,St.y=0,t.SetLinearVelocity(St),t.SetAngularVelocity(0))},i.setType=function(t){o.instance.physicsWorld._updateBodyType(this),t===r.Dynamic?this._body.SetType(W.BodyType.b2_dynamicBody):t===r.Kinematic?this._body.SetType(W.BodyType.b2_kinematicBody):t===r.Static&&this._body.SetType(W.BodyType.b2_staticBody)},i.setLinearDamping=function(t){this._body.SetLinearDamping(t)},i.setAngularDamping=function(t){this._body.SetAngularDamping(t)},i.setGravityScale=function(t){this._body.SetGravityScale(t)},i.setFixedRotation=function(t){this._body.SetFixedRotation(t)},i.setAllowSleep=function(t){this._body.SetSleepingAllowed(t)},i.isActive=function(){return this._body.IsEnabled()},i.setActive=function(t){this._body.GetWorld().IsLocked()?g("Can not active RigidBody in contract listener."):this._body.SetEnabled(t)},i.wakeUp=function(){this._body.SetAwake(!0)},i.sleep=function(){this._body.SetAwake(!1)},i.getMass=function(){return this._body.GetMass()},i.setLinearVelocity=function(t){this._body.SetLinearVelocity(t)},i.getLinearVelocity=function(t){var i=this._body.GetLinearVelocity();return t.x=i.x,t.y=i.y,t},i.getLinearVelocityFromWorldPoint=function(t,i){i=i||new A,St.x=t.x/n,St.y=t.y/n;var e=this._body.GetLinearVelocityFromWorldPoint(St);return i.x=e.x*n,i.y=e.y*n,i},i.setAngularVelocity=function(t){this._body.SetAngularVelocity(t)},i.getAngularVelocity=function(){return this._body.GetAngularVelocity()},i.getLocalVector=function(t,i){i=i||new A,St.x=t.x/n,St.y=t.y/n;var e=this._body.GetLocalVector(St);return i.x=e.x*n,i.y=e.y*n,i},i.getWorldVector=function(t,i){St.x=t.x/n,St.y=t.y/n;var e=this._body.GetWorldVector(St);return i.x=e.x*n,i.y=e.y*n,i},i.getLocalPoint=function(t,i){i=i||new A,St.x=t.x/n,St.y=t.y/n;var e=this._body.GetLocalPoint(St);return i.x=e.x*n,i.y=e.y*n,i},i.getWorldPoint=function(t,i){i=i||new A,St.x=t.x/n,St.y=t.y/n;var e=this._body.GetWorldPoint(St);return i.x=e.x*n,i.y=e.y*n,i},i.getLocalCenter=function(t){t=t||new A;var i=this._body.GetLocalCenter();return t.x=i.x*n,t.y=i.y*n,t},i.getWorldCenter=function(t){t=t||new A;var i=this._body.GetWorldCenter();return t.x=i.x*n,t.y=i.y*n,t},i.getInertia=function(){return this._body.GetInertia()},i.applyForce=function(t,i,e){this._body&&(St.x=i.x/n,St.y=i.y/n,this._body.ApplyForce(t,St,e))},i.applyForceToCenter=function(t,i){this._body&&this._body.ApplyForceToCenter(t,i)},i.applyTorque=function(t,i){this._body&&this._body.ApplyTorque(t,i)},i.applyLinearImpulse=function(t,i,e){this._body&&(St.x=i.x/n,St.y=i.y/n,this._body.ApplyLinearImpulse(t,St,e))},i.applyLinearImpulseToCenter=function(t,i){this._body&&this._body.ApplyLinearImpulse(t,this._body.GetPosition(),i)},i.applyAngularImpulse=function(t,i){this._body&&this._body.ApplyAngularImpulse(t,i)},p(t,[{key:"impl",get:function(){return this._body}},{key:"_imp",set:function(t){this._body=t}},{key:"rigidBody",get:function(){return this._rigidBody}},{key:"isAwake",get:function(){return this._body.IsAwake()}},{key:"isSleeping",get:function(){return!this._body.IsAwake()}}]),t}(),Bt={categoryBits:0,maskBits:0,groupIndex:0},Ct={x:0,y:0},Dt={x:0,y:0};function jt(t){var i=t.collider;return i.body?Bt.categoryBits=i.group===E.DEFAULT?i.body.group:i.group:Bt.categoryBits=i.group,Bt.maskBits=o.instance.collisionMatrix[Bt.categoryBits],Bt}var Tt=function(){function t(){this._shapes=[],this._fixtures=[],this._collider=null,this._body=null,this._inited=!1,this._rect=new G}var i=t.prototype;return i.initialize=function(t){this._collider=t},i.onLoad=function(){},i.onEnable=function(){o.instance._callAfterStep(this,this._init)},i.onDisable=function(){o.instance._callAfterStep(this,this.destroy)},i.start=function(){},i.onGroupChanged=function(){var t=jt(this);this._fixtures.forEach((function(i){W.FixtureSetFilterData(i,t)}))},i.apply=function(){this.destroy(),this.collider.enabledInHierarchy&&this._init()},i.getFixtureIndex=function(t){return this._fixtures.indexOf(t)},i._createShapes=function(){return[]},i._init=function(){if(!this._inited){var t=this.collider,i=t.node.worldScale,e=C.ZERO,n=t.getComponent(l);n&&n.impl&&n.impl.impl?this._body=n.impl.impl:(this._body=o.instance.physicsWorld.groundBodyImpl,e=t.node.worldPosition);for(var r=0===i.x&&0===i.y?[]:this._createShapes(i.x,i.y,e.x,e.y),s=jt(this),a=0;a<r.length;a++){var c=r[a],u=o.instance.physicsWorld.tempB2FixtureDefPtr;W.FixtureDefSetAll(u,c,0,t.friction,t.restitution,t.density,t.sensor,s.categoryBits,s.maskBits,s.groupIndex);var h=W.BodyCreateFixture(q(this._body),u);N(0,this,h),Q(0,h,h),null!=n&&n.enabledContactListener&&o.instance.physicsWorld.registerContactFixture(h),this._shapes.push(c),this._fixtures.push(h)}this._inited=!0}},i.destroy=function(){if(this._inited){for(var t=this._fixtures,i=this._body,e=t.length-1;e>=0;e--){var n=t[e];O(0,n),Y(0,n),o.instance.physicsWorld.unregisterContactFixture(n),i&&W.BodyDestroyFixture(q(i),n)}this._body=null,this._fixtures.length=0,this._shapes.length=0,this._inited=!1}},p(t,[{key:"impl",get:function(){return this._shapes}},{key:"collider",get:function(){return this._collider}},{key:"worldAABB",get:function(){for(var t=1e7,i=t,e=t,o=-t,r=-t,s=this._fixtures,a=0;a<s.length;a++)for(var l=s[a],c=W.FixtureGetShape(l),u=W.ShapeGetChildCount(c),h=0;h<u;h++){var d=W.FixtureGetAABB(l,h);if(Ct.x=d.lowerBound.x,Ct.y=d.lowerBound.y,Dt.x=d.upperBound.x,Dt.y=d.upperBound.y,2===W.ShapeGetType(c)){var f=W.ShapeGetRadius(c);Ct.x+=f,Ct.y+=f,Dt.x+=f,Dt.y+=f}Ct.x<i&&(i=Ct.x),Ct.y<e&&(e=Ct.y),Dt.x>o&&(o=Dt.x),Dt.y>r&&(r=Dt.y)}i*=n,e*=n,o*=n,r*=n;var y=this._rect;return y.x=i,y.y=e,y.width=o-i,y.height=r-e,y}}]),t}(),Mt=new G,Ft=function(t){function i(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this)._worldPoints=[new A,new A,new A,new A],i}return m(i,t),i.prototype._createShapes=function(t,i,e,o){t=Math.abs(t),i=Math.abs(i);var r=this.collider,s=r.size.width/2/n*t,a=r.size.height/2/n*i,l=(e+r.offset.x*t)/n,c=(o+r.offset.y*i)/n,u=W.PolygonShapeNew();return W.PolygonShapeSetAsBoxWithCenterAndAngle(u,s,a,l,c,0),[u]},p(i,[{key:"worldPoints",get:function(){var t=Mt,i=this.collider,e=i.size,n=i.offset;t.x=n.x-e.width/2,t.y=n.y-e.height/2,t.width=e.width,t.height=e.height;var o=this._worldPoints,r=o[0],s=o[1],a=o[2],l=o[3];return t.transformMat4ToPoints(i.node.worldMatrix,r,s,a,l),o}}]),i}(Tt),Gt=function(t){function i(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this)._worldPosition=new A,i}return m(i,t),i.prototype._createShapes=function(t,i,e,o){t=Math.abs(t),i=Math.abs(i);var r=this.collider,s=(e+r.offset.x*t)/n,a=(o+r.offset.y*i)/n,l=W.CircleShapeNew();return W.ShapeSetRadius(l,r.radius/n*t),W.CircleShapeSetPosition(l,s,a),[l]},p(i,[{key:"worldRadius",get:function(){return W.CircleShapeGetRadius(this._shapes[0])*n}},{key:"worldPosition",get:function(){var t=W.CircleShapeGetPosition(this._shapes[0]);return this._worldPosition.set(t.x*n,t.y*n)}}]),i}(Tt),Lt=function(t){function i(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this)._worldPoints=[],i}return m(i,t),i.prototype._createShapes=function(t,i,e,o){var r=[],s=this.collider,a=s.points;a.length>0&&a[0].equals(a[a.length-1])&&(a.length-=1);var l=c(a);if(!l)return g("[Physics2D] b2PolygonShape failed to decompose polygon into convex polygons, node name: ",s.node.name),r;for(var u=s.offset,h=0;h<l.length;h++){for(var d=l[h],f=0,y=W.Vec2VectorNew(),_=null,p=0,m=d.length;p<m;p++){f||(f=W.PolygonShapeNew());var b=d[p],x=(e+(b.x+u.x)*t)/n,v=(o+(b.y+u.y)*i)/n,w={x:x,y:v};if(W.Vec2VectorPush(y,x,v),_||(_=w),W.Vec2VectorSize(y)===W.maxPolygonVertices&&(W.PolygonShapeSet(f,W.Vec2VectorGetPtr(y),W.Vec2VectorSize(y)),r.push(f),f=0,p<m-1)){var S=W.Vec2VectorGet(y,W.Vec2VectorSize(y)-1);W.Vec2VectorResize(y,0,0,0),W.Vec2VectorPush(y,_.x,_.y),W.Vec2VectorPush(y,S.x,S.y)}}f&&(W.PolygonShapeSet(f,W.Vec2VectorGetPtr(y),W.Vec2VectorSize(y)),r.push(f)),W.Vec2VectorDelete(y)}return r},p(i,[{key:"worldPoints",get:function(){for(var t=this.collider,i=t.points,e=this._worldPoints,n=t.node.worldMatrix,o=0;o<i.length;o++)e[o]||(e[o]=new A),A.transformMat4(e[o],i[o],n);return e.length=i.length,this._worldPoints}}]),i}(Tt),kt=function(){function t(){this._b2joint=null,this._jointComp=null,this._body=null,this._inited=!1}var i=t.prototype;return i.initialize=function(t){this._jointComp=t},i.onEnable=function(){o.instance._callAfterStep(this,this._init)},i.onDisable=function(){o.instance._callAfterStep(this,this.destroy)},i.start=function(){o.instance._callAfterStep(this,this._init)},i.apply=function(){o.instance._callAfterStep(this,this.destroy),this.comp.enabledInHierarchy&&o.instance._callAfterStep(this,this._init)},i._init=function(){if(!this._inited){var t=this._jointComp;if(t.isValid)if(this._body=t.getComponent(l),this._body){var i=this._createJointDef();if(i){i.SetBodyA(this._body.impl.impl);var e=t.connectedBody;e&&!e.enabledInHierarchy||(e?i.SetBodyB(e.impl.impl):i.SetBodyB(o.instance.physicsWorld.groundBodyImpl),i.collideConnected=t.collideConnected,this._b2joint=o.instance.physicsWorld.impl.CreateJoint(i),N(3,this,q(this._b2joint)),Q(3,this._b2joint,q(this._b2joint)),this._inited=!0)}}else g("Joint2D: Body is not found, can not create joint. Node Name: "+t.node.name)}},i.destroy=function(){this._inited&&(O(3,q(this._b2joint)),Y(3,q(this._b2joint)),o.instance.physicsWorld.impl.DestroyJoint(this._b2joint),this._b2joint=null,this._inited=!1)},i._createJointDef=function(){return null},i.isValid=function(){return this._b2joint&&this._body&&this._body.impl&&this._jointComp},p(t,[{key:"impl",get:function(){return this._b2joint}},{key:"comp",get:function(){return this._jointComp}},{key:"body",get:function(){return this._body}}]),t}(),Vt={x:0,y:0},Rt=function(t){function i(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this)._touchPoint=new A,i._isTouched=!1,i}m(i,t);var e=i.prototype;return e.setTarget=function(t){this._b2joint&&(Vt.x=t.x/n,Vt.y=t.y/n,this._b2joint.SetTarget(Vt))},e.setFrequency=function(t){this._b2joint&&this._b2joint.SetFrequency(t)},e.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetDampingRatio(t)},e.setMaxForce=function(t){this._b2joint&&this._b2joint.SetMaxForce(t)},e._createJointDef=function(){var t=new W.MouseJointDef,i=this._jointComp;return t.target={x:this._touchPoint.x/n,y:this._touchPoint.y/n},t.maxForce=i.maxForce,t.dampingRatio=i.dampingRatio,t.frequencyHz=i.frequency,t},e.start=function(){},e.onEnable=function(){this._enableTouch(!0)},e.onDisable=function(){t.prototype.onDisable.call(this),this._enableTouch(!1)},e._enableTouch=function(t){var i=k("Canvas");if(i){var e=t?i.on:i.off;e.call(i,I.TOUCH_START,this.onTouchBegan,this),e.call(i,I.TOUCH_MOVE,this.onTouchMove,this),e.call(i,I.TOUCH_END,this.onTouchEnd,this),e.call(i,I.TOUCH_CANCEL,this.onTouchEnd,this)}},e.onTouchBegan=function(t){this._isTouched=!0;var i=this._touchPoint.set(t.getUILocation()),e=o.instance.physicsWorld.testPoint(i);if(!(e.length<=0)){var n=e[0].body;n.wakeUp();var r=this._jointComp;r.connectedBody=n,this._init(),this.setMaxForce(r.maxForce*n.getMass()),this.setTarget(i)}},e.onTouchMove=function(t){this._touchPoint=t.getUILocation()},e.onTouchEnd=function(){this.destroy(),this._isTouched=!1},e.update=function(){this._isTouched&&this.isValid()&&this.setTarget(this._touchPoint)},i}(kt),It=function(t){function i(){return t.apply(this,arguments)||this}m(i,t);var e=i.prototype;return e.setMaxLength=function(t){this._b2joint&&this._b2joint.SetMaxLength(t)},e._createJointDef=function(){var t=this._jointComp,i=new W.RopeJointDef;return i.localAnchorA={x:t.anchor.x/n,y:t.anchor.y/n},i.localAnchorB={x:t.connectedAnchor.x/n,y:t.connectedAnchor.y/n},i.maxLength=t.maxLength/n,i},i}(kt),Et=function(t){function i(){return t.apply(this,arguments)||this}m(i,t);var e=i.prototype;return e.setFrequency=function(t){this._b2joint&&this._b2joint.SetFrequency(t)},e.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetDampingRatio(t)},e.setDistance=function(t){this._b2joint&&this._b2joint.SetLength(t)},e._createJointDef=function(){var t=this._jointComp,i=new W.DistanceJointDef;return i.localAnchorA={x:t.anchor.x/n,y:t.anchor.y/n},i.localAnchorB={x:t.connectedAnchor.x/n,y:t.connectedAnchor.y/n},i.length=t.distance/n,i.dampingRatio=t.dampingRatio,i.frequencyHz=t.frequency,i},i}(kt),Wt={x:0,y:0},qt=function(t){function i(){return t.apply(this,arguments)||this}m(i,t);var e=i.prototype;return e.setMaxForce=function(t){this._b2joint&&this._b2joint.SetMaxForce(t)},e.setAngularOffset=function(t){this._b2joint&&this._b2joint.SetAngularOffset(F(t))},e.setLinearOffset=function(t){this._b2joint&&(Wt.x=t.x/n,Wt.y=t.y/n,this._b2joint.SetLinearOffset(Wt))},e.setCorrectionFactor=function(t){this._b2joint&&this._b2joint.SetCorrectionFactor(t)},e.setMaxTorque=function(t){this._b2joint&&this._b2joint.SetMaxTorque(t)},e._createJointDef=function(){var t=this._jointComp,i=new W.MotorJointDef;return i.linearOffset={x:t.linearOffset.x/n,y:t.linearOffset.y/n},i.angularOffset=F(t.angularOffset),i.maxForce=t.maxForce,i.maxTorque=t.maxTorque,i.correctionFactor=t.correctionFactor,i},i}(kt),Jt=function(t){function i(){return t.apply(this,arguments)||this}m(i,t);var e=i.prototype;return e.enableLimit=function(t){this._b2joint&&this._b2joint.EnableLimit(t)},e.setLowerLimit=function(){this.updateLimits()},e.setUpperLimit=function(){this.updateLimits()},e.updateLimits=function(){if(this._b2joint){var t=this._jointComp;this._b2joint.SetLimits(t.lowerLimit/n,t.upperLimit/n)}},e.enableMotor=function(t){this._b2joint&&this._b2joint.EnableMotor(t)},e.setMaxMotorForce=function(t){this._b2joint&&this._b2joint.SetMaxMotorForce(t)},e.setMotorSpeed=function(t){this._b2joint&&this._b2joint.SetMotorSpeed(t)},e._createJointDef=function(){var t=this._jointComp,i=new W.PrismaticJointDef;i.localAnchorA={x:t.anchor.x/n,y:t.anchor.y/n},i.localAnchorB={x:t.connectedAnchor.x/n,y:t.connectedAnchor.y/n};var e=F(t.angle);return i.localAxisA={x:Math.cos(e),y:Math.sin(e)},i.referenceAngle=0,i.enableLimit=t.enableLimit,i.lowerTranslation=t.lowerLimit/n,i.upperTranslation=t.upperLimit/n,i.enableMotor=t.enableMotor,i.maxMotorForce=t.maxMotorForce,i.motorSpeed=t.motorSpeed,i},i}(kt),Nt=function(t){function i(){return t.apply(this,arguments)||this}m(i,t);var e=i.prototype;return e.setFrequency=function(t){this._b2joint&&this._b2joint.SetFrequency(t)},e.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetDampingRatio(t)},e._createJointDef=function(){var t=this._jointComp,i=new W.WeldJointDef;return i.localAnchorA={x:t.anchor.x/n,y:t.anchor.y/n},i.localAnchorB={x:t.connectedAnchor.x/n,y:t.connectedAnchor.y/n},i.referenceAngle=0,i.dampingRatio=t.dampingRatio,i.frequencyHz=t.frequency,i},i}(kt),Ot=function(t){function i(){return t.apply(this,arguments)||this}m(i,t);var e=i.prototype;return e.setFrequency=function(t){this._b2joint&&this._b2joint.SetSpringFrequencyHz(t)},e.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetSpringDampingRatio(t)},e.enableMotor=function(t){this._b2joint&&this._b2joint.EnableMotor(t)},e.setMaxMotorTorque=function(t){this._b2joint&&this._b2joint.SetMaxMotorTorque(t)},e.setMotorSpeed=function(t){this._b2joint&&this._b2joint.SetMotorSpeed(t)},e._createJointDef=function(){var t=this._jointComp,i=new W.WheelJointDef;i.localAnchorA={x:t.anchor.x/n,y:t.anchor.y/n},i.localAnchorB={x:t.connectedAnchor.x/n,y:t.connectedAnchor.y/n};var e=F(t.angle);return i.localAxisA={x:Math.cos(e),y:Math.sin(e)},i.maxMotorTorque=t.maxMotorTorque,i.motorSpeed=F(t.motorSpeed),i.enableMotor=t.enableMotor,i.dampingRatio=t.dampingRatio,i.frequencyHz=t.frequency,i},i}(kt),zt=function(t){function i(){return t.apply(this,arguments)||this}m(i,t);var e=i.prototype;return e.enableLimit=function(t){this._b2joint&&this._b2joint.EnableLimit(t)},e.setLowerAngle=function(){this.updateLimits()},e.setUpperAngle=function(){this.updateLimits()},e.updateLimits=function(){if(this._b2joint){var t=this._jointComp;this._b2joint.SetLimits(F(t.lowerAngle),F(t.upperAngle))}},e.enableMotor=function(t){this._b2joint&&this._b2joint.EnableMotor(t)},e.setMaxMotorTorque=function(t){this._b2joint&&this._b2joint.SetMaxMotorTorque(t)},e.setMotorSpeed=function(t){this._b2joint&&this._b2joint.SetMotorSpeed(t)},e._createJointDef=function(){var t=this._jointComp,i=new W.RevoluteJointDef;return i.localAnchorA={x:t.anchor.x/n,y:t.anchor.y/n},i.localAnchorB={x:t.connectedAnchor.x/n,y:t.connectedAnchor.y/n},i.enableMotor=t.enableMotor,i.maxMotorTorque=t.maxMotorTorque,i.motorSpeed=F(t.motorSpeed),i.enableLimit=t.enableLimit,i.lowerAngle=F(t.lowerAngle),i.upperAngle=F(t.upperAngle),i},i}(kt);v.once(w.EVENT_PRE_SUBSYSTEM_INIT,(function(){u.register("box2d-wasm",{PhysicsWorld:vt,RigidBody:At,BoxShape:Ft,CircleShape:Gt,PolygonShape:Lt,MouseJoint:Rt,DistanceJoint:It,SpringJoint:Et,RelativeJoint:qt,SliderJoint:Jt,FixedJoint:Nt,WheelJoint:Ot,HingeJoint:zt})}))}}}));
//# sourceMappingURL=physics-2d-box2d-wasm.js.map
