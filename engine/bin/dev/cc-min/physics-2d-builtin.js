System.register(["./physics-2d-framework-S9Sh01v2.js","./gc-object-BD6DANSw.js","./_virtual_internal_constants-CVZmBipG.js","./index-BcjqSS2q.js","./intersection-2d.js","./prefab-CJahvMeV.js","./scene-D5fG1En6.js","./pipeline-state-manager-C4BAah3w.js","./node-event-BDYemSfE.js","./deprecated-gv6rCJsk.js","./director-D6Xf3-Ej.js","./collision-matrix-DvJE_i6G.js","./global-exports-ZavlJGEN.js","./touch-Ch03mDFP.js","./device-manager-BCOP-4pU.js","./buffer-barrier-CZBuOw0V.js","./debug-view-zRQBd5E1.js","./deprecated-BaebfHhU.js"],(function(){"use strict";var t,n,i,e,o,s,r,a,l,c,h,u,d,f,p,g,w,y,v,_,x;return{setters:[function(o){t=o.P,n=o.C,i=o.E,e=o.s},function(t){o=t.a,s=t._,r=t.L,a=t.I,l=t.d,c=t.h},null,function(t){h=t.l,u=t.V,d=t.M,f=t.C,p=t.f},function(t){g=t.Intersection2D},function(t){w=t.f},function(t){y=t.N},null,null,function(t){v=t.g,_=t.G},function(t){x=t.d},null,null,null,null,null,null,null],execute:function(){var P=function(){function n(){this._collider=null,this._worldAabb=new h,this._contacts=[]}var i=n.prototype;return i.apply=function(){},i.initialize=function(t){this._collider=t},i.onLoad=function(){},i.onEnable=function(){t.instance.physicsWorld.addShape(this)},i.onDisable=function(){t.instance.physicsWorld.removeShape(this)},i.start=function(){},i.update=function(){},i.containsPoint=function(t){return!!this.worldAABB.contains(t)},i.intersectsRect=function(t){return!!this.worldAABB.intersects(t)},i.onGroupChanged=function(){t.instance.physicsWorld.updateShapeGroup(this)},o(n,[{key:"impl",get:function(){return null}},{key:"collider",get:function(){return this._collider}},{key:"worldAABB",get:function(){return this._worldAabb}}]),n}(),b=function(t){function n(){for(var n,i=arguments.length,e=new Array(i),o=0;o<i;o++)e[o]=arguments[o];return(n=t.call.apply(t,[this].concat(e))||this)._worldPoints=[new u,new u,new u,new u],n}s(n,t);var i=n.prototype;return i.update=function(){var t=this._worldAabb,n=this.collider,i=n.size,e=n.offset;t.x=e.x-i.width/2,t.y=e.y-i.height/2,t.width=i.width,t.height=i.height;var o=this._worldPoints,s=o[0],r=o[1],a=o[2],l=o[3];t.transformMat4ToPoints(n.node.worldMatrix,s,r,a,l);var c=Math.min(s.x,r.x,a.x,l.x),h=Math.min(s.y,r.y,a.y,l.y),u=Math.max(s.x,r.x,a.x,l.x),d=Math.max(s.y,r.y,a.y,l.y);t.x=c,t.y=h,t.width=u-c,t.height=d-h},i.containsPoint=function(t){return!!this.worldAABB.contains(t)&&g.pointInPolygon(t,this.worldPoints)},i.intersectsRect=function(t){return!!this.worldAABB.intersects(t)&&g.rectPolygon(t,this.worldPoints)},o(n,[{key:"worldPoints",get:function(){return this._worldPoints}}]),n}(P),A=new u,m=new d,B=function(t){function n(){for(var n,i=arguments.length,e=new Array(i),o=0;o<i;o++)e[o]=arguments[o];return(n=t.call.apply(t,[this].concat(e))||this)._worldPosition=new u,n._worldRadius=0,n}s(n,t);var i=n.prototype;return i.update=function(){var t=this._worldAabb,n=this.collider,i=n.node.getWorldMatrix(m);u.transformMat4(A,n.offset,i);var e=this._worldPosition;e.x=A.x,e.y=A.y,i.m12=i.m13=0,A.x=n.radius,A.y=0,u.transformMat4(A,A,i);var o=this._worldRadius=A.length();t.x=e.x-o,t.y=e.y-o,t.width=2*o,t.height=2*o},i.containsPoint=function(t){return!!this.worldAABB.contains(t)&&u.subtract(A,t,this.worldPosition).length()<this.worldRadius},i.intersectsRect=function(t){return!!this.worldAABB.intersects(t)&&g.rectCircle(t,this.worldPosition,this.worldRadius)},o(n,[{key:"worldPosition",get:function(){return this._worldPosition}},{key:"worldRadius",get:function(){return this._worldRadius}}]),n}(P),C=new u,S=function(t){function n(){for(var n,i=arguments.length,e=new Array(i),o=0;o<i;o++)e[o]=arguments[o];return(n=t.call.apply(t,[this].concat(e))||this)._worldPoints=[],n}s(n,t);var i=n.prototype;return i.update=function(){var t=this._worldAabb,n=this.collider,i=n.points,e=n.offset,o=n.node.worldMatrix,s=this._worldPoints;s.length=i.length;for(var r=1e6,a=1e6,l=-1e6,c=-1e6,h=0,d=i.length;h<d;h++){s[h]||(s[h]=new u),C.x=i[h].x+e.x,C.y=i[h].y+e.y,u.transformMat4(C,C,o);var f=C.x,p=C.y;s[h].x=f,s[h].y=p,f>l&&(l=f),f<r&&(r=f),p>c&&(c=p),p<a&&(a=p)}t.x=r,t.y=a,t.width=l-r,t.height=c-a},i.containsPoint=function(t){return!!this.worldAABB.contains(t)&&g.pointInPolygon(t,this.worldPoints)},i.intersectsRect=function(t){return!!this.worldAABB.intersects(t)&&g.rectPolygon(t,this.worldPoints)},o(n,[{key:"worldPoints",get:function(){return this._worldPoints}}]),n}(P),M=function(){function t(t,i){this.shape1=void 0,this.shape2=void 0,this.testFunc=void 0,this.touching=!1,this.type=n.None,this.shape1=t,this.shape2=i,this.touching=!1;var e=t instanceof b||t instanceof S,o=i instanceof b||i instanceof S,s=t instanceof B,a=i instanceof B;e&&o?this.testFunc=g.polygonPolygon:s&&a?this.testFunc=g.circleCircle:e&&a?this.testFunc=g.polygonCircle:s&&o?(this.testFunc=g.polygonCircle,this.shape1=i,this.shape2=t):r("Can not find contact for builtin shape: "+t.constructor.name+", "+i.constructor.name)}var i=t.prototype;return i.test=function(){var t=this.shape1,n=this.shape2;return!!t.worldAABB.intersects(n.worldAABB)&&(this.testFunc===g.polygonPolygon?g.polygonPolygon(t.worldPoints,n.worldPoints):this.testFunc===g.circleCircle?g.circleCircle(t.worldPosition,t.worldRadius,n.worldPosition,n.worldRadius):this.testFunc===g.polygonCircle&&g.polygonCircle(t.worldPoints,n.worldPosition,n.worldRadius))},i.updateState=function(){var t=this.test(),i=n.None;return t&&!this.touching?(this.touching=!0,i=n.BEGIN_CONTACT):!t&&this.touching&&(this.touching=!1,i=n.END_CONTACT),this.type=i,i},t}(),D=[],R=[],j=function(){function e(){this._contacts=[],this._shapes=[],this._debugGraphics=null,this._debugDrawFlags=0}var s=e.prototype;return s.shouldCollide=function(n,i){var e=n.collider,o=i.collider,s=t.instance.collisionMatrix;return e!==o&&e.node!==o.node&&s[e.group]&o.group&&s[o.group]&e.group},s.addShape=function(t){var n=this._shapes;if(-1===n.indexOf(t)){for(var i=0,e=n.length;i<e;i++){var o=n[i];if(this.shouldCollide(t,o)){var s=new M(t,o);this._contacts.push(s),-1===t._contacts.indexOf(s)&&t._contacts.push(s),-1===o._contacts.indexOf(s)&&o._contacts.push(s)}}n.push(t)}},s.removeShape=function(t){var i=this._shapes,e=i.indexOf(t);if(e>=0){a(i,e);for(var o=this._contacts,s=o.length-1;s>=0;s--){var r=o[s];if(r.shape1===t||r.shape2===t){r.touching&&this._emitCollide(r,n.END_CONTACT),a(o,s);var l=r.shape1===t?r.shape2:r.shape1,c=l._contacts.indexOf(r);c>=0&&a(l._contacts,c)}}}t._contacts.length=0},s.updateShapeGroup=function(t){this.removeShape(t),t.collider.enabledInHierarchy&&this.addShape(t)},s.step=function(){for(var t=this._shapes,i=0,e=t.length;i<e;i++)t[i].update();var o=this._contacts;D.length=0;for(var s=0,r=o.length;s<r;s++)o[s].updateState()!==n.None&&D.push(o[s]);for(var a=0,l=D.length;a<l;a++){var c=D[a];this._emitCollide(c)}},s.drawDebug=function(){if(this._debugDrawFlags){this._checkDebugDrawValid();var t=this._debugGraphics;if(t){t.clear(),t.lineWidth=3;for(var n=this._shapes,e=0,o=n.length;e<o;e++){var s=n[e];if(t.strokeColor=f.WHITE,s instanceof b||s instanceof S){var r=s.worldPoints;if(r.length>0){t.moveTo(r[0].x,r[0].y);for(var a=1;a<r.length;a++)t.lineTo(r[a].x,r[a].y);t.close(),t.stroke()}}else s instanceof B&&(t.circle(s.worldPosition.x,s.worldPosition.y,s.worldRadius),t.stroke());if(this._debugDrawFlags&i.Aabb){var l=s.worldAABB;t.strokeColor=f.BLUE,t.moveTo(l.xMin,l.yMin),t.lineTo(l.xMin,l.yMax),t.lineTo(l.xMax,l.yMax),t.lineTo(l.xMax,l.yMin),t.close(),t.stroke()}}}}},s._emitCollide=function(n,i){i=i||n.type;var e=n.shape1.collider,o=n.shape2.collider;t.instance.emit(i,e,o),e.emit(i,e,o),o.emit(i,o,e)},s._checkDebugDrawValid=function(){if(!this._debugGraphics||!this._debugGraphics.isValid){var t=w("Canvas");if(!t){var n=x.getScene();if(!n)return;(t=new y("Canvas")).addComponent("cc.Canvas"),t.parent=n}var i=new y("PHYSICS_2D_DEBUG_DRAW");i.hideFlags|=l.DontSave,i.parent=t,i.worldPosition=p.ZERO;try{this._debugGraphics=i.addComponent("cc.Graphics"),this._debugGraphics.lineWidth=2}catch(t){c(4501,t.message),i.destroy(),i=null}}if(this._debugGraphics){var e=this._debugGraphics.node.parent;this._debugGraphics.node.setSiblingIndex(e.children.length-1)}},s.testPoint=function(t){var n=this._shapes;R.length=0;for(var i=0;i<n.length;i++){var e=n[i];e.containsPoint(t)&&R.push(e.collider)}return R},s.testAABB=function(t){var n=this._shapes;R.length=0;for(var i=0;i<n.length;i++){var e=n[i];e.intersectsRect(t)&&R.push(e.collider)}return R},s.impl=function(){return null},s.setGravity=function(){},s.setAllowSleep=function(){},s.syncPhysicsToScene=function(){},s.syncSceneToPhysics=function(){},s.raycast=function(){return[]},o(e,[{key:"debugDrawFlags",get:function(){return this._debugDrawFlags},set:function(t){this._debugDrawFlags=t}}]),e}();v.once(_.EVENT_PRE_SUBSYSTEM_INIT,(function(){e.register("builtin",{PhysicsWorld:j,RigidBody:null,BoxShape:b,CircleShape:B,PolygonShape:S,MouseJoint:null,DistanceJoint:null,SpringJoint:null,RelativeJoint:null,SliderJoint:null,FixedJoint:null,WheelJoint:null,HingeJoint:null})}))}}}));
//# sourceMappingURL=physics-2d-builtin.js.map
