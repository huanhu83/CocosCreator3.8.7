System.register(["./index-D-Wi7yQz.js","./gc-object-BD6DANSw.js","./index-BcjqSS2q.js","./collision-matrix-DvJE_i6G.js","./array-collision-matrix-DU5_JQW3.js","./physics-framework.js","./deprecated-gv6rCJsk.js","./director-D6Xf3-Ej.js","./util-BWh5q49O.js","./_virtual_internal_constants-CVZmBipG.js","./global-exports-ZavlJGEN.js","./node-event-BDYemSfE.js","./scene-D5fG1En6.js","./pipeline-state-manager-C4BAah3w.js","./device-manager-BCOP-4pU.js","./buffer-barrier-CZBuOw0V.js","./touch-Ch03mDFP.js","./deprecated-BaebfHhU.js","./debug-view-zRQBd5E1.js","./prefab-CJahvMeV.js","./mesh-BsaPYlYJ.js","./wasm-web-DpHjq6qw.js","./zlib.min-CyXMsivM.js","./skeleton-hXUbiLKQ.js","./terrain-asset-DtjAFN8y.js","./base.js","./deprecated-BfPl6EQ2.js","./render-types-DTmbYHic.js","./deprecated-B2PZGYTz.js","./camera-component-DK1ym1MK.js","./model-renderer-KnEZ5pPV.js","./renderer-DVTO-7-w.js","./instantiate-B8jTMe8K.js","./move-DN1M4QQp.js","./capsule-C5D-FUD0.js"],(function(e){"use strict";var t,i,o,n,s,r,l,a,d,h,u,c,p,f,y,g,_,w,v,B,S,m,b,C;return{setters:[function(o){t=o.P,i=o.s,e("CharacterControllerContact",o.q)},function(e){o=e._,n=e.I,s=e.a,r=e.w,l=e.L},function(e){a=e.M,d=e.f,h=e.Q,u=e.o,c=e.G,p=e.C,f=e.Z,y=e._,g=e.$},function(e){_=e.P,w=e.c,v=e.E},function(e){B=e.A},null,function(e){S=e.g,m=e.G},function(e){b=e.d},function(e){C=e.m},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var e=function(){function e(){this.collisionFilterGroup=t.PhysicsGroup.DEFAULT,this.collisionFilterMask=-1}var i=e.prototype;return i.getGroup=function(){return this.collisionFilterGroup},i.setGroup=function(e){this.collisionFilterGroup=e},i.addGroup=function(e){this.collisionFilterGroup|=e},i.removeGroup=function(e){this.collisionFilterGroup&=~e},i.getMask=function(){return this.collisionFilterMask},i.setMask=function(e){this.collisionFilterMask=e},i.addMask=function(e){this.collisionFilterMask|=e},i.removeMask=function(e){this.collisionFilterMask&=~e},e}(),k=new a,M=new d,x=new d,A=new h,G=function(e){function i(t,o){var n;return(n=e.call(this)||this)._id=void 0,n.index=-1,n.ref=0,n.node=void 0,n.world=void 0,n.shapes=[],n.wrappedBody=null,n._id=i.idCounter++,n.node=t,n.world=o,n}o(i,e),i.getSharedBody=function(e,o,n){var s,r=e.uuid;if(i.sharedBodesMap.has(r))s=i.sharedBodesMap.get(r);else{s=new i(e,o);var l=_.DEFAULT,a=t.instance.collisionMatrix[l];s.collisionFilterGroup=l,s.collisionFilterMask=a,i.sharedBodesMap.set(e.uuid,s)}if(n){s.wrappedBody=n;var d=n.rigidBody.group,h=t.instance.collisionMatrix[d];s.collisionFilterGroup=d,s.collisionFilterMask=h}return s};var r=i.prototype;return r.intersects=function(e){for(var t=0;t<this.shapes.length;t++)for(var i=this.shapes[t],o=0;o<e.shapes.length;o++){var n=e.shapes[o];(i.collider.needTriggerEvent||n.collider.needTriggerEvent)&&u.resolve(i.worldShape,n.worldShape)&&(this.world.shapeArr.push(i),this.world.shapeArr.push(n))}},r.addShape=function(e){this.shapes.indexOf(e)<0&&this.shapes.push(e)},r.removeShape=function(e){var t=this.shapes.indexOf(e);t>=0&&n(this.shapes,t)},r.syncSceneToPhysics=function(){if(this.node.hasChangedFlags){this.node.getWorldMatrix(k),M.set(this.node.worldPosition),A.set(this.node.worldRotation),x.set(this.node.worldScale);for(var e=0;e<this.shapes.length;e++)this.shapes[e].transform(k,M,A,x)}},r.syncInitial=function(){this.node.getWorldMatrix(k),M.set(this.node.worldPosition),A.set(this.node.worldRotation),x.set(this.node.worldScale);for(var e=0;e<this.shapes.length;e++)this.shapes[e].transform(k,M,A,x)},r.destroy=function(){i.sharedBodesMap.delete(this.node.uuid),this.node=null,this.world=null,this.shapes=null},s(i,[{key:"id",get:function(){return this._id}},{key:"enabled",set:function(e){e?this.index<0&&(this.index=this.world.bodies.length,this.world.addSharedBody(this),this.syncInitial()):this.index>=0&&0===this.shapes.length&&(this.index=-1,this.world.removeSharedBody(this))}},{key:"reference",set:function(e){e?this.ref++:this.ref--,0===this.ref&&this.destroy()}}]),i}(e);G.sharedBodesMap=new Map,G.idCounter=0;var j=new d,F={type:"onTriggerEnter",selfCollider:null,otherCollider:null,impl:{}},P=new c,E=function(){function e(){this.shapeArr=[],this.bodies=[],this._shapeArrPrev=[],this._collisionMatrix=new B,this._collisionMatrixPrev=new B,this._debugLineCount=0,this._MAX_DEBUG_LINE_COUNT=16384,this._debugDrawFlags=w.NONE,this._debugConstraintSize=.3,this._aabbColor=new p(0,255,255,255),this._wireframeColor=new p(255,0,255,255)}var t=e.prototype;return t.sweepBox=function(){return r(9640),!1},t.sweepBoxClosest=function(){return r(9640),!1},t.sweepSphere=function(){return r(9640),!1},t.sweepSphereClosest=function(){return r(9640),!1},t.sweepCapsule=function(){return r(9640),!1},t.sweepCapsuleClosest=function(){return r(9640),!1},t.setGravity=function(){},t.setAllowSleep=function(){},t.setDefaultMaterial=function(){},t.destroy=function(){this.bodies.length&&l("You should destroy all physics component first.")},t.step=function(){var e=this._shapeArrPrev;this._shapeArrPrev=this.shapeArr,this.shapeArr=e,this.shapeArr.length=0;for(var t=0;t<this.bodies.length;t++)for(var i=this.bodies[t],o=t+1;o<this.bodies.length;o++){var n=this.bodies[o];i.collisionFilterGroup&n.collisionFilterMask&&n.collisionFilterGroup&i.collisionFilterMask&&i.intersects(n)}this._debugDraw()},t.syncSceneToPhysics=function(){for(var e=0;e<this.bodies.length;e++)this.bodies[e].syncSceneToPhysics()},t.syncAfterEvents=function(){this.syncSceneToPhysics()},t.emitEvents=function(){this.emitTriggerEvent()},t.raycastClosest=function(e,t,i){for(var o=1/0,n=t.maxDistance,s=t.mask,r=0;r<this.bodies.length;r++){var l=this.bodies[r];if(l.collisionFilterGroup&s)for(var a=0;a<l.shapes.length;a++){var h=l.shapes[a],c=u.resolve(e,h.worldShape);0===c||c>n||o>c&&(o=c,d.normalize(j,e.d),d.scaleAndAdd(j,e.o,j,c),i._assign(j,c,h.collider,d.ZERO))}}return!(o===1/0)},t.raycast=function(e,t,i,o){for(var n=t.maxDistance,s=t.mask,r=0;r<this.bodies.length;r++){var l=this.bodies[r];if(l.collisionFilterGroup&s)for(var a=0;a<l.shapes.length;a++){var h=l.shapes[a],c=u.resolve(e,h.worldShape);if(!(0===c||c>n)){var p=i.add();e.computeHit(j,c),p._assign(j,c,h.collider,d.ZERO),o.push(p)}}}return o.length>0},t.getSharedBody=function(e,t){return G.getSharedBody(e,this,t)},t.addSharedBody=function(e){this.bodies.indexOf(e)<0&&this.bodies.push(e)},t.removeSharedBody=function(e){var t=this.bodies.indexOf(e);t>=0&&n(this.bodies,t)},t.emitTriggerEvent=function(){for(var e,t,i=0;i<this.shapeArr.length;i+=2)e=this.shapeArr[i],t=this.shapeArr[i+1],F.selfCollider=e.collider,F.otherCollider=t.collider,this._collisionMatrix.set(e.id,t.id,!0),this._collisionMatrixPrev.get(e.id,t.id)?F.type="onTriggerStay":F.type="onTriggerEnter",e.collider&&e.collider.emit(F.type,F),F.selfCollider=t.collider,F.otherCollider=e.collider,t.collider&&t.collider.emit(F.type,F);for(var o=0;o<this._shapeArrPrev.length;o+=2)e=this._shapeArrPrev[o],t=this._shapeArrPrev[o+1],this._collisionMatrixPrev.get(e.id,t.id)&&(this._collisionMatrix.get(e.id,t.id)||(F.type="onTriggerExit",F.selfCollider=e.collider,F.otherCollider=t.collider,e.collider&&e.collider.emit(F.type,F),F.selfCollider=t.collider,F.otherCollider=e.collider,t.collider&&t.collider.emit(F.type,F),this._collisionMatrix.set(e.id,t.id,!1)));var n=this._collisionMatrixPrev.matrix;this._collisionMatrixPrev.matrix=this._collisionMatrix.matrix,this._collisionMatrix.matrix=n,this._collisionMatrix.reset()},t._getDebugRenderer=function(){var e,t=null==(e=b.root.mainWindow)?void 0:e.cameras;return t?0===t.length?null:t[0]?(t[0].initGeometryRenderer(),t[0].geometryRenderer):null:null},t._debugDraw=function(){var e=this._getDebugRenderer();if(e&&(this._debugLineCount=0,this._debugDrawFlags&w.AABB))for(var t=0;t<this.bodies.length;t++)for(var i=this.bodies[t],o=0;o<i.shapes.length;o++){var n=i.shapes[o];this._debugLineCount+12<this._MAX_DEBUG_LINE_COUNT&&(this._debugLineCount+=12,n.getAABB(P),e.addBoundingBox(P,this._aabbColor))}},s(e,[{key:"impl",get:function(){return this}},{key:"debugDrawFlags",get:function(){return this._debugDrawFlags},set:function(e){this._debugDrawFlags=e}},{key:"debugDrawConstraintSize",get:function(){return this._debugConstraintSize},set:function(e){this._debugConstraintSize=e}}]),e}(),D=function(){function e(){this._rigidBody=void 0,this._sharedBody=void 0}var i=e.prototype;return i.initialize=function(e){this._rigidBody=e,this._sharedBody=t.instance.physicsWorld.getSharedBody(this._rigidBody.node,this),this._sharedBody.reference=!0},i.onEnable=function(){this._sharedBody.enabled=!0},i.onDisable=function(){this._sharedBody.enabled=!1},i.onDestroy=function(){this._sharedBody.reference=!1,this._rigidBody=null,this._sharedBody=null},i.setMass=function(){},i.setType=function(){},i.setLinearDamping=function(){},i.setAngularDamping=function(){},i.useGravity=function(){},i.useCCD=function(){},i.isUsingCCD=function(){return!1},i.setLinearFactor=function(){},i.setAngularFactor=function(){},i.setAllowSleep=function(){},i.wakeUp=function(){},i.sleep=function(){},i.clearState=function(){},i.clearForces=function(){},i.clearVelocity=function(){},i.setSleepThreshold=function(){},i.getSleepThreshold=function(){return 0},i.getLinearVelocity=function(){},i.setLinearVelocity=function(){},i.getAngularVelocity=function(){},i.setAngularVelocity=function(){},i.applyForce=function(){},i.applyLocalForce=function(){},i.applyImpulse=function(){},i.applyLocalImpulse=function(){},i.applyTorque=function(){},i.applyLocalTorque=function(){},i.setGroup=function(e){this._sharedBody.setGroup(e)},i.getGroup=function(){return this._sharedBody.getGroup()},i.addGroup=function(e){this._sharedBody.addGroup(e)},i.removeGroup=function(e){this._sharedBody.removeGroup(e)},i.setMask=function(e){this._sharedBody.setMask(e)},i.getMask=function(){return this._sharedBody.getMask()},i.addMask=function(e){this._sharedBody.addMask(e)},i.removeMask=function(e){this._sharedBody.removeMask(e)},s(e,[{key:"impl",get:function(){return this}},{key:"isAwake",get:function(){return!0}},{key:"isSleepy",get:function(){return!1}},{key:"isSleeping",get:function(){return!1}},{key:"rigidBody",get:function(){return this._rigidBody}},{key:"sharedBody",get:function(){return this._sharedBody}}]),e}(),L=function(){function e(){this.id=e.idCounter++,this._sharedBody=void 0,this._collider=void 0,this._localShape=void 0,this._worldShape=void 0}var i=e.prototype;return i.getAABB=function(){},i.getBoundingSphere=function(){},i.updateEventListener=function(){},i.setMaterial=function(){},i.setAsTrigger=function(){},i.setCenter=function(e){d.copy(this._localShape.center,e)},i.initialize=function(e){this._collider=e,this._sharedBody=t.instance.physicsWorld.getSharedBody(this._collider.node),this._sharedBody.reference=!0},i.onLoad=function(){this.setCenter(this._collider.center)},i.onEnable=function(){this._sharedBody.addShape(this),this._sharedBody.enabled=!0},i.onDisable=function(){this._sharedBody.removeShape(this),this._sharedBody.enabled=!1},i.onDestroy=function(){this._sharedBody.reference=!1,this._collider=null,this._localShape=null,this._worldShape=null},i.transform=function(e,t,i,o){this._localShape.transform(e,t,i,o,this._worldShape)},i.getGroup=function(){return this._sharedBody.getGroup()},i.setGroup=function(e){this._sharedBody.setGroup(e)},i.addGroup=function(e){this._sharedBody.addGroup(e)},i.removeGroup=function(e){this._sharedBody.removeGroup(e)},i.getMask=function(){return this._sharedBody.getMask()},i.setMask=function(e){this._sharedBody.setMask(e)},i.addMask=function(e){this._sharedBody.addMask(e)},i.removeMask=function(e){this._sharedBody.removeMask(e)},s(e,[{key:"attachedRigidBody",get:function(){return null}},{key:"localShape",get:function(){return this._localShape}},{key:"worldShape",get:function(){return this._worldShape}},{key:"impl",get:function(){return this._worldShape}},{key:"sharedBody",get:function(){return this._sharedBody}},{key:"collider",get:function(){return this._collider}}]),e}();L.idCounter=0;var T=new d,R=new d,O=function(e){function t(){var t;return(t=e.call(this)||this)._localShape=new f,t._worldShape=new f,t}o(t,e);var i=t.prototype;return i.updateSize=function(){d.multiplyScalar(this.localObb.halfExtents,this.collider.size,.5),d.multiply(this.worldObb.halfExtents,this.localObb.halfExtents,this.collider.node.worldScale)},i.onLoad=function(){e.prototype.onLoad.call(this),this.updateSize()},i.getAABB=function(e){this.worldObb.getBoundary(T,R),c.fromPoints(e,T,R)},s(t,[{key:"localObb",get:function(){return this._localShape}},{key:"worldObb",get:function(){return this._worldShape}},{key:"collider",get:function(){return this._collider}}]),t}(L),z=new d,I=new d,N=function(e){o(i,e);var t=i.prototype;function i(t){var i;return void 0===t&&(t=.5),(i=e.call(this)||this)._localShape=new y(0,0,0,t),i._worldShape=new y(0,0,0,t),i}return t.updateRadius=function(){this.localSphere.radius=this.collider.radius;var e=C(this.collider.node.worldScale);this.worldSphere.radius=this.localSphere.radius*e},t.onLoad=function(){e.prototype.onLoad.call(this),this.updateRadius()},t.getAABB=function(e){this.worldSphere.getBoundary(z,I),c.fromPoints(e,z,I)},s(i,[{key:"localSphere",get:function(){return this._localShape}},{key:"worldSphere",get:function(){return this._worldShape}},{key:"collider",get:function(){return this._collider}}]),i}(L),U=new d,V=new d,W=function(e){function t(t,i,o){var n;void 0===t&&(t=.5),void 0===i&&(i=2),void 0===o&&(o=v.Y_AXIS);var s=(i-2*t)/2,r=s<0?0:s;return(n=e.call(this)||this)._localShape=new g(t,r,o),n._worldShape=new g(t,r,o),n}o(t,e);var i=t.prototype;return i.setRadius=function(e){this.localCapsule.radius=e,this.transform(this._sharedBody.node.worldMatrix,this._sharedBody.node.worldPosition,this._sharedBody.node.worldRotation,this._sharedBody.node.worldScale)},i.setCylinderHeight=function(e){this.localCapsule.halfHeight=e/2,this.localCapsule.updateCache(),this.transform(this._sharedBody.node.worldMatrix,this._sharedBody.node.worldPosition,this._sharedBody.node.worldRotation,this._sharedBody.node.worldScale)},i.setDirection=function(e){this.localCapsule.axis=e,this.localCapsule.updateCache(),this.worldCapsule.axis=e,this.worldCapsule.updateCache(),this.transform(this._sharedBody.node.worldMatrix,this._sharedBody.node.worldPosition,this._sharedBody.node.worldRotation,this._sharedBody.node.worldScale)},i.onLoad=function(){e.prototype.onLoad.call(this),this.setRadius(this.collider.radius),this.setDirection(this.collider.direction)},i.getAABB=function(e){e.center.set(this.worldCapsule.center),e.halfExtents.set(0,0,0),U.set(this.worldCapsule.radius,this.worldCapsule.radius,this.worldCapsule.radius),d.add(V,this.worldCapsule.ellipseCenter0,U),e.mergePoint(V),d.subtract(V,this.worldCapsule.ellipseCenter0,U),e.mergePoint(V),d.add(V,this.worldCapsule.ellipseCenter1,U),e.mergePoint(V),d.subtract(V,this.worldCapsule.ellipseCenter1,U),e.mergePoint(V)},s(t,[{key:"localCapsule",get:function(){return this._localShape}},{key:"worldCapsule",get:function(){return this._worldShape}},{key:"collider",get:function(){return this._collider}}]),t}(L);S.once(m.EVENT_PRE_SUBSYSTEM_INIT,(function(){i.register("builtin",{RigidBody:D,BoxShape:O,SphereShape:N,PhysicsWorld:E,CapsuleShape:W})}))}}}));
//# sourceMappingURL=physics-builtin.js.map
