System.register(["./gc-object-BD6DANSw.js","./index-BcjqSS2q.js","./_virtual_internal_constants-CVZmBipG.js","./global-exports-ZavlJGEN.js","./pipeline-state-manager-C4BAah3w.js","./node-event-BDYemSfE.js","./touch-Ch03mDFP.js","./device-manager-BCOP-4pU.js","./buffer-barrier-CZBuOw0V.js"],(function(t,e){"use strict";var i,n,r,s,o,a,u,h,f,l,c,p,_,d,g,v,m,y,b,A,T,I,R,w,E,D,S,C,x,M,P,L,k,O,B,N,F,U,H,G,z,V,j,W,X,q,K,Y,J,Q,$,Z,tt,et,it,nt,rt,st,ot,at,ut,ht,ft,lt,ct,pt,_t,dt,gt,vt,mt,yt,bt,At,Tt,It,Rt,wt,Et,Dt,St,Ct,xt,Mt,Pt,Lt,kt,Ot,Bt,Nt,Ft,Ut,Ht,Gt,zt,Vt,jt,Wt,Xt,qt,Kt,Yt,Jt,Qt,$t,Zt,te,ee,ie,ne,re,se,oe,ae,ue,he,fe,le,ce,pe,_e,de,ge,ve,me,ye,be,Ae,Te,Ie,Re,we,Ee,De,Se,Ce,xe,Me,Pe,Le,ke,Oe,Be,Ne,Fe,Ue,He,Ge,ze,Ve,je,We,Xe,qe,Ke,Ye,Je,Qe,$e,Ze,ti,ei,ii,ni,ri,si,oi,ai,ui,hi,fi,li,ci,pi,di,gi,vi,mi,yi;return{setters:[function(t){i=t.E,n=t._,r=t.j,s=t.F,o=t.z,a=t.w,u=t.a,h=t.b,f=t.r,l=t.h,c=t.an,p=t.aF,_=t.aG,d=t.g,g=t.ab,v=t.a4,m=t.l,y=t.v,b=t.L,A=t.am,T=t.aH,I=t.aI,R=t.q,w=t.ai,E=t.aj,D=t.aJ,S=t.aK,C=t.t,x=t.Q,M=t.I,P=t.J,L=t.aL,k=t.D,O=t.ao,B=t.p,N=t.aM,F=t.s,U=t.S,H=t.n,G=t.x,z=t.H,V=t.U,j=t.d,W=t.P,X=t.ak,q=t.G,K=t.aN,Y=t.K,J=t.o,Q=t.m,$=t.f,Z=t.V},function(t){tt=t.c,et=t.n,it=t.I,nt=t.a,rt=t.s,st=t.b6,ot=t.aw,at=t.V,ut=t.f,ht=t.g,ft=t.Q,lt=t.C,ct=t.A,pt=t.l,_t=t.M,dt=t.t,gt=t.L,vt=t._,mt=t.w,yt=t.u,bt=t.a2,At=t.ax,Tt=t.a7,It=t.p,Rt=t.N,wt=t.k,Et=t.e},function(t){Dt=t.X,St=t.a,Ct=t.E,xt=t.P},function(t){Mt=t.a,Pt=t.c,Lt=t.l},function(t){kt=t.o,Ot=t.A,Bt=t.S,Nt=t.H,Ft=t.N,Ut=t.v,Ht=t.w,Gt=t.x,zt=t.Y,Vt=t.R,jt=t.a0,Wt=t.i,Xt=t.P,qt=t.a1,Kt=t.a2,Yt=t.L},function(t){Jt=t.A,Qt=t.C,$t=t.l,Zt=t.n,te=t.o,ee=t.h,ie=t.q,ne=t.f,re=t.r,se=t.k,oe=t.R,ae=t.b,ue=t.B,he=t.t,fe=t.u,le=t.v,ce=t.P,pe=t.w,_e=t.x,de=t.y,ge=t.z,ve=t.e,me=t.D,ye=t.F,be=t.N},function(t){Ae=t.d,Te=t.I},function(t){Ie=t.d},function(t){Re=t.F,we=t.ae,Ee=t.v,De=t.o,Se=t.ad,Ce=t.m,xe=t.p,Me=t.e,Pe=t.f,Le=t.r,ke=t.T,Oe=t.d,Be=t.bi,Ne=t.j,Fe=t.aM,Ue=t.ay,He=t.b4,Ge=t.g,ze=t.h,Ve=t.U,je=t.i,We=t.k,Xe=t.bk,qe=t.bn,Ke=t.bl,Ye=t.bm,Je=t.bj,Qe=t.A,$e=t.b5,Ze=t.S,ti=t.aW,ei=t.ar,ii=t.at,ni=t.B,ri=t.b,si=t.M,oi=t.I,ai=t.a4,ui=t.a6,hi=t.a3,fi=t.P,li=t.aC,ci=t.K,pi=t.a7,di=t.al,gi=t.ax,vi=t.bo,mi=t.ac,yi=t.J}],execute:function(){var bi,Ai,Ti,Ii,Ri,wi,Ei;t({K:Do,L:qo,Q:So,U:Co,aA:Fo,aC:_p,aD:cp,aF:function(t,e,i,n,r){if(!Wt()&&n&&n.enabled&&r===Ra){var s=n.subModels[0],o=s.inputAssembler,a=s.passes,u=s.shaders,h=s.descriptorSet;ca.width=pa.width=r.window.width,ca.height=pa.height=r.window.height;var f=Xt.getOrCreatePipelineState(t,a[0],u[0],e,o);i.setViewport(ca),i.setScissor(pa),i.bindPipelineState(f),i.bindDescriptorSet(Bt.MATERIAL,a[0].descriptorSet),i.bindDescriptorSet(Bt.LOCAL,h),i.bindInputAssembler(o),i.draw(o)}},aG:_a,ad:Xn,ap:qr,aq:function(t){Nr=t},ar:function(t,e){var i=t.sortRender,n=e.sortRender;return i.hash-n.hash||i.shaderId-n.shaderId},as:function(t){for(var e=t.length-1;e>=0;--e){var i=t[e];if(i.window.swapchain)return void(Ra=i)}Ra=null},at:Oo,au:Mo,av:ko,aw:Po,ax:Uo,ay:zo,az:Go,e:Ma}),function(t){t[t.VALUE=1024]="VALUE"}(bi||(bi={})),t("P",Ai),function(t){t[t.RGB565=Re.R5G6B5]="RGB565",t[t.RGB5A1=Re.RGB5A1]="RGB5A1",t[t.RGBA4444=Re.RGBA4]="RGBA4444",t[t.RGB888=Re.RGB8]="RGB888",t[t.RGB32F=Re.RGB32F]="RGB32F",t[t.RGBA8888=Re.RGBA8]="RGBA8888",t[t.BGRA8888=Re.BGRA8]="BGRA8888",t[t.RGBA32F=Re.RGBA32F]="RGBA32F",t[t.A8=Re.A8]="A8",t[t.I8=Re.L8]="I8",t[t.AI8=Re.LA8]="AI8",t[t.RGB_PVRTC_2BPPV1=Re.PVRTC_RGB2]="RGB_PVRTC_2BPPV1",t[t.RGBA_PVRTC_2BPPV1=Re.PVRTC_RGBA2]="RGBA_PVRTC_2BPPV1",t[t.RGB_A_PVRTC_2BPPV1=bi.VALUE]="RGB_A_PVRTC_2BPPV1",t[t.RGB_PVRTC_4BPPV1=Re.PVRTC_RGB4]="RGB_PVRTC_4BPPV1",t[t.RGBA_PVRTC_4BPPV1=Re.PVRTC_RGBA4]="RGBA_PVRTC_4BPPV1",t[t.RGB_A_PVRTC_4BPPV1=bi.VALUE+1]="RGB_A_PVRTC_4BPPV1",t[t.RGB_ETC1=Re.ETC_RGB8]="RGB_ETC1",t[t.RGBA_ETC1=bi.VALUE+2]="RGBA_ETC1",t[t.RGB_ETC2=Re.ETC2_RGB8]="RGB_ETC2",t[t.RGBA_ETC2=Re.ETC2_RGBA8]="RGBA_ETC2",t[t.RGBA_ASTC_4x4=Re.ASTC_RGBA_4X4]="RGBA_ASTC_4x4",t[t.RGBA_ASTC_5x4=Re.ASTC_RGBA_5X4]="RGBA_ASTC_5x4",t[t.RGBA_ASTC_5x5=Re.ASTC_RGBA_5X5]="RGBA_ASTC_5x5",t[t.RGBA_ASTC_6x5=Re.ASTC_RGBA_6X5]="RGBA_ASTC_6x5",t[t.RGBA_ASTC_6x6=Re.ASTC_RGBA_6X6]="RGBA_ASTC_6x6",t[t.RGBA_ASTC_8x5=Re.ASTC_RGBA_8X5]="RGBA_ASTC_8x5",t[t.RGBA_ASTC_8x6=Re.ASTC_RGBA_8X6]="RGBA_ASTC_8x6",t[t.RGBA_ASTC_8x8=Re.ASTC_RGBA_8X8]="RGBA_ASTC_8x8",t[t.RGBA_ASTC_10x5=Re.ASTC_RGBA_10X5]="RGBA_ASTC_10x5",t[t.RGBA_ASTC_10x6=Re.ASTC_RGBA_10X6]="RGBA_ASTC_10x6",t[t.RGBA_ASTC_10x8=Re.ASTC_RGBA_10X8]="RGBA_ASTC_10x8",t[t.RGBA_ASTC_10x10=Re.ASTC_RGBA_10X10]="RGBA_ASTC_10x10",t[t.RGBA_ASTC_12x10=Re.ASTC_RGBA_12X10]="RGBA_ASTC_12x10",t[t.RGBA_ASTC_12x12=Re.ASTC_RGBA_12X12]="RGBA_ASTC_12x12"}(Ai||t("P",Ai={})),t("W",Ti),function(t){t[t.REPEAT=we.WRAP]="REPEAT",t[t.CLAMP_TO_EDGE=we.CLAMP]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=we.MIRROR]="MIRRORED_REPEAT",t[t.CLAMP_TO_BORDER=we.BORDER]="CLAMP_TO_BORDER"}(Ti||t("W",Ti={})),t("j",Ii),function(t){t[t.NONE=Ee.NONE]="NONE",t[t.LINEAR=Ee.LINEAR]="LINEAR",t[t.NEAREST=Ee.POINT]="NEAREST"}(Ii||t("j",Ii={}));var Di=1346981187,Si=i({PVR:0,PKM:1,ASTC:2});function Ci(t,e){return 4===t?Ai.RGBA_ASTC_4x4:5===t?4===e?Ai.RGBA_ASTC_5x4:Ai.RGBA_ASTC_5x5:6===t?5===e?Ai.RGBA_ASTC_6x5:Ai.RGBA_ASTC_6x6:8===t?5===e?Ai.RGBA_ASTC_8x5:6===e?Ai.RGBA_ASTC_8x6:Ai.RGBA_ASTC_8x8:10===t?5===e?Ai.RGBA_ASTC_10x5:6===e?Ai.RGBA_ASTC_10x6:8===e?Ai.RGBA_ASTC_10x8:Ai.RGBA_ASTC_10x10:10===e?Ai.RGBA_ASTC_12x10:Ai.RGBA_ASTC_12x12}function xi(t,e){return t[e]<<8|t[e+1]}function Mi(t){return!!(et.hasFeature(et.Feature.IMAGE_BITMAP)&&t instanceof ImageBitmap)}var Pi,Li,ki,Oi,Bi,Ni,Fi,Ui,Hi,Gi,zi,Vi=t("I",tt("cc.ImageAsset")((Ei=function(t){n(i,t),i.mergeCompressedTextureMips=function(t){var e=new Uint8Array(0);try{for(var i,n=8+4*t.length,o=0,a=r(t);!(i=a()).done;)o+=i.value.byteLength;o+=n,e=new Uint8Array(o);var u=new DataView(e.buffer,e.byteOffset,e.byteLength);u.setUint32(0,Di,!0),u.setUint32(4,t.length,!0);for(var h=n,f=0;f<t.length;f++){var l=t[f];if(u.setUint32(8+4*f,l.byteLength,!0),l instanceof ArrayBuffer){var c=new Uint8Array(l);e.set(c,h)}else{var p=new Uint8Array(l.buffer,l.byteOffset,l.byteLength);e.set(p,h)}h+=l.byteLength}}catch(t){s(t)}return e},i.parseCompressedTextures=function(t,e){var n={_data:new Uint8Array(0),_compressed:!0,width:0,height:0,format:0,mipmapLevelDataSize:[]},r=t instanceof ArrayBuffer?t:t.buffer,s=new DataView(r);if(s.getUint32(0,!0)===Di){var o=s.getUint32(4,!0),a=s.getUint32(8,!0),u=8+4*o;i.parseCompressedTexture(t,0,u,a,e,n);for(var h=u+a,f=1;f<o;f++){var l=s.getUint32(8+4*f,!0);i.parseCompressedTexture(t,f,h,l,e,n),h+=l}}else i.parseCompressedTexture(t,0,0,0,e,n);return n},i.parseCompressedTexture=function(t,e,n,r,s,o){switch(s){case Si.PVR:i.parsePVRTexture(t,e,n,r,o);break;case Si.PKM:i.parsePKMTexture(t,e,n,r,o);break;case Si.ASTC:i.parseASTCTexture(t,e,n,r,o)}},i.parsePVRTexture=function(t,e,i,n,r){var s=t instanceof ArrayBuffer?t:t.buffer,o=new Int32Array(s,i,13);if(55727696===o[0]){var a=i+o[12]+52,u=n-o.byteLength;if(n>0){var h=new Uint8Array(s,a,u),f=new Uint8Array(r._data.byteLength+h.byteLength);f.set(r._data),f.set(h,r._data.byteLength),r._data=f,r.mipmapLevelDataSize[e]=u}else r._data=new Uint8Array(s,a);r.width=e>0?r.width:o[7],r.height=e>0?r.height:o[6]}else{if(559044176!==o[11])throw new Error("Invalid magic number in PVR header");var l=i+o[0],c=n-o.byteLength;if(n>0){var p=new Uint8Array(s,l,c),_=new Uint8Array(r._data.byteLength+p.byteLength);_.set(r._data),_.set(p,r._data.byteLength),r._data=_,r.mipmapLevelDataSize[e]=c}else r._data=new Uint8Array(s,l);r.width=e>0?r.width:o[1],r.height=e>0?r.height:o[2]}},i.parsePKMTexture=function(t,e,i,n,r){var s=t instanceof ArrayBuffer?t:t.buffer,o=new Uint8Array(s,i,16),a=xi(o,6);if(0!==a&&1!==a&&3!==a)throw new Error("Invalid magic number in ETC header");var u=i+16,h=n-16;if(n>0){var f=new Uint8Array(s,u,h),l=new Uint8Array(r._data.byteLength+f.byteLength);l.set(r._data),l.set(f,r._data.byteLength),r._data=l,r.mipmapLevelDataSize[e]=h}else r._data=new Uint8Array(s,u);r.width=e>0?r.width:xi(o,12),r.height=e>0?r.height:xi(o,14)},i.parseASTCTexture=function(t,e,i,n,r){var s=t instanceof ArrayBuffer?t:t.buffer,o=new Uint8Array(s,i,16);if(1554098963!==o[0]+(o[1]<<8)+(o[2]<<16)+(o[3]<<24))throw new Error("Invalid magic number in ASTC header");var a=o[4],u=o[5],h=o[6];if((a<3||a>6||u<3||u>6||h<3||h>6)&&(a<4||7===a||9===a||11===a||a>12||u<4||7===u||9===u||11===u||u>12||1!==h))throw new Error("Invalid block number in ASTC header");var f=Ci(a,u),l=i+16,c=n-16;if(n>0){var p=new Uint8Array(s,l,c),_=new Uint8Array(r._data.byteLength+p.byteLength);_.set(r._data),_.set(p,r._data.byteLength),r._data=_,r.mipmapLevelDataSize[e]=c}else r._data=new Uint8Array(s,l);r.width=e>0?r.width:o[7]+(o[8]<<8)+(o[9]<<16),r.height=e>0?r.height:o[10]+(o[11]<<8)+(o[12]<<16),r.format=f};var e=i.prototype;function i(e){var i;return(i=t.call(this)||this)._nativeData=void 0,i._exportedExts=void 0,i._format=Ai.RGBA8888,i._width=0,i._height=0,i._nativeData={_data:null,width:0,height:0,format:0,_compressed:!1,mipmapLevelDataSize:[]},void 0!==e&&i.reset(e),i}return e.extractMipmap0=function(){if(this.mipmapLevelDataSize&&this.mipmapLevelDataSize.length>0){var t=this.mipmapLevelDataSize[0],e=this.data,n=new i({_data:new Uint8Array(e.buffer,0,t),_compressed:!0,width:this.width,height:this.height,format:this.format,mipmapLevelDataSize:[]});return n._uuid=""+this._uuid,n}return this},e.extractMipmaps=function(){var t=[];if(this.mipmapLevelDataSize&&this.mipmapLevelDataSize.length>0)for(var e,n=this.mipmapLevelDataSize,s=this.data,o=0,a=this.height,u=this.width,h=r(n);!(e=h()).done;){var f=e.value,l=new i({_data:new Uint8Array(s.buffer,o,f),_compressed:!0,width:u,height:a,format:this.format,mipmapLevelDataSize:[]});o+=f,l._uuid=""+this._uuid,u=Math.max(u>>1,1),a=Math.max(a>>1,1),t.push(l)}else t.push(this);return t},e.reset=function(t){Mi(t)||t instanceof HTMLElement?this._nativeData=t:(this._nativeData=t,this._format=t.format)},e.destroy=function(){if(this.data&&this.data instanceof HTMLImageElement)this.data.src="",this._setRawAsset("");else if(Mi(this.data)){var e;null==(e=this.data)||e.close()}return t.prototype.destroy.call(this)},e._serialize=function(){},e._deserialize=function(t){var e="";"string"==typeof t?e=t:(this._width=t.w,this._height=t.h,e=t.fmt);for(var n,s=Ie.gfxDevice,u=e.split("_"),h=Number.MAX_VALUE,f=this._format,l="",c=o.SUPPORT_TEXTURE_FORMATS,p=r(u);!(n=p()).done;){var _=n.value.split("@"),d=parseInt(_[0],void 0),g=i.extnames[d]||_[0],v=c.indexOf(g);if(-1!==v&&v<h){var m=_[1]?parseInt(_[1]):this._format;if(!(".astc"!==g||s&&s.getFormatFeatures(Re.ASTC_RGBA_4X4)&De.SAMPLED_TEXTURE))continue;if(!(".pvr"!==g||s&&s.getFormatFeatures(Re.PVRTC_RGBA4)&De.SAMPLED_TEXTURE))continue;if(!(m!==Ai.RGB_ETC1&&m!==Ai.RGBA_ETC1||s&&s.getFormatFeatures(Re.ETC_RGB8)&De.SAMPLED_TEXTURE))continue;if(!(m!==Ai.RGB_ETC2&&m!==Ai.RGBA_ETC2||s&&s.getFormatFeatures(Re.ETC2_RGB8)&De.SAMPLED_TEXTURE))continue;if(".webp"===g&&!et.hasFeature(et.Feature.WEBP))continue;h=v,l=g,f=m}}l?(this._setRawAsset(l),this._format=f):a(3121)},e.initDefault=function(e){if(t.prototype.initDefault.call(this,e),i._sharedPlaceHolderCanvas)this.reset(i._sharedPlaceHolderCanvas);else{var n=Mt.document.createElement("canvas"),r=n.getContext("2d"),s=n.width=n.height=2;r.fillStyle="#ff00ff",r.fillRect(0,0,s,s),this.reset(n),i._sharedPlaceHolderCanvas=n}},e.validate=function(){return!!this.data},u(i,[{key:"_nativeAsset",get:function(){return this._nativeData},set:function(t){t instanceof HTMLElement||Mi(t)||(t.format=t.format||this._format),this.reset(t)}},{key:"data",get:function(){return(t=this._nativeData)instanceof HTMLImageElement||t instanceof HTMLCanvasElement||Mi(t)?this._nativeData:this._nativeData&&this._nativeData._data;var t}},{key:"width",get:function(){return this._nativeData.width||this._width}},{key:"height",get:function(){return this._nativeData.height||this._height}},{key:"format",get:function(){return this._format}},{key:"isCompressed",get:function(){return this._format>=Ai.RGB_ETC1&&this._format<=Ai.RGBA_ASTC_12x12||this._format>=Ai.RGB_A_PVRTC_2BPPV1&&this._format<=Ai.RGBA_ETC1}},{key:"mipmapLevelDataSize",get:function(){return this._nativeData.mipmapLevelDataSize}},{key:"url",get:function(){return this.nativeUrl}}]),i}(Jt),Ei.extnames=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],Ei._sharedPlaceHolderCanvas=null,h((wi=Ei).prototype,"_nativeAsset",[it],Object.getOwnPropertyDescriptor(wi.prototype,"_nativeAsset"),wi.prototype),Ri=wi))||Ri);Pt.ImageAsset=Vi,f(Re);var ji,Wi,Xi,qi=new c("Tex"),Ki=t("f",tt("cc.TextureBase")((zi=function(t){function e(e){var i;return(i=t.call(this,e)||this)._format=ki&&ki(),i._minFilter=Oi&&Oi(),i._magFilter=Bi&&Bi(),i._mipFilter=Ni&&Ni(),i._wrapS=Fi&&Fi(),i._wrapT=Ui&&Ui(),i._wrapR=Hi&&Hi(),i._anisotropy=Gi&&Gi(),i._width=1,i._height=1,i._samplerInfo=new Se,i._gfxSampler=null,i._gfxDevice=null,i._textureHash=0,i._id=qi.getNewId(),i._gfxDevice=i._getGFXDevice(),i._textureHash=Ce(i._id,666),i}n(e,t);var i=e.prototype;return i.getId=function(){return this._id},i.getPixelFormat=function(){return this._format},i.getAnisotropy=function(){return this._anisotropy},i.setWrapMode=function(t,e,i){void 0===i&&(i=t),this._wrapS=t,this._samplerInfo.addressU=t,this._wrapT=e,this._samplerInfo.addressV=e,this._wrapR=i,this._samplerInfo.addressW=i,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},i.setFilters=function(t,e){this._minFilter=t,this._samplerInfo.minFilter=t,this._magFilter=e,this._samplerInfo.magFilter=e,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},i.setMipFilter=function(t){this._mipFilter=t,this._samplerInfo.mipFilter=t,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},i.setAnisotropy=function(t){t=Math.min(t,16),this._anisotropy=t,this._samplerInfo.maxAnisotropy=t,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},i.destroy=function(){var e,i=t.prototype.destroy.call(this);return i&&null!=(e=Pt.director.root)&&e.batcher2D&&Pt.director.root.batcher2D._releaseDescriptorSetCache(this._textureHash),i},i.getHash=function(){return this._textureHash},i.getGFXTexture=function(){return null},i.getSamplerInfo=function(){return this._samplerInfo},i.getGFXSampler=function(){return this._gfxSampler||(this._gfxDevice?this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo):l(9302)),this._gfxSampler},i._serialize=function(){return""},i._deserialize=function(t){var e=t.split(",");e.unshift(""),e.length>=5&&(this.setFilters(parseInt(e[1]),parseInt(e[2])),this.setWrapMode(parseInt(e[3]),parseInt(e[4]))),e.length>=7&&(this.setMipFilter(parseInt(e[5])),this.setAnisotropy(parseInt(e[6])))},i._getGFXDevice=function(){return Ie.gfxDevice},i._getGFXFormat=function(){return this._getGFXPixelFormat(this._format)},i._setGFXFormat=function(t){this._format=void 0===t?Ai.RGBA8888:t},i._getGFXPixelFormat=function(t){return t===Ai.RGBA_ETC1?t=Ai.RGB_ETC1:t===Ai.RGB_A_PVRTC_4BPPV1?t=Ai.RGB_PVRTC_4BPPV1:t===Ai.RGB_A_PVRTC_2BPPV1&&(t=Ai.RGB_PVRTC_2BPPV1),t},u(e,[{key:"isCompressed",get:function(){return this._format>=Ai.RGB_ETC1&&this._format<=Ai.RGBA_ASTC_12x12||this._format>=Ai.RGB_A_PVRTC_2BPPV1&&this._format<=Ai.RGBA_ETC1}},{key:"isAlphaAtlas",get:function(){return this._format===Ai.RGBA_ETC1||this._format===Ai.RGB_A_PVRTC_4BPPV1||this._format===Ai.RGB_A_PVRTC_2BPPV1}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),e}(Jt),zi.PixelFormat=Ai,zi.WrapMode=Ti,zi.Filter=Ii,ki=nt((Li=zi).prototype,"_format",[rt],(function(){return Ai.RGBA8888})),Oi=nt(Li.prototype,"_minFilter",[rt],(function(){return Ii.LINEAR})),Bi=nt(Li.prototype,"_magFilter",[rt],(function(){return Ii.LINEAR})),Ni=nt(Li.prototype,"_mipFilter",[rt],(function(){return Ii.NONE})),Fi=nt(Li.prototype,"_wrapS",[rt],(function(){return Ti.REPEAT})),Ui=nt(Li.prototype,"_wrapT",[rt],(function(){return Ti.REPEAT})),Hi=nt(Li.prototype,"_wrapR",[rt],(function(){return Ti.REPEAT})),Gi=nt(Li.prototype,"_anisotropy",[rt],(function(){return 0})),Pi=Li))||Pi);Pt.TextureBase=Ki;var Yi=t("ac",tt("cc.MissingScript")((Wi=function(t){function e(){var e;return(e=t.call(this)||this)._$erialized=Xi&&Xi(),e}return n(e,t),e.safeFindClass=function(t){var e=p(t);if(e)return e;Pt.deserialize.reportMissingClass(t)},e.prototype.onLoad=function(){a(4600,this.node.name)},e}(Qt),Xi=nt(Wi.prototype,"_$erialized",[rt,st],(function(){return null})),ji=Wi))||ji);Pt._MissingScript=Yi;try{var Ji=Yi.__values__;0!==Ji.length&&"_$erialized"===Ji[Ji.length-1]||(l(16338),l(16339,Ji.join(", ")))}catch(t){l(16340,""+t)}var Qi=function(){function t(t){if(this._offset=0,this._buffer=void 0,this._view=void 0,t instanceof ArrayBuffer)this._buffer=t,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(t))throw new Error("Invalid argument");this._buffer=t.buffer,this._view=new DataView(this._buffer,t.byteOffset,t.byteLength)}}var e=t.prototype;return e._array=function(t){for(var e=new Array(t),i=0;i<t;i++)e[i]=this.parse();return e},e._map=function(t){for(var e={},i=0;i<t;i++)e[this.parse()]=this.parse();return e},e._str=function(t){var e=$i(this._view,this._offset,t);return this._offset+=t,e},e._bin=function(t){var e=this._buffer.slice(this._offset,this._offset+t);return this._offset+=t,e},e.parse=function(){var t,e=this._view.getUint8(this._offset++),i=0,n=0,r=0,s=0;if(e<192)return e<128?e:e<144?this._map(15&e):e<160?this._array(15&e):this._str(31&e);if(e>223)return-1*(255-e+1);switch(e){case 192:return null;case 194:return!1;case 195:return!0;case 196:return i=this._view.getUint8(this._offset),this._offset+=1,this._bin(i);case 197:return i=this._view.getUint16(this._offset),this._offset+=2,this._bin(i);case 198:return i=this._view.getUint32(this._offset),this._offset+=4,this._bin(i);case 199:if(i=this._view.getUint8(this._offset),n=this._view.getInt8(this._offset+1),this._offset+=2,-1===n){var o=this._view.getUint32(this._offset);return r=this._view.getInt32(this._offset+4),s=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*r+s)+o/1e6)}return[n,this._bin(i)];case 200:return i=this._view.getUint16(this._offset),n=this._view.getInt8(this._offset+2),this._offset+=3,[n,this._bin(i)];case 201:return i=this._view.getUint32(this._offset),n=this._view.getInt8(this._offset+4),this._offset+=5,[n,this._bin(i)];case 202:return t=this._view.getFloat32(this._offset),this._offset+=4,t;case 203:return t=this._view.getFloat64(this._offset),this._offset+=8,t;case 204:return t=this._view.getUint8(this._offset),this._offset+=1,t;case 205:return t=this._view.getUint16(this._offset),this._offset+=2,t;case 206:return t=this._view.getUint32(this._offset),this._offset+=4,t;case 207:return r=this._view.getUint32(this._offset)*Math.pow(2,32),s=this._view.getUint32(this._offset+4),this._offset+=8,r+s;case 208:return t=this._view.getInt8(this._offset),this._offset+=1,t;case 209:return t=this._view.getInt16(this._offset),this._offset+=2,t;case 210:return t=this._view.getInt32(this._offset),this._offset+=4,t;case 211:return r=this._view.getInt32(this._offset)*Math.pow(2,32),s=this._view.getUint32(this._offset+4),this._offset+=8,r+s;case 212:return n=this._view.getInt8(this._offset),this._offset+=1,0===n?void(this._offset+=1):[n,this._bin(1)];case 213:return n=this._view.getInt8(this._offset),this._offset+=1,[n,this._bin(2)];case 214:return n=this._view.getInt8(this._offset),this._offset+=1,-1===n?(t=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*t)):[n,this._bin(4)];case 215:return n=this._view.getInt8(this._offset),this._offset+=1,0===n?(r=this._view.getInt32(this._offset)*Math.pow(2,32),s=this._view.getUint32(this._offset+4),this._offset+=8,new Date(r+s)):-1===n?(r=this._view.getUint32(this._offset),s=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&r)+s)+(r>>>2)/1e6)):[n,this._bin(8)];case 216:return n=this._view.getInt8(this._offset),this._offset+=1,[n,this._bin(16)];case 217:return i=this._view.getUint8(this._offset),this._offset+=1,this._str(i);case 218:return i=this._view.getUint16(this._offset),this._offset+=2,this._str(i);case 219:return i=this._view.getUint32(this._offset),this._offset+=4,this._str(i);case 220:return i=this._view.getUint16(this._offset),this._offset+=2,this._array(i);case 221:return i=this._view.getUint32(this._offset),this._offset+=4,this._array(i);case 222:return i=this._view.getUint16(this._offset),this._offset+=2,this._map(i);case 223:return i=this._view.getUint32(this._offset),this._offset+=4,this._map(i)}throw new Error("Could not parse")},u(t,[{key:"offset",get:function(){return this._offset}}]),t}();function $i(t,e,i){for(var n="",r=0,s=e,o=e+i;s<o;s++){var a=t.getUint8(s);if(128&a)if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(r=(7&a)<<18|(63&t.getUint8(++s))<<12|(63&t.getUint8(++s))<<6|63&t.getUint8(++s))>=65536?(r-=65536,n+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):n+=String.fromCharCode(r)}else n+=String.fromCharCode((15&a)<<12|(63&t.getUint8(++s))<<6|63&t.getUint8(++s));else n+=String.fromCharCode((31&a)<<6|63&t.getUint8(++s));else n+=String.fromCharCode(a)}return n}function Zi(t){var e=new Qi(t),i=e.parse();if(e.offset!==t.byteLength)throw new Error(t.byteLength-e.offset+" trailing bytes");return i}var tn=function(){function t(t,e){this._document=t,this._chunks=e}return u(t,[{key:"document",get:function(){return this._document}},{key:"chunks",get:function(){return this._chunks}}]),t}();function en(t){if(t.length<16)throw new rn(d(13102));var e=new DataView(t.buffer,t.byteOffset,t.byteLength);if(1313817411!==e.getUint32(0,!0))throw new rn(d(13100));var i=e.getUint32(4,!0);if(e.getUint32(8,!0)!==e.byteLength)throw new rn(d(13102));var n=12,r=e.getUint32(n,!0);n+=4;var s,o=new Uint8Array(e.buffer,n+e.byteOffset,r);n+=r;try{if(1===i){var a=nn(o);s=JSON.parse(a)}else 2===i&&(s=Zi(o))}catch(t){throw new rn(t)}for(var u=[];n<e.byteLength;){n%8!=0&&(n+=8-n%8);var h=e.getUint32(n,!0);n+=4,u.push(new Uint8Array(e.buffer,n+e.byteOffset,h)),n+=h}if(n!==e.byteLength)throw new rn(d(13102));return new tn(s,u)}function nn(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);if("Buffer"in globalThis)return globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString();throw new Error(d(13104))}var rn=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e}(_(Error));function sn(t,e,i,n,r){if(e instanceof Pt.ValueType){r||t.push("if(prop){");var s=A(e);t.push("s._deserializeFastDefinedObject(o"+i+",prop,"+s+");"),r||t.push("}else o"+i+"=null;")}else t.push("\nif (prop) {\n    s._deserializeAndAssignField(o, prop, "+n+");\n} else {\n    o"+i+"=null;\n}\n")}!function(){function t(){this._viewOrPaddings=[],this._length=0}var e=t.prototype;e.alignAs=function(t){if(0!==t){var e=this._length%t;if(0!==e){var i=t-e;return this._viewOrPaddings.push(i),this._length+=i,i}}return 0},e.append=function(t){var e=this._length;return this._viewOrPaddings.push(t),this._length+=t.byteLength,e},e.get=function(){var t=new Uint8Array(this._length),e=0;return this._viewOrPaddings.forEach((function(i){"number"==typeof i?e+=i:(t.set(new Uint8Array(i.buffer,i.byteOffset,i.byteLength),e),e+=i.byteLength)})),t},u(t,[{key:"byteLength",get:function(){return this._length}}])}(),Pt.internal.decodeCCONBinary=en,Pt.internal.CCON=tn;var on=function(t,e){for(var i=g.Attr.getClassAttrs(e),n=e.__values__,r=["var prop;"],s=ln(e),o=0;o<n.length;o++){var a=n[o],u=void 0,h=void 0;g.IDENTIFIER_RE.test(a)?(h='"'+a+'"',u="."+a):u="["+(h=g.escapeForJS(a))+"]";var f=u;if(i[a+fn]){var l=i[a+fn];f=g.IDENTIFIER_RE.test(l)?"."+l:"["+g.escapeForJS(l)+"]"}r.push("prop=d"+f+";"),r.push('if(typeof prop!=="undefined"){');var c=g.getDefault(i[a+hn]),p=i[a+un];s&&(void 0!==c||p)?cn(c,p)?r.push("o"+u+"=prop;"):sn(r,c,u,h,!0):(r.push('if(typeof prop!=="object"){o'+u+"=prop;}else{"),sn(r,c,u,h,!1),r.push("}")),r.push("}")}return(T(e,Pt.Node)||T(e,Pt.Component))&&r.push("d._id&&(o._id=d._id);"),"_$erialized"===n[n.length-1]&&(r.push("o._$erialized=JSON.parse(JSON.stringify(d));"),r.push("s._fillPlainObject(o._$erialized,d);")),Function("s","o","d","k",r.join(""))},an=g.Attr.DELIMETER,un=an+"type",hn=an+"default",fn=an+"formerlySerializedAs";function ln(t){return I.test(R(t))}function cn(t,e){if(void 0===t)return e instanceof g.Attr.PrimitiveType||e===w||e===E;var i=typeof t;return"string"===i||"number"===i||"boolean"===i}var pn=function(t){function e(){return t.call(this,(function(t){t.clear()}),1)||this}return n(e,t),e}(v);pn.prototype.get=function(t,e,i,n,r){var s=this._get();return s?(s.reset(t,e,i,n,r),s):new _n(t,e,i,n,r)};var _n=function(){function t(t,e,i,n){this.deserializedList=[],this.deserializedData=null,this.result=t,this.customEnv=n,this._classFinder=e,this._reportMissingClass=i,this._onDereferenced=null==e?void 0:e.onDereferenced}var e=t.prototype;return e.reset=function(t,e,i,n){this.result=t,this.customEnv=n,this._classFinder=e,this._reportMissingClass=i,this._onDereferenced=null==e?void 0:e.onDereferenced},e.clear=function(){this.result=null,this.customEnv=null,this.deserializedList.length=0,this.deserializedData=null,this._classFinder=null,this._reportMissingClass=null,this._onDereferenced=null},e.deserialize=function(t){var e,i=!1;t instanceof tn?(i=!0,e=t.document,t.chunks.length>0&&(m(1===t.chunks.length),this._mainBinChunk=t.chunks[0])):e=t,this._serializedData=e,this._context={fromCCON:i};var n=Array.isArray(e)?e[0]:e;return this.deserializedData=this._deserializeObject(n,0),this._serializedData=void 0,this._mainBinChunk=void 0,this._context=void 0,this.deserializedData},e._deserializeObject=function(t,e,i,n){switch(t.__type__){case"TypedArray":return this._deserializeTypedArrayView(t);case"TypedArrayRef":return this._deserializeTypedArrayViewRef(t);default:return t.__type__?this._deserializeTypeTaggedObject(t,e,i,n):Array.isArray(t)?this._deserializeArray(t):this._deserializePlainObject(t)}},e._deserializeTypedArrayView=function(t){return globalThis[t.ctor].from(t.array)},e._deserializeTypedArrayViewRef=function(t){var e=t.offset,i=t.length,n=t.ctor;return new globalThis[n](this._mainBinChunk.buffer,this._mainBinChunk.byteOffset+e,i)},e._deserializeArray=function(t){for(var e,i=new Array(t.length),n=0;n<t.length;n++)"object"==typeof(e=t[n])&&e?this._deserializeAndAssignField(i,e,""+n)&&(i[n]=null):i[n]=e;return i},e._deserializePlainObject=function(t){var e={};return this._fillPlainObject(e,t),e},e._deserializeTypeTaggedObject=function(t,e,i,n){var r=this,s=t.__type__,o=this._classFinder(s,t,i,n);if(!o)return this._classFinder===p&&this._reportMissingClass(s),null;var a=function(t){var i=new t;return e>=0&&(r.deserializedList[e]=i),i}(o);return this._deserializeInto(t,a,o),a},e._deserializeInto=function(t,e,i,n){void 0===n&&(n=!1),n||!e[ot]?e._deserialize?e._deserialize(t.content,this):Pt.Class._isCCClass(i)?this._deserializeFireClass(e,t,i):this._deserializeFastDefinedObject(e,t,i):this._runCustomizedDeserialize(t,e,i)},e._runCustomizedDeserialize=function(t,e,i){var n=this,r={readProperty:function(e){var i=t[e];return"object"==typeof i&&i?n._deserializeObjectField(i):i},readThis:function(){n._deserializeInto(t,e,i,!0)},readSuper:function(){var r=D(i);r&&n._deserializeInto(t,e,r)}};e[ot](r,this._context)},e._deserializeFireClass=function(t,e,i){var n;if(i.hasOwnProperty("__deserialize__"))n=i.__deserialize__;else{n=on(0,i);try{if(i===Yi){var r=i.__values__;0!==r.length&&"_$erialized"===r[r.length-1]||(l(16341),l(16342,r.join(", ")));var s=n;n=function(t,e,i,n){s(t,e,i,n),e._$erialized||l(16343,JSON.stringify(i))}}}catch(t){l(16344,""+t)}y(i,"__deserialize__",n,!0)}n(this,t,e,i)},e._deserializeAndAssignField=function(t,e,i){var n=e.__id__;if("number"==typeof n){var r=this.deserializedList[n];if(r)t[i]=r;else{var s,o=this._serializedData[n];t[i]=this._deserializeObject(o,n,void 0,i),null==(s=this._onDereferenced)||s.call(this,this.deserializedList,n,t,i)}}else{var a=e.__uuid__;if(a){var u=e.__expectedType__;this.result.push(t,i,a,u)}else t[i]=this._deserializeObject(e,-1)}return!1},e._deserializeObjectField=function(t){var e=t.__id__;if("number"==typeof e){var i=this.deserializedList[e];if(i)return i;var n=this._serializedData[e];return this._deserializeObject(n,e,void 0,void 0)}if(t.__uuid__)throw t.__expectedType__,new Error("Asset reference field serialization is currently not supported in custom serialization.");return this._deserializeObject(t,-1)},e._fillPlainObject=function(t,e){for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];"object"!=typeof n?"__type__"!==i&&(t[i]=n):n?this._deserializeAndAssignField(t,n,i)&&(t[i]=null):t[i]=null}},e._deserializeFastDefinedObject=function(t,e,i){if(i===Pt.Vec2)return t.x=e.x||0,void(t.y=e.y||0);if(i===Pt.Vec3)return t.x=e.x||0,t.y=e.y||0,void(t.z=e.z||0);if(i!==Pt.Color){if(i===Pt.Size)return t.width=e.width||0,void(t.height=e.height||0);var n=g.Attr.getClassAttrs(i),r=i.__values__;r||b("Unable to deserialize "+A(i)+". For non-CCClass types, they can only be marked as serializable by `CCClass.fastDefine`.");for(var s=0;s<r.length;s++){var o=r[s],a=e[o];void 0!==a||e.hasOwnProperty(o)||(a=g.getDefault(n[o+hn])),"object"!=typeof a?t[o]=a:a?this._deserializeAndAssignField(t,a,o):t[o]=null}}else{t.r=e.r||0,t.g=e.g||0,t.b=e.b||0;var u=e.a;t.a=void 0===u?255:u}},u(t,[{key:"ignoreEditorOnly",get:function(){return this._ignoreEditorOnly}}]),t}();function dn(t,e,i){var n,r=(i=i||{}).classFinder||p,s=i.createAssetRefs||et.platform===S.EDITOR_CORE,o=i.customEnv,a=i.ignoreEditorOnly,u=null!==(n=i.reportMissingClass)&&void 0!==n?n:Pt.deserialize.reportMissingClass;e.init();var h=_n.pool.get(e,r,u,o,a);Pt.game._isCloning=!0;var f=h.deserialize(t);return Pt.game._isCloning=!1,_n.pool.put(h),s&&e.assignAssetsBy((function(t,e){return EditorExtends.serialize.asAsset(t,e.type)})),f}_n.pool=new pn;var gn=[at,ut,ht,ft,lt,ct,pt,_t];function vn(t,e){t.x=e[1],t.y=e[2],t.z=e[3],t.w=e[4]}var mn=[function(t,e){t.x=e[1],t.y=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.z=e[3]},vn,vn,function(t,e){lt.fromUint32(t,e[1])},function(t,e){t.width=e[1],t.height=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.width=e[3],t.height=e[4]},function(t,e){_t.fromArray(t,e,1)}],yn=1,bn=0,An=0,Tn=1,In=2,Rn=0,wn=0,En={EACH_RECORD_LENGTH:3,OWNER_OFFSET:0,KEY_OFFSET:1,TARGET_OFFSET:2},Dn={Version:0,Context:0,SharedUuids:1,SharedStrings:2,SharedClasses:3,SharedMasks:4,Instances:5,InstanceTypes:6,Refs:7,DependObjs:8,DependKeys:9,DependUuidIndices:10,ARRAY_LENGTH:11},Sn=Dn.Instances,Cn=t("ae",function(){function t(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null,this.uuidTypeList=[]}var e=t.prototype;return e.init=function(t){t?(this.uuidObjList=t[Dn.DependObjs],this.uuidPropList=t[Dn.DependKeys],this.uuidList=t[Dn.DependUuidIndices]):this.uuidList||(this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.uuidTypeList=[])},e.reset=function(){this.uuidList&&(this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.uuidTypeList.length=0)},e.push=function(t,e,i,n){this.uuidObjList.push(t),this.uuidPropList.push(e),this.uuidList.push(i),this.uuidTypeList.push(n||"")},t}());function xn(t,e,i){for(var n=t.length-1,r=0,s=t[n]*En.EACH_RECORD_LENGTH;r<s;r+=En.EACH_RECORD_LENGTH){var o=t[r],a=e[t[r+En.TARGET_OFFSET]],u=t[r+En.KEY_OFFSET];u>=0?o[i[u]]=a:o[~u]=a}for(;r<n;r+=En.EACH_RECORD_LENGTH){var h=e[t[r]],f=e[t[r+En.TARGET_OFFSET]],l=t[r+En.KEY_OFFSET];l>=0?h[i[l]]=f:h[~l]=f}}function Mn(t,e){for(var i=t[Dn.SharedMasks][e[wn]],n=i[Rn],r=new(0,n[An]),s=n[Tn],o=n[In],a=i[i.length-1],u=Rn+1;u<a;++u)r[s[i[u]]]=e[u];for(;u<e.length;++u){var h=s[i[u]],f=n[i[u]+o];(0,Nn[f])(t,r,h,e[u])}return r}function Pn(t,e,i){var n=new e;return n._deserialize?n._deserialize(i,t[Dn.Context]):l(5303,A(e)),n}function Ln(t,e,i,n){n>=0?e[i]=t[Dn.Instances][n]:t[Dn.Refs][~n*En.EACH_RECORD_LENGTH]=e}function kn(t){return function(e,i,n,r){for(var s=0;s<r.length;++s)t(e,r,s,r[s]);i[n]=r}}function On(t,e,i,n){e[i]=null,t[Dn.DependObjs][n]=e}function Bn(t,e,i,n){e[i]=Mn(t,n)}Cn.pool=new v((function(t){t.reset()}),5),Cn.pool.get=function(){return this._get()||new Cn};var Nn=new Array(13);function Fn(t){var e=t[Dn.Instances],i=t[Dn.InstanceTypes],n=i===bn?0:i.length,r=e[e.length-1],s=e.length-n;"number"!=typeof r?r=0:(r<0&&(r=~r),--s);for(var o=0;o<s;++o)e[o]=Mn(t,e[o]);for(var a=t[Dn.SharedClasses],u=0;u<n;++u,++o){var h=i[u],f=e[o];if(h>=0){var l=a[h];e[o]=Pn(t,l,f)}else(0,Nn[h=~h])(t,e,o,f)}return r}function Un(t,e,i){return t||i(e),Object}function Hn(t,e,i,n,r,s,o){var a,u,h,f=t(e);if(!f){if(r)return void(i[n]=(a=i,u=n,h=e,function(){var e=t(h)||Un(s,h,o);return a[u]=e,new e}));f=Un(s,e,o)}i[n]=f}function Gn(t,e,i,n){for(var r=i||p,s=t[Dn.SharedClasses],o=0;o<s.length;++o){var a=s[o];if("string"!=typeof a){if("function"==typeof a[An])throw new Error("Can not deserialize the same JSON data again.");Hn(r,a[An],a,An,e,i,n)}else Hn(r,a,s,o,e,i,n)}}function zn(t){var e=t[Dn.SharedMasks];if(e)for(var i=t[Dn.SharedClasses],n=0;n<e.length;++n){var r=e[n];r[Rn]=i[r[Rn]]}}function Vn(t){for(var e=t[Dn.Instances],i=t[Dn.SharedStrings],n=t[Dn.SharedUuids],r=t[Dn.DependObjs],s=t[Dn.DependKeys],o=t[Dn.DependUuidIndices],a=0;a<r.length;++a){var u=r[a];"number"==typeof u&&(r[a]=e[u]);var h=s[a];"number"==typeof h&&(h=h>=0?i[h]:~h,s[a]=h);var f=o[a];"number"==typeof f&&(o[a]=n[f])}}function jn(t){if(Array.isArray(t)){var e=t[0];return"number"==typeof e||e instanceof qn}return!1}function Wn(t,e,i){var n;e.init(t),null!==(n=i)&&void 0!==n||(i={});var r=t[Dn.Version],s=!1;if("object"==typeof r&&(s=r.preprocessed,r=r.version),r<yn)throw new Error(d(5304,r));var o,a=i;a._version=r,a.result=e,t[Dn.Context]=a,s||(Gn(t,!1,i.classFinder,null!==(o=i.reportMissingClass)&&void 0!==o?o:Xn.reportMissingClass),zn(t))}function Xn(t,e,i){"string"==typeof t&&(t=JSON.parse(t));var n,r=!1;if(!e){var s=Cn.pool.get();m(s,"Can not allocate deserialization details"),e=s,r=!0}if(jn(t)){Wn(t,e,i);var o=t;Pt.game._isCloning=!0;var a=o[Dn.Instances],u=Fn(o);Pt.game._isCloning=!1,o[Dn.Refs]&&xn(o[Dn.Refs],a,o[Dn.SharedStrings]),Vn(o),n=a[u]}else n=dn(t,e,i);return r&&Cn.pool.put(e),n}Nn[0]=function(t,e,i,n){e[i]=n},Nn[1]=Ln,Nn[2]=kn(Ln),Nn[3]=kn(On),Nn[4]=Bn,Nn[5]=function(t,e,i,n){var r=n[0];m(r>=0&&r<gn.length);var s=e[i];(0,mn[r])(s,n)},Nn[6]=On,Nn[7]=function(t,e,i,n){e[i].set(n)},Nn[8]=function(t,e,i,n){var r=n[0];m(r>=0&&r<gn.length);var s=new gn[r];(0,mn[r])(s,n),e[i]=s},Nn[9]=kn(Bn),Nn[10]=function(t,e,i,n){var r=t[Dn.SharedClasses][n[0]];e[i]=Pn(t,r,n[1])},Nn[11]=function(t,e,i,n){var r=n[0];e[i]=r;for(var s=1;s<n.length;s+=3){var o=n[s],a=n[s+1],u=n[s+2];(0,Nn[a])(t,r,o,u)}},Nn[12]=function(t,e,i,n){for(var r=n[0],s=0;s<r.length;++s){var o=r[s],a=n[s+1];0!==a&&(0,Nn[a])(t,r,s,o)}e[i]=r},Xn.Details=Cn,Xn.reportMissingClass=function(t){l(5302,t)};var qn=function(t){this.preprocessed=!0,this.version=t};function Kn(t,e){if(t[Dn.Version]<yn)throw new Error(d(5304,t[Dn.Version]));Gn(t,!0,e,Xn.reportMissingClass),zn(t);for(var i=new qn(t[Dn.Version]),n=t[Dn.SharedUuids],r=t[Dn.SharedStrings],s=t[Dn.SharedClasses],o=t[Dn.SharedMasks],a=t[Sn],u=0;u<a.length;++u)a[u].unshift(i,n,r,s,o);return a}function Yn(t,e,i){return[yn,bn,bn,[t],bn,i?[e,-1]:[e],[0],bn,[],[],[]]}function Jn(t){return i=(e=t)[Dn.SharedUuids],e[Dn.DependUuidIndices].map((function(t){return i[t]}));var e,i}Pt.deserialize=Xn;var Qn=new WeakMap,$n=new WeakSet,Zn=new WeakSet;function tr(t,e){var i;i=Yi.safeFindClass;var n,r=Cn.pool.get();try{n=Xn(t,r,{classFinder:i,customEnv:e})}catch(t){throw b(t),Cn.pool.put(r),t}n._uuid=e.__uuid__||"";for(var s=r.uuidList,o=r.uuidObjList,a=r.uuidPropList,u=r.uuidTypeList||[],h=[],f=0;f<s.length;f++){var l=s[f];h[f]={uuid:$t(l),owner:o[f],prop:a[f],type:p(u[f])}}return Qn.set(n,h),n._native&&$n.add(n),Cn.pool.put(r),n}var er=function(){function t(){this._depends=new ee}var e=t.prototype;return e.init=function(){this._depends.clear()},e.getNativeDep=function(t){var e=this._depends.get(t);return e&&e.nativeDep?C({},e.nativeDep):null},e.getDeps=function(t){return this._depends.has(t)?this._depends.get(t).deps:[]},e.getDepsRecursively=function(t){var e=Object.create(null),i=[];return this._descend(t,e,i),i},e.remove=function(t){this._depends.remove(t)},e.parse=function(t,e){var i,n,r=null;if(Array.isArray(e)||e.__type__||e instanceof tn){if(this._depends.has(t))return this._depends.get(t);if(!Array.isArray(e)||"number"==typeof(n=(i=e[Dn.Instances])[i.length-1])&&n<0)try{var s=tr(e,{__uuid__:t});(r=this._parseDepsFromAsset(s)).nativeDep&&(r.nativeDep.uuid=t),Zt.add(t+"@import",s)}catch(e){te.remove(t+"@import"),r={deps:[]}}else r={deps:this._parseDepsFromJson(e)}}else{if(this._depends.has(t)&&(r=this._depends.get(t)).parsedFromExistAsset)return r;r=this._parseDepsFromAsset(e)}return this._depends.add(t,r),r},e._parseDepsFromAsset=function(t){var e={deps:[],parsedFromExistAsset:!0},i=Qn.get(t);x(i);for(var n=0,r=i.length;n<r;n++)e.deps.push(i[n].uuid);return $n.has(t)&&(e.nativeDep=t._nativeDep),e},e._parseDepsFromJson=function(t){var e=Jn(t);return e.forEach((function(t,i){return e[i]=$t(t)})),e},e._descend=function(t,e,i){for(var n=this.getDeps(t),r=0;r<n.length;r++){var s=n[r];e[s]||(e[s]=!0,i.push(s),this._descend(s,e,i))}},u(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}();er._instance=void 0;var ir,nr=t("an",er.instance),rr=[new Pe];function sr(t,e){for(var i=Math.max(t,e),n=0;i;)i>>=1,n++;return n}function or(t){return t&&!(t&t-1)}function ar(t,e,i){return!(t.gfxAPI===Le.WEBGL)||or(e)&&or(i)}var ur,hr,fr,lr,cr,pr=tt("cc.SimpleTexture")(ir=function(t){function e(e){var i;return(i=t.call(this,e)||this)._gfxTexture=null,i._gfxTextureView=null,i._mipmapLevel=1,i._textureWidth=0,i._textureHeight=0,i._baseLevel=0,i._maxLevel=1e3,i}n(e,t);var i=e.prototype;return i.getGFXTexture=function(){return this._gfxTextureView},i.destroy=function(){return this._tryDestroyTextureView(),this._tryDestroyTexture(),t.prototype.destroy.call(this)},i.updateImage=function(){this.updateMipmaps(0)},i.updateMipmaps=function(){},i.uploadData=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),this._gfxTexture&&!(this._mipmapLevel<=e)){var n=this._getGFXDevice();if(n){var r=rr[0];r.texExtent.width=this._textureWidth>>e,r.texExtent.height=this._textureHeight>>e,r.texSubres.mipLevel=e,r.texSubres.baseArrayLayer=i,ArrayBuffer.isView(t)?n.copyBuffersToTexture([t],this._gfxTexture,rr):n.copyTexImagesToTexture([t],this._gfxTexture,rr)}}},i._assignImage=function(t,e,i){var n=t.data;if(n&&(this.uploadData(n,e,i),this._checkTextureLoaded(),o.CLEANUP_IMAGE_CACHE)){var r=nr.getDeps(this._uuid),s=r.indexOf(t._uuid);-1!==s&&(M(r,s),t.decRef())}},i._checkTextureLoaded=function(){this._textureReady()},i._textureReady=function(){this.loaded=!0,this.emit("load")},i._setMipmapLevel=function(t){this._mipmapLevel=t<1?1:t},i._setMipRange=function(t,e){this._baseLevel=t<1?0:t,this._maxLevel=e<1?0:e},i.setMipRange=function(t,e){P(t<=e,3124),this._setMipRange(t,e);var i=this._getGFXDevice();if(i){var n=this._createTextureView(i);this._tryDestroyTextureView(),this._gfxTextureView=n}},i._getGfxTextureCreateInfo=function(){return null},i._getGfxTextureViewCreateInfo=function(){return null},i._tryReset=function(){if(this._tryDestroyTextureView(),this._tryDestroyTexture(),0!==this._mipmapLevel){var t=this._getGFXDevice();t&&(this._createTexture(t),this._gfxTextureView=this._createTextureView(t))}},i.isUsingOfflineMipmaps=function(){return!1},i._createTexture=function(t){if(0!==this._width&&0!==this._height){var e=xe.NONE;this._mipFilter!==Ii.NONE&&ar(t,this._width,this._height)&&(this._mipmapLevel=sr(this._width,this._height),this.isUsingOfflineMipmaps()||this.isCompressed||(e=xe.GEN_MIPMAP));var i=this._getGfxTextureCreateInfo({usage:Me.SAMPLED|Me.TRANSFER_DST|Me.COLOR_ATTACHMENT,format:this._getGFXFormat(),levelCount:this._mipmapLevel,flags:e});if(i){var n=t.createTexture(i);this._textureWidth=i.width,this._textureHeight=i.height,this._gfxTexture=n}}},i._createTextureView=function(t){if(!this._gfxTexture)return null;var e=this._maxLevel<this._mipmapLevel?this._maxLevel:this._mipmapLevel-1,i=this._getGfxTextureViewCreateInfo({texture:this._gfxTexture,format:this._getGFXFormat(),baseLevel:this._baseLevel,levelCount:e-this._baseLevel+1});return i?t.createTexture(i):null},i._tryDestroyTexture=function(){this._gfxTexture&&(this._gfxTexture.destroy(),this._gfxTexture=null)},i._tryDestroyTextureView=function(){this._gfxTextureView&&(this._gfxTextureView.destroy(),this._gfxTextureView=null)},u(e,[{key:"mipmapLevel",get:function(){return this._mipmapLevel}}]),e}(Ki))||ir;Pt.SimpleTexture=pr;var _r,dr,gr,vr,mr,yr,br,Ar,Tr,Ir=t("i",(ur=tt("cc.Texture2D"),hr=dt([Vi]),ur((lr=function(t){function e(e){var i;return(i=t.call(this,e)||this)._mipmaps=cr&&cr(),i._generatedMipmaps=[],i}n(e,t);var i=e.prototype;return i._setMipmapParams=function(t){var e=this;if(this._generatedMipmaps=t,this._setMipmapLevel(this._generatedMipmaps.length),this._generatedMipmaps.length>0){var i=this._generatedMipmaps[0];this.reset({width:i.width,height:i.height,format:i.format,mipmapLevel:this._generatedMipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel}),this._generatedMipmaps.forEach((function(t,i){e._assignImage(t,i)}))}else this.reset({width:0,height:0,mipmapLevel:this._generatedMipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel})},i.initialize=function(){this.mipmaps=this._mipmaps},i.onLoaded=function(){this.initialize()},i.reset=function(t){this._width=t.width,this._height=t.height,this._setGFXFormat(t.format);var e=void 0===t.mipmapLevel?1:t.mipmapLevel;this._setMipmapLevel(e);var i=void 0===t.baseLevel?0:t.baseLevel,n=void 0===t.maxLevel?1e3:t.maxLevel;this._setMipRange(i,n),this._tryReset()},i.create=function(t,e,i,n,r,s){void 0===i&&(i=Ai.RGBA8888),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=1e3),this.reset({width:t,height:e,format:i,mipmapLevel:n,baseLevel:r,maxLevel:s})},i.toString=function(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""},i.updateMipmaps=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=void 0),!(t>=this._generatedMipmaps.length))for(var i=Math.min(void 0===e?this._generatedMipmaps.length:e,this._generatedMipmaps.length-t),n=0;n<i;++n){var r=t+n;this._assignImage(this._generatedMipmaps[r],r)}},i.getHtmlElementObj=function(){return this._mipmaps[0]&&this._mipmaps[0].data instanceof HTMLElement?this._mipmaps[0].data:null},i.destroy=function(){return this._mipmaps=[],this._generatedMipmaps=[],t.prototype.destroy.call(this)},i.description=function(){return"<cc.Texture2D | Name = "+(this._mipmaps[0]?this._mipmaps[0].url:"")+" | Dimension = "+this.width+" x "+this.height+">"},i.releaseTexture=function(){this.destroy()},i._serialize=function(){return null},i._deserialize=function(e,i){var n=e;t.prototype._deserialize.call(this,n.base,i),this._mipmaps=new Array(n.mipmaps.length);for(var r=0;r<n.mipmaps.length;++r)if(this._mipmaps[r]=new Vi,n.mipmaps[r]){var s=n.mipmaps[r];i.result.push(this._mipmaps,""+r,s,R(Vi))}},i._getGfxTextureCreateInfo=function(t){var e=new ke(Oe.TEX2D);return e.width=this._width,e.height=this._height,Object.assign(e,t),e},i._getGfxTextureViewCreateInfo=function(t){var e=new Be;return e.type=Oe.TEX2D,Object.assign(e,t),e},i.initDefault=function(e){t.prototype.initDefault.call(this,e);var i=new Vi;i.initDefault(),this.image=i},i.validate=function(){return this.mipmaps&&0!==this.mipmaps.length},u(e,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){this._mipmaps=t;var e=[];if(1===t.length){var i=t[0];e.push.apply(e,i.extractMipmaps())}else if(t.length>1)for(var n=0;n<t.length;++n){var r=t[n];e.push(r.extractMipmap0())}this._setMipmapParams(e)}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),e}(pr),cr=nt(lr.prototype,"_mipmaps",[hr],(function(){return[]})),fr=lr))||fr));Pt.Texture2D=Ir,function(t){t[t.right=0]="right",t[t.left=1]="left",t[t.top=2]="top",t[t.bottom=3]="bottom",t[t.front=4]="front",t[t.back=5]="back"}(Ar||(Ar={})),function(t){t[t.NONE=0]="NONE",t[t.AUTO=1]="AUTO",t[t.BAKED_CONVOLUTION_MAP=2]="BAKED_CONVOLUTION_MAP"}(Tr||(Tr={}));var Rr=t("ai",tt("cc.TextureCube")((br=function(t){function e(e){var i;return(i=t.call(this,e)||this).isRGBE=gr&&gr(),i._mipmapAtlas=vr&&vr(),i._mipmapMode=mr&&mr(),i._mipmaps=yr&&yr(),i._generatedMipmaps=[],i}n(e,t);var i=e.prototype;return i._setMipmapParams=function(t){var e=this;if(this._generatedMipmaps=t,this._setMipmapLevel(this._generatedMipmaps.length),this._generatedMipmaps.length>0){var i=this._generatedMipmaps[0].front;this.reset({width:i.width,height:i.height,format:i.format,mipmapLevel:this._generatedMipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel}),this._generatedMipmaps.forEach((function(t,i){wr(t,(function(t,n){e._assignImage(t,i,n)}))}))}else this.reset({width:0,height:0,mipmapLevel:this._generatedMipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel})},i.isUsingOfflineMipmaps=function(){return this._mipmapMode===Tr.BAKED_CONVOLUTION_MAP},e.fromTexture2DArray=function(t,i){for(var n=[],r=t.length/6,s=0;s<r;s++){var o=6*s;n.push({front:t[o+Ar.front].image,back:t[o+Ar.back].image,left:t[o+Ar.left].image,right:t[o+Ar.right].image,top:t[o+Ar.top].image,bottom:t[o+Ar.bottom].image})}return(i=i||new e).mipmaps=n,i},i.onLoaded=function(){this._mipmapMode===Tr.BAKED_CONVOLUTION_MAP?this.mipmapAtlas=this._mipmapAtlas:this.mipmaps=this._mipmaps},i.reset=function(t){this._width=t.width,this._height=t.height,this._setGFXFormat(t.format);var e=void 0===t.mipmapLevel?1:t.mipmapLevel;this._setMipmapLevel(e);var i=void 0===t.baseLevel?0:t.baseLevel,n=void 0===t.maxLevel?1e3:t.maxLevel;this._setMipRange(i,n),this._tryReset()},i.updateMipmaps=function(t,e){var i=this;if(void 0===t&&(t=0),void 0===e&&(e=void 0),!(t>=this._generatedMipmaps.length))for(var n=Math.min(void 0===e?this._generatedMipmaps.length:e,this._generatedMipmaps.length-t),r=function(){var e=t+s;wr(i._generatedMipmaps[e],(function(t,n){i._assignImage(t,e,n)}))},s=0;s<n;++s)r()},i.destroy=function(){return this._mipmaps=[],this._generatedMipmaps=[],this._mipmapAtlas=null,t.prototype.destroy.call(this)},i.releaseTexture=function(){this.destroy()},i._serialize=function(){return null},i._deserialize=function(e,i){var n=e;if(t.prototype._deserialize.call(this,n.base,i),this.isRGBE=n.rgbe,this._mipmapMode=n.mipmapMode,this._mipmapMode===Tr.BAKED_CONVOLUTION_MAP){var r=n.mipmapAtlas,s=n.mipmapLayout;this._mipmapAtlas={atlas:{},layout:s},this._mipmapAtlas.atlas={front:new Vi,back:new Vi,left:new Vi,right:new Vi,top:new Vi,bottom:new Vi};var o=R(Vi);i.result.push(this._mipmapAtlas.atlas,"front",r.front,o),i.result.push(this._mipmapAtlas.atlas,"back",r.back,o),i.result.push(this._mipmapAtlas.atlas,"left",r.left,o),i.result.push(this._mipmapAtlas.atlas,"right",r.right,o),i.result.push(this._mipmapAtlas.atlas,"top",r.top,o),i.result.push(this._mipmapAtlas.atlas,"bottom",r.bottom,o)}else{this._mipmaps=new Array(n.mipmaps.length);for(var a=0;a<n.mipmaps.length;++a){this._mipmaps[a]={front:new Vi,back:new Vi,left:new Vi,right:new Vi,top:new Vi,bottom:new Vi};var u=n.mipmaps[a],h=R(Vi);i.result.push(this._mipmaps[a],"front",u.front,h),i.result.push(this._mipmaps[a],"back",u.back,h),i.result.push(this._mipmaps[a],"left",u.left,h),i.result.push(this._mipmaps[a],"right",u.right,h),i.result.push(this._mipmaps[a],"top",u.top,h),i.result.push(this._mipmaps[a],"bottom",u.bottom,h)}}},i._getGfxTextureCreateInfo=function(t){var e=new ke(Oe.CUBE);return e.width=this._width,e.height=this._height,e.layerCount=6,Object.assign(e,t),e},i._getGfxTextureViewCreateInfo=function(t){var e=new Be;return e.type=Oe.CUBE,e.baseLayer=0,e.layerCount=6,Object.assign(e,t),e},i._uploadAtlas=function(){var t=this,e=this._mipmapAtlas.layout,i=e[0];this.reset({width:i.width,height:i.height,format:this._mipmapAtlas.atlas.front.format,mipmapLevel:e.length}),wr(this._mipmapAtlas.atlas,(function(i,n){var r=new Ir;r.image=i,r.reset({width:i.width,height:i.height,format:i.format}),r.uploadData(i.data);for(var s=0;s<e.length;s++){var o=e[s],a=r.getGFXTexture().size,u=new Uint8Array(a),h=new Pe;h.texOffset.x=o.left,h.texOffset.y=o.top,h.texExtent.width=o.width,h.texExtent.height=o.height,t._getGFXDevice().copyTextureToBuffers(r.getGFXTexture(),[u],[h]);var f=new Vi({_data:u,_compressed:i.isCompressed,width:o.width,height:o.height,format:i.format});t._assignImage(f,o.level,n)}}))},i.initDefault=function(e){t.prototype.initDefault.call(this,e);var i=new Vi;i.initDefault(),this.mipmaps=[{front:i,back:i,top:i,bottom:i,left:i,right:i}]},i.validate=function(){if(this._mipmapMode===Tr.BAKED_CONVOLUTION_MAP){if(null===this.mipmapAtlas||0===this.mipmapAtlas.layout.length)return!1;var t=this.mipmapAtlas.atlas;return!!(t.top&&t.bottom&&t.front&&t.back&&t.left&&t.right)}return 0!==this._mipmaps.length&&!this._mipmaps.find((function(t){return!(t.top&&t.bottom&&t.front&&t.back&&t.left&&t.right)}))},u(e,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){this._mipmaps=t;var e=[];if(1===t.length){var i=t[0],n=i.front.extractMipmaps(),r=i.back.extractMipmaps(),s=i.left.extractMipmaps(),o=i.right.extractMipmaps(),a=i.top.extractMipmaps(),u=i.bottom.extractMipmaps();if(n.length!==r.length||n.length!==s.length||n.length!==o.length||n.length!==a.length||n.length!==u.length)return l(16347),void this._setMipmapParams([]);for(var h=n.length,f=0;f<h;++f){var c={front:n[f],back:r[f],left:s[f],right:o[f],top:a[f],bottom:u[f]};e.push(c)}}else t.length>1&&t.forEach((function(t){var i={front:t.front.extractMipmap0(),back:t.back.extractMipmap0(),left:t.left.extractMipmap0(),right:t.right.extractMipmap0(),top:t.top.extractMipmap0(),bottom:t.bottom.extractMipmap0()};e.push(i)}));this._setMipmapParams(e)}},{key:"mipmapAtlas",get:function(){return this._mipmapAtlas},set:function(t){var e=this;if(this._mipmapAtlas=t,this._mipmapAtlas){var i=this._mipmapAtlas.atlas.front;if(i.data){var n=this._mipmapAtlas.atlas,r=this._mipmapAtlas.layout,s=r[0],o=Object.assign(Mt.document.createElement("canvas"),{width:i.width,height:i.height}).getContext("2d");this.reset({width:s.width,height:s.height,format:i.format,mipmapLevel:r.length});for(var a=function(){var t=r[u];wr(n,(function(n,r){o.clearRect(0,0,i.width,i.height);var s=n.data;o.drawImage(s,0,0);var a=o.getImageData(t.left,t.top,t.width,t.height),u=new Vi({_data:a.data,_compressed:n.isCompressed,width:a.width,height:a.height,format:n.format});e._assignImage(u,t.level,r)}))},u=0;u<r.length;u++)a()}}else this.reset({width:0,height:0,mipmapLevel:0})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),e}(pr),br.FaceIndex=Ar,gr=nt((dr=br).prototype,"isRGBE",[rt],(function(){return!1})),vr=nt(dr.prototype,"_mipmapAtlas",[rt],(function(){return null})),mr=nt(dr.prototype,"_mipmapMode",[rt],(function(){return Tr.NONE})),yr=nt(dr.prototype,"_mipmaps",[rt],(function(){return[]})),_r=dr))||_r);function wr(t,e){e(t.front,Ar.front),e(t.back,Ar.back),e(t.left,Ar.left),e(t.right,Ar.right),e(t.top,Ar.top),e(t.bottom,Ar.bottom)}Lt.TextureCube=Rr;var Er=function(t,e){return!(t.length>e.length)||47===t.charCodeAt(e.length)},Dr=function(t){var e=t.uuids,i=t.paths,n=t.types,r=t.deps,s=t.paths=Object.create(null);if(!1===t.debug){for(var o=0,a=e.length;o<a;o++)e[o]=$t(e[o]);for(var u in i){var h=i[u],f=h[1];h[1]=n[f]}}else{for(var l=Object.create(null),c=0,p=e.length;c<p;c++){var _=e[c];e[c]=l[_]=$t(_)}e=l}for(var d in i){var g=i[d];s[e[d]]=g}var v=t.scenes;for(var m in v){var y=v[m];v[m]=e[y]}var b=t.packs;for(var A in b)for(var T=b[A],I=0;I<T.length;++I)T[I]=e[T[I]];var R=t.versions;if(R)for(var w in R)for(var E=R[w],D=0;D<E.length;D+=2){var S=E[D];E[D]=e[S]||S}var C=t.redirect;if(C)for(var x=0;x<C.length;x+=2)C[x]=e[C[x]],C[x+1]=r[C[x+1]];if(t.extensionMap){var M=function(i){if(!Object.prototype.hasOwnProperty.call(t.extensionMap,i))return 1;t.extensionMap[i].forEach((function(n,r){t.extensionMap[i][r]=e[n]||n}))};for(var P in t.extensionMap)M(P)}},Sr=function(){function t(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new ee,this.scenes=new ee,this.paths=new ee}var e=t.prototype;return e.init=function(t){var e=this;Dr(t),this.importBase=t.importBase||"",this.nativeBase=t.nativeBase||"",this.base=t.base||"",this.name=t.name||"",this.deps=t.deps||[],this._initUuid(t.uuids),this._initPath(t.paths),this._initScene(t.scenes),this._initPackage(t.packs,t.extensionMap[".cconb"]),this._initVersion(t.versions),this._initRedirect(t.redirect);var i=function(i){if(!Object.prototype.hasOwnProperty.call(t.extensionMap,i))return 1;t.extensionMap[i].forEach((function(t){var n=e.assetInfos.get(t);n&&(n.extension=i)}))};for(var n in t.extensionMap)i(n)},e.getInfoWithPath=function(t,e){if(!t)return null;t=ie(t);var i=this.paths.get(t);if(i){if(!e)return i[0];for(var n=0,r=i.length;n<r;n++){var s=i[n];if(T(s.ctor,e))return s}}return null},e.getDirWithPath=function(t,e,i){"/"===(t=ie(t))[t.length-1]&&(t=t.slice(0,-1));var n=i||[];return this.paths.forEach((function(i,r){if(r.startsWith(t)&&Er(r,t)||!t)for(var s=0,o=i.length;s<o;s++){var a=i[s];e&&!T(a.ctor,e)||n.push(a)}})),n},e.getAssetInfo=function(t){return this.assetInfos.get(t)||null},e.getSceneInfo=function(t){return t.endsWith(".scene")||(t+=".scene"),"/"===t[0]||t.startsWith("db://")||(t="/"+t),this.scenes.find((function(e,i){return i.endsWith(t)}))},e.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},e._initUuid=function(t){if(t){this.assetInfos.clear();for(var e=0,i=t.length;e<i;e++){var n=t[e];this.assetInfos.add(n,{uuid:n})}}},e._initPath=function(t){if(t){var e=this.paths;for(var i in e.clear(),t){var n=t[i],r=n[0],s=n[1],o=3===n.length,a=this.assetInfos.get(i);a.path=r,a.ctor=p(s),e.has(r)?o?e.get(r).push(a):e.get(r).unshift(a):e.add(r,[a])}}},e._initScene=function(t){if(t){var e=this.scenes;e.clear();var i=this.assetInfos;for(var n in t){var r=t[n],s=i.get(r);s.url=n,e.add(n,s)}}},e._initPackage=function(t,e){if(t){var i=this.assetInfos;for(var n in t){var r=t[n],s={uuid:n,packedUuids:r,ext:(null==r?void 0:r.length)>0&&(null==e?void 0:e.includes(r[0]))?".bin":".json"};i.add(n,s);for(var o=0,a=r.length;o<a;o++){var u=r[o],h=i.get(u),f=h.packs;f?1===a?f.unshift(s):f.push(s):h.packs=[s]}}}},e._initVersion=function(t){if(t){var e=this.assetInfos,i=t.import;if(i)for(var n=0,r=i.length;n<r;n+=2){var s=i[n];e.get(s).ver=i[n+1]}if(i=t.native)for(var o=0,a=i.length;o<a;o+=2){var u=i[o];e.get(u).nativeVer=i[o+1]}}},e._initRedirect=function(t){if(t)for(var e=this.assetInfos,i=0,n=t.length;i<n;i+=2){var r=t[i];e.get(r).redirect=t[i+1]}},t}();function Cr(t,e){t._uuid&&e.push(t._uuid)}function xr(t,e){for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var r=i[n];if("node"!==r&&"__eventTargets"!==r){var s=t[r];if("object"==typeof s&&s)if(Array.isArray(s))for(var o=0;o<s.length;o++){var a=s[o];a instanceof Jt&&Cr(a,e)}else if(s.constructor&&s.constructor!==Object)s instanceof Jt&&Cr(s,e);else for(var u=Object.getOwnPropertyNames(s),h=0;h<u.length;h++){var f=s[u[h]];f instanceof Jt&&Cr(f,e)}}}}function Mr(t,e){for(var i=0;i<t._components.length;i++)xr(t._components[i],e);for(var n=0;n<t._children.length;n++)Mr(t._children[n],e)}function Pr(t,e,i,n){i.push(t._uuid);for(var r=nr.getDeps(t._uuid),s=0,o=r.length;s<o;s++){var a=ne.get(r[s]);if(a){var u=a._uuid;u in e?e[u]+=n:e[u]=a.refCount+n,i.includes(u)||Pr(a,e,i,n)}}}var Lr=[];function kr(t){var e=Object.create(null);if(e[t._uuid]=t.refCount,Pr(t,e,Lr,-1),Lr.length=0,0!==e[t._uuid])return e[t._uuid];for(var i in e)0!==e[i]&&Pr(ne.get(i),e,Lr,1);return Lr.length=0,e[t._uuid]}var Or=function(){function t(){this._persistNodeDeps=new ee,this._toDelete=new ee,this._eventListener=!1,this._dontDestroyAssets=[]}var e=t.prototype;return e.addIgnoredAsset=function(t){this._dontDestroyAssets.push(t._uuid)},e.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},e._addPersistNodeRef=function(t){var e=[];Mr(t,e);for(var i=0,n=e.length;i<n;i++){var r=ne.get(e[i]);r&&r.addRef()}this._persistNodeDeps.add(t.uuid,e)},e._removePersistNodeRef=function(t){if(this._persistNodeDeps.has(t.uuid)){for(var e=this._persistNodeDeps.get(t.uuid),i=0,n=e.length;i<n;i++){var r=ne.get(e[i]);r&&r.decRef()}this._persistNodeDeps.remove(t.uuid)}},e._autoRelease=function(t,e,i){if(t){for(var n=nr.getDeps(t.uuid),s=0,o=n.length;s<o;s++){var a=ne.get(n[s]);a&&a.decRef(t.autoReleaseAssets)}var u=nr._depends.get(t.uuid);if(u&&u.persistDeps)for(var h=u.persistDeps,f=0,l=h.length;f<l;f++){var c=ne.get(h[f]);c&&c.decRef(t.autoReleaseAssets)}t.uuid!==e.uuid&&nr.remove(t.uuid)}var p=nr._depends.get(e.uuid);for(var _ in p&&(p.persistDeps=[]),i){for(var d,g,v=i[_],m=this._persistNodeDeps.get(v.uuid),y=r(m);!(g=y()).done;){var b=g.value,A=ne.get(b);A&&A.addRef()}p&&(d=p.persistDeps).push.apply(d,m)}},e.tryRelease=function(t,e){void 0===e&&(e=!1),t instanceof Jt&&(e?this._free(t,e):(this._toDelete.add(t._uuid,t),this._eventListener||(this._eventListener=!0,L(this._freeAssets.bind(this)))))},e._freeAssets=function(){var t=this;this._eventListener=!1,this._toDelete.forEach((function(e){t._free(e)})),this._toDelete.clear()},e._free=function(t,e){void 0===e&&(e=!1);var i=t._uuid;if(this._toDelete.remove(i),k(t,!0)&&-1===this._dontDestroyAssets.indexOf(i)&&!(!e&&t.refCount>0&&kr(t)>0)){ne.remove(i);for(var n=nr.getDeps(i),r=0,s=n.length;r<s;r++){var o=ne.get(n[r]);o&&(o.decRef(!1),this._free(o,!1))}t.destroy(),nr.remove(i)}},t}(),Br=t("r",new Or),Nr=null;function Fr(t){for(var e=0,i=t.input.length;e<i;e++){var n=t.input[e];!n.isNative&&n.content instanceof Jt&&n.content.decRef(!1),n.recycle()}t.input=null}function Ur(t,e){return e?/\?/.test(t)?t+"&_t="+Date.now():t+"?_t="+Date.now():t}function Hr(t,e,i,n,r){void 0===r&&(r=0),t(r,(function(s,o){r++,!s||r>e?n&&n(s,o):setTimeout((function(){Hr(t,e,i,n,r)}),i)}))}function Gr(t,e,i,n,r){try{for(var s=nr.parse(t,e),o=0,a=s.deps.length;o<a;o++){var u=s.deps[o];u in i||(i[u]=!0,n.push({uuid:u,bundle:r&&r.name}))}s.nativeDep&&(r&&(s.nativeDep.bundle=r.name),n.push(C({},s.nativeDep)))}catch(t){b(t.message,t.stack)}}function zr(t,e,i){e&&(i=void 0!==i?i:Pt.assetManager.cacheAsset,re(e)||!i||e.isDefault||ne.add(t,e))}function Vr(t,e,i){var n=!1,r=Qn.get(e);if(r){for(var s=0,o=r.length;s<o;s++){var a=r[s],u=i[a.uuid+"@import"];if(u)a.owner[a.prop]=u.addRef();else{if(l(16350,a.uuid),Pt.assetManager.dispatchAssetMissing(e,a.owner,a.prop,a.uuid),a.type&&a.type!==Jt){var h=new a.type;h.initDefault(a.uuid),a.owner[a.prop]=h}n=!0}}Qn.delete(e)}return $n.has(e)&&(i[t+"@native"]?e._nativeAsset=i[t+"@native"]:(n=!0,l(16351,t)),$n.delete(e)),n}function jr(t){var e=t.source;if(t.options.__outputAsArray__||1!==e.length)for(var i=t.output=[],n=0,r=e.length;n<r;n++)i.push(e[n].content);else t.output=e[0].content}function Wr(t,e,i){var n=0,r=[],s=t.length;0===s&&i&&i(r);for(var o=function(t){t&&r.push(t),++n===s&&i&&i(r)},a=0;a<s;a++)e(t[a],o)}function Xr(t,e,i){var n=t,r=e,s=i;if(void 0===i){var o="function"==typeof t;e?(s=e,o||(r=null)):void 0===e&&o&&(s=t,n=null,r=null),void 0!==e&&o&&(r=t,n=null)}return{options:n||Object.create(null),onProgress:r,onComplete:s}}function qr(t,e,i){var n=t,r=e,s=i;if(void 0===i){var o=T(t,Jt);e?(s=e,o&&(r=null)):void 0!==e||o||(s=t,r=null,n=null),void 0===e||o||(r=t,n=null)}return{type:n,onProgress:r||Nr,onComplete:s}}function Kr(t,e,i,n){if(void 0===n&&(n={}),!i[e]||n[e])return!1;n[e]=!0;var r=!1,s=nr.getDeps(e);if(s)for(var o=0,a=s.length;o<a;o++){var u=s[o];if(u===t||Kr(t,u,i,n)){r=!0;break}}return r}function Yr(t){return function(e,i){if(t){var n=[];Array.isArray(i)?i.forEach((function(t){return t instanceof Jt&&n.push(t.addRef())})):i instanceof Jt&&n.push(i.addRef()),L((function(){n.forEach((function(t){return t.decRef(!1)})),t(e,i)}))}}}var Jr=function(){function t(){this._config=new Sr}var e=t.prototype;return e.getInfoWithPath=function(t,e){return this._config.getInfoWithPath(t,e)},e.getDirWithPath=function(t,e,i){return this._config.getDirWithPath(t,e,i)},e.getAssetInfo=function(t){return this._config.getAssetInfo(t)},e.getSceneInfo=function(t){return this._config.getSceneInfo(t)},e.init=function(t){this._config.init(t),se.add(t.name,this)},e.load=function(t,e,i,n){var r=qr(e,i,n),s=r.type,o=r.onProgress,a=r.onComplete,u={__requestType__:oe.PATH,type:s,bundle:this.name,__outputAsArray__:Array.isArray(t)};Pt.assetManager.loadAny(t,u,o,a)},e.preload=function(t,e,i,n){var r=qr(e,i,n),s=r.type,o=r.onProgress,a=r.onComplete;Pt.assetManager.preloadAny(t,{__requestType__:oe.PATH,type:s,bundle:this.name},o,a)},e.loadDir=function(t,e,i,n){var r=qr(e,i,n),s=r.type,o=r.onProgress,a=r.onComplete;Pt.assetManager.loadAny(t,{__requestType__:oe.DIR,type:s,bundle:this.name,__outputAsArray__:!0},o,a)},e.preloadDir=function(t,e,i,n){var r=qr(e,i,n),s=r.type,o=r.onProgress,a=r.onComplete;Pt.assetManager.preloadAny(t,{__requestType__:oe.DIR,type:s,bundle:this.name},o,a)},e.loadScene=function(t,e,i,n){var r=Xr(e,i,n),s=r.options,o=r.onProgress,a=r.onComplete;s.preset=s.preset||"scene",s.bundle=this.name,Pt.assetManager.loadAny({scene:t},s,o,(function(t,e){if(t)b(t.message,t.stack);else if(e.scene){var i=e.scene;i.id=e._uuid,i.name=e.name}else t=new Error("The asset "+e._uuid+" is not a scene");a&&a(t,e)}))},e.preloadScene=function(t,e,i,n){var r=Xr(e,i,n),s=r.options,o=r.onProgress,a=r.onComplete;s.bundle=this.name,Pt.assetManager.preloadAny({scene:t},s,o,(function(e){e&&l(1210,t,e.message),a&&a(e)}))},e.get=function(t,e){var i=this.getInfoWithPath(t,e);return i&&ne.get(i.uuid)||null},e.release=function(t,e){var i=this.get(t,e);i&&Br.tryRelease(i,!0)},e.releaseUnusedAssets=function(){var t=this;ne.forEach((function(e){var i=t.getAssetInfo(e._uuid);i&&!i.redirect&&Br.tryRelease(e)}))},e.releaseAll=function(){var t=this;ne.forEach((function(e){var i=t.getAssetInfo(e._uuid);i&&!i.redirect&&Br.tryRelease(e,!0)}))},e._destroy=function(){this._config.destroy()},u(t,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),t}(),Qr=t("ak",new Jr);function $r(t,e,i){var n=new Mt.Image;function r(){n.removeEventListener("load",r),n.removeEventListener("error",s),i&&i(null,n)}function s(){n.removeEventListener("load",r),n.removeEventListener("error",s),i&&i(new Error(d(4930,t)))}return("file:"!==Mt.location.protocol||Dt)&&(n.crossOrigin="anonymous"),n.addEventListener("load",r),n.addEventListener("error",s),n.src=t,n}function Zr(t,e,i,n){var r=new XMLHttpRequest,s="download failed: "+t+", status: ";if(r.open("GET",t,!0),void 0!==e.xhrResponseType&&(r.responseType=e.xhrResponseType),void 0!==e.xhrWithCredentials&&(r.withCredentials=e.xhrWithCredentials),void 0!==e.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(e.xhrMimeType),void 0!==e.xhrTimeout&&(r.timeout=e.xhrTimeout),e.xhrHeader)for(var o in e.xhrHeader)r.setRequestHeader(o,e.xhrHeader[o]);return r.onload=function(){200===r.status||0===r.status?n&&n(null,r.response):n&&n(new Error(""+s+r.status+"(no response)"))},i&&(r.onprogress=function(t){t.lengthComputable&&i(t.loaded,t.total)}),r.onerror=function(){n&&n(new Error(""+s+r.status+"(error)"))},r.ontimeout=function(){n&&n(new Error(""+s+r.status+"(time out)"))},r.onabort=function(){n&&n(new Error(""+s+r.status+"(abort)"))},r.send(null),r}Pt.resources=Qr;var ts=Mt.document,es={};function is(t,e,i){if(es[t])return i&&i(null),null;var n=ts.createElement("script");function r(){n.parentNode.removeChild(n),n.removeEventListener("load",r,!1),n.removeEventListener("error",s,!1),es[t]=!0,i&&i(null)}function s(){n.parentNode.removeChild(n),n.removeEventListener("load",r,!1),n.removeEventListener("error",s,!1),i&&i(new Error(d(4928,t)))}return"file:"!==Mt.location.protocol&&(n.crossOrigin="anonymous"),n.async=e.scriptAsyncLoading||!1,n.src=t,n.addEventListener("load",r,!1),n.addEventListener("error",s,!1),ts.body.appendChild(n),n}var ns=/^(?:\w+:\/\/|\.+\/).+/,rs=function(t,e,i){(et.hasFeature(et.Feature.IMAGE_BITMAP)&&Pt.assetManager.allowImageBitmap?ss:$r)(t,e,i)},ss=function(t,e,i){e.xhrResponseType="blob",Zr(t,e,e.onFileProgress,i)},os=function(t,e,i){e.xhrResponseType="json",Zr(t,e,e.onFileProgress,i)},as=function(t,e,i){e.xhrResponseType="arraybuffer",Zr(t,e,e.onFileProgress,i)},us=function(t,e,i){var n=function(t,e){try{e(null,en(new Uint8Array(t)))}catch(t){e(t)}};ms._downloadArrayBuffer(t.replace(".cconb",".bin"),e,(function(r,s){r?ms._downloadArrayBuffer(t,e,(function(t,e){t?i(t):n(e,i)})):n(s,i)}))},hs=function(t,e,i){e.xhrResponseType="text",Zr(t,e,e.onFileProgress,i)},fs=function(t,e,i){var n=ae(t),r=t;ns.test(r)||(r=-1!==ms.remoteBundles.indexOf(n)?ms.remoteServerAddress+"remote/"+n:"assets/"+n);var s=e.version||ms.bundleVers[n],o=0,a=null,u=null;os(r+"/config."+(s?s+".":"")+"json",e,(function(t,e){u=t||u,(a=e)&&(a.base=r+"/"),2==++o&&i(u,a)})),is(r+"/index."+(s?s+".":"")+"js",e,(function(t){u=t||u,2==++o&&i(u,a)}))},ls=function(){var t=e.prototype;function e(){this.maxConcurrency=15,this.maxRequestsPerFrame=15,this.maxRetryCount=3,this.appendTimeStamp=!!St,this.limited=!Ct,this.retryInterval=2e3,this.bundleVers={},this.remoteBundles=[],this.downloadDomImage=$r,this.downloadDomAudio=null,this.downloadFile=Zr,this.downloadScript=is,this._downloadArrayBuffer=as,this._downloadJson=os,this._downloaders={".png":rs,".jpg":rs,".bmp":rs,".jpeg":rs,".gif":rs,".ico":rs,".tiff":rs,".webp":rs,".image":rs,".pvr":as,".pkm":as,".astc":as,".txt":hs,".xml":hs,".vsh":hs,".fsh":hs,".atlas":hs,".tmx":hs,".tsx":hs,".json":os,".ExportJson":os,".plist":hs,".cconb":us,".fnt":hs,".binary":as,".bin":as,".dbbin":as,".skel":as,".js":is,bundle:fs,default:hs},this._downloading=new ee,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}return t.init=function(t,e,i){void 0===t&&(t=""),void 0===e&&(e={}),void 0===i&&(i=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=t,this.bundleVers=e,this.remoteBundles=i},t.register=function(t,e){"object"==typeof t?O(this._downloaders,t):this._downloaders[t]=e},t.download=function(t,e,i,n,r){var s=this,o=te.get(t);if(o)r(null,o);else{var a=this._downloading.get(t);if(a){a.push(r);var u=this._queue.find((function(e){return e.id===t}));if(!u)return;var h=n.priority||0;u.priority<h&&(u.priority=h,this._queueDirty=!0)}else{var f=void 0!==n.maxRetryCount?n.maxRetryCount:this.maxRetryCount,l=void 0!==n.maxConcurrency?n.maxConcurrency:this.maxConcurrency,c=void 0!==n.maxRequestsPerFrame?n.maxRequestsPerFrame:this.maxRequestsPerFrame,p=this._downloaders[i]||this._downloaders.default;Hr((function(i,o){if(0===i&&s._downloading.add(t,[r]),s.limited){s._updateTime();var a=function(t,e){s._totalNum--,s._handleQueueInNextFrame(l,c),o(t,e)};s._totalNum<l&&s._totalNumThisPeriod<c?(p(Ur(e,s.appendTimeStamp),n,a),s._totalNum++,s._totalNumThisPeriod++):(s._queue.push({id:t,priority:n.priority||0,url:e,options:n,done:a,handler:p}),s._queueDirty=!0,s._totalNum<l&&s._handleQueueInNextFrame(l,c))}else p(Ur(e,s.appendTimeStamp),n,o)}),f,this.retryInterval,(function(e,i){e||te.add(t,i);for(var n=s._downloading.remove(t),r=0,o=n.length;r<o;r++)n[r](e,i)}))}}},t.loadSubpackage=function(t,e){Pt.assetManager.loadBundle(t,null,e)},t._updateTime=function(){var t=performance.now(),e=Pt.game.deltaTime,i=e>this._maxInterval?this._maxInterval:e;t-this._lastDate>1e3*i&&(this._totalNumThisPeriod=0,this._lastDate=t)},t._handleQueue=function(t,e){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<t&&this._totalNumThisPeriod<e;){this._queueDirty&&(this._queue.sort((function(t,e){return t.priority-e.priority})),this._queueDirty=!1);var i=this._queue.pop();if(!i)break;this._totalNum++,this._totalNumThisPeriod++,i.handler(Ur(i.url,this.appendTimeStamp),i.options,i.done)}this._handleQueueInNextFrame(t,e)},t._handleQueueInNextFrame=function(t,e){!this._checkNextPeriod&&this._queue.length>0&&(L(this._handleQueue.bind(this),t,e),this._checkNextPeriod=!0)},u(e,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}},{key:"handlers",get:function(){return this._downloaders}}],[{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}]),e}();ls._instance=void 0;var cs,ps,_s,ds,gs,vs,ms=ls.instance,ys=t("m",ls.instance),bs=t("ah",tt("cc.JsonAsset")((ps=function(t){function e(e){var i;return(i=t.call(this,e)||this).json=_s&&_s(),i}return n(e,t),e}(Jt),_s=nt(ps.prototype,"json",[rt],(function(){return null})),cs=ps))||cs);Pt.JsonAsset=bs;var As,Ts,Is=t("ag",tt("cc.TextAsset")((gs=function(t){function e(e){var i;return(i=t.call(this,e)||this).text=vs&&vs(),i}return n(e,t),e.prototype.toString=function(){return this.text},e}(Jt),vs=nt(gs.prototype,"text",[rt],(function(){return""})),ds=gs))||ds);Pt.TextAsset=Is;var Rs=t("af",tt("cc.BufferAsset")((Ts=function(t){function e(e){var i;return(i=t.call(this,e)||this)._buffer=null,i}n(e,t);var i=e.prototype;return i.buffer=function(){return x(this._buffer),this._buffer},i.validate=function(){return!!this._buffer},u(e,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(t){t instanceof ArrayBuffer?this._buffer=t:this._buffer=t.buffer}}]),e}(Jt),h(Ts.prototype,"_nativeAsset",[it],Object.getOwnPropertyDescriptor(Ts.prototype,"_nativeAsset"),Ts.prototype),As=Ts))||As);function ws(t,e,i,n){var r=null,s=null;try{(r=new Vi)._nativeUrl=t,r._nativeAsset=e}catch(t){s=t}n(s,r)}function Es(t,e,i,n){var r=new bs;r.json=e,n(null,r)}function Ds(t,e,i,n){var r=new Is;r.text=e,n(null,r)}function Ss(t,e,i,n){var r=new Rs;r._nativeUrl=t,r._nativeAsset=e,n(null,r)}function Cs(t,e,i,n){var r=new Jt;r._nativeUrl=t,r._nativeAsset=e,n(null,r)}function xs(t,i,n,r){var s=se.get(i.name);s||(s=i.name===ue.RESOURCES?Qr:new Jr,i.base=i.base||t+"/",s.init(i)),e.import("virtual:///prerequisite-imports/"+s.name).then((function(){r(null,s)})).catch(r)}Pt.BufferAsset=Rs;var Ms=function(){function t(){this._creating=new ee,this._producers={".png":ws,".jpg":ws,".bmp":ws,".jpeg":ws,".gif":ws,".ico":ws,".tiff":ws,".webp":ws,".image":ws,".pvr":ws,".pkm":ws,".astc":ws,".txt":Ds,".xml":Ds,".vsh":Ds,".fsh":Ds,".atlas":Ds,".tmx":Ds,".tsx":Ds,".fnt":Ds,".json":Es,".ExportJson":Es,".binary":Ss,".bin":Ss,".dbbin":Ss,".skel":Ss,bundle:xs,default:Cs}}var e=t.prototype;return e.register=function(t,e){"object"==typeof t?O(this._producers,t):this._producers[t]=e},e.create=function(t,e,i,n,r){var s=this,o=this._producers[i]||this._producers.default,a=ne.get(t);if(n.reloadAsset||!a){var u=this._creating.get(t);u?u.push(r):(this._creating.add(t,[r]),o(t,e,n,(function(e,i){!e&&i instanceof Jt&&(i._uuid=t,zr(t,i,n.cacheAsset));for(var r=s._creating.remove(t),o=0,a=r.length;o<a;o++)r[o](e,i)})))}else r(null,a)},t}(),Ps=t("n",new Ms),Ls=!0;function ks(t){var e=new DataView(t,0,t.byteLength);if("BINP"!==String.fromCharCode.apply(String,new Uint8Array(t.slice(0,4))))throw new Error("Invalid bin package format");var i=e.getUint32(4,Ls);if(2!==i)return Os(t,e,i);for(var n=e.getUint32(8,Ls),r=[],s=4*(3+2*n),o=0;o<n;o++){var a=e.getUint32(4*(3+2*o),Ls)+s,u=e.getUint32(4*(4+2*o),Ls);r.push({offset:a,size:u})}return r.map((function(e){var i=e.offset,n=e.size;return new Uint8Array(t,i,n)}))}function Os(t,e,i){return{1:Bs}[i](t,e)}function Bs(t,e){for(var i=e.getUint32(8,Ls),n=[],r=4*(3+i),s=0;s<i;s++){var o=e.getUint32(4*(3+s),Ls);n.push({offset:r,size:o}),r+=o}return n.map((function(e){var i=e.offset,n=e.size;return new Uint8Array(t,i,n)}))}var Ns=function(){function t(){this._loading=new ee,this._unpackers={".json":this.unpackJson,".bin":this.unpackBin}}var e=t.prototype;return e.unpackJson=function(t,e,i,n){var r=B(!0),s=null;if(Array.isArray(e)){(e=Kn(e)).length!==t.length&&l(4915);for(var o=0;o<t.length;o++)r[t[o]+"@import"]=e[o]}else{var a=R(Ir),u=R(Vi);if(e.type===a&&e.data){var h=e.data;h.length!==t.length&&l(4915);for(var f=0;f<t.length;f++)r[t[f]+"@import"]=Yn(a,{base:h[f][0],mipmaps:h[f][1]})}else{if(e.type!==u||!e.data)return void n(s=new Error("unmatched type pack!"),null);var c=e.data;c.length!==t.length&&l(4915);for(var p=0;p<t.length;p++)r[t[p]+"@import"]=c[p]}}n(s,r)},e.unpackBin=function(t,e,i,n){var r=B(!0),s=null;try{var o=ks(e);t.forEach((function(t,e){return r[t+"@import"]=en(o[e])}))}catch(t){s=t}n(s,r)},e.init=function(){this._loading.clear()},e.register=function(t,e){"object"==typeof t?O(this._unpackers,t):this._unpackers[t]=e},e.unpack=function(t,e,i,n,r){e?(0,this._unpackers[i])(t,e,n,r):r(new Error("package data is wrong!"))},e.load=function(t,e,i){var n=this;if(!t.isNative&&t.info&&t.info.packs)if(te.has(t.id))i(null,te.get(t.id));else{var r=t.info.packs,s=r.find((function(t){return n._loading.has(t.uuid)}));if(s){var o=this._loading.get(s.uuid);return m(o),void o.push({onComplete:i,id:t.id})}var a=r[0];this._loading.add(a.uuid,[{onComplete:i,id:t.id}]),m(t.config);var u=he(a.uuid,{ext:a.ext,bundle:t.config.name}),h=function(e,i){te.remove(a.uuid),e&&b(e.message,e.stack),n.unpack(a.packedUuids,i,a.ext,t.options,(function(t,i){if(!t)for(var r in i)te.add(r,i[r]);var s=n._loading.remove(a.uuid);m(s);for(var o=0,u=s.length;o<u;o++){var h=s[o];if(e||t)h.onComplete(e||t);else{var f=i[h.id];f?h.onComplete(null,f):h.onComplete(new Error("can not retrieve data from package"))}}}))};".bin"===a.ext?ys._downloadArrayBuffer(u,t.options,h):".json"===a.ext?ys.download(a.uuid,u,a.ext,t.options,h):l(4916,a.ext)}else ys.download(t.id,t.url,t.ext,t.options,i)},t}(),Fs=new Ns;function Us(t,e){var i=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},i=!0);var n=t.options,r=t.progress,s=[],o=r.total,a=n.__exclude__=n.__exclude__||Object.create(null);t.output=[],Wr(t.input,(function(n,u){if(!n.isNative&&ne.has(n.uuid)){var h=ne.get(n.uuid);return n.content=h.addRef(),t.output.push(n),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,n),void u()}Fs.load(n,t.options,(function(h,f){h?t.isFinished||(!Pt.assetManager.force||i?(b(h.message,h.stack),r.canInvoke=!1,e(h)):(t.output.push(n),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,n))):t.isFinished||(n.file=f,t.output.push(n),n.isNative||(a[n.uuid]=!0,Gr(n.uuid,f,a,s,n.config),r.total=o+s.length),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,n)),u()}))}),(function(){if(t.isFinished)return Fr(t),void t.dispatch("error");if(s.length>0){var o=fe.create({input:s,progress:r,options:n,onProgress:t.onProgress,onError:fe.prototype.recycle,onComplete:function(n){var r;n||((r=t.output).push.apply(r,o.output),o.recycle()),i&&Hs(t),e(n)}});le.async(o)}else i&&Hs(t),e()}))}function Hs(t){for(var e=t.output,i=0,n=e.length;i<n;i++)e[i].content&&e[i].content.decRef(!1)}var Gs=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var i=e.prototype;return i.parse=function(t){var e=this._parseXML(t).documentElement;if("plist"!==e.tagName)return a(5100),{};for(var i=null,n=0,r=e.childNodes.length;n<r&&1!==(i=e.childNodes[n]).nodeType;n++);return this._parseNode(i)},i._parseNode=function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].nodeValue}else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));return e},i._parseArray=function(t){for(var e=[],i=0,n=t.childNodes.length;i<n;i++){var r=t.childNodes[i];1===r.nodeType&&e.push(this._parseNode(r))}return e},i._parseDict=function(t){for(var e={},i="",n=0,r=t.childNodes.length;n<r;n++){var s=t.childNodes[n];1===s.nodeType&&("key"===s.tagName?i=s.firstChild.nodeValue:e[i]=this._parseNode(s))}return e},e}(t("am",function(){function t(){this._parser=null,globalThis.DOMParser&&(this._parser=new DOMParser)}var e=t.prototype;return e.parse=function(t){return this._parseXML(t)},e._parseXML=function(t){if(this._parser)return this._parser.parseFromString(t,"text/xml");throw new Error("Dom parser is not supported in this platform!")},t}())),zs=new Gs,Vs=function(){function t(){this._parsing=new ee,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".plist":this.parsePlist,import:this.parseImport,".ccon":this.parseImport,".cconb":this.parseImport}}var e=t.prototype;return e.parseImage=function(t,e,i){t instanceof HTMLImageElement?i(null,t):createImageBitmap(t,{premultiplyAlpha:"none"}).then((function(t){i(null,t)}),(function(t){i(t,null)}))},e.parsePVRTex=function(t,e,i){var n=null,r=null;try{r=Vi.parseCompressedTextures(t,0)}catch(t){s(n=t)}i(n,r)},e.parsePKMTex=function(t,e,i){var n=null,r=null;try{r=Vi.parseCompressedTextures(t,1)}catch(t){s(n=t)}i(n,r)},e.parseASTCTex=function(t,e,i){var n=null,r=null;try{r=Vi.parseCompressedTextures(t,2)}catch(t){s(n=t)}i(n,r)},e.parsePlist=function(t,e,i){var n=null,r=zs.parse(t);r||(n=new Error("parse failed")),i(n,r)},e.parseImport=function(t,e,i){if(t){var n=null,r=null;try{n=tr(t,e)}catch(t){r=t}i(r,n)}else i(new Error(d(3702,e.__uuid__)))},e.init=function(){this._parsing.clear()},e.register=function(t,e){"object"==typeof t?O(this._parsers,t):this._parsers[t]=e},e.parse=function(t,e,i,n,r){var s=this,o=Zt.get(t);if(o)r(null,o);else{var a=this._parsing.get(t);if(a)a.push(r);else{var u=this._parsers[i];u?(this._parsing.add(t,[r]),u(e,n,(function(e,i){e?te.remove(t):re(i)||Zt.add(t,i);for(var n=s._parsing.remove(t),r=0,o=n.length;r<o;r++)n[r](e,i)}))):r(null,e)}}},u(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}();Vs._instance=void 0;var js=t("ao",Vs.instance);function Ws(t,e){var i=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},i=!0);var n=t.options,r=t.progress;n.__exclude__=n.__exclude__||Object.create(null),t.output=[],Wr(t.input,(function(s,o){var a=fe.create({input:s,onProgress:t.onProgress,options:n,progress:r,onComplete:function(n,u){n&&!t.isFinished&&(!Pt.assetManager.force||i?(b(n.message,n.stack),r.canInvoke=!1,e(n)):r.canInvoke&&t.dispatch("progress",++r.finish,r.total,s)),t.output.push(u),a.recycle(),o(null)}});Xs.async(a)}),(function(){if(n.__exclude__=null,t.isFinished)return Fr(t),void t.dispatch("error");jr(t),Fr(t),e()}))}var Xs=new ce("loadOneAsset",[function(t,e){var i=t.output=t.input,n=i.options,r=i.isNative,s=i.uuid,o=i.file,a=n.reloadAsset;o||!a&&!r&&ne.has(s)?e():Fs.load(i,t.options,(function(t,n){i.file=n,e(t)}))},function(t,e){var i=t.output=t.input,n=t.progress,r=t.options.__exclude__,s=i.id,o=i.file,a=i.options;if(i.isNative)js.parse(s,o,i.ext,a,(function(r,o){r?e(r):(i.content=o,n.canInvoke&&t.dispatch("progress",++n.finish,n.total,i),te.remove(s),Zt.remove(s),e())}));else{var u=i.uuid;if(u in r){var h=r[u],f=h.finish,l=h.content,c=h.err,p=h.callbacks;n.canInvoke&&t.dispatch("progress",++n.finish,n.total,i),f||Kr(u,u,r)?(l&&l.addRef(),i.content=l,e(c)):p.push({done:e,item:i})}else if(!a.reloadAsset&&ne.has(u)){var _=ne.get(u);i.content=_.addRef(),n.canInvoke&&t.dispatch("progress",++n.finish,n.total,i),e()}else a.__uuid__=u,js.parse(s,o,"import",a,(function(i,n){i?e(i):qs(t,n,e)}))}}]);function qs(t,e,i){var n=t.input,s=t.progress,o=n,a=o.uuid,u=o.id,h=o.options,f=o.config,c=h.cacheAsset,p=[];e.addRef&&e.addRef(),Gr(a,e,Object.create(null),p,f),s.canInvoke&&t.dispatch("progress",++s.finish,s.total+=p.length,n);var _=t.options.__exclude__[a]={content:e,finish:!1,callbacks:[{done:i,item:n}]},d=fe.create({input:p,options:t.options,onProgress:t.onProgress,onError:fe.prototype.recycle,progress:s,onComplete:function(t){if(e.decRef&&e.decRef(!1),_.finish=!0,_.err=t,!t){for(var i,n=Array.isArray(d.output)?d.output:[d.output],s=Object.create(null),o=r(n);!(i=o()).done;){var h=i.value;h&&(s[h instanceof Jt?h._uuid+"@import":a+"@native"]=h)}Vr(a,e,s);try{"function"!=typeof e.onLoaded||Zn.has(e)||$n.has(e)||(e.onLoaded(),Zn.add(e))}catch(t){l(16352,a,t.message,t.stack)}te.remove(u),Zt.remove(u),zr(a,e,c),d.recycle()}for(var f=_.callbacks,p=0,g=f.length;p<g;p++){var v=f[p];e.addRef&&e.addRef(),v.item.content=e,v.done(t)}f.length=0}});pe.async(d)}function Ks(t,e){var i=t.options,n=Object.create(null),r=Object.create(null);for(var s in i)switch(s){case oe.PATH:case oe.UUID:case oe.DIR:case oe.SCENE:case oe.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":n[s]=i[s];break;case"__exclude__":case"__outputAsArray__":r[s]=i[s];break;default:n[s]=i[s],r[s]=i[s]}t.options=r;var o=fe.create({input:t.input,options:n}),a=null;try{t.output=t.source=_e.sync(o)}catch(t){a=t;for(var u=0,h=o.output.length;u<h;u++)o.output[u].recycle()}o.recycle(),e(a)}var Ys=function(){function t(){this.uuid="",this.overrideUuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return t.create=function(){return 0!==t._deadPool.length?t._deadPool.pop():new t},t.prototype.recycle=function(){t._deadPool.length!==t.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.overrideUuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),t._deadPool.push(this))},u(t,[{key:"id",get:function(){return this._id||(this._id=(this.overrideUuid||this.uuid)+"@"+(this.isNative?"native":"import")),this._id}}]),t}();Ys.MAX_DEAD_NUM=500,Ys._deadPool=[];var Js=[];function Qs(t){var e=t.options,i=Array.isArray(t.input)?t.input:[t.input];t.output=[];for(var n=function(){var n=i[s],o=Ys.create(),a=null,u=null;if("string"==typeof n&&((n=Object.create(null))[e.__requestType__||oe.UUID]=i[s]),"object"==typeof n){N(n,e),n.preset&&N(n,de[n.preset]);var h=function(){var t;switch(f){case oe.UUID:var e,s=o.uuid=$t(n.uuid);if(!n.bundle){var h=se.find((function(t){return!!t.getAssetInfo(s)}));n.bundle=h&&h.name}if(se.has(n.bundle)){if(a=se.get(n.bundle).config,(u=a.getAssetInfo(s))&&u.redirect){if(!se.has(u.redirect))throw new Error("Please load bundle "+u.redirect+" first");a=se.get(u.redirect).config,u=a.getAssetInfo(s)}o.config=a,o.info=u}o.ext=n.ext||(null==(e=u)?void 0:e.extension)||".json";break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case oe.DIR:if(se.has(n.bundle)){se.get(n.bundle).config.getDirWithPath(n.dir,n.type,Js);for(var l,c=r(Js);!(l=c()).done;){var p=l.value;i.push({uuid:p.uuid,__isNative__:!1,ext:p.extension||".json",bundle:n.bundle})}Js.length=0}o.recycle(),o=null;break;case oe.PATH:if(se.has(n.bundle)){if(a=se.get(n.bundle).config,(u=a.getInfoWithPath(n.path,n.type))&&u.redirect){if(!se.has(u.redirect))throw new Error("you need to load bundle "+u.redirect+" first");a=se.get(u.redirect).config,u=a.getAssetInfo(u.uuid)}if(!u)throw o.recycle(),new Error("Bundle "+n.bundle+" doesn't contain "+n.path);o.config=a,o.uuid=u.uuid,o.info=u}o.ext=n.ext||(null==(t=u)?void 0:t.extension)||".json";break;case oe.SCENE:if(!n.bundle){var _=se.find((function(t){return!!t.getSceneInfo(n.scene)}));n.bundle=_&&_.name}if(se.has(n.bundle)){if(a=se.get(n.bundle).config,(u=a.getSceneInfo(n.scene))&&u.redirect){if(!se.has(u.redirect))throw new Error("you need to load bundle "+u.redirect+" first");a=se.get(u.redirect).config,u=a.getAssetInfo(u.uuid)}if(!u)throw o.recycle(),new Error("Bundle "+a.name+" doesn't contain scene "+n.scene);o.config=a,o.uuid=u.uuid,o.info=u}break;case"__isNative__":o.isNative=n.__isNative__;break;case oe.URL:o.url=n.url,o.uuid=n.uuid||n.url,o.ext=n.ext||ve(n.url),o.isNative=void 0===n.__isNative__||n.__isNative__;break;default:o.options[f]=n[f]}if(!o)return 1};for(var f in n)if(h())break}if(!o)return 1;if(t.output.push(o),!o.uuid&&!o.url)throw new Error("Can not parse this input:"+JSON.stringify(n))},s=0;s<i.length;s++)n();return null}function $s(t){for(var e=t.output=t.input,i=function(){var t=e[n];if(ge.has(t.uuid)){var i=ge.get(t.uuid),r=se.find((function(t){return!!t.getAssetInfo(i)}));if(r){var s;t.overrideUuid=i;var o=r.config,u=o.getAssetInfo(i);if(u&&u.redirect){if(!se.has(u.redirect))throw new Error("Please load bundle "+u.redirect+" first");u=(o=se.get(u.redirect).config).getAssetInfo(i)}t.config=o,t.info=u,t.ext=t.isNative?t.ext:(null==(s=u)?void 0:s.extension)||".json"}else a(16201,i,t.uuid)}},n=0;n<e.length;n++)i()}function Zs(t){for(var e=t.output=t.input,i=0;i<e.length;i++){var n=e[i];if(!n.url){var r,s,o=n.config;s=n.isNative?o&&o.nativeBase?o.base+o.nativeBase:Pt.assetManager.generalNativeBase:o&&o.importBase?o.base+o.importBase:Pt.assetManager.generalImportBase;var a=n.overrideUuid||n.uuid,u="";n.info&&(u=n.isNative?n.info.nativeVer?"."+n.info.nativeVer:"":n.info.ver?"."+n.info.ver:""),r=".ttf"===n.ext?s+"/"+a.slice(0,2)+"/"+a+u+"/"+n.options.__nativeName__:s+"/"+a.slice(0,2)+"/"+a+u+n.ext,n.url=r}}return null}var to=F.querySettings.bind(F),eo=U.ASSETS,io="asset-missing",no=t("aj",function(){function t(){this.pipeline=pe.append(Ks).append(Ws),this.fetchPipeline=le.append(Ks).append(Us),this.transformPipeline=_e.append(Qs).append($s).append(Zs),this.bundles=se,this.assets=ne,this.assetsOverrideMap=ge,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=nr,this.force=xt,this.allowImageBitmap=!1,this.utils=me,this.downloader=ys,this.parser=js,this.packManager=Fs,this.cacheAsset=!0,this.cacheManager=null,this.presets=de,this.factory=Ps,this.preprocessPipe=Ks,this.fetchPipe=Us,this.loadPipe=Ws,this.references=ye,this._releaseManager=Br,this._files=te,this._parsed=Zt,this._parsePipeline=null,this._projectBundles=[],this._eventTarget=new H}var e=t.prototype;return e.getReleaseManager=function(){return this._releaseManager},e.onAssetMissing=function(t,e){this._eventTarget.on(io,t,e)},e.offAssetMissing=function(t,e){this._eventTarget.off(io,t,e)},e.dispatchAssetMissing=function(t,e,i,n){this._eventTarget.emit(io,t,e,i,n)},e.init=function(t){void 0===t&&(t={});var e=t.server||to(eo,"server")||"",i=t.bundleVers||to(eo,"bundleVers")||{},n=t.remoteBundles||to(eo,"remoteBundles")||[],r=t.downloadMaxConcurrency||to(eo,"downloadMaxConcurrency");r&&r>0&&(this.downloader.maxConcurrency=r),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(e,i,n),this.parser.init(),this.dependUtil.init();var s=t.importBase||to(eo,"importBase")||"";s&&s.endsWith("/")&&(s=s.substring(0,s.length-1));var o=t.nativeBase||to(eo,"nativeBase")||"";o&&o.endsWith("/")&&(o=o.substring(0,o.length-1)),this.generalImportBase=s,this.generalNativeBase=o,this._projectBundles=to(eo,"projectBundles")||[];var a=to(eo,"assetsOverrides")||{};for(var u in a)this.assetsOverrideMap.set(u,a[u])},e.getBundle=function(t){return se.get(t)||null},e.removeBundle=function(t){t._destroy(),se.remove(t.name)},e.loadAny=function(t,e,i,n){var r=Xr(e,i,n),s=r.options,o=r.onProgress,a=r.onComplete;s.preset=s.preset||"default",t=Array.isArray(t)?t.slice():t;var u=fe.create({input:t,onProgress:o,onComplete:Yr(a),options:s});pe.async(u)},e.preloadAny=function(t,e,i,n){var r=Xr(e,i,n),s=r.options,o=r.onProgress,a=r.onComplete;s.preset=s.preset||"preload",t=Array.isArray(t)?t.slice():t;var u=fe.create({input:t,onProgress:o,onComplete:Yr(a),options:s});le.async(u)},e.loadRemote=function(t,e,i){var n=Xr(e,void 0,i),r=n.options,s=n.onComplete;r.reloadAsset||!this.assets.has(t)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:t},r,null,(function(e,i){e?(b(e.message,e.stack),s&&s(e,i)):Ps.create(t,i,r.ext||ve(t),r,(function(t,e){s&&s(t,e)}))}))):Yr(s)(null,this.assets.get(t))},e.loadBundle=function(t,e,i){var n=Xr(e,void 0,i),r=n.options,s=n.onComplete,o=ae(t);this.bundles.has(o)?Yr(s)(null,this.getBundle(o)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:t},r,null,(function(e,i){e?(b(e.message,e.stack),s&&s(e,i)):Ps.create(t,i,"bundle",r,(function(t,e){s&&s(t,e)}))})))},e.releaseAsset=function(t){Br.tryRelease(t,!0)},e.releaseUnusedAssets=function(){ne.forEach((function(t){Br.tryRelease(t)}))},e.releaseAll=function(){ne.forEach((function(t){Br.tryRelease(t,!0)}))},e.loadWithJson=function(){throw new Error("Only valid in Editor")},u(t,[{key:"files",get:function(){return this._files}},{key:"main",get:function(){return se.get(ue.MAIN)||null}},{key:"resources",get:function(){return se.get(ue.RESOURCES)||null}}],[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}());no._instance=void 0,no.Pipeline=ce,no.Task=fe,no.Cache=ee,no.RequestItem=Ys,no.Bundle=Jr,no.BuiltinBundleName=ue,no.CacheManager=function(){this.cacheDir=void 0,this.cacheEnabled=void 0,this.autoClear=void 0,this.cacheInterval=void 0,this.deleteInterval=void 0,this.cachedFiles=void 0},no.Downloader=ls,no.Parser=Vs,no.DependUtil=er;var ro=t("k",Pt.assetManager=no.instance);Pt.AssetManager=no;var so,oo,ao,uo,ho,fo=t("al",function(){function t(){this._resources={},this._materialsToBeCompiled=[]}var e=t.prototype;return e.init=function(){for(var t=this._resources,e=new Uint8Array(16),i=new Uint8Array(16),n=new Uint8Array(16),r=new Uint8Array(16),s=new Uint8Array(16),o=0,a=0;a<4;a++)e[o]=0,e[o+1]=0,e[o+2]=0,e[o+3]=255,i[o]=0,i[o+1]=0,i[o+2]=0,i[o+3]=0,n[o]=119,n[o+1]=119,n[o+2]=119,n[o+3]=255,r[o]=255,r[o+1]=255,r[o+2]=255,r[o+3]=255,s[o]=127,s[o+1]=127,s[o+2]=255,s[o+3]=255,o+=4;var u=new Uint8Array(1024);o=0;for(var h=0;h<256;h++)u[o]=221,u[o+1]=221,u[o+2]=221,u[o+3]=255,o+=4;o=0;for(var f=0;f<8;f++){for(var l=0;l<8;l++)u[o]=85,u[o+1]=85,u[o+2]=85,u[o+3]=255,o+=4;o+=32}o+=32;for(var c=0;c<8;c++){for(var p=0;p<8;p++)u[o]=85,u[o+1]=85,u[o+2]=85,u[o+3]=255,o+=4;o+=32}var _={width:2,height:2,_data:e,_compressed:!1,format:Ai.RGBA8888},d={width:2,height:2,_data:i,_compressed:!1,format:Ai.RGBA8888},g={width:2,height:2,_data:n,_compressed:!1,format:Ai.RGBA8888},v={width:2,height:2,_data:r,_compressed:!1,format:Ai.RGBA8888},m={width:2,height:2,_data:s,_compressed:!1,format:Ai.RGBA8888},y={width:16,height:16,_data:u,_compressed:!1,format:Ai.RGBA8888},b=new Vi(_),A=new Ir;A._uuid="black-texture",A.image=b,t[A._uuid]=A;var T=new Vi(d),I=new Ir;I._uuid="empty-texture",I.image=T,t[I._uuid]=I;var R=new Rr;R._uuid="black-cube-texture",R.setMipFilter(Ii.NEAREST),R.image={front:new Vi(_),back:new Vi(_),left:new Vi(_),right:new Vi(_),top:new Vi(_),bottom:new Vi(_)},t[R._uuid]=R;var w=new Vi(g),E=new Ir;E._uuid="grey-texture",E.image=w,t[E._uuid]=E;var D=new Rr;D._uuid="grey-cube-texture",D.setMipFilter(Ii.NEAREST),D.image={front:new Vi(g),back:new Vi(g),left:new Vi(g),right:new Vi(g),top:new Vi(g),bottom:new Vi(g)},t[D._uuid]=D;var S=new Vi(v),C=new Ir;C._uuid="white-texture",C.image=S,t[C._uuid]=C;var x=new Rr;x._uuid="white-cube-texture",x.setMipFilter(Ii.NEAREST),x.image={front:new Vi(v),back:new Vi(v),left:new Vi(v),right:new Vi(v),top:new Vi(v),bottom:new Vi(v)},t[x._uuid]=x;var M=new Vi(m),P=new Ir;P._uuid="normal-texture",P.image=M,t[P._uuid]=P;var L=new Vi(y),k=new Ir;k._uuid="default-texture",k.image=L,t[k._uuid]=k;var O=new Rr;if(O.setMipFilter(Ii.NEAREST),O._uuid="default-cube-texture",O.image={front:new Vi(y),back:new Vi(y),left:new Vi(y),right:new Vi(y),top:new Vi(y),bottom:new Vi(y)},t[O._uuid]=O,Pt.SpriteFrame){var B=new Pt.SpriteFrame,N=b,F=new Ir;F.image=N,B.texture=F,B._uuid="default-spriteframe",t[B._uuid]=B}},e.addAsset=function(t,e){this._resources[t]=e},e.get=function(t){return this._resources[t]},e.loadBuiltinAssets=function(){var t=this,e=F.querySettings(U.ENGINE,"builtinAssets");if(!e)return Promise.resolve();var i=this._resources;return new Promise((function(n,r){ro.loadBundle(ue.INTERNAL,(function(s){s?r(s):ro.loadAny(e,(function(e,s){e?r(e):(s.forEach((function(e){i[e.name]=e,Br.addIgnoredAsset(e),e instanceof Pt.Material&&t._materialsToBeCompiled.push(e)})),n())}))}))}))},e.compileBuiltinMaterial=function(){for(var t=0;t<this._materialsToBeCompiled.length;++t)for(var e=this._materialsToBeCompiled[t],i=0;i<e.passes.length;++i)e.passes[i].tryCompile();this._materialsToBeCompiled.length=0},t}()),lo=t("d",Pt.builtinResMgr=new fo),co=t("g",(so=new Map,oo=0,function(t){return"number"==typeof t?t:(so.has(t)||(so.set(t,1<<oo),oo++),so.get(t))})),po=4227858432,_o=66060288,go=1044480,vo=t("G",(function(t,e,i,n){return void 0===n&&(n=0),e<<26&po|t<<20&_o|i<<12&go|4095&n})),mo=t("R",(function(t){return(t&po)>>>26})),yo=t("H",(function(t){return(t&_o)>>>20})),bo=t("J",(function(t){return(t&go)>>>12})),Ao=t("O",(function(t){return 4095&t})),To=t("D",(function(t,e){return 67108863&t|e<<26&po})),Io=t("X",((ao={})[Ne.UNKNOWN]=function(t,e,i){return void 0===i&&(i=0),a(12010,i)},ao[Ne.INT]=function(t,e,i){return void 0===i&&(i=0),t[i]},ao[Ne.INT2]=function(t,e,i){return void 0===i&&(i=0),at.fromArray(e,t,i)},ao[Ne.INT3]=function(t,e,i){return void 0===i&&(i=0),ut.fromArray(e,t,i)},ao[Ne.INT4]=function(t,e,i){return void 0===i&&(i=0),ht.fromArray(e,t,i)},ao[Ne.FLOAT]=function(t,e,i){return void 0===i&&(i=0),t[i]},ao[Ne.FLOAT2]=function(t,e,i){return void 0===i&&(i=0),at.fromArray(e,t,i)},ao[Ne.FLOAT3]=function(t,e,i){return void 0===i&&(i=0),ut.fromArray(e,t,i)},ao[Ne.FLOAT4]=function(t,e,i){return void 0===i&&(i=0),ht.fromArray(e,t,i)},ao[Ne.MAT3]=function(t,e,i){return void 0===i&&(i=0),gt.fromArray(e,t,i)},ao[Ne.MAT4]=function(t,e,i){return void 0===i&&(i=0),_t.fromArray(e,t,i)},ao)),Ro=t("Z",((uo={})[Ne.UNKNOWN]=function(t,e,i){return void 0===i&&(i=0),a(12010,i)},uo[Ne.INT]=function(t,e,i){return void 0===i&&(i=0),t[i]=e},uo[Ne.INT2]=function(t,e,i){return void 0===i&&(i=0),at.toArray(t,e,i)},uo[Ne.INT3]=function(t,e,i){return void 0===i&&(i=0),ut.toArray(t,e,i)},uo[Ne.INT4]=function(t,e,i){return void 0===i&&(i=0),ht.toArray(t,e,i)},uo[Ne.FLOAT]=function(t,e,i){return void 0===i&&(i=0),t[i]=e},uo[Ne.FLOAT2]=function(t,e,i){return void 0===i&&(i=0),at.toArray(t,e,i)},uo[Ne.FLOAT3]=function(t,e,i){return void 0===i&&(i=0),ut.toArray(t,e,i)},uo[Ne.FLOAT4]=function(t,e,i){return void 0===i&&(i=0),ht.toArray(t,e,i)},uo[Ne.MAT3]=function(t,e,i){return void 0===i&&(i=0),gt.toArray(t,e,i)},uo[Ne.MAT4]=function(t,e,i){return void 0===i&&(i=0),_t.toArray(t,e,i)},uo)),wo=t("Y",((ho={})[Ne.INT]=function(t){return"number"==typeof t},ho[Ne.FLOAT]=function(t){return"number"==typeof t},ho[Ne.INT2]=function(t){return!!(t instanceof at)},ho[Ne.FLOAT2]=function(t){return!!(t instanceof at)},ho[Ne.INT3]=function(t){return!!(t instanceof ut)},ho[Ne.FLOAT3]=function(t){return!!(t instanceof ut)},ho[Ne.INT4]=function(t){return!!(t instanceof ht)},ho[Ne.FLOAT4]=function(t){return!!(t instanceof ht||t instanceof lt||t instanceof ft)},ho[Ne.MAT3]=function(t){return!!(t instanceof gt)},ho[Ne.MAT4]=function(t){return!!(t instanceof _t)},ho)),Eo=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function Do(t){switch(t){case Ne.BOOL:case Ne.INT:case Ne.UINT:case Ne.FLOAT:return Eo[0];case Ne.BOOL2:case Ne.INT2:case Ne.UINT2:case Ne.FLOAT2:return Eo[1];case Ne.BOOL4:case Ne.INT4:case Ne.UINT4:case Ne.FLOAT4:return Eo[2];case Ne.MAT4:return Eo[3];case Ne.SAMPLER2D:return"default-texture";case Ne.SAMPLER_CUBE:return"default-cube-texture";case Ne.SAMPLER2D_ARRAY:return"default-array-texture";case Ne.SAMPLER3D:return"default-3d-texture"}return Eo[0]}function So(t){switch(t){case Ne.SAMPLER2D:return"-texture";case Ne.SAMPLER_CUBE:return"-cube-texture";case Ne.SAMPLER2D_ARRAY:return"-array-texture";case Ne.SAMPLER3D:return"-3d-texture";default:return"-unknown"}}function Co(t,e){for(var i=Object.entries(e),n=!1,r=0;r<i.length;r++)t[i[r][0]]!==i[r][1]&&(t[i[r][0]]=i[r][1],n=!0);return n}function xo(t,e){switch(t.type){case"boolean":return"number"==typeof e?e.toString():e?"1":"0";case"string":return void 0!==e?e:t.options[0];case"number":return void 0!==e?e.toString():t.range[0].toString();default:return a(16369),"-1"}}function Mo(t,e){for(var i=[],n=0;n<e.length;n++){var r=e[n],s=r.name,o=t[s],a=xo(r,o),u=!o||"0"===o;i.push({name:s,value:a,isDefault:u})}return i}function Po(t,e){return t+e.reduce((function(t,e){return e.isDefault?t:t+"|"+e.name+e.value}),"")}function Lo(t,e){for(var i=0;i<t.length;i++){var n=t[i];if("!"===n[0]){if(e[n.slice(1)])return!1}else if(!e[n])return!1}return!0}function ko(t,e,i){for(var n=[],r=t.attributes,s=0;s<r.length;s++)Lo(r[s].defines,i)&&n.push(e[s]);return n}function Oo(t,e){var i=t.defines;if(t.uber){for(var n="",r=0;r<i.length;r++){var s=i[r],o=e[s.name];if(o&&s._map){var a=s._map(o);n+=""+s._offset+a+"|"}}return""+n+t.hash}for(var u=0,h=0;h<i.length;h++){var f=i[h],l=e[f.name];l&&f._map&&(u|=f._map(l)<<f._offset)}return u.toString(16)+"|"+t.hash}var Bo=new Map;function No(t,e){if(e.count)return t+Fe(e.type)*e.count;var i=Bo.get(e.name);return void 0!==i?t+Fe(e.type)*i:(l(16345,e.name),t)}function Fo(t){return t.reduce(No,0)}function Uo(t){for(var e={},i=0;i<t.blocks.length;i++)for(var n=t.blocks[i],r=n.members,s=0,o=0;o<r.length;o++){var a=r[o];e[a.name]=vo(n.binding,a.type,a.count,s),s+=(Fe(a.type)>>2)*a.count}for(var u=0;u<t.samplerTextures.length;u++){var h=t.samplerTextures[u];e[h.name]=vo(h.binding,h.type,h.count)}return e}function Ho(t){return Math.ceil(Math.log2(Math.max(t,2)))}function Go(t){for(var e=0,i=function(){var i=t.defines[n],r=1;if("number"===i.type){var s=i.range;r=Ho(s[1]-s[0]+1),i._map=function(t){return t-s[0]}}else"string"===i.type?(r=Ho(i.options.length),i._map=function(t){return Math.max(0,i.options.findIndex((function(e){return e===t})))}):"boolean"===i.type&&(i._map=function(t){return t?1:0});i._offset=e,e+=r},n=0;n<t.defines.length;n++)i();for(var r in e>31&&(t.uber=!0),t.constantMacros="",t.builtins.statistics)t.constantMacros+="#define "+r+" "+t.builtins.statistics[r]+"\n"}function zo(t){return Object.keys(t).reduce((function(e,i){return e.reduce((function(e,n){for(var r=t[i],s=0;s<r.length;++s){var o=C({},n);o[i]=r[s],e.push(o)}return e}),[])}),[{}])}function Vo(t){for(var e=0;e<t.techniques.length;e++)for(var i=t.techniques[e],n=0;n<i.passes.length;n++){var r=i.passes[n];void 0!==r.propertyIndex&&void 0===r.properties&&(r.properties=i.passes[r.propertyIndex].properties)}}Bo.set("cc_joints",kt.LAYOUT.members[0].count),Bo.set("cc_lightPos",Ot.LIGHTS_PER_PASS),Bo.set("cc_lightColor",Ot.LIGHTS_PER_PASS),Bo.set("cc_lightSizeRangeAngle",Ot.LIGHTS_PER_PASS),Bo.set("cc_lightDir",Ot.LIGHTS_PER_PASS),Bo.set("cc_lightBoundingSizeVS",Ot.LIGHTS_PER_PASS);var jo=new Ue;function Wo(t,e,i,n){for(var r=t.builtins[n],s=[],o=function(){var t=r.blocks[u],e=i.layouts[t.name],n=e&&i.bindings.find((function(t){return t.binding===e.binding}));if(!(e&&n&&n.descriptorType&ei))return a(16348,t.name),1;s.push(e)},u=0;u<r.blocks.length;u++)o();Array.prototype.unshift.apply(e.shaderInfo.blocks,s);for(var h=[],f=function(){var t=r.samplerTextures[_i],e=i.layouts[t.name],n=e&&i.bindings.find((function(t){return t.binding===e.binding}));if(!(e&&n&&n.descriptorType&ii))return a(16349,t.name),1;h.push(e)},l=0;l<r.samplerTextures.length;l++)f();Array.prototype.unshift.apply(e.shaderInfo.samplerTextures,h)}var Xo=function(){function t(){this._templates={},this._cache={},this._templateInfos={}}var e=t.prototype;return e.register=function(t){for(var e=0;e<t.shaders.length;e++)this.define(t.shaders[e]).effectName=t.name;for(var i=0;i<t.techniques.length;i++)for(var n=t.techniques[i],r=0;r<n.passes.length;r++){var s=n.passes[r];void 0!==s.propertyIndex&&void 0===s.properties&&(s.properties=n.passes[s.propertyIndex].properties)}},e.define=function(t){var e=this._templates[t.name];if(e&&e.hash===t.hash)return e;var i=C({},t);if(Go(i),this._templates[t.name]=i,!this._templateInfos[i.hash]){var n={};n.samplerStartBinding=i.blocks.length,n.shaderInfo=new He,n.blockSizes=[],n.bindings=[];for(var r=0;r<i.blocks.length;r++){var s=i.blocks[r];n.blockSizes.push(Fo(s.members)),n.bindings.push(new Ge(s.binding,ze.UNIFORM_BUFFER,1,s.stageFlags)),n.shaderInfo.blocks.push(new Ve(Bt.MATERIAL,s.binding,s.name,s.members.map((function(t){return new je(t.name,t.type,t.count)})),1))}for(var o=0;o<i.samplerTextures.length;o++){var a=i.samplerTextures[o];n.bindings.push(new Ge(a.binding,ze.SAMPLER_TEXTURE,a.count,a.stageFlags)),n.shaderInfo.samplerTextures.push(new We(Bt.MATERIAL,a.binding,a.name,a.type,a.count))}for(var u=0;u<i.samplers.length;u++){var h=i.samplers[u];n.bindings.push(new Ge(h.binding,ze.SAMPLER,h.count,h.stageFlags)),n.shaderInfo.samplers.push(new Xe(Bt.MATERIAL,h.binding,h.name,h.count))}for(var f=0;f<i.textures.length;f++){var l=i.textures[f];n.bindings.push(new Ge(l.binding,ze.TEXTURE,l.count,l.stageFlags)),n.shaderInfo.textures.push(new qe(Bt.MATERIAL,l.binding,l.name,l.type,l.count))}for(var c=0;c<i.buffers.length;c++){var p=i.buffers[c];n.bindings.push(new Ge(p.binding,ze.STORAGE_BUFFER,1,p.stageFlags)),n.shaderInfo.buffers.push(new Ke(Bt.MATERIAL,p.binding,p.name,1,p.memoryAccess))}for(var _=0;_<i.images.length;_++){var d=i.images[_];n.bindings.push(new Ge(d.binding,ze.STORAGE_IMAGE,d.count,d.stageFlags)),n.shaderInfo.images.push(new Ye(Bt.MATERIAL,d.binding,d.name,d.type,d.count,d.memoryAccess))}for(var g=0;g<i.subpassInputs.length;g++){var v=i.subpassInputs[g];n.bindings.push(new Ge(v.binding,ze.INPUT_ATTACHMENT,v.count,v.stageFlags)),n.shaderInfo.subpassInputs.push(new Je(Bt.MATERIAL,v.binding,v.name,v.count))}n.gfxAttributes=[];for(var m=0;m<i.attributes.length;m++){var y=i.attributes[m];n.gfxAttributes.push(new Qe(y.name,y.format,y.isNormalized,0,y.isInstanced,y.location))}Wo(i,n,Nt,"locals"),n.shaderInfo.stages.push(new $e(Ze.VERTEX,"")),n.shaderInfo.stages.push(new $e(Ze.FRAGMENT,"")),n.handleMap=Uo(i),n.setLayouts=[],this._templateInfos[i.hash]=n}return i},e.getTemplate=function(t){return this._templates[t]},e.getTemplateInfo=function(t){var e=this._templates[t].hash;return this._templateInfos[e]},e.getDescriptorSetLayout=function(t,e,i){void 0===i&&(i=!1);var n=this._templates[e],r=this._templateInfos[n.hash];return r.setLayouts.length||(jo.bindings=r.bindings,r.setLayouts[Bt.MATERIAL]=t.createDescriptorSetLayout(jo),jo.bindings=Nt.bindings,r.setLayouts[Bt.LOCAL]=t.createDescriptorSetLayout(jo)),r.setLayouts[i?Bt.LOCAL:Bt.MATERIAL]},e.hasProgram=function(t){return void 0!==this._templates[t]},e.getKey=function(t,e){return Oo(this._templates[t],e)},e.destroyShaderByDefines=function(t){var e=this,i=Object.keys(t);if(i.length)for(var n=i.map((function(e){var i=t[e];return"boolean"==typeof i&&(i=i?"1":"0"),new RegExp(""+e+i)})),r=Object.keys(this._cache).filter((function(t){return n.every((function(i){return i.test(e._cache[t].name)}))})),s=0;s<r.length;s++){var o=r[s],a=this._cache[o];G("destroyed shader "+a.name),a.destroy(),delete this._cache[o]}},e.getGFXShader=function(t,e,i,n,r){Object.assign(i,n.macros),r||(r=this.getKey(e,i));var s=this._cache[r];if(s)return s;var o=this._templates[e],a=this._templateInfos[o.hash];a.pipelineLayout||(this.getDescriptorSetLayout(t,e),Wo(o,a,Ft,"globals"),a.setLayouts[Bt.GLOBAL]=n.descriptorSetLayout,a.pipelineLayout=t.createPipelineLayout(new ti(a.setLayouts)));var u=Mo(i,o.defines),h=n.constantMacros+o.constantMacros+u.reduce((function(t,e){return t+"#define "+e.name+" "+e.value+"\n"}),""),f=o.glsl3,c=qo(t);c?f=o[c]:l(16346),a.shaderInfo.stages[0].source=h+f.vert,a.shaderInfo.stages[1].source=h+f.frag,a.shaderInfo.attributes=ko(o,a.gfxAttributes,i),a.shaderInfo.name=Po(e,u);var p=a.shaderInfo;return this._cache[r]=t.createShader(p)},t}();function qo(t){switch(t.gfxAPI){case Le.GLES2:case Le.WEBGL:return"glsl1";case Le.GLES3:case Le.WEBGL2:return"glsl3";default:return"glsl4"}}var Ko=t("V",new Xo);Pt.programLib=Ko;var Yo,Jo=t("_",function(){function t(t){this.instances=[],this.hasPendingModels=!1,this.dynamicOffsets=[],this.sortRender=void 0,this._device=t.device,this.pass=t,this._passPool=zt(),this.sortRender=this._passPool.add()}var e=t.prototype;return e.destroy=function(){this.instances.forEach((function(t){t.vb.destroy(),t.ia.destroy()})),this._passPool.reset(),this.instances.length=0},e.merge=function(t,e,i){void 0===i&&(i=null);var n=t.instancedAttributeBlock,r=n.buffer.length;if(r){var s=t.inputAssembler,o=t.descriptorSet,a=o.getTexture(Ut),u=o.getTexture(Ht),h=o.getTexture(Gt),f=t.useReflectionProbeType,l=i;l||(l=t.shaders[e]);var c=t.descriptorSet,p=t.passes[e].priority<<16|t.priority<<8|e;this.sortRender.hash=p,this.sortRender.shaderId=l.typedID,this.sortRender.passIdx=e;for(var _=0;_<this.instances.length;++_){var d,g,v=this.instances[_];if(!((null==(d=v.ia.indexBuffer)?void 0:d.objectID)!==(null==(g=s.indexBuffer)?void 0:g.objectID)||v.count>=1024)&&v.lightingMap.objectID===a.objectID&&v.useReflectionProbeType===f&&v.reflectionProbeCubemap.objectID===u.objectID&&v.reflectionProbePlanarMap.objectID===h.objectID&&v.stride===r){if(v.count>=v.capacity){v.capacity<<=1;var m=v.stride*v.capacity,y=v.data;v.data=new Uint8Array(m),v.data.set(y),v.vb.resize(m)}return v.shader=l,v.descriptorSet=c,v.data.set(n.buffer,v.stride*v.count++),void(this.hasPendingModels=!0)}}for(var b=this._device.createBuffer(new ni(ri.VERTEX|ri.TRANSFER_DST,si.HOST|si.DEVICE,32*r,r)),A=new Uint8Array(32*r),T=s.vertexBuffers.slice(),I=s.attributes.slice(),R=s.indexBuffer,w=0;w<n.attributes.length;w++){var E=n.attributes[w],D=new Qe(E.name,E.format,E.isNormalized,T.length,!0);I.push(D)}A.set(n.buffer),T.push(b);var S=new oi(I,T,R),C=this._device.createInputAssembler(S);this.instances.push({count:1,capacity:32,vb:b,data:A,ia:C,stride:r,shader:l,descriptorSet:c,lightingMap:a,reflectionProbeCubemap:u,reflectionProbePlanarMap:h,useReflectionProbeType:f,reflectionProbeBlendCubemap:null}),this.hasPendingModels=!0}},e.uploadBuffers=function(t){for(var e=0;e<this.instances.length;++e){var i=this.instances[e];i.count&&(i.ia.instanceCount=i.count,t.updateBuffer(i.vb,i.data))}},e.clear=function(){this.instances.forEach((function(t){t.count=0})),this.hasPendingModels=!1,this._passPool.reset()},t}()),Qo=new ni(ri.UNIFORM|ri.TRANSFER_DST,si.DEVICE),$o=new di(null),Zo=new gi(null);t("B",Yo),function(t){t[t.NONE=0]="NONE",t[t.INSTANCING=1]="INSTANCING"}(Yo||t("B",Yo={}));var ta,ea,ia,na,ra,sa,oa,aa=t("h",function(){function t(t){this._rootBuffer=null,this._buffers=[],this._descriptorSet=null,this._pipelineLayout=null,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocksInt=[],this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._shader=null,this._bs=new ai,this._dss=new ui,this._rs=new hi,this._priority=Vt.DEFAULT,this._stage=jt.DEFAULT,this._phase=co("default"),this._passID=4294967295,this._subpassID=4294967295,this._phaseID=4294967295,this._primitive=fi.TRIANGLE_LIST,this._batchingScheme=Yo.NONE,this._dynamicStates=li.NONE,this._instancedBuffers={},this._hash=0,this._rootBufferDirty=!1,this._root=t,this._device=Ie.gfxDevice}t.fillPipelineInfo=function(t,e){void 0!==e.priority&&(t._priority=e.priority),void 0!==e.primitive&&(t._primitive=e.primitive),void 0!==e.stage&&(t._stage=e.stage),void 0!==e.dynamicStates&&(t._dynamicStates=e.dynamicStates),void 0!==e.phase&&(t._phase=co(e.phase));var i=t._bs;if(e.blendState){var n=e.blendState,r=n.targets;r&&r.forEach((function(t,e){i.setTarget(e,t)})),void 0!==n.isA2C&&(i.isA2C=n.isA2C),void 0!==n.isIndepend&&(i.isIndepend=n.isIndepend),void 0!==n.blendColor&&(i.blendColor=n.blendColor)}t._rs.assign(e.rasterizerState),t._dss.assign(e.depthStencilState)},t.getPassHash=function(t){var e="";if(Pt.rendering&&Pt.rendering.enableEffectImport){var i=Pt.rendering.programLib.getKey(t._phaseID,t.program,t.defines);e=t._phaseID.toString()+","+i}else e=Ko.getKey(t.program,t.defines);var n,r=e+","+t._primitive+","+t._dynamicStates;return r+=ua(t._bs),r+=ha(t._dss),r+=",rs,"+(n=t._rs).cullMode+","+n.depthBias+","+n.isFrontFaceCCW,Ce(r,666)};var e=t.prototype;return e.initialize=function(t){this._doInit(t),this.resetUBOs(),this.resetTextures(),this.tryCompile()},e.getHandle=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=Ne.UNKNOWN);var n=this._propertyHandleMap[t];return n?(i?n=To(n,i):e&&(n=To(n,mo(n)-e)),n+e):0},e.getBinding=function(t){var e=this.getHandle(t);return e?yo(e):-1},e.setUniform=function(t,e){var i=yo(t),n=mo(t),r=Ao(t),s=this._getBlockView(n,i),o=wo[n];P(Boolean(o&&o(e)),12011,i,Ne[n]),Ro[n](s,e,r),this._rootBufferDirty=!0},e.getUniform=function(t,e){var i=yo(t),n=mo(t),r=Ao(t),s=this._getBlockView(n,i);return Io[n](s,e,r)},e.setUniformArray=function(t,e){for(var i=yo(t),n=mo(t),r=Fe(n)>>2,s=this._getBlockView(n,i),o=Ao(t),a=0;a<e.length;a++,o+=r)null!==e[a]&&Ro[n](s,e[a],o);this._rootBufferDirty=!0},e.bindTexture=function(t,e,i){this._descriptorSet.bindTexture(t,e,i||0)},e.bindSampler=function(t,e,i){this._descriptorSet.bindSampler(t,e,i||0)},e.setDynamicState=function(t,e){var i=this._dynamics[t];i&&i.value===e||(i.value=e,i.dirty=!0)},e.overridePipelineStates=function(){a(12102)},e.update=function(){this._descriptorSet?(this._rootBuffer&&this._rootBufferDirty&&(this._rootBuffer.update(this._rootBlock),this._rootBufferDirty=!1),this._descriptorSet.update()):l(12006)},e.getInstancedBuffer=function(t){return void 0===t&&(t=0),this._instancedBuffers[t]||(this._instancedBuffers[t]=new Jo(this))},e.destroy=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++){var e=this._shaderInfo.blocks[t];this._buffers[e.binding].destroy()}for(var i in this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBuffer=null),this._instancedBuffers)this._instancedBuffers[i].destroy();this._descriptorSet.destroy(),this._rs.destroy(),this._dss.destroy(),this._bs.destroy()},e.resetUniform=function(t){var e=this.getHandle(t);if(e){for(var i=mo(e),n=yo(e),r=Ao(e),s=bo(e),o=this._getBlockView(i,n),a=this._properties[t],u=a&&a.value||Do(i),h=(Fe(i)>>2)*s,f=0;f+u.length<=h;f+=u.length)o.set(u,r+f);this._rootBufferDirty=!0}},e.resetTexture=function(t,e){var i=this.getHandle(t);if(i){var n,r=mo(i),s=yo(i),o=this._properties[t],a=o&&o.value,u=(n="string"==typeof a?lo.get(""+a+So(r)):a||lo.get(Do(r)))&&n.getGFXTexture(),h=o&&void 0!==o.samplerHash?ci.unpackFromHash(o.samplerHash):n&&n.getSamplerInfo(),f=this._device.getSampler(h);this._descriptorSet.bindSampler(s,f,e||0),this._descriptorSet.bindTexture(s,u,e||0)}},e.resetUBOs=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++)for(var e=this._shaderInfo.blocks[t],i=0,n=0;n<e.members.length;n++){for(var r=e.members[n],s=this._getBlockView(r.type,e.binding),o=this._properties[r.name],a=o&&o.value||Do(r.type),u=(Fe(r.type)>>2)*r.count,h=0;h+a.length<=u;h+=a.length)s.set(a,i+h);i+=u}this._rootBufferDirty=!0},e.resetTextures=function(){var t=this;if(Pt.rendering)this._shaderInfo.descriptors[Bt.MATERIAL].samplerTextures.forEach((function(e){for(var i=0;i<e.count;++i)t.resetTexture(e.name,i)}));else for(var e=0;e<this._shaderInfo.samplerTextures.length;e++)for(var i=this._shaderInfo.samplerTextures[e],n=0;n<i.count;n++)this.resetTexture(i.name,n)},e.tryCompile=function(){var e=this._root.pipeline;if(!e)return!1;if(this._syncBatchingScheme(),Pt.rendering&&Pt.rendering.enableEffectImport){var i=Pt.rendering.programLib,n=i.getProgramVariant(this._device,this._phaseID,this._programName,this._defines);if(!n)return a(12103,this._programName),!1;this._shader=n.shader,this._pipelineLayout=i.getPipelineLayout(this.device,this._phaseID,this._programName)}else{var r=Ko.getGFXShader(this._device,this._programName,this._defines,e);if(!r)return a(12104,this._programName),!1;this._shader=r,this._pipelineLayout=Ko.getTemplateInfo(this._programName).pipelineLayout}return this._hash=t.getPassHash(this),!0},e.getShaderVariant=function(t){if(void 0===t&&(t=null),!this._shader&&!this.tryCompile())return a(12105),null;if(!t)return this._shader;for(var e=this._root.pipeline,i=0;i<t.length;i++){var n=t[i];this._defines[n.name]=n.value}this._isBlend&&(this._defines.CC_IS_TRANSPARENCY_PASS=1);var r=null;if(Pt.rendering&&Pt.rendering.enableEffectImport){var s=Pt.rendering.programLib.getProgramVariant(this._device,this._phaseID,this._programName,this._defines);s&&(r=s.shader)}else r=Ko.getGFXShader(this._device,this._programName,this._defines,e);for(var o=0;o<t.length;o++){var u=t[o];delete this._defines[u.name]}return r},e.beginChangeStatesSilently=function(){},e.endChangeStatesSilently=function(){},e._doInit=function(e,i){var n;void 0===i&&(i=!1),this._priority=Vt.DEFAULT,this._stage=jt.DEFAULT;var r=null==(n=Pt.rendering)?void 0:n.enableEffectImport;if(r){var s=Pt.rendering;if("number"==typeof e.phase?(this._passID=e._passID,this._subpassID=e._subpassID,this._phaseID=e._phaseID):(this._passID=s.getPassID(e.pass),this._passID!==s.INVALID_ID&&(e.subpass?(this._subpassID=s.getSubpassID(this._passID,e.subpass),this._phaseID=s.getPhaseID(this._subpassID,e.phase)):this._phaseID=s.getPhaseID(this._passID,e.phase))),this._passID===s.INVALID_ID)return void l(12107,e.program);if(this._phaseID===s.INVALID_ID)return void l(12108,e.program)}else"number"==typeof e.phase?this._passID=e._passID:e.pass&&"default"!==e.pass&&(P(4294967295===this._passID,12110),this._passID=0);this._phase=co("default"),this._primitive=fi.TRIANGLE_LIST,this._passIndex=e.passIndex,this._propertyIndex=void 0!==e.propertyIndex?e.propertyIndex:e.passIndex,this._programName=e.program,this._defines=i?C({},e.defines):e.defines,this._shaderInfo=r?Pt.rendering.programLib.getProgramInfo(this._phaseID,this._programName):Ko.getTemplate(e.program),this._properties=e.properties||this._properties;var o=this._device;t.fillPipelineInfo(this,e),e.stateOverrides&&t.fillPipelineInfo(this,e.stateOverrides),Zo.layout=r?Pt.rendering.programLib.getMaterialDescriptorSetLayout(this._device,this._phaseID,e.program):Ko.getDescriptorSetLayout(this._device,e.program),this._descriptorSet=this._device.createDescriptorSet(Zo);var a,u,h=this._shaderInfo.blocks;if(r){var f=Pt.rendering.programLib;a=f.getBlockSizes(this._phaseID,this._programName),u=f.getHandleMap(this._phaseID,this._programName)}else{var c=Ko.getTemplateInfo(e.program);a=c.blockSizes,u=c.handleMap}if(r){var p=Pt.rendering.programLib.getShaderInfo(this._phaseID,this.program);this._buildMaterialUniformBlocks(o,p.blocks,a)}else this._buildUniformBlocks(o,h,a);var _=this._propertyHandleMap=u,d={};for(var g in this._properties){var v=this._properties[g];v.handleInfo&&(d[g]=this.getHandle.apply(this,v.handleInfo))}Object.assign(_,d)},e._buildUniformBlocks=function(t,e,i){for(var n=t.capabilities.uboOffsetAlignment,r=[],s=0,o=0,a=0;a<e.length;a++){var u=i[a];r.push(o),o+=Math.ceil(u/n)*n,s=u}var h=r[r.length-1]+16*Math.ceil(s/16);h&&(Qo.size=16*Math.ceil(h/16),this._rootBuffer=t.createBuffer(Qo),this._rootBlock=new ArrayBuffer(h));for(var f=0,l=0;f<e.length;f++){var c=e[f].binding,p=i[f];$o.buffer=this._rootBuffer,$o.offset=r[l++],$o.range=16*Math.ceil(p/16);var _=this._buffers[c]=t.createBuffer($o);this._blocks[c]=new Float32Array(this._rootBlock,$o.offset,p/Float32Array.BYTES_PER_ELEMENT),this._blocksInt[c]=new Int32Array(this._blocks[c].buffer,this._blocks[c].byteOffset,this._blocks[c].length),this._descriptorSet.bindBuffer(c,_)}},e._buildMaterialUniformBlocks=function(t,e,i){for(var n=t.capabilities.uboOffsetAlignment,r=[],s=0,o=0,a=0;a<e.length;a++)if(1===e[a].set){var u=i[a];r.push(o),o+=Math.ceil(u/n)*n,s=u}if(0!==s){var h=r[r.length-1]+s;h&&(Qo.size=16*Math.ceil(h/16),this._rootBuffer=t.createBuffer(Qo),this._rootBlock=new ArrayBuffer(h))}for(var f=0,l=0;f<e.length;f++)if(1===e[f].set){var c=e[f].binding,p=i[f];$o.buffer=this._rootBuffer,$o.offset=r[l++],$o.range=16*Math.ceil(p/16);var _=this._buffers[c]=t.createBuffer($o);this._blocks[c]=new Float32Array(this._rootBlock,$o.offset,p/Float32Array.BYTES_PER_ELEMENT),this._blocksInt[c]=new Int32Array(this._blocks[c].buffer,this._blocks[c].byteOffset,this._blocks[c].length),this._descriptorSet.bindBuffer(c,_)}},e._syncBatchingScheme=function(){this._defines.USE_INSTANCING?this._device.hasFeature(pi.INSTANCED_ARRAYS)?this._batchingScheme=Yo.INSTANCING:(this._defines.USE_INSTANCING=!1,this._batchingScheme=Yo.NONE):this._batchingScheme=Yo.NONE},e._getBlockView=function(t,e){return t<Ne.FLOAT?this._blocksInt[e]:this._blocks[e]},e._initPassFromTarget=function(t,e,i){this._priority=t.priority,this._stage=t.stage,this._phase=t.phase,this._phaseID=t._phaseID,this._passID=t._passID,this._batchingScheme=t.batchingScheme,this._primitive=t.primitive,this._dynamicStates=t.dynamicStates,this._bs=t.blendState,this._dss=e,this._descriptorSet=t.descriptorSet,this._rs=t.rasterizerState,this._passIndex=t.passIndex,this._propertyIndex=t.propertyIndex,this._programName=t.program,this._defines=t.defines,this._shaderInfo=t._shaderInfo,this._properties=t._properties,this._blocks=t._blocks,this._blocksInt=t._blocksInt,this._dynamics=t._dynamics,this._shader=t._shader,Pt.rendering&&Pt.rendering.enableEffectImport?this._pipelineLayout=Pt.rendering.programLib.getPipelineLayout(this.device,this._phaseID,this._programName):this._pipelineLayout=Ko.getTemplateInfo(this._programName).pipelineLayout,this._hash=t._hash^i},e._updatePassHash=function(){this._hash=t.getPassHash(this)},e.setRootBufferDirty=function(t){this._rootBufferDirty=t},e.setPriority=function(t){this._priority=t},u(t,[{key:"_isBlend",get:function(){return this.blendState.targets.some((function(t){return t.blend}))}},{key:"root",get:function(){return this._root}},{key:"device",get:function(){return this._device}},{key:"shaderInfo",get:function(){return this._shaderInfo}},{key:"localSetLayout",get:function(){return Pt.rendering&&Pt.rendering.enableEffectImport?Pt.rendering.programLib.getLocalDescriptorSetLayout(this._device,this._phaseID,this._programName):Ko.getDescriptorSetLayout(this._device,this._programName,!0)}},{key:"program",get:function(){return this._programName}},{key:"properties",get:function(){return this._properties}},{key:"defines",get:function(){return this._defines}},{key:"passIndex",get:function(){return this._passIndex}},{key:"propertyIndex",get:function(){return this._propertyIndex}},{key:"dynamics",get:function(){return this._dynamics}},{key:"blocks",get:function(){return this._blocks}},{key:"blocksInt",get:function(){return this._blocksInt}},{key:"rootBufferDirty",get:function(){return this._rootBufferDirty}},{key:"priority",get:function(){return this._priority}},{key:"primitive",get:function(){return this._primitive}},{key:"stage",get:function(){return this._stage}},{key:"phase",get:function(){return this._phase}},{key:"passID",get:function(){return this._passID}},{key:"phaseID",get:function(){return this._phaseID}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"batchingScheme",get:function(){return this._batchingScheme}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"hash",get:function(){return this._hash}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}}]),t}());function ua(t){var e=",bs,"+t.isA2C;return t.targets.forEach((function(t){e+=",bt,"+t.blend+","+t.blendEq+","+t.blendAlphaEq+","+t.blendColorMask,e+=","+t.blendSrc+","+t.blendDst+","+t.blendSrcAlpha+","+t.blendDstAlpha})),e}function ha(t){var e=",dss,"+t.depthTest+","+t.depthWrite+","+t.depthFunc;return e+=","+t.stencilTestFront+","+t.stencilFuncFront+","+t.stencilRefFront+","+t.stencilReadMaskFront,e+=","+t.stencilFailOpFront+","+t.stencilZFailOpFront+","+t.stencilPassOpFront+","+t.stencilWriteMaskFront,(e+=","+t.stencilTestBack+","+t.stencilFuncBack+","+t.stencilRefBack+","+t.stencilReadMaskBack)+","+t.stencilFailOpBack+","+t.stencilZFailOpBack+","+t.stencilPassOpBack+","+t.stencilWriteMaskBack}aa.getTypeFromHandle=mo,aa.getBindingFromHandle=yo,aa.getCountFromHandle=bo,aa.getOffsetFromHandle=Ao;var fa=["planar-shadow","skybox","deferred-lighting","bloom","hbao","copy-pass","post-process","profiler","splash-screen","unlit","sprite","particle","particle-gpu","particle-trail","billboard","terrain","graphics","clear-stencil","spine","occlusion-query","geometry-renderer","debug-renderer","ssss-blur","float-output-process"],la=t("E",tt("cc.EffectAsset")((oa=function(t){function e(e){var i;return(i=t.call(this,e)||this).techniques=ia&&ia(),i.shaders=na&&na(),i.combinations=ra&&ra(),i.hideInEditor=sa&&sa(),i}n(e,t),e.register=function(t){e._effects[t.name]=t,e._layoutValid=!1},e.remove=function(t){if("string"!=typeof t)e._effects[t.name]&&e._effects[t.name]===t&&delete e._effects[t.name];else{if(e._effects[t])return void delete e._effects[t];for(var i in e._effects)if(e._effects[i]._uuid===t)return void delete e._effects[i]}},e.get=function(t){if(e._effects[t])return e._effects[t];for(var i in e._effects)if(e._effects[i]._uuid===t)return e._effects[i];return fa.includes(t)&&a(16101,t),null},e.getAll=function(){return e._effects},e.isLayoutValid=function(){return e._layoutValid},e.setLayoutValid=function(){e._layoutValid=!0};var i=e.prototype;return i.onLoaded=function(){if(Pt.rendering&&Pt.rendering.enableEffectImport){Vo(this);var t=Pt.rendering.programLib;t.addEffect(this),t.init(Ie.gfxDevice)}else Ko.register(this);e.register(this),Pt.game.once(Pt.Game.EVENT_RENDERER_INITED,this._precompile,this)},i._precompile=function(){var t=this;if(Pt.rendering&&Pt.rendering.enableEffectImport)Pt.rendering.programLib.precompileEffect(Ie.gfxDevice,this);else for(var e=Pt.director.root,i=function(){var i=t.shaders[n],r=t.combinations[n];if(!r)return 1;zo(r).forEach((function(t){return Ko.getGFXShader(Ie.gfxDevice,i.name,t,e.pipeline)}))},n=0;n<this.shaders.length;n++)i()},i.destroy=function(){return e.remove(this),t.prototype.destroy.call(this)},i.initDefault=function(i){t.prototype.initDefault.call(this,i);var n=e.get("builtin-unlit");this.name="builtin-unlit",this.shaders=n.shaders,this.combinations=n.combinations,this.techniques=n.techniques},i.validate=function(){return this.techniques.length>0&&this.shaders.length>0},e}(Jt),oa._effects={},oa._layoutValid=!0,ia=nt((ea=oa).prototype,"techniques",[rt],(function(){return[]})),na=nt(ea.prototype,"shaders",[rt],(function(){return[]})),ra=nt(ea.prototype,"combinations",[rt],(function(){return[]})),sa=nt(ea.prototype,"hideInEditor",[rt,st],(function(){return!1})),ta=ea))||ta);Pt.EffectAsset=la;var ca=new vi,pa=new mi;function _a(t,e){t.x=e.x*e.x,t.y=e.y*e.y,t.z=e.z*e.z}var da,ga,va,ma,ya,ba,Aa,Ta,Ia,Ra=null,wa=new ht,Ea=t("b",(da=tt("cc.Material"),ga=dt(la),da((ma=function(t){function e(e){var i;return(i=t.call(this,e)||this)._effectAsset=ya&&ya(),i._techIdx=ba&&ba(),i._defines=Aa&&Aa(),i._states=Ta&&Ta(),i._props=Ia&&Ia(),i._passes=[],i._hash=0,i}n(e,t),e.getHash=function(t){for(var e,i=0,n=r(t.passes);!(e=n()).done;)i^=e.value.hash;return i};var i=e.prototype;return i.initialize=function(t){this._passes.length?a(12005):(this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),this._fillInfo(t),this._update())},i.reset=function(t){this.initialize(t)},i.destroy=function(){return this._doDestroy(),t.prototype.destroy.call(this)},i.recompileShaders=function(){a(16370,this.name)},i.overridePipelineStates=function(){a(16371,this.name)},i.onLoaded=function(){this._update()},i.resetUniforms=function(t){void 0===t&&(t=!0),this._props.length=this._passes.length;for(var e=0;e<this._props.length;e++)this._props[e]={};if(t)for(var i,n=r(this._passes);!(i=n()).done;){var s=i.value;s.resetUBOs(),s.resetTextures()}},i.setProperty=function(t,e,i){var n=!1;if(void 0===i)for(var r=this._passes,s=r.length,o=0;o<s;o++){var u=r[o];this._uploadProperty(u,t,e)&&(this._props[u.propertyIndex][t]=e,n=!0)}else{i>=this._passes.length&&a(16372,i);var h=this._passes[i];this._uploadProperty(h,t,e)&&(this._props[h.propertyIndex][t]=e,n=!0)}n||a(16373,t)},i.getProperty=function(t,e){if(void 0===e)for(var i=this._props,n=i.length,r=0;r<n;r++){var s=i[r];if(t in s)return s[t]}else{if(e>=this._passes.length)return a(16372,e),null;var o=this._props[this._passes[e].propertyIndex];if(t in o)return o[t]}return null},i.copy=function(t,e){this._techIdx=t._techIdx,this._props.length=t._props.length;for(var i=0;i<t._props.length;i++)this._props[i]=C({},t._props[i]);this._defines.length=t._defines.length;for(var n=0;n<t._defines.length;n++)this._defines[n]=C({},t._defines[n]);this._states.length=t._states.length;for(var r=0;r<t._states.length;r++)this._states[r]=C({},t._states[r]);this._effectAsset=t._effectAsset,e&&this._fillInfo(e),this._update()},i._fillInfo=function(t){void 0!==t.technique&&(this._techIdx=t.technique),t.effectAsset?this._effectAsset=t.effectAsset:t.effectName&&(this._effectAsset=la.get(t.effectName)),t.defines&&this._prepareInfo(t.defines,this._defines),t.states&&this._prepareInfo(t.states,this._states)},i._prepareInfo=function(t,e){var i=t;if(!Array.isArray(i)){var n=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;i=Array(n).fill(i)}for(var r=0;r<i.length;++r)Object.assign(e[r]||(e[r]={}),i[r])},i._createPasses=function(){var t=this._effectAsset.techniques[this._techIdx||0];if(!t)return[];for(var e=t.passes.length,i=[],n=0;n<e;++n){var r=t.passes[n],s=r.passIndex=n,o=r.defines=this._defines[s]||(this._defines[s]={});if(r.stateOverrides=this._states[s]||(this._states[s]={}),void 0!==r.propertyIndex&&Object.assign(o,this._defines[r.propertyIndex]),void 0!==r.embeddedMacros&&Object.assign(o,r.embeddedMacros),!r.switch||o[r.switch]){var a=new aa(Pt.director.root);a.initialize(r),i.push(a)}}return i},i._update=function(t){var i=this;if(void 0===t&&(t=!0),this._effectAsset){this._passes=this._createPasses();var n=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=n,t)this._passes.forEach((function(t,e){var n=i._props[e];for(var r in n||(n=i._props[e]={}),void 0!==t.propertyIndex&&Object.assign(n,i._props[t.propertyIndex]),n)i._uploadProperty(t,r,n[r])}));else for(var r=0;r<this._props.length;r++)this._props[r]={}}this._hash=e.getHash(this)},i._uploadProperty=function(t,e,i){var n=this,r=t.getHandle(e);if(!r)return!1;if(mo(r)<Ne.SAMPLER1D)if(Array.isArray(i))t.setUniformArray(r,i);else if(null!==i){var s;if(null!=(s=t.properties[e])&&s.linear){var o=i;_a(wa,o),wa.w=o.w,i=wa}t.setUniform(r,i)}else t.resetUniform(e);else Array.isArray(i)?i.forEach((function(e,i){n._bindTexture(t,r,e,i)})):i?this._bindTexture(t,r,i):t.resetTexture(e);return!0},i._bindTexture=function(t,e,i,n){var r=aa.getBindingFromHandle(e);if(i instanceof yi)t.bindTexture(r,i,n);else if(i instanceof Ki){var s=i.getGFXTexture();if(!s||!s.width||!s.height)return;t.bindTexture(r,s,n),t.bindSampler(r,i.getGFXSampler(),n)}},i._doDestroy=function(){if(this._passes&&this._passes.length)for(var t,e=r(this._passes);!(t=e()).done;)t.value.destroy();this._passes.length=0},i.initDefault=function(e){t.prototype.initDefault.call(this,e),this.initialize({effectName:"builtin-unlit",defines:{USE_COLOR:!0},technique:0}),this.setProperty("mainColor",new lt("#ff00ff"))},i.validate=function(){return!!this._effectAsset&&!this._effectAsset.isDefault&&this.passes.length>0},u(e,[{key:"effectAsset",get:function(){return this._effectAsset}},{key:"effectName",get:function(){return this._effectAsset?this._effectAsset.name:""}},{key:"technique",get:function(){return this._techIdx}},{key:"passes",get:function(){return this._passes}},{key:"hash",get:function(){return this._hash}},{key:"parent",get:function(){return null}},{key:"owner",get:function(){return null}}]),e}(Jt),ya=nt(ma.prototype,"_effectAsset",[ga],(function(){return null})),ba=nt(ma.prototype,"_techIdx",[rt],(function(){return 0})),Aa=nt(ma.prototype,"_defines",[rt],(function(){return[]})),Ta=nt(ma.prototype,"_states",[rt],(function(){return[]})),Ia=nt(ma.prototype,"_props",[rt],(function(){return[]})),va=ma))||va));Pt.Material=Ea;var Da=t("v",i({Low_256x256:256,Medium_512x512:512,High_1024x1024:1024,Ultra_2048x2048:2048})),Sa=t("w",i({Planar:0,ShadowMap:1})),Ca=(t("t",i({HARD:0,SOFT:1,SOFT_2X:2,SOFT_4X:3})),t("C",i({LEVEL_1:1,LEVEL_2:2,LEVEL_3:3,LEVEL_4:4})),t("o",i({NONE:1,RemoveDuplicates:2,DisableRotationFix:3})),Sa.ShadowMap+1),xa=t("S",function(){function t(){this.fixedSphere=new vt(0,0,0,.01),this.maxReceived=4,this._matLight=new _t,this._material=null,this._instancingMaterial=null,this._enabled=!1,this._type=Ca,this._distance=0,this._planeBias=1,this._normal=new ut(0,1,0),this._shadowColor=new lt(0,0,0,76),this._size=new at(1024,1024),this._shadowMapDirty=!1}var e=t.prototype;return e.getPlanarShader=function(t){this._material||(this._material=new Ea,this._material.initialize({effectName:"pipeline/planar-shadow"}));var e=this._material.passes;return z(e.length>0,"passes should not be empty!"),e.length>0?e[0].getShaderVariant(t):null},e.initialize=function(t){this._enabled=t.enabled,this._type=this.enabled?t.type:Ca,this.normal=t.planeDirection,this.distance=t.planeHeight,this.planeBias=t.planeBias,this.shadowColor=t.shadowColor,this.maxReceived=t.maxReceived,t.shadowMapSize!==this._size.x&&(this.size.set(t.shadowMapSize,t.shadowMapSize),this._shadowMapDirty=!0)},e.activate=function(){if(this._enabled)if(this.type===Sa.Planar)this._updatePlanarInfo();else{var t=Pt.director.root;t.pipeline.macros.CC_SHADOW_TYPE=2,t.onGlobalPipelineStateChanged()}else{var e=Pt.director.root;e.pipeline.macros.CC_SHADOW_TYPE=0,e.onGlobalPipelineStateChanged()}},e._updatePlanarInfo=function(){this._material||(this._material=new Ea,this._material.initialize({effectName:"pipeline/planar-shadow"}));var t=Pt.director.root;t.pipeline.macros.CC_SHADOW_TYPE=1,t.onGlobalPipelineStateChanged()},e.destroy=function(){this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this.fixedSphere.destroy()},u(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t,this.activate()}},{key:"type",get:function(){return this._type},set:function(t){this._type=this.enabled?t:Ca,this.activate()}},{key:"normal",get:function(){return this._normal},set:function(t){ut.copy(this._normal,t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance=t}},{key:"planeBias",get:function(){return this._planeBias},set:function(t){this._planeBias=t}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor=t}},{key:"size",get:function(){return this._size},set:function(t){this._size.set(t)}},{key:"shadowMapDirty",get:function(){return this._shadowMapDirty},set:function(t){this._shadowMapDirty=t}},{key:"matLight",get:function(){return this._matLight}},{key:"material",get:function(){return this._material}},{key:"instancingMaterial",get:function(){return this._instancingMaterial}}]),t}());function Ma(){return Pt.director.root.pipeline.pipelineSceneData}xa.MAX_FAR=2e3,xa.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),Pt.Shadows=xa;var Pa=t("A",function(){function t(){this._groundAlbedoHDR=new ht(.2,.2,.2,1),this._skyColorHDR=new ht(.2,.5,.8,1),this._skyIllumHDR=0,this._groundAlbedoLDR=new ht(.2,.2,.2,1),this._skyColorLDR=new ht(.2,.5,.8,1),this._skyIllumLDR=0,this._mipmapCount=1,this._enabled=!1}return t.prototype.initialize=function(t){this._skyColorHDR=t.skyColorHDR,this._groundAlbedoHDR.set(t.groundAlbedoHDR),this._skyIllumHDR=t.skyIllumHDR,this._skyColorLDR=t.skyColorLDR,this._groundAlbedoLDR.set(t.groundAlbedoLDR),this._skyIllumLDR=t.skyIllumLDR},u(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"skyColor",get:function(){return Ma().isHDR?this._skyColorHDR:this._skyColorLDR},set:function(t){Ma().isHDR?this._skyColorHDR.set(t):this._skyColorLDR.set(t)}},{key:"skyIllum",get:function(){return Ma().isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(t){Ma().isHDR?this._skyIllumHDR=t:this._skyIllumLDR=t}},{key:"groundAlbedo",get:function(){return Ma().isHDR?this._groundAlbedoHDR:this._groundAlbedoLDR},set:function(t){Ma().isHDR?this._groundAlbedoHDR.set(t):this._groundAlbedoLDR.set(t)}}]),t}());Pa.SUN_ILLUM=65e3,Pa.SKY_ILLUM=2e4,Pt.Ambient=Pa;var La,ka=t("z",function(t){function e(e,i){var n;(n=t.call(this,e.root)||this)._dontNotify=!1,n._parent=e,n._owner=i,n._doInit(n._parent,!0),n._shaderInfo.blocks.forEach((function(t){var e=n._blocks[t.binding],i=n._parent.blocks[t.binding];e.set(i)})),n._rootBufferDirty=!0;var r=n._parent,s=n._descriptorSet;return n._shaderInfo.samplerTextures.forEach((function(t){for(var e=0;e<t.count;e++){var i=r._descriptorSet,n=t.binding,o=i.getSampler(n,e),a=i.getTexture(n,e);s.bindSampler(n,o,e),s.bindTexture(n,a,e)}})),t.prototype.tryCompile.call(V(n)),n}n(e,t);var i=e.prototype;return i.overridePipelineStates=function(t,e){this._bs.reset(),this._rs.reset(),this._dss.reset(),aa.fillPipelineInfo(this,t),aa.fillPipelineInfo(this,e),this._onStateChange()},i.tryCompile=function(e){if(e&&!Co(this._defines,e))return!1;var i=t.prototype.tryCompile.call(this);return this._onStateChange(),i},i.beginChangeStatesSilently=function(){this._dontNotify=!0},i.endChangeStatesSilently=function(){this._dontNotify=!1},i._syncBatchingScheme=function(){this._defines.USE_INSTANCING=!1,this._batchingScheme=Yo.NONE},i._onStateChange=function(){this._hash=aa.getPassHash(this),this._owner.onPassStateChange(this._dontNotify)},u(e,[{key:"parent",get:function(){return this._parent}}]),e}(aa)),Oa=t("M",function(t){function e(e){var i;return(i=t.call(this)||this)._passes=[],i._subModelIdx=0,i._parent=e.parent,i._owner=e.owner||null,i._subModelIdx=e.subModelIdx||0,i.copy(i._parent),i}n(e,t);var i=e.prototype;return i.recompileShaders=function(t,e){this._passes&&this.effectAsset&&(void 0===e?this._passes.forEach((function(e){e.tryCompile(t)})):this._passes[e].tryCompile(t))},i.overridePipelineStates=function(t,e){if(this._passes&&this.effectAsset){var i=this.effectAsset.techniques[this.technique].passes;if(void 0===e)for(var n=0;n<this._passes.length;n++){var r=this._passes[n],s=this._states[n]||(this._states[n]={});for(var o in t)s[o]=t[o];r.overridePipelineStates(i[r.passIndex],s)}else{var a=this._states[e]||(this._states[e]={});for(var u in t)a[u]=t[u];this._passes[e].overridePipelineStates(i[e],a)}}},i.destroy=function(){return this._doDestroy(),!0},i.onPassStateChange=function(t){this._hash=Ea.getHash(this),!t&&this._owner&&this._owner._onRebuildPSO(this._subModelIdx,this)},i._createPasses=function(){var t=[],e=this._parent.passes;if(!e)return t;for(var i=0;i<e.length;++i)t.push(new ka(e[i],this));return t},u(e,[{key:"parent",get:function(){return this._parent}},{key:"owner",get:function(){return this._owner}}]),e}(Ea)),Ba=null,Na=null;t("p",La),function(t){t[t.HEMISPHERE_DIFFUSE=0]="HEMISPHERE_DIFFUSE",t[t.AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION=1]="AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION",t[t.DIFFUSEMAP_WITH_REFLECTION=2]="DIFFUSEMAP_WITH_REFLECTION"}(La||t("p",La={})),i(La);var Fa=t("x",function(){function t(){this._envmapLDR=null,this._envmapHDR=null,this._diffuseMapLDR=null,this._diffuseMapHDR=null,this._globalDSManager=null,this._model=null,this._default=null,this._enabled=!1,this._useIBL=!1,this._useHDR=!0,this._useDiffuseMap=!1,this._editableMaterial=null,this._activated=!1,this._reflectionHDR=null,this._reflectionLDR=null,this._rotationAngle=0}var e=t.prototype;return e.initialize=function(t){this._activated=!1,this._enabled=t.enabled,this._useIBL=t.useIBL,this._useDiffuseMap=t.applyDiffuseMap,this._useHDR=t.useHDR},e.setEnvMaps=function(t,e){this._envmapHDR=t,this._envmapLDR=e,this._updateGlobalBinding(),this._updatePipeline()},e.setDiffuseMaps=function(t,e){this._diffuseMapHDR=t,this._diffuseMapLDR=e,this._updateGlobalBinding(),this._updatePipeline()},e.setSkyboxMaterial=function(t){t?(this._editableMaterial=new Oa({parent:t}),this._editableMaterial.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE})):this._editableMaterial=null,this._updatePipeline()},e.setReflectionMaps=function(t,e){this._reflectionHDR=t,this._reflectionLDR=e,this._updateGlobalBinding(),this._updatePipeline()},e.setRotationAngle=function(t){this._rotationAngle=t},e.getRotationAngle=function(){return this._rotationAngle},e.updateMaterialRenderInfo=function(){this._updateGlobalBinding(),this._updatePipeline()},e.activate=function(){var t=Pt.director.root.pipeline;this._globalDSManager=t.globalDSManager,this._default=lo.get("default-cube-texture"),this._model||(this._model=Pt.director.root.createModel(Pt.renderer.scene.Model));var e=this._default.isRGBE;if(this._default.isUsingOfflineMipmaps(),this.envmap&&(e=this.envmap.isRGBE,this.envmap.isUsingOfflineMipmaps()),!Na){var i=new Ea;i.initialize({effectName:"pipeline/skybox",defines:{USE_RGBE_CUBEMAP:e}}),Na=new Oa({parent:i})}this.enabled&&(Ba||(Ba=Pt.utils.createMesh(Pt.primitives.box({width:2,height:2,length:2}))),this._editableMaterial?this._model.initSubModel(0,Ba.renderingSubMeshes[0],this._editableMaterial):this._model.initSubModel(0,Ba.renderingSubMeshes[0],Na)),this.envmap||(this.envmap=this._default),this.diffuseMap||(this.diffuseMap=this._default),this._updateGlobalBinding(),this._updatePipeline(),this._activated=!0},e._updatePipeline=function(){var t=Pt.director.root,e=t.pipeline,i=this.useIBL?this.isRGBE?2:1:0,n=this.useIBL&&this.useDiffuseMap&&this.diffuseMap&&this.diffuseMap!==this._default?this.isRGBE?2:1:0,r=this.useHDR,s=this.useConvolutionMap;if(e.macros.CC_USE_IBL===i&&e.macros.CC_USE_DIFFUSEMAP===n&&e.macros.CC_USE_HDR===r&&e.macros.CC_IBL_CONVOLUTED===s||(e.macros.CC_USE_IBL=i,e.macros.CC_USE_DIFFUSEMAP=n,e.macros.CC_USE_HDR=r,e.macros.CC_IBL_CONVOLUTED=s,this._activated&&t.onGlobalPipelineStateChanged()),this.enabled){var o=this.envmap?this.envmap:this._default,a=this._editableMaterial?this._editableMaterial:Na;a&&(a.setProperty("environmentMap",o),a.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE})),this._model&&(this._model.setSubModelMaterial(0,a),this._updateSubModes())}},e._updateGlobalBinding=function(){if(!Pt.rendering&&this._globalDSManager){var t=Ie.gfxDevice;if(this.reflectionMap){var e=this.reflectionMap.getGFXTexture(),i=t.getSampler(this.reflectionMap.getSamplerInfo());this._globalDSManager.bindSampler(qt,i),this._globalDSManager.bindTexture(qt,e)}else{var n=this.envmap?this.envmap:this._default;if(n){var r=n.getGFXTexture(),s=t.getSampler(n.getSamplerInfo());this._globalDSManager.bindSampler(qt,s),this._globalDSManager.bindTexture(qt,r)}}var o=this.diffuseMap?this.diffuseMap:this._default;if(o){var a=o.getGFXTexture(),u=t.getSampler(o.getSamplerInfo());this._globalDSManager.bindSampler(Kt,u),this._globalDSManager.bindTexture(Kt,a)}this._globalDSManager.update()}},e._updateSubModes=function(){if(this._model)for(var t=this._model.subModels,e=0;e<t.length;e++)t[e].update()},u(t,[{key:"model",get:function(){return this._model}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t,t?this.activate():this._updatePipeline()}},{key:"useHDR",get:function(){return this._useHDR},set:function(t){this._useHDR=t,this.setEnvMaps(this._envmapHDR,this._envmapLDR)}},{key:"useIBL",get:function(){return this._useIBL},set:function(t){this._useIBL=t,this._updatePipeline()}},{key:"useDiffuseMap",get:function(){return this._useDiffuseMap},set:function(t){this._useDiffuseMap=t,this._updatePipeline()}},{key:"isRGBE",get:function(){return!!this.envmap&&this.envmap.isRGBE}},{key:"useConvolutionMap",get:function(){return this.reflectionMap?this.reflectionMap.isUsingOfflineMipmaps():!!this.envmap&&this.envmap.isUsingOfflineMipmaps()}},{key:"envmap",get:function(){return Ma().isHDR?this._envmapHDR:this._envmapLDR},set:function(t){Ma().isHDR?this.setEnvMaps(t,this._envmapLDR):this.setEnvMaps(this._envmapHDR,t)}},{key:"diffuseMap",get:function(){return Ma().isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(t){Ma().isHDR?this.setDiffuseMaps(t,this._diffuseMapLDR):this.setDiffuseMaps(this._diffuseMapHDR,t)}},{key:"reflectionMap",get:function(){return Ma().isHDR?this._reflectionHDR:this._reflectionLDR}},{key:"editableMaterial",get:function(){return this._editableMaterial}}]),t}());Pt.Skybox=Fa;var Ua,Ha,Ga=new ht,za=t("s",i({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3})),Va=t("F",za.LAYERED+1),ja=t("q",function(){function t(){this._fogColor=new lt("#C8C8C8"),this._colorArray=new ht(.2,.2,.2,1),this._enabled=!1,this._accurate=!1,this._type=0,this._fogDensity=.3,this._fogStart=.5,this._fogEnd=300,this._fogAtten=5,this._fogTop=1.5,this._fogRange=1.2,this._activated=!1}var e=t.prototype;return e.initialize=function(t){this._activated=!1,this.fogColor=t.fogColor,this._enabled=t.enabled,this._type=this.enabled?t.type:Va,this._accurate=t.accurate,this.fogDensity=t.fogDensity,this.fogStart=t.fogStart,this.fogEnd=t.fogEnd,this.fogAtten=t.fogAtten,this.fogTop=t.fogTop,this.fogRange=t.fogRange},e.activate=function(){this._updatePipeline(),this._activated=!0},e._updatePipeline=function(){var t=Pt.director.root,e=this.enabled?this.type:Va,i=this.accurate?1:0,n=t.pipeline;n.macros.CC_USE_FOG===e&&n.macros.CC_USE_ACCURATE_FOG===i||(n.macros.CC_USE_FOG=e,n.macros.CC_USE_ACCURATE_FOG=i,this._activated&&t.onGlobalPipelineStateChanged())},u(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t,t?this.activate():(this._type=Va,this._updatePipeline())}},{key:"accurate",get:function(){return this._accurate},set:function(t){this._accurate=t,this._updatePipeline()}},{key:"fogColor",get:function(){return this._fogColor},set:function(t){this._fogColor.set(t),Ga.set(t.x,t.y,t.z,t.w),_a(this._colorArray,Ga)}},{key:"type",get:function(){return this._type},set:function(t){this._type=this.enabled?t:Va,this.enabled&&this._updatePipeline()}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t}},{key:"colorArray",get:function(){return this._colorArray}}]),t}());Pt.Fog=ja,t("$",Ua),function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD"}(Ua||t("$",Ua={})),t("T",Ha),function(t){t[t.NONE=0]="NONE",t[t.POSITION=1]="POSITION",t[t.ROTATION=2]="ROTATION",t[t.SCALE=4]="SCALE",t[t.SKEW=8]="SKEW",t[t.RS=t.ROTATION|t.SCALE]="RS",t[t.RSS=t.ROTATION|t.SCALE|t.SKEW]="RSS",t[t.TRS=t.POSITION|t.ROTATION|t.SCALE]="TRS",t[t.TRS_MASK=~t.TRS]="TRS_MASK"}(Ha||t("T",Ha={})),Lt.internal.TransformBit=Ha;var Wa=t("c",i({Static:0,Stationary:1,Movable:2})),Xa=t("y",i({DEFAULT:0,LINEAR:1})),qa=(t("u",function(){function t(){this._toneMappingType=Xa.DEFAULT,this._activated=!1}var e=t.prototype;return e.initialize=function(t){this._toneMappingType=t.toneMappingType},e.activate=function(){this._updatePipeline(),this._activated=!0},e._updatePipeline=function(){var t=Pt.director.root;t.pipeline.macros.CC_TONE_MAPPING_TYPE=this._toneMappingType,this._activated&&t.onGlobalPipelineStateChanged()},u(t,[{key:"toneMappingType",get:function(){return this._toneMappingType},set:function(t){this._toneMappingType=t,this._updatePipeline()}}]),t}()),t("aB",function(){var t=e.prototype;function e(t){this._uiComp=null,this._opacity=1,this._localOpacity=1,this.colorDirty=!0,this._uiTransformComp=null,this._uiSkewComp=null,this._node=t}return t.setOpacity=function(t){this._opacity=t},t.applyOpacity=function(t){this._opacity=this._localOpacity*t},e.markOpacityTree=function(){},u(e,[{key:"uiTransformComp",get:function(){return this._uiTransformComp||(this._uiTransformComp=this._node.getComponent("cc.UITransform")),this._uiTransformComp},set:function(t){this._uiTransformComp=t}},{key:"uiComp",get:function(){return this._uiComp},set:function(t){this._uiComp&&t?a(12002):this._uiComp=t}},{key:"opacity",get:function(){return this._opacity}},{key:"localOpacity",get:function(){return this._localOpacity},set:function(t){this._localOpacity=t,this.colorDirty=!0}}]),e}()));j.Destroying,Lt.GAME_VIEW;var Ka,Ya=new W((function(){return new Array(16)}),3),Ja=null,Qa=new at,$a=[be.TOUCH_START,be.TOUCH_MOVE,be.TOUCH_END,be.TOUCH_CANCEL],Za=[be.MOUSE_DOWN,be.MOUSE_ENTER,be.MOUSE_MOVE,be.MOUSE_LEAVE,be.MOUSE_UP,be.MOUSE_WHEEL];t("aI",Ka),function(t){t[t.ADD_POINTER_EVENT_PROCESSOR=0]="ADD_POINTER_EVENT_PROCESSOR",t[t.REMOVE_POINTER_EVENT_PROCESSOR=1]="REMOVE_POINTER_EVENT_PROCESSOR",t[t.MARK_LIST_DIRTY=2]="MARK_LIST_DIRTY"}(Ka||t("aI",Ka={}));var tu=new X,eu=t("aH",function(){function t(t){this.claimedTouchIdList=[],this.maskList=null,this.cachedCameraPriority=0,this.previousMouseIn=!1,this.bubblingTarget=null,this.capturingTarget=null,this.shouldHandleEventMouse=!1,this.shouldHandleEventTouch=!1,this._dispatchingTouch=null,this._isEnabled=!1,this._isMouseLeaveWindow=!1,this._node=t}var e=t.prototype;return e.setEnabled=function(t,e){if(void 0===e&&(e=!1),this._isEnabled!==t){this._isEnabled=t;var i=this.node.children;if(t&&this._attachMask(),tu.emit(Ka.MARK_LIST_DIRTY),e&&i.length>0)for(var n=0;n<i.length;++n)i[n].eventProcessor.setEnabled(t,!0)}},e.reattach=function(){this.node.walk((function(e){var i=e.eventProcessor,n=i._searchComponentsInParent(t._maskComp);i.maskList=n}))},e.destroy=function(){if(Ja===this._node&&(Ja=null),this.capturingTarget&&this.capturingTarget.clear(),this.bubblingTarget&&this.bubblingTarget.clear(),tu.emit(Ka.REMOVE_POINTER_EVENT_PROCESSOR,this),this._dispatchingTouch){var t=new Ae([this._dispatchingTouch],!0,Te.TOUCH_CANCEL);t.touch=this._dispatchingTouch,this.dispatchEvent(t),this._dispatchingTouch=null}},e.on=function(t,e,i,n){var r,s;return this._tryEmittingAddEvent(t),((n=!!n)?null!==(r=this.capturingTarget)&&void 0!==r?r:this.capturingTarget=this._newCallbacksInvoker():null!==(s=this.bubblingTarget)&&void 0!==s?s:this.bubblingTarget=this._newCallbacksInvoker()).on(t,e,i),e},e.once=function(t,e,i,n){var r,s;return this._tryEmittingAddEvent(t),((n=!!n)?null!==(r=this.capturingTarget)&&void 0!==r?r:this.capturingTarget=this._newCallbacksInvoker():null!==(s=this.bubblingTarget)&&void 0!==s?s:this.bubblingTarget=this._newCallbacksInvoker()).on(t,e,i,!0),e},e.off=function(t,e,i,n){var r;null==(r=(n=!!n)?this.capturingTarget:this.bubblingTarget)||r.off(t,e,i)},e.targetOff=function(t){var e,i;null==(e=this.capturingTarget)||e.removeAll(t),null==(i=this.bubblingTarget)||i.removeAll(t),this.shouldHandleEventTouch&&!this._hasTouchListeners()&&(this.shouldHandleEventTouch=!1),this.shouldHandleEventMouse&&!this._hasMouseListeners()&&(this.shouldHandleEventMouse=!1),this._hasPointerListeners()||tu.emit(Ka.REMOVE_POINTER_EVENT_PROCESSOR,this)},e.emit=function(t,e,i,n,r,s){var o;null==(o=this.bubblingTarget)||o.emit(t,e,i,n,r,s)},e.dispatchEvent=function(t){var e,i=this.node,n=0;t.target=i;var r=Ya.alloc();for(r.length=0,this.getCapturingTargets(t.type,r),t.eventPhase=1,n=r.length-1;n>=0;--n)if((e=r[n]).eventProcessor.capturingTarget&&(t.currentTarget=e,e.eventProcessor.capturingTarget.emit(t.type,t,r),t.propagationStopped))return void Ya.free(r);if(t.eventPhase=2,t.currentTarget=i,this.capturingTarget&&this.capturingTarget.emit(t.type,t),!t.propagationImmediateStopped&&this.bubblingTarget&&this.bubblingTarget.emit(t.type,t),!t.propagationStopped&&t.bubbles)for(r.length=0,this.getBubblingTargets(t.type,r),t.eventPhase=3,n=0;n<r.length;++n)if((e=r[n]).eventProcessor.bubblingTarget&&(t.currentTarget=e,e.eventProcessor.bubblingTarget.emit(t.type,t),t.propagationStopped))return void Ya.free(r);Ya.free(r)},e.hasEventListener=function(t,e,i){var n=!1;return this.bubblingTarget&&(n=this.bubblingTarget.hasEventListener(t,e,i)),!n&&this.capturingTarget&&(n=this.capturingTarget.hasEventListener(t,e,i)),n},e.getCapturingTargets=function(t,e){for(var i=this._node.parent;i;){var n;null!=(n=i.eventProcessor.capturingTarget)&&n.hasEventListener(t)&&e.push(i),i=i.parent}},e.getBubblingTargets=function(t,e){for(var i=this._node.parent;i;){var n;null!=(n=i.eventProcessor.bubblingTarget)&&n.hasEventListener(t)&&e.push(i),i=i.parent}},e.onUpdatingSiblingIndex=function(){tu.emit(Ka.MARK_LIST_DIRTY)},e._searchComponentsInParent=function(t){var e=this.node;if(t){for(var i=0,n=[],r=e;r&&Pt.Node.isNode(r);r=r.parent,++i){var s=r.getComponent(t);if(s){var o={index:i,comp:s};n?n.push(o):n=[o]}}return n.length>0?n:null}return null},e._attachMask=function(){this.maskList=this._searchComponentsInParent(t._maskComp)},e._isTouchEvent=function(t){return-1!==$a.indexOf(t)},e._isMouseEvent=function(t){return-1!==Za.indexOf(t)},e._hasTouchListeners=function(){for(var t=0;t<$a.length;++t){var e=$a[t];if(this.hasEventListener(e))return!0}return!1},e._hasMouseListeners=function(){for(var t=0;t<Za.length;++t){var e=Za[t];if(this.hasEventListener(e))return!0}return!1},e._hasPointerListeners=function(){return!!this._hasTouchListeners()||this._hasMouseListeners()},e._tryEmittingAddEvent=function(t){var e=this._isTouchEvent(t),i=this._isMouseEvent(t);e?this.shouldHandleEventTouch=!0:i&&(this.shouldHandleEventMouse=!0),!e&&!i||this._hasPointerListeners()||tu.emit(Ka.ADD_POINTER_EVENT_PROCESSOR,this)},e._newCallbacksInvoker=function(){var t=this,e=new X;return e._registerOffCallback((function(){t.shouldHandleEventTouch&&!t._hasTouchListeners()&&(t.shouldHandleEventTouch=!1),t.shouldHandleEventMouse&&!t._hasMouseListeners()&&(t.shouldHandleEventMouse=!1),t._hasPointerListeners()||tu.emit(Ka.REMOVE_POINTER_EVENT_PROCESSOR,t)})),e},e._handleEventMouse=function(t){switch(t.type){case Te.MOUSE_DOWN:return this._handleMouseDown(t);case Te.MOUSE_MOVE:return this._handleMouseMove(t);case Te.MOUSE_UP:return this._handleMouseUp(t);case Te.MOUSE_WHEEL:return this._handleMouseWheel(t);case Te.MOUSE_LEAVE:return this._handleMouseLeave(t);case Te.MOUSE_ENTER:return this._handleMouseEnter(t);default:return!1}},e._handleMouseDown=function(t){var e=this._node,i=e._getUITransformComp();return!(!e||!i||(t.getLocation(Qa),!i.hitTest(Qa,t.windowId)||(t.type=be.MOUSE_DOWN,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))},e._handleMouseMove=function(t){var e=this._node,i=e._getUITransformComp();return!(!e||!i||this._isMouseLeaveWindow||(t.getLocation(Qa),i.hitTest(Qa,t.windowId)?(this.previousMouseIn||(Ja&&Ja!==e&&(t.type=be.MOUSE_LEAVE,Ja.dispatchEvent(t),Ja.eventProcessor.previousMouseIn=!1),Ja=e,t.type=be.MOUSE_ENTER,e.dispatchEvent(t),this.previousMouseIn=!0),t.type=be.MOUSE_MOVE,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0):(this.previousMouseIn&&(t.type=be.MOUSE_LEAVE,e.dispatchEvent(t),this.previousMouseIn=!1,Ja=null),1)))},e._handleMouseUp=function(t){var e=this._node,i=e._getUITransformComp();return!(!e||!i||(t.getLocation(Qa),!i.hitTest(Qa,t.windowId)||(t.type=be.MOUSE_UP,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))},e._handleMouseWheel=function(t){var e=this._node,i=e._getUITransformComp();return!(!e||!i||(t.getLocation(Qa),!i.hitTest(Qa,t.windowId)||(t.type=be.MOUSE_WHEEL,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))},e._handleMouseLeave=function(t){return this._isMouseLeaveWindow=!0,this.previousMouseIn&&(t.type=be.MOUSE_LEAVE,this._node.dispatchEvent(t),this.previousMouseIn=!1,Ja=null),!1},e._handleMouseEnter=function(){return this._isMouseLeaveWindow=!1,!1},e._handleEventTouch=function(t){try{switch(t.type){case Te.TOUCH_START:return this._handleTouchStart(t);case Te.TOUCH_MOVE:return this._handleTouchMove(t);case Te.TOUCH_END:return this._handleTouchEnd(t);case Te.TOUCH_CANCEL:return this._handleTouchCancel(t);default:return!1}}catch(t){throw this.claimedTouchIdList.length=0,t}},e._handleTouchStart=function(t){var e=this.node,i=e._getUITransformComp();return!(!e||!i||(t.getLocation(Qa),!i.hitTest(Qa,t.windowId)||(t.type=be.TOUCH_START,t.bubbles=!0,this._dispatchingTouch=t.touch,e.dispatchEvent(t),0)))},e._handleTouchMove=function(t){var e=this.node;return!(!e||!e._getUITransformComp()||(t.type=be.TOUCH_MOVE,t.bubbles=!0,this._dispatchingTouch=t.touch,e.dispatchEvent(t),0))},e._handleTouchEnd=function(t){var e=this.node,i=e._getUITransformComp();e&&i&&(t.getLocation(Qa),i.hitTest(Qa,t.windowId)?t.type=be.TOUCH_END:t.type=be.TOUCH_CANCEL,t.bubbles=!0,e.dispatchEvent(t),this._dispatchingTouch=null)},e._handleTouchCancel=function(t){var e=this.node;e&&e._getUITransformComp()&&(t.type=be.TOUCH_CANCEL,t.bubbles=!0,e.dispatchEvent(t),this._dispatchingTouch=null)},u(t,[{key:"isEnabled",get:function(){return this._isEnabled}},{key:"node",get:function(){return this._node}}]),t}());eu._maskComp=null,eu.callbacksInvoker=tu,Pt.NodeEventProcessor=eu;var iu,nu,ru,su,ou,au,uu,hu,fu,lu,cu,pu,_u,du,gu,vu,mu,yu=mt(),bu=[],Au=Math.PI/180;function Tu(t,e){if(!t)return!1;bu.length=0;for(var i=bu,n=null,r=t;r;r=r.parent)i.push(r),r._uiProps._uiSkewComp&&(n=r);var s=!1;if(n){e.set(n.parent._mat);for(var o=i.indexOf(n);o>=0;--o){var a=i[o];_t.fromSRT(yu,a.rotation,a.position,a.scale),_t.multiply(e,e,yu)}s=!0}else e.set(t._mat);return bu.length=0,s}function Iu(t,e){if(t.isSkewEnabled()&&(0!==t.x||0!==t.y))if(t.rotational){var i=-t.x*Au,n=t.y*Au,r=Math.cos(i),s=Math.sin(i),o=Math.cos(n),a=Math.sin(n),u=e.m00,h=e.m01,f=e.m04,l=e.m05;e.m00=o*u-s*h,e.m01=a*u+r*h,e.m04=o*f-s*l,e.m05=a*f+r*l}else{var c=Math.tan(t.x*Au),p=Math.tan(t.y*Au),_=e.m00,d=e.m01,g=e.m04,v=e.m05;e.m00=_+g*p,e.m01=d+v*p,e.m04=g+_*c,e.m05=v+d*c}}var Ru=j.Destroying,wu=j.DontDestroy,Eu=j.Deactivating,Du=be.TRANSFORM_CHANGED,Su=be.ACTIVE_CHANGED,Cu=t("a",1),xu=new c("Node");function Mu(t){return t?"string"==typeof t?K(t):t:(l(3804),null)}var Pu,Lu,ku,Ou,Bu,Nu,Fu,Uu,Hu,Gu,zu,Vu,ju,Wu,Xu,qu,Ku,Yu,Ju,Qu,$u,Zu,th,eh,ih,nh,rh,sh,oh,ah,uh,hh,fh,lh,ch,ph,_h,dh,gh,vh,mh,yh,bh,Ah,Th,Ih,Rh,wh,Eh,Dh,Sh,Ch,xh,Mh,Ph,Lh,kh,Oh,Bh,Nh,Fh,Uh,Hh,Gh,zh,Vh,jh,Wh,Xh,qh,Kh,Yh,Jh,Qh,$h,Zh,tf,ef,nf,rf,sf,of,af,uf,hf,ff,lf,cf,pf,_f,df,gf,vf,mf,yf,bf,Af,Tf,If,Rf,wf,Ef,Df,Sf,Cf,xf,Mf,Pf,Lf,kf,Of,Bf,Nf,Ff,Uf,Hf,Gf,zf,Vf,jf,Wf,Xf,qf,Kf,Yf,Jf,Qf,$f,Zf,tl,el=yt(),il=yt(),nl=bt(),rl=bt(),sl=bt(),ol=new gt,al=mt(),ul=mt(),hl=[],fl=Symbol("ReserveContentsForAllSyncablePrefab"),ll=0,cl=0,pl=t("N",(iu=tt("cc.Node"),nu=dt(ut),ru=dt(Wa),iu((mu=function(t){n(i,t);var e=i.prototype;function i(e){var i;return void 0===e&&(e="New Node"),(i=t.call(this,e)||this)._parent=au&&au(),i._children=uu&&uu(),i._active=hu&&hu(),i._components=fu&&fu(),i._prefab=lu&&lu(),i._scene=null,i._activeInHierarchy=!1,i._id=xu.getNewId(),i._eventProcessor=new eu(V(i)),i._eventMask=0,i._siblingIndex=0,i._originalSceneId="",i._uiProps=new qa(V(i)),i._static=!1,i._lpos=cu&&cu(),i._lrot=pu&&pu(),i._lscale=_u&&_u(),i._mobility=du&&du(),i._layer=gu&&gu(),i._euler=vu&&vu(),i._transformFlags=Ha.TRS|Ha.SKEW,i._eulerDirty=!1,i._flagChangeVersion=0,i._hasChangedFlags=0,i._pos=new ut,i._rot=new ft,i._scale=new ut(1,1,1),i._mat=new _t,i}return e._setActiveInHierarchy=function(t){this._activeInHierarchy=t},i._setScene=function(t){t._updateScene()},i._incSkewCompCount=function(){++cl},i._decSkewCompCount=function(){--cl},i._findComponent=function(t,e){var i=e,n=t._components;if(i._sealed)for(var r=0;r<n.length;++r){var s=n[r];if(s.constructor===e)return s}else for(var o=0;o<n.length;++o){var a=n[o];if(a instanceof e)return a}return null},i._findComponents=function(t,e,i){var n=e,r=t._components;if(n._sealed)for(var s=0;s<r.length;++s){var o=r[s];o.constructor===e&&i.push(o)}else for(var a=0;a<r.length;++a){var u=r[a];u instanceof e&&i.push(u)}},i._findChildComponent=function(t,e){for(var n=0;n<t.length;++n){var r=t[n],s=i._findComponent(r,e);if(s)return s;if(r._children.length>0&&(s=i._findChildComponent(r._children,e)))return s}return null},i._findChildComponents=function(t,e,n){for(var r=0;r<t.length;++r){var s=t[r];i._findComponents(s,e,n),s._children.length>0&&i._findChildComponents(s._children,e,n)}},e.getWritableComponents=function(){return this._components},e._updateScene=function(){null==this._parent?l(1640,this.name,this.uuid):this._scene=this._parent._scene},e.attr=function(t){O(this,t)},e.getParent=function(){return this._parent},e.modifyParent=function(t){this._parent=t},e.setParent=function(t,e){if(void 0===e&&(e=!1),e&&this.updateWorldTransform(),this._parent!==t){var i=this._parent,n=t;if(i&&i._objFlags&Eu&&l(3821),this._parent=n,this._siblingIndex=0,this._onSetParent(i,e),this.emit&&this.emit(be.PARENT_CHANGED,i),i&&!(i._objFlags&Ru)){var r=i._children.indexOf(this);i._children.splice(r,1),i._updateSiblingIndex(),i.emit&&i.emit(be.CHILD_REMOVED,this)}n&&(n._objFlags&Eu&&l(3821),n._children.push(this),this._siblingIndex=n._children.length-1,n.emit&&n.emit(be.CHILD_ADDED,this)),this._onHierarchyChanged(i)}},e.getChildByUuid=function(t){if(!t)return q("Invalid uuid"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._id===t)return e[i];return null},e.getChildByName=function(t){if(!t)return q("Invalid name"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._name===t)return e[i];return null},e.getChildByPath=function(t){for(var e,i=t.split("/"),n=this,r=function(){var t=i[s];if(0===t.length)return 0;var e=n.children.find((function(e){return e.name===t}));if(!e)return{v:null};n=e},s=0;s<i.length;++s)if(0!==(e=r())&&e)return e.v;return n},e.addChild=function(t){t.setParent(this)},e.insertChild=function(t,e){t.setParent(this),t.setSiblingIndex(e)},e.getSiblingIndex=function(){return this._siblingIndex},e.setSiblingIndex=function(t){if(this._parent)if(this._parent._objFlags&Eu)l(3821);else{var e=this._parent._children;t=t>=0?t:e.length+t;var i=e.indexOf(this);t!==i&&(e.splice(i,1),t<e.length?e.splice(t,0,this):e.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t),this._eventProcessor.onUpdatingSiblingIndex())}},e.walk=function(t,e){var n=1,r=null,s=null,o=0,a=i._stacks[i._stackId];a||(a=[],i._stacks.push(a)),i._stackId++,a.length=0,a[0]=this;for(var u=null,h=!1;n;)if(s=a[--n])if(!h&&t?t(s):h&&e&&e(s),a[n]=null,h){if(u===this._parent)break;if(h=!1,r)if(r[++o])a[n]=r[o],n++;else if(u&&(a[n]=u,n++,h=!0,u._parent?(o=(r=u._parent._children).indexOf(u),u=u._parent):(u=null,r=null),o<0))break}else s._children.length>0?(u=s,r=s._children,o=0,a[n]=r[o],n++):(a[n]=s,n++,h=!0);a.length=0,i._stackId--},e.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},e.removeChild=function(t){this._children.indexOf(t)>-1&&(t.parent=null)},e.removeAllChildren=function(){for(var t=this._children,e=t.length-1;e>=0;e--){var i=t[e];i&&(i.parent=null)}this._children.length=0},e.isChildOf=function(t){var e=this;do{if(e===t)return!0;e=e._parent}while(e);return!1},e.getComponent=function(t){var e=Mu(t);return e?i._findComponent(this,e):null},e.getComponents=function(t){var e=Mu(t),n=[];return e&&i._findComponents(this,e,n),n},e.getComponentInChildren=function(t){var e=Mu(t);return e?i._findChildComponent(this._children,e):null},e.getComponentsInChildren=function(t){var e=Mu(t),n=[];return e&&(i._findComponents(this,e,n),i._findChildComponents(this._children,e,n)),n},e.addComponent=function(t){var e;if("string"==typeof t){if(!(e=K(t)))throw Pt._RF.peek()&&l(3808,t),TypeError(d(3807,t))}else{if(!t)throw TypeError(d(3804));e=t}if("function"!=typeof e)throw TypeError(d(3809));if(!T(e,Pt.Component))throw TypeError(d(3810));var i=e._requireComponent;if(i)if(Array.isArray(i))for(var n=0;n<i.length;n++){var r=i[n];this.getComponent(r)||this.addComponent(r)}else{var s=i;this.getComponent(s)||this.addComponent(s)}var o=new e;return o.node=this,this._components.push(o),this.emit(be.COMPONENT_ADDED,o),this._activeInHierarchy&&Pt.director._nodeActivator.activateComp(o),o},e.removeComponent=function(t){if(t){var e=null;(e=t instanceof Qt?t:this.getComponent(t))&&e.destroy()}else l(3813)},e.on=function(t,e,i,n){switch(void 0===n&&(n=!1),t){case Du:this._eventMask|=Cu;break;case Su:this._eventMask|=2}this._eventProcessor.on(t,e,i,n)},e.off=function(t,e,i,n){if(void 0===n&&(n=!1),this._eventProcessor.off(t,e,i,n),!this._eventProcessor.hasEventListener(t))switch(t){case Du:this._eventMask&=~Cu;break;case Su:this._eventMask&=-3}},e.once=function(t,e,i,n){this._eventProcessor.once(t,e,i,n)},e.emit=function(t,e,i,n,r,s){this._eventProcessor.emit(t,e,i,n,r,s)},e.dispatchEvent=function(t){this._eventProcessor.dispatchEvent(t)},e.hasEventListener=function(t,e,i){return this._eventProcessor.hasEventListener(t,e,i)},e.targetOff=function(t){this._eventProcessor.targetOff(t),this._eventMask&Cu&&!this._eventProcessor.hasEventListener(Du)&&(this._eventMask&=~Cu),2&this._eventMask&&!this._eventProcessor.hasEventListener(Su)&&(this._eventMask&=-3)},e.destroy=function(){return!!t.prototype.destroy.call(this)&&(this.active=!1,!0)},e.destroyAllChildren=function(){for(var t=this._children,e=0;e<t.length;++e)t[e].destroy()},e._removeComponent=function(t){if(t){if(!(this._objFlags&Ru)){var e=this._components.indexOf(t);-1!==e?(this._components.splice(e,1),this.emit(be.COMPONENT_REMOVED,t)):t.node!==this&&l(3815)}}else l(3814)},e._updateSiblingIndex=function(){for(var t=0;t<this._children.length;++t)this._children[t]._siblingIndex=t;this.emit(be.CHILDREN_ORDER_CHANGED)},e._instantiate=function(t,e){return void 0===e&&(e=!1),t||(t=Pt.instantiate._clone(this,this)),t._prefab,t._parent=null,t._onBatchCreated(e),t},e._onHierarchyChangedBase=function(){var t=this._parent;!this._persistNode||t instanceof Pt.Scene||Pt.game.removePersistRootNode(this);var e=this._active&&!(!t||!t._activeInHierarchy);this._activeInHierarchy!==e&&Pt.director._nodeActivator.activateNode(this,e)},e._onPreDestroyBase=function(){this._objFlags|=Ru;var t=this._parent,e=!!t&&!!(t._objFlags&Ru);if(this._persistNode&&Pt.game.removePersistRootNode(this),!e&&t){this.emit(be.PARENT_CHANGED,this);var i=t._children.indexOf(this);t._children.splice(i,1),this._siblingIndex=0,t._updateSiblingIndex(),t.emit&&t.emit(be.CHILD_REMOVED,this)}this.emit(be.NODE_DESTROYED,this),this._eventProcessor.destroy();for(var n=this._children,r=0;r<n.length;++r)n[r]._destroyImmediate();for(var s=this._components,o=0;o<s.length;++o)s[o]._destroyImmediate();return e},i.isNode=function(t){return t instanceof i&&(t.constructor===i||!(t instanceof Pt.Scene))},e._onPreDestroy=function(){return this._onPreDestroyBase()},e[At]=function(t){t.writeThis()},e._onSetParent=function(t,e){void 0===e&&(e=!1);var n=this,r=n._parent;if(r&&(null!=t&&t._scene===r._scene||null==r._scene||n.walk(i._setScene)),e){if(r)if(r.updateWorldTransform(),Tt(_t.determinant(r._mat),0,Rt))a(14300),n._transformFlags|=Ha.TRS,n.updateWorldTransform();else{var s=r._mat;if(cl>0){if(t){var o=Tu(t,ul);_t.fromSRT(al,n._lrot,n._lpos,n._lscale);var u=o?ul:t._mat;_t.multiply(n._mat,u,al)}Tu(r,ul)&&(s=ul)}_t.multiply(al,_t.invert(al,s),n._mat),_t.toSRT(al,n._lrot,n._lpos,n._lscale)}else ut.copy(n._lpos,n._pos),ft.copy(n._lrot,n._rot),ut.copy(n._lscale,n._scale);n._eulerDirty=!0}n.invalidateChildren(Ha.TRS)},e._onHierarchyChanged=function(t){this.eventProcessor.reattach(),this._onHierarchyChangedBase(t)},e._onBatchCreated=function(t){2&this._eventMask&&(this._activeInHierarchy||this.emit(Su,this,!1)),this.hasChangedFlags=Ha.TRS,this._children.forEach((function(e,i){e._siblingIndex=i,e._onBatchCreated(t)}))},e._onBeforeSerialize=function(){this.eulerAngles},e._onPostActivated=function(t){var e=this;2&e._eventMask&&e.emit(Su,e,t);var i=this._eventProcessor;if(i.isEnabled===t&&eu.callbacksInvoker.emit(Ka.MARK_LIST_DIRTY),i.setEnabled(t),t){e.invalidateChildren(Ha.TRS);var n=e._uiProps&&e._uiProps.uiComp;n&&(n.setNodeDirty(),n.setTextureDirty(),n._markForUpdateRenderData())}},e.translate=function(t,e){var i=e||Ua.LOCAL;if(i===Ua.LOCAL)ut.transformQuat(el,t,this._lrot),this._lpos.x+=el.x,this._lpos.y+=el.y,this._lpos.z+=el.z;else if(i===Ua.WORLD)if(this._parent){ft.invert(nl,this._parent.worldRotation),ut.transformQuat(el,t,nl);var n=this.worldScale;this._lpos.x+=el.x/n.x,this._lpos.y+=el.y/n.y,this._lpos.z+=el.z/n.z}else this._lpos.x+=t.x,this._lpos.y+=t.y,this._lpos.z+=t.z;this.invalidateChildren(Ha.POSITION),this._eventMask&Cu&&this.emit(Du,Ha.POSITION)},e.rotate=function(t,e){var i=e||Ua.LOCAL;if(ft.normalize(nl,t),i===Ua.LOCAL)ft.multiply(this._lrot,this._lrot,nl);else if(i===Ua.WORLD){var n=this.worldRotation;ft.multiply(rl,nl,n),ft.invert(nl,n),ft.multiply(rl,nl,rl),ft.multiply(this._lrot,this._lrot,rl)}this._eulerDirty=!0,this.invalidateChildren(Ha.ROTATION),this._eventMask&Cu&&this.emit(Du,Ha.ROTATION)},e.lookAt=function(t,e){this.getWorldPosition(el),ut.subtract(el,el,t),ut.normalize(el,el),ft.fromViewUp(nl,el,e),this.setWorldRotation(nl)},e.invalidateChildren=function(t){var e,i,n=0,r=0,s=0,o=0,a=t|Ha.POSITION;for(hl[0]=this;n>=0;){if(o=(e=hl[n--]).hasChangedFlags,e.isValid&&!e.isSkipTransformUpdate&&(e._transformFlags&o&t)!==t)for(e._transformFlags|=t,e.hasChangedFlags=o|t,s=(i=e._children).length,r=0;r<s;r++)hl[++n]=i[r];t=a}},e.updateWorldTransform=function(){if(this._transformFlags){for(var t,e,i,n=this,r=0;n&&n._transformFlags;)hl[r++]=n,n=n._parent;for(var s=0,o=0,a=0,u=null,h=!1;r;){if(e=(t=hl[--r])._mat,i=t._pos,o=(s|=t._transformFlags)&Ha.POSITION,a=s&Ha.RSS,n){if(o&&!a&&(ut.transformMat4(i,t._lpos,n._mat),e.m12=i.x,e.m13=i.y,e.m14=i.z),a){var f=e;_t.fromSRT(al,t._lrot,t._lpos,t._lscale),cl>0&&(h=Tu(n,ul),((u=t._uiProps._uiSkewComp)||h)&&(_t.multiply(ul,ul,al),u&&Iu(u,al),f=ul)),_t.multiply(e,n._mat,al);var l=s&Ha.ROTATION?t._rot:null;_t.toSRT(f,l,i,t._scale),h&&ut.transformMat4(i,t._lpos,n._mat)}}else o&&(ut.copy(i,t._lpos),e.m12=i.x,e.m13=i.y,e.m14=i.z),a&&(s&Ha.ROTATION&&ft.copy(t._rot,t._lrot),s&Ha.SCALE&&ut.copy(t._scale,t._lscale),_t.fromSRT(e,t._rot,t._pos,t._scale),cl>0&&(u=t._uiProps._uiSkewComp)&&Iu(u,e));t._transformFlags=Ha.NONE,n=t}}},e.setPosition=function(t,e,i){var n=this._lpos;void 0===e?ut.copy(n,t):(void 0===i&&(i=n.z),ut.set(n,t,e,i)),this.invalidateChildren(Ha.POSITION),this._eventMask&Cu&&this.emit(Du,Ha.POSITION)},e.getPosition=function(t){return t?ut.set(t,this._lpos.x,this._lpos.y,this._lpos.z):ut.copy(new ut,this._lpos)},e.setRotation=function(t,e,i,n){void 0===e?ft.copy(this._lrot,t):ft.set(this._lrot,t,e,i,n),this._eulerDirty=!0,this.invalidateChildren(Ha.ROTATION),this._eventMask&Cu&&this.emit(Du,Ha.ROTATION)},e.setRotationFromEuler=function(t,e,i){if(void 0===e)ut.copy(this._euler,t),ft.fromEuler(this._lrot,t.x,t.y,t.z);else{var n=void 0===i?this._euler.z:i;ut.set(this._euler,t,e,n),ft.fromEuler(this._lrot,t,e,n)}this._eulerDirty=!1,this.invalidateChildren(Ha.ROTATION),this._eventMask&Cu&&this.emit(Du,Ha.ROTATION)},e.getRotation=function(t){return t?ft.set(t,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):ft.copy(new ft,this._lrot)},e.setScale=function(t,e,i){var n=this._lscale;void 0===e?ut.copy(n,t):(void 0===i&&(i=n.z),ut.set(n,t,e,i)),this.invalidateChildren(Ha.SCALE),this._eventMask&Cu&&this.emit(Du,Ha.SCALE)},e.getScale=function(t){return t?ut.set(t,this._lscale.x,this._lscale.y,this._lscale.z):ut.copy(new ut,this._lscale)},e.inverseTransformPoint=function(t,e){ut.copy(t,e);for(var i=this,n=0;i._parent;)hl[n++]=i,i=i._parent;for(;n>=0;)ut.transformInverseRTS(t,t,i._lrot,i._lpos,i._lscale),i=hl[--n];return t},e.setWorldPosition=function(t,e,i){var n=this._pos;void 0===e?ut.copy(n,t):ut.set(n,t,e,i);var r=this._parent,s=this._lpos;r?(r.updateWorldTransform(),ut.transformMat4(s,n,_t.invert(al,r._mat))):ut.copy(s,n),this.invalidateChildren(Ha.POSITION),this._eventMask&Cu&&this.emit(Du,Ha.POSITION)},e.getWorldPosition=function(t){return this.updateWorldTransform(),t?ut.copy(t,this._pos):ut.copy(new ut,this._pos)},e.setWorldRotation=function(t,e,i,n){var r=this._rot;void 0===e?ft.copy(r,t):ft.set(r,t,e,i,n),this._parent?(this._parent.updateWorldTransform(),ft.multiply(this._lrot,ft.conjugate(this._lrot,this._parent._rot),r)):ft.copy(this._lrot,r),this._eulerDirty=!0,this.invalidateChildren(Ha.ROTATION),this._eventMask&Cu&&this.emit(Du,Ha.ROTATION)},e.setWorldRotationFromEuler=function(t,e,i){ft.fromEuler(nl,t,e,i),this.setWorldRotation(nl)},e.getWorldRotation=function(t){return this.updateWorldTransform(),t?ft.copy(t,this._rot):ft.copy(new ft,this._rot)},e.setWorldScale=function(t,e,i){var n=this,r=n._parent;r&&n.updateWorldTransform();var s=n._scale;void 0===e?ut.copy(s,t):ut.set(s,t,e,i);var o=Ha.NONE;if(r){var a=n._mat;n._uiProps._uiSkewComp&&(_t.fromSRT(al,n._lrot,n._lpos,n._lscale),_t.multiply(a,r._mat,al));var u=ut.set(il,a.m00,a.m01,a.m02).length(),h=ut.set(il,a.m04,a.m05,a.m06).length(),f=ut.set(il,a.m08,a.m09,a.m10).length();0===u?(el.x=s.x,a.m00=1,o=Ha.ROTATION):el.x=s.x/u,0===h?(el.y=s.y,a.m05=1,o=Ha.ROTATION):el.y=s.y/h,0===f?(el.z=s.z,a.m10=1,o=Ha.ROTATION):el.z=s.z/f,_t.scale(al,a,el),_t.multiply(ul,_t.invert(ul,r._mat),al),gt.fromQuat(ol,ft.conjugate(sl,n._lrot)),gt.multiplyMat4(ol,ol,ul);var l=n._lscale;l.x=ut.set(el,ol.m00,ol.m01,ol.m02).length(),l.y=ut.set(el,ol.m03,ol.m04,ol.m05).length(),l.z=ut.set(el,ol.m06,ol.m07,ol.m08).length(),0!==l.x&&0!==l.y&&0!==l.z||(o=Ha.ROTATION)}else ut.copy(n._lscale,s);n.invalidateChildren(Ha.SCALE|o),n._eventMask&Cu&&n.emit(Du,Ha.SCALE|o)},e.getWorldScale=function(t){return this.updateWorldTransform(),t?ut.copy(t,this._scale):ut.copy(new ut,this._scale)},e.getWorldMatrix=function(t){this.updateWorldTransform();var e=t||new _t;return _t.copy(e,this._mat)},e.getWorldRS=function(t){this.updateWorldTransform();var e=t||new _t;return _t.copy(e,this._mat),e.m12=0,e.m13=0,e.m14=0,e},e.getWorldRT=function(t){this.updateWorldTransform();var e=t||new _t;return _t.fromRT(e,this._rot,this._pos)},e.setRTS=function(t,e,i){var n=0;t&&(n|=Ha.ROTATION,void 0!==t.w?(ft.copy(this._lrot,t),this._eulerDirty=!0):(ut.copy(this._euler,t),ft.fromEuler(this._lrot,t.x,t.y,t.z),this._eulerDirty=!1)),e&&(ut.copy(this._lpos,e),n|=Ha.POSITION),i&&(ut.copy(this._lscale,i),n|=Ha.SCALE),n&&(this.invalidateChildren(n),this._eventMask&Cu&&this.emit(Du,n))},e.isTransformDirty=function(){return this._transformFlags!==Ha.NONE},e.pauseSystemEvents=function(t){this._eventProcessor.setEnabled(!1,t)},e.resumeSystemEvents=function(t){this._eventProcessor.setEnabled(!0,t)},i.resetHasChangedFlags=function(){ll+=1},i.clearNodeArray=function(){i.ClearFrame<i.ClearRound&&!Ct?i.ClearFrame++:(i.ClearFrame=0,hl.length=0)},e.getPathInHierarchy=function(){for(var t=this.name,e=this.parent;e&&!(e instanceof Pt.Scene);)t=e.name+"/"+t,e=e.parent;return t},e._getUITransformComp=function(){return this._uiProps.uiTransformComp},u(i,[{key:"components",get:function(){return this._components}},{key:"_persistNode",get:function(){return(this._objFlags&wu)>0},set:function(t){t?this._objFlags|=wu:this._objFlags&=~wu}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"active",get:function(){return this._active},set:function(t){if(t=!!t,this._active!==t){this._active=t;var e=this._parent;e&&e._activeInHierarchy&&Pt.director._nodeActivator.activateNode(this,t)}}},{key:"activeInHierarchy",get:function(){return this._activeInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(t){this.setParent(t)}},{key:"scene",get:function(){return this._scene}},{key:"eventProcessor",get:function(){return this._eventProcessor}},{key:"prefab",get:function(){return this._prefab}},{key:"id",set:function(t){this._id=t}},{key:"siblingIndex",get:function(){return this._siblingIndex},set:function(t){this._siblingIndex=t}},{key:"position",get:function(){return this._lpos},set:function(t){this.setPosition(t)}},{key:"x",get:function(){return this._lpos.x},set:function(t){this.setPosition(t,this._lpos.y,this._lpos.z)}},{key:"y",get:function(){return this._lpos.y},set:function(t){this.setPosition(this._lpos.x,t,this._lpos.z)}},{key:"z",get:function(){return this._lpos.z},set:function(t){this.setPosition(this._lpos.x,this._lpos.y,t)}},{key:"worldPosition",get:function(){return this.updateWorldTransform(),this._pos},set:function(t){this.setWorldPosition(t)}},{key:"worldPositionX",get:function(){return this.updateWorldTransform(),this._pos.x},set:function(t){this.setWorldPosition(t,this._pos.y,this._pos.z)}},{key:"worldPositionY",get:function(){return this.updateWorldTransform(),this._pos.y},set:function(t){this.setWorldPosition(this._pos.x,t,this._pos.z)}},{key:"worldPositionZ",get:function(){return this.updateWorldTransform(),this._pos.z},set:function(t){this.setWorldPosition(this._pos.x,this._pos.y,t)}},{key:"rotation",get:function(){return this._lrot},set:function(t){this.setRotation(t)}},{key:"eulerAngles",get:function(){return this._eulerDirty&&(ft.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler},set:function(t){this.setRotationFromEuler(t.x,t.y,t.z)}},{key:"angle",get:function(){return this.eulerAngles.z},set:function(t){ut.set(this._euler,0,0,t),ft.fromAngleZ(this._lrot,t),this._eulerDirty=!1,this.invalidateChildren(Ha.ROTATION),this._eventMask&Cu&&this.emit(Du,Ha.ROTATION)}},{key:"worldRotation",get:function(){return this.updateWorldTransform(),this._rot},set:function(t){this.setWorldRotation(t)}},{key:"scale",get:function(){return this._lscale},set:function(t){this.setScale(t)}},{key:"worldScale",get:function(){return this.updateWorldTransform(),this._scale},set:function(t){this.setWorldScale(t)}},{key:"matrix",set:function(t){_t.toSRT(t,this._lrot,this._lpos,this._lscale),this.invalidateChildren(Ha.TRS),this._eulerDirty=!0,this._eventMask&Cu&&this.emit(Du,Ha.TRS)}},{key:"worldMatrix",get:function(){return this.updateWorldTransform(),this._mat}},{key:"forward",get:function(){return ut.transformQuat(new ut,ut.FORWARD,this.worldRotation)},set:function(t){var e=t.length();ut.multiplyScalar(el,t,-1/e),ft.fromViewUp(nl,el),this.setWorldRotation(nl)}},{key:"up",get:function(){return ut.transformQuat(new ut,ut.UP,this.worldRotation)}},{key:"right",get:function(){return ut.transformQuat(new ut,ut.RIGHT,this.worldRotation)}},{key:"mobility",get:function(){return this._mobility},set:function(t){this._mobility!==t&&(this._mobility=t,this.emit(be.MOBILITY_CHANGED))}},{key:"layer",get:function(){return this._layer},set:function(t){var e=this;if(e._layer!==t){e._layer=t;var i=e._uiProps&&e._uiProps.uiComp;i&&(i.setNodeDirty(),i._markForUpdateRenderData()),e.emit(be.LAYER_CHANGED,e._layer)}}},{key:"flagChangedVersion",get:function(){return this._flagChangeVersion}},{key:"hasChangedFlags",get:function(){return this._flagChangeVersion===ll?this._hasChangedFlags:0},set:function(t){this._flagChangeVersion=ll,this._hasChangedFlags=t}},{key:"isSkipTransformUpdate",get:function(){return!!(this._objFlags&j.IsSkipTransformUpdate)},set:function(t){t?this._objFlags|=j.IsSkipTransformUpdate:this._objFlags&=~j.IsSkipTransformUpdate}}]),i}(Y),mu.idGenerator=xu,mu._stacks=[[]],mu._stackId=0,mu.EventType=be,mu.NodeSpace=Ua,mu.TransformDirtyBit=Ha,mu.TransformBit=Ha,mu.reserveContentsForAllSyncablePrefabTag=fl,mu.ClearFrame=0,mu.ClearRound=1e3,h((ou=mu).prototype,"_persistNode",[It],Object.getOwnPropertyDescriptor(ou.prototype,"_persistNode"),ou.prototype),au=nt(ou.prototype,"_parent",[rt],(function(){return null})),uu=nt(ou.prototype,"_children",[rt],(function(){return[]})),hu=nt(ou.prototype,"_active",[rt],(function(){return!0})),fu=nt(ou.prototype,"_components",[rt],(function(){return[]})),lu=nt(ou.prototype,"_prefab",[rt],(function(){return null})),cu=nt(ou.prototype,"_lpos",[rt],(function(){return new ut})),pu=nt(ou.prototype,"_lrot",[rt],(function(){return new ft})),_u=nt(ou.prototype,"_lscale",[rt],(function(){return new ut(1,1,1)})),du=nt(ou.prototype,"_mobility",[rt],(function(){return Wa.Static})),gu=nt(ou.prototype,"_layer",[rt],(function(){return Yt.Enum.DEFAULT})),vu=nt(ou.prototype,"_euler",[rt],(function(){return new ut})),h(ou.prototype,"eulerAngles",[nu],Object.getOwnPropertyDescriptor(ou.prototype,"eulerAngles"),ou.prototype),h(ou.prototype,"mobility",[ru],Object.getOwnPropertyDescriptor(ou.prototype,"mobility"),ou.prototype),su=ou))||su));Pt.Node=pl;var _l=new ut(0,1,0),dl=new ut,gl=new ht,vl=new lt,ml=new ft,yl=function(t){var e=1/Math.max(Math.max(Math.max(t.x,t.y),t.z),1e-4);e<1&&(t.x*=e,t.y*=e,t.z*=e)},bl=t("a0",(Pu=tt("cc.AmbientInfo"),Lu=dt(J),ku=wt("_skyColor"),Ou=wt("_skyIllum"),Bu=wt("_groundAlbedo"),Pu((Fu=function(){function t(){this._skyColorHDR=Uu&&Uu(),this._skyIllumHDR=Hu&&Hu(),this._groundAlbedoHDR=Gu&&Gu(),this._skyColorLDR=zu&&zu(),this._skyIllumLDR=Vu&&Vu(),this._groundAlbedoLDR=ju&&ju(),this._resource=null}return t.prototype.activate=function(t){this._resource=t,t.initialize(this)},u(t,[{key:"skyColorHDR",get:function(){return this._skyColorHDR}},{key:"groundAlbedoHDR",get:function(){return this._groundAlbedoHDR}},{key:"skyIllumHDR",get:function(){return this._skyIllumHDR}},{key:"skyColorLDR",get:function(){return this._skyColorLDR}},{key:"groundAlbedoLDR",get:function(){return this._groundAlbedoLDR}},{key:"skyIllumLDR",get:function(){return this._skyIllumLDR}},{key:"skyLightingColor",get:function(){var t=Ma().isHDR;return gl.set(t?this._skyColorHDR:this._skyColorLDR),yl(gl),vl.set(255*gl.x,255*gl.y,255*gl.z,255)},set:function(t){gl.set(t.x,t.y,t.z,t.w),Ma().isHDR?this._skyColorHDR.set(gl):this._skyColorLDR.set(gl),this._resource&&this._resource.skyColor.set(gl)}},{key:"skyColor",set:function(t){Ma().isHDR?this._skyColorHDR.set(t):this._skyColorLDR.set(t),this._resource&&this._resource.skyColor.set(t)}},{key:"skyIllum",get:function(){return Ma().isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(t){Ma().isHDR?this._skyIllumHDR=t:this._skyIllumLDR=t,this._resource&&(this._resource.skyIllum=t)}},{key:"groundLightingColor",get:function(){var t=Ma().isHDR;return gl.set(t?this._groundAlbedoHDR:this._groundAlbedoLDR),yl(gl),vl.set(255*gl.x,255*gl.y,255*gl.z,255)},set:function(t){gl.set(t.x,t.y,t.z,t.w),Ma().isHDR?this._groundAlbedoHDR.set(gl):this._groundAlbedoLDR.set(gl),this._resource&&this._resource.groundAlbedo.set(gl)}},{key:"groundAlbedo",set:function(t){Ma().isHDR?this._groundAlbedoHDR.set(t):this._groundAlbedoLDR.set(t),this._resource&&this._resource.groundAlbedo.set(t)}}]),t}(),h(Fu.prototype,"skyIllum",[Lu],Object.getOwnPropertyDescriptor(Fu.prototype,"skyIllum"),Fu.prototype),Uu=nt(Fu.prototype,"_skyColorHDR",[rt,ku],(function(){return new ht(.2,.5,.8,1)})),Hu=nt(Fu.prototype,"_skyIllumHDR",[rt,Ou],(function(){return Pa.SKY_ILLUM})),Gu=nt(Fu.prototype,"_groundAlbedoHDR",[rt,Bu],(function(){return new ht(.2,.2,.2,1)})),zu=nt(Fu.prototype,"_skyColorLDR",[rt],(function(){return new ht(.2,.5,.8,1)})),Vu=nt(Fu.prototype,"_skyIllumLDR",[rt],(function(){return Pa.SKY_ILLUM})),ju=nt(Fu.prototype,"_groundAlbedoLDR",[rt],(function(){return new ht(.2,.2,.2,1)})),Nu=Fu))||Nu));Lt.AmbientInfo=bl;var Al=t("a1",(Wu=tt("cc.SkyboxInfo"),Xu=dt(La),qu=dt(Rr),Ku=dt(J),Yu=dt(Rr),Ju=dt(Rr),Qu=dt(Ea),$u=dt(Rr),Zu=wt("_envmap"),th=dt(Rr),eh=dt(Rr),ih=dt(Rr),nh=dt(Ea),rh=dt(Rr),sh=dt(Rr),Wu((ah=function(){function t(){this._envLightingType=uh&&uh(),this._envmapHDR=hh&&hh(),this._envmapLDR=fh&&fh(),this._diffuseMapHDR=lh&&lh(),this._diffuseMapLDR=ch&&ch(),this._enabled=ph&&ph(),this._useHDR=_h&&_h(),this._editableMaterial=dh&&dh(),this._reflectionHDR=gh&&gh(),this._reflectionLDR=vh&&vh(),this._rotationAngle=mh&&mh(),this._resource=null}var e=t.prototype;return e.activate=function(t){this.envLightingType=this._envLightingType,this._resource=t,t.initialize(this),t.setEnvMaps(this._envmapHDR,this._envmapLDR),t.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),t.setSkyboxMaterial(this._editableMaterial),t.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),t.setRotationAngle(this._rotationAngle),t.activate()},e.updateEnvMap=function(t){t||(this.applyDiffuseMap=!1,this.useIBL=!1,this.envLightingType=La.HEMISPHERE_DIFFUSE,a(15001));var e=this._resource;e&&(e.setEnvMaps(this._envmapHDR,this._envmapLDR),e.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),e.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),e.useDiffuseMap=this.applyDiffuseMap,e.envmap=t)},e.setMaterialProperty=function(t,e,i){var n=this._resource;if(n){var r=n.editableMaterial;n.enabled&&r&&(r.setProperty(t,e,i),r.passes.forEach((function(t){t.update()})))}},u(t,[{key:"applyDiffuseMap",get:function(){return La.DIFFUSEMAP_WITH_REFLECTION===this._envLightingType},set:function(t){this._resource&&(this._resource.useDiffuseMap=t)}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=this._enabled))}},{key:"envLightingType",get:function(){return this._envLightingType},set:function(t){this.envmap||La.HEMISPHERE_DIFFUSE===t?(La.HEMISPHERE_DIFFUSE===t?(this.useIBL=!1,this.applyDiffuseMap=!1):La.AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION===t?(this.useIBL=!0,this.applyDiffuseMap=!1):La.DIFFUSEMAP_WITH_REFLECTION===t&&(this.useIBL=!0,this.applyDiffuseMap=!0),this._envLightingType=t):(this.useIBL=!1,this.applyDiffuseMap=!1,this._envLightingType=La.HEMISPHERE_DIFFUSE,a(15001))}},{key:"useIBL",get:function(){return La.HEMISPHERE_DIFFUSE!==this._envLightingType},set:function(t){this._resource&&(this._resource.useIBL=t)}},{key:"useHDR",get:function(){return Ma().isHDR=this._useHDR,this._useHDR},set:function(t){Ma().isHDR=t,this._useHDR=t;var e=this._resource;e&&this.envLightingType===La.DIFFUSEMAP_WITH_REFLECTION&&(null===this.diffuseMap?(this.envLightingType=La.AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION,a(15e3)):this.diffuseMap.isDefault&&a(15002)),e&&(e.useHDR=this._useHDR,e.updateMaterialRenderInfo())}},{key:"envmap",get:function(){return Ma().isHDR?this._envmapHDR:this._envmapLDR},set:function(t){var e=Ma().isHDR;e?(this._envmapHDR=t,this._reflectionHDR=null):(this._envmapLDR=t,this._reflectionLDR=null),t||(e?this._diffuseMapHDR=null:this._diffuseMapLDR=null,this.applyDiffuseMap=!1,this.useIBL=!1,this.envLightingType=La.HEMISPHERE_DIFFUSE,a(15001));var i=this._resource;i&&(i.setEnvMaps(this._envmapHDR,this._envmapLDR),i.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),i.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),i.useDiffuseMap=this.applyDiffuseMap,i.envmap=t)}},{key:"rotationAngle",get:function(){return this._rotationAngle},set:function(t){this._rotationAngle=t,this._resource&&this._resource.setRotationAngle(this._rotationAngle)}},{key:"diffuseMap",get:function(){return Ma().isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(t){Ma().isHDR?this._diffuseMapHDR=t:this._diffuseMapLDR=t,this._resource&&this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR)}},{key:"reflectionMap",get:function(){return Ma().isHDR?this._reflectionHDR:this._reflectionLDR},set:function(t){Ma().isHDR?this._reflectionHDR=t:this._reflectionLDR=t,this._resource&&this._resource.setReflectionMaps(this._reflectionHDR,this._reflectionLDR)}},{key:"skyboxMaterial",get:function(){return this._editableMaterial},set:function(t){this._editableMaterial=t,this._resource&&this._resource.setSkyboxMaterial(this._editableMaterial)}}]),t}(),h(ah.prototype,"envLightingType",[Xu],Object.getOwnPropertyDescriptor(ah.prototype,"envLightingType"),ah.prototype),h(ah.prototype,"envmap",[qu],Object.getOwnPropertyDescriptor(ah.prototype,"envmap"),ah.prototype),h(ah.prototype,"rotationAngle",[Ku],Object.getOwnPropertyDescriptor(ah.prototype,"rotationAngle"),ah.prototype),h(ah.prototype,"diffuseMap",[Yu],Object.getOwnPropertyDescriptor(ah.prototype,"diffuseMap"),ah.prototype),h(ah.prototype,"reflectionMap",[Ju],Object.getOwnPropertyDescriptor(ah.prototype,"reflectionMap"),ah.prototype),h(ah.prototype,"skyboxMaterial",[Qu],Object.getOwnPropertyDescriptor(ah.prototype,"skyboxMaterial"),ah.prototype),uh=nt(ah.prototype,"_envLightingType",[rt],(function(){return La.HEMISPHERE_DIFFUSE})),hh=nt(ah.prototype,"_envmapHDR",[rt,$u,Zu],(function(){return null})),fh=nt(ah.prototype,"_envmapLDR",[rt,th],(function(){return null})),lh=nt(ah.prototype,"_diffuseMapHDR",[rt,eh],(function(){return null})),ch=nt(ah.prototype,"_diffuseMapLDR",[rt,ih],(function(){return null})),ph=nt(ah.prototype,"_enabled",[rt],(function(){return!1})),_h=nt(ah.prototype,"_useHDR",[rt],(function(){return!0})),dh=nt(ah.prototype,"_editableMaterial",[rt,nh],(function(){return null})),gh=nt(ah.prototype,"_reflectionHDR",[rt,rh],(function(){return null})),vh=nt(ah.prototype,"_reflectionLDR",[rt,sh],(function(){return null})),mh=nt(ah.prototype,"_rotationAngle",[rt],(function(){return 0})),oh=ah))||oh));Lt.SkyboxInfo=Al;var Tl=t("a2",(yh=tt("cc.FogInfo"),bh=dt(za),Ah=dt(J),Th=dt(J),Ih=dt(J),Rh=dt(J),wh=dt(J),Eh=dt(J),yh((Uh=function(){function t(){this._type=Ch&&Ch(),this._fogColor=xh&&xh(),this._enabled=Mh&&Mh(),this._fogDensity=Ph&&Ph(),this._fogStart=Lh&&Lh(),this._fogEnd=kh&&kh(),this._fogAtten=Oh&&Oh(),this._fogTop=Bh&&Bh(),this._fogRange=Nh&&Nh(),this._accurate=Fh&&Fh(),this._resource=null}return t.prototype.activate=function(t){this._resource=t,t.initialize(this),t.activate()},u(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){if(this._enabled!==t){this._enabled=t;var e=this._resource;e&&(e.enabled=t,t&&(e.type=this._type))}}},{key:"accurate",get:function(){return this._accurate},set:function(t){if(this._accurate!==t){this._accurate=t;var e=this._resource;e&&(e.accurate=t,t&&(e.type=this._type))}}},{key:"fogColor",get:function(){return this._fogColor},set:function(t){this._fogColor.set(t),this._resource&&(this._resource.fogColor=this._fogColor)}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t,this._resource&&(this._resource.fogDensity=t)}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t,this._resource&&(this._resource.fogStart=t)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t,this._resource&&(this._resource.fogEnd=t)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t,this._resource&&(this._resource.fogAtten=t)}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t,this._resource&&(this._resource.fogTop=t)}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t,this._resource&&(this._resource.fogRange=t)}}]),t}(),Uh.FogType=za,h((Sh=Uh).prototype,"type",[bh],Object.getOwnPropertyDescriptor(Sh.prototype,"type"),Sh.prototype),h(Sh.prototype,"fogDensity",[Ah],Object.getOwnPropertyDescriptor(Sh.prototype,"fogDensity"),Sh.prototype),h(Sh.prototype,"fogStart",[Th],Object.getOwnPropertyDescriptor(Sh.prototype,"fogStart"),Sh.prototype),h(Sh.prototype,"fogEnd",[Ih],Object.getOwnPropertyDescriptor(Sh.prototype,"fogEnd"),Sh.prototype),h(Sh.prototype,"fogAtten",[Rh],Object.getOwnPropertyDescriptor(Sh.prototype,"fogAtten"),Sh.prototype),h(Sh.prototype,"fogTop",[wh],Object.getOwnPropertyDescriptor(Sh.prototype,"fogTop"),Sh.prototype),h(Sh.prototype,"fogRange",[Eh],Object.getOwnPropertyDescriptor(Sh.prototype,"fogRange"),Sh.prototype),Ch=nt(Sh.prototype,"_type",[rt],(function(){return za.LINEAR})),xh=nt(Sh.prototype,"_fogColor",[rt],(function(){return new lt("#C8C8C8")})),Mh=nt(Sh.prototype,"_enabled",[rt],(function(){return!1})),Ph=nt(Sh.prototype,"_fogDensity",[rt],(function(){return.3})),Lh=nt(Sh.prototype,"_fogStart",[rt],(function(){return.5})),kh=nt(Sh.prototype,"_fogEnd",[rt],(function(){return 300})),Oh=nt(Sh.prototype,"_fogAtten",[rt],(function(){return 5})),Bh=nt(Sh.prototype,"_fogTop",[rt],(function(){return 1.5})),Nh=nt(Sh.prototype,"_fogRange",[rt],(function(){return 1.2})),Fh=nt(Sh.prototype,"_accurate",[rt],(function(){return!1})),Dh=Sh))||Dh)),Il=t("a3",(Hh=tt("cc.ShadowsInfo"),Gh=dt(Sa),zh=dt(J),Vh=dt(J),jh=dt(Q),Wh=dt(Da),Hh((qh=function(){function t(){this._enabled=Kh&&Kh(),this._type=Yh&&Yh(),this._normal=Jh&&Jh(),this._distance=Qh&&Qh(),this._planeBias=$h&&$h(),this._shadowColor=Zh&&Zh(),this._maxReceived=tf&&tf(),this._size=ef&&ef(),this._resource=null}var e=t.prototype;return e.setPlaneFromNode=function(t){t.getWorldRotation(ml),this.planeDirection=ut.transformQuat(dl,_l,ml),t.getWorldPosition(dl),this.planeHeight=ut.dot(this._normal,dl)},e.activate=function(t){this._resource=t,t.initialize(this),t.activate()},u(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){if(this._enabled!==t){this._enabled=t;var e=this._resource;e&&(e.enabled=t,t&&(e.type=this._type))}}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor.set(t),this._resource&&(this._resource.shadowColor=t)}},{key:"planeDirection",get:function(){return this._normal},set:function(t){ut.copy(this._normal,t),this._resource&&(this._resource.normal=t)}},{key:"planeHeight",get:function(){return this._distance},set:function(t){this._distance=t,this._resource&&(this._resource.distance=t)}},{key:"planeBias",get:function(){return this._planeBias},set:function(t){this._planeBias=t,this._resource&&(this._resource.planeBias=t)}},{key:"maxReceived",get:function(){return this._maxReceived},set:function(t){this._maxReceived=t,this._resource&&(this._resource.maxReceived=t)}},{key:"shadowMapSize",get:function(){return this._size.x},set:function(t){var e=this._resource;this._size.set(t,t),e&&(e.size.set(t,t),e.shadowMapDirty=!0)}}]),t}(),h(qh.prototype,"type",[Gh],Object.getOwnPropertyDescriptor(qh.prototype,"type"),qh.prototype),h(qh.prototype,"planeHeight",[zh],Object.getOwnPropertyDescriptor(qh.prototype,"planeHeight"),qh.prototype),h(qh.prototype,"planeBias",[Vh],Object.getOwnPropertyDescriptor(qh.prototype,"planeBias"),qh.prototype),h(qh.prototype,"maxReceived",[jh],Object.getOwnPropertyDescriptor(qh.prototype,"maxReceived"),qh.prototype),h(qh.prototype,"shadowMapSize",[Wh],Object.getOwnPropertyDescriptor(qh.prototype,"shadowMapSize"),qh.prototype),Kh=nt(qh.prototype,"_enabled",[rt],(function(){return!1})),Yh=nt(qh.prototype,"_type",[rt],(function(){return Sa.Planar})),Jh=nt(qh.prototype,"_normal",[rt],(function(){return new ut(0,1,0)})),Qh=nt(qh.prototype,"_distance",[rt],(function(){return 0})),$h=nt(qh.prototype,"_planeBias",[rt],(function(){return 1})),Zh=nt(qh.prototype,"_shadowColor",[rt],(function(){return new lt(0,0,0,76)})),tf=nt(qh.prototype,"_maxReceived",[rt],(function(){return 4})),ef=nt(qh.prototype,"_size",[rt],(function(){return new at(1024,1024)})),Xh=qh))||Xh));Lt.ShadowsInfo=Il;var Rl=t("a4",new ut(-1024,-1024,-1024)),wl=t("a5",new ut(1024,1024,1024)),El=t("a6",8),Dl=t("a7",(nf=tt("cc.OctreeInfo"),rf=dt(Q),nf((of=function(){function t(){this._enabled=af&&af(),this._minPos=uf&&uf(),this._maxPos=hf&&hf(),this._depth=ff&&ff(),this._resource=null}return t.prototype.activate=function(t){this._resource=t,t.initialize(this)},u(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t))}},{key:"minPos",get:function(){return this._minPos},set:function(t){this._minPos=t,this._resource&&(this._resource.minPos=t)}},{key:"maxPos",get:function(){return this._maxPos},set:function(t){this._maxPos=t,this._resource&&(this._resource.maxPos=t)}},{key:"depth",get:function(){return this._depth},set:function(t){this._depth=t,this._resource&&(this._resource.depth=t)}}]),t}(),h(of.prototype,"depth",[rf],Object.getOwnPropertyDescriptor(of.prototype,"depth"),of.prototype),af=nt(of.prototype,"_enabled",[rt],(function(){return!1})),uf=nt(of.prototype,"_minPos",[rt],(function(){return new ut(Rl)})),hf=nt(of.prototype,"_maxPos",[rt],(function(){return new ut(wl)})),ff=nt(of.prototype,"_depth",[rt],(function(){return El})),sf=of))||sf));Lt.OctreeInfo=Dl;var Sl=t("a8",(lf=tt("cc.SkinInfo"),cf=dt(J),pf=dt(J),lf((df=function(){function t(){this._enabled=gf&&gf(),this._blurRadius=vf&&vf(),this._sssIntensity=mf&&mf(),this._resource=null}return t.prototype.activate=function(t){this._resource=t,t.initialize(this)},u(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t))}},{key:"blurRadius",get:function(){return this._blurRadius},set:function(t){this._blurRadius=t,this._resource&&(this._resource.blurRadius=t)}},{key:"sssIntensity",get:function(){return this._sssIntensity},set:function(t){this._sssIntensity=t,this._resource&&(this._resource.sssIntensity=t)}}]),t}(),h(df.prototype,"blurRadius",[cf],Object.getOwnPropertyDescriptor(df.prototype,"blurRadius"),df.prototype),h(df.prototype,"sssIntensity",[pf],Object.getOwnPropertyDescriptor(df.prototype,"sssIntensity"),df.prototype),gf=nt(df.prototype,"_enabled",[rt],(function(){return!0})),vf=nt(df.prototype,"_blurRadius",[rt],(function(){return.01})),mf=nt(df.prototype,"_sssIntensity",[rt],(function(){return 3})),_f=df))||_f));Lt.SkinInfo=Sl;var Cl=t("a9",(yf=tt("cc.PostSettingsInfo"),bf=dt(Xa),yf((Tf=function(){function t(){this._toneMappingType=If&&If(),this._resource=null}return t.prototype.activate=function(t){this._resource=t,t.initialize(this),t.activate()},u(t,[{key:"toneMappingType",get:function(){return this._toneMappingType},set:function(t){this._toneMappingType=t,this._resource&&(this._resource.toneMappingType=t)}}]),t}(),h(Tf.prototype,"toneMappingType",[bf],Object.getOwnPropertyDescriptor(Tf.prototype,"toneMappingType"),Tf.prototype),If=nt(Tf.prototype,"_toneMappingType",[rt],(function(){return Xa.DEFAULT})),Af=Tf))||Af));Lt.PostSettingsInfo=Cl;var xl,Ml,Pl,Ll,kl,Ol,Bl,Nl,Fl,Ul,Hl,Gl,zl,Vl,jl,Wl,Xl,ql,Kl,Yl,Jl,Ql,$l,Zl,tc,ec,ic,nc,rc,sc,oc,ac,uc,hc,fc,lc,cc,pc,_c,dc,gc,vc,mc,yc,bc,Ac,Tc,Ic,Rc,wc,Ec,Dc,Sc,Cc,xc,Mc,Pc,Lc,kc,Oc,Bc,Nc,Fc,Uc,Hc,Gc,zc,Vc,jc,Wc=t("aa",(Rf=tt("cc.LightProbeInfo"),wf=dt(J),Ef=dt(Q),Df=dt(Q),Sf=dt(J),Cf=dt(J),Rf((Mf=function(){function t(){this._giScale=Pf&&Pf(),this._giSamples=Lf&&Lf(),this._bounces=kf&&kf(),this._reduceRinging=Of&&Of(),this._showProbe=Bf&&Bf(),this._showWireframe=Nf&&Nf(),this._showConvex=Ff&&Ff(),this._data=Uf&&Uf(),this._lightProbeSphereVolume=Hf&&Hf(),this._nodes=[],this._scene=null,this._resource=null}var e=t.prototype;return e.activate=function(t,e){this._scene=t,this._resource=e,e.initialize(this)},e.onProbeBakeFinished=function(){this.onProbeBakingChanged(this._scene)},e.onProbeBakeCleared=function(){this.clearSHCoefficients(),this.onProbeBakingChanged(this._scene)},e.onProbeBakingChanged=function(t){var e=this;t&&(t.emit(be.LIGHT_PROBE_BAKING_CHANGED),t.children.forEach((function(t){e.onProbeBakingChanged(t)})))},e.clearSHCoefficients=function(){this._data&&(this._data.probes.forEach((function(t){t.coefficients.length=0})),this.clearAllSHUBOs())},e.isUniqueNode=function(){return 1===this._nodes.length},e.addNode=function(t){if(!t)return!1;for(var e=0;e<this._nodes.length;e++)if(this._nodes[e].node===t)return!1;return this._nodes.push({node:t,probes:null}),!0},e.removeNode=function(t){if(!t)return!1;var e=this._nodes.findIndex((function(e){return e.node===t}));return-1!==e&&(this._nodes.splice(e,1),!0)},e.syncData=function(t,e){for(var i=0;i<this._nodes.length;i++)if(this._nodes[i].node===t)return void(this._nodes[i].probes=e)},e.update=function(t){if(void 0===t&&(t=!0),Pt.internal.LightProbesData){this._data||(this._data=new Pt.internal.LightProbesData,this._resource&&(this._resource.data=this._data));for(var e=[],i=0;i<this._nodes.length;i++){var n=this._nodes[i],r=n.node,s=n.probes,o=r.worldPosition;if(s)for(var a=0;a<s.length;a++){var u=yt();ut.add(u,s[a],o),e.push(u)}}if(e.length<4)return this.resetAllTetraIndices(),void this._data.reset();this._data.updateProbes(e),t&&(this.resetAllTetraIndices(),this._data.updateTetrahedrons())}},e.clearAllSHUBOs=function(){if(this._scene){var t=this._scene.renderScene;t&&t.models.forEach((function(t){t.clearSHUBOs()}))}},e.resetAllTetraIndices=function(){if(this._scene){var t=this._scene.renderScene;t&&t.models.forEach((function(t){t.tetrahedronIndex=-1}))}},u(t,[{key:"giScale",get:function(){return this._giScale},set:function(t){this._giScale!==t&&(this._giScale=t,this._resource&&(this._resource.giScale=t))}},{key:"giSamples",get:function(){return this._giSamples},set:function(t){this._giSamples!==t&&(this._giSamples=t,this._resource&&(this._resource.giSamples=t))}},{key:"bounces",get:function(){return this._bounces},set:function(t){this._bounces!==t&&(this._bounces=t,this._resource&&(this._resource.bounces=t))}},{key:"reduceRinging",get:function(){return this._reduceRinging},set:function(t){this._reduceRinging!==t&&(this._reduceRinging=t,this._resource&&(this._resource.reduceRinging=t))}},{key:"showProbe",get:function(){return this._showProbe},set:function(t){this._showProbe!==t&&(this._showProbe=t,this._resource&&(this._resource.showProbe=t))}},{key:"showWireframe",get:function(){return this._showWireframe},set:function(t){this._showWireframe!==t&&(this._showWireframe=t,this._resource&&(this._resource.showWireframe=t))}},{key:"showConvex",get:function(){return this._showConvex},set:function(t){this._showConvex!==t&&(this._showConvex=t,this._resource&&(this._resource.showConvex=t))}},{key:"data",get:function(){return this._data},set:function(t){this._data!==t&&(this._data=t,this._resource&&(this._resource.data=t))}},{key:"lightProbeSphereVolume",get:function(){return this._lightProbeSphereVolume},set:function(t){this._lightProbeSphereVolume!==t&&(this._lightProbeSphereVolume=t,this._resource&&(this._resource.lightProbeSphereVolume=t))}}]),t}(),h(Mf.prototype,"giScale",[wf],Object.getOwnPropertyDescriptor(Mf.prototype,"giScale"),Mf.prototype),h(Mf.prototype,"giSamples",[Ef],Object.getOwnPropertyDescriptor(Mf.prototype,"giSamples"),Mf.prototype),h(Mf.prototype,"bounces",[Df],Object.getOwnPropertyDescriptor(Mf.prototype,"bounces"),Mf.prototype),h(Mf.prototype,"reduceRinging",[Sf],Object.getOwnPropertyDescriptor(Mf.prototype,"reduceRinging"),Mf.prototype),h(Mf.prototype,"lightProbeSphereVolume",[Cf],Object.getOwnPropertyDescriptor(Mf.prototype,"lightProbeSphereVolume"),Mf.prototype),Pf=nt(Mf.prototype,"_giScale",[rt],(function(){return 1})),Lf=nt(Mf.prototype,"_giSamples",[rt],(function(){return 1024})),kf=nt(Mf.prototype,"_bounces",[rt],(function(){return 2})),Of=nt(Mf.prototype,"_reduceRinging",[rt],(function(){return 0})),Bf=nt(Mf.prototype,"_showProbe",[rt],(function(){return!0})),Nf=nt(Mf.prototype,"_showWireframe",[rt],(function(){return!0})),Ff=nt(Mf.prototype,"_showConvex",[rt],(function(){return!1})),Uf=nt(Mf.prototype,"_data",[rt],(function(){return null})),Hf=nt(Mf.prototype,"_lightProbeSphereVolume",[rt],(function(){return 1})),xf=Mf))||xf)),Xc=t("ab",(Gf=tt("cc.SceneGlobals"),zf=dt(Al),Gf((jf=function(){function t(){this.ambient=Wf&&Wf(),this.shadows=Xf&&Xf(),this._skybox=qf&&qf(),this.fog=Kf&&Kf(),this.octree=Yf&&Yf(),this.skin=Jf&&Jf(),this.lightProbeInfo=Qf&&Qf(),this.postSettings=$f&&$f(),this.bakedWithStationaryMainLight=Zf&&Zf(),this.bakedWithHighpLightmap=tl&&tl(),this.disableLightmap=!1}return t.prototype.activate=function(t){var e=Lt.director.root.pipeline.pipelineSceneData;this.skybox.activate(e.skybox),this.ambient.activate(e.ambient),this.shadows.activate(e.shadows),this.fog.activate(e.fog),this.octree.activate(e.octree),this.skin.activate(e.skin),this.postSettings.activate(e.postSettings),this.lightProbeInfo&&e.lightProbes&&this.lightProbeInfo.activate(t,e.lightProbes),Lt.director.root.onGlobalPipelineStateChanged()},u(t,[{key:"skybox",get:function(){return this._skybox},set:function(t){this._skybox=t}}]),t}(),Wf=nt(jf.prototype,"ambient",[rt],(function(){return new bl})),Xf=nt(jf.prototype,"shadows",[rt],(function(){return new Il})),qf=nt(jf.prototype,"_skybox",[rt],(function(){return new Al})),Kf=nt(jf.prototype,"fog",[rt],(function(){return new Tl})),h(jf.prototype,"skybox",[zf],Object.getOwnPropertyDescriptor(jf.prototype,"skybox"),jf.prototype),Yf=nt(jf.prototype,"octree",[rt],(function(){return new Dl})),Jf=nt(jf.prototype,"skin",[rt],(function(){return new Sl})),Qf=nt(jf.prototype,"lightProbeInfo",[rt],(function(){return new Wc})),$f=nt(jf.prototype,"postSettings",[rt],(function(){return new Cl})),Zf=nt(jf.prototype,"bakedWithStationaryMainLight",[rt],(function(){return!1})),tl=nt(jf.prototype,"bakedWithHighpLightmap",[rt],(function(){return!1})),Vf=jf))||Vf));Lt.SceneGlobals=Xc;var qc,Kc,Yc,Jc,Qc=(xl=tt("cc.TargetInfo"),Ml=dt([$]),xl((Ll=function(){this.localID=kl&&kl()},kl=nt(Ll.prototype,"localID",[rt,Ml],(function(){return[]})),Pl=Ll))||Pl),$c=(Ol=tt("cc.TargetOverrideInfo"),Bl=dt(Y),Nl=dt(Qc),Fl=dt([$]),Ul=dt(pl),Hl=dt(Qc),Ol((zl=function(){this.source=Vl&&Vl(),this.sourceInfo=jl&&jl(),this.propertyPath=Wl&&Wl(),this.target=Xl&&Xl(),this.targetInfo=ql&&ql()},Vl=nt(zl.prototype,"source",[rt,Bl],(function(){return null})),jl=nt(zl.prototype,"sourceInfo",[rt,Nl],(function(){return null})),Wl=nt(zl.prototype,"propertyPath",[rt,Fl],(function(){return[]})),Xl=nt(zl.prototype,"target",[rt,Ul],(function(){return null})),ql=nt(zl.prototype,"targetInfo",[rt,Hl],(function(){return null})),Gl=zl))||Gl),Zc=tt("cc.CompPrefabInfo")((Yl=function(){this.fileId=Jl&&Jl()},Jl=nt(Yl.prototype,"fileId",[rt],(function(){return""})),Kl=Yl))||Kl,tp=(Ql=tt("CCPropertyOverrideInfo"),$l=dt(Qc),Zl=dt([$]),Ql((ec=function(){function t(){this.targetInfo=ic&&ic(),this.propertyPath=nc&&nc(),this.value=rc&&rc()}return t.prototype.isTarget=function(){},t}(),ic=nt(ec.prototype,"targetInfo",[rt,$l],(function(){return null})),nc=nt(ec.prototype,"propertyPath",[rt,Zl],(function(){return[]})),rc=nt(ec.prototype,"value",[rt],null),tc=ec))||tc),ep=(sc=tt("cc.MountedChildrenInfo"),oc=dt(Qc),ac=dt([pl]),sc((hc=function(){function t(){this.targetInfo=fc&&fc(),this.nodes=lc&&lc()}return t.prototype.isTarget=function(){},t}(),fc=nt(hc.prototype,"targetInfo",[rt,oc],(function(){return null})),lc=nt(hc.prototype,"nodes",[rt,ac],(function(){return[]})),uc=hc))||uc),ip=(cc=tt("cc.MountedComponentsInfo"),pc=dt(Qc),_c=dt([Qt]),cc((gc=function(){function t(){this.targetInfo=vc&&vc(),this.components=mc&&mc()}return t.prototype.isTarget=function(){},t}(),vc=nt(gc.prototype,"targetInfo",[rt,pc],(function(){return null})),mc=nt(gc.prototype,"components",[rt,_c],(function(){return[]})),dc=gc))||dc),np=(yc=tt("cc.PrefabInstance"),bc=dt(pl),Ac=dt([ep]),Tc=dt([ip]),Ic=dt([tp]),Rc=dt([Qc]),yc((Ec=function(){function t(){this.fileId=Dc&&Dc(),this.prefabRootNode=Sc&&Sc(),this.mountedChildren=Cc&&Cc(),this.mountedComponents=xc&&xc(),this.propertyOverrides=Mc&&Mc(),this.removedComponents=Pc&&Pc(),this.targetMap={},this.expanded=!1}var e=t.prototype;return e.findPropertyOverride=function(){},e.removePropertyOverride=function(){},t}(),Dc=nt(Ec.prototype,"fileId",[rt],(function(){return""})),Sc=nt(Ec.prototype,"prefabRootNode",[rt,bc],null),Cc=nt(Ec.prototype,"mountedChildren",[rt,Ac],(function(){return[]})),xc=nt(Ec.prototype,"mountedComponents",[rt,Tc],(function(){return[]})),Mc=nt(Ec.prototype,"propertyOverrides",[rt,Ic],(function(){return[]})),Pc=nt(Ec.prototype,"removedComponents",[rt,Rc],(function(){return[]})),wc=Ec))||wc),rp=(Lc=tt("cc.PrefabInfo"),kc=dt(pl),Oc=dt(np),Bc=dt([$c]),Lc((Fc=function(){this.root=Uc&&Uc(),this.asset=Hc&&Hc(),this.fileId=Gc&&Gc(),this.instance=zc&&zc(),this.targetOverrides=Vc&&Vc(),this.nestedPrefabInstanceRoots=jc&&jc()},Uc=nt(Fc.prototype,"root",[rt,kc],null),Hc=nt(Fc.prototype,"asset",[rt],null),Gc=nt(Fc.prototype,"fileId",[rt],(function(){return""})),zc=nt(Fc.prototype,"instance",[rt,Oc],null),Vc=nt(Fc.prototype,"targetOverrides",[rt,Bc],null),jc=nt(Fc.prototype,"nestedPrefabInstanceRoots",[rt],null),Nc=Fc))||Nc);function sp(t){var e=null==t?void 0:t.prefab;if(e&&e.instance){if(!e.asset)return l(3701,t.name),void(e.instance=void 0);var i=t._objFlags,n=t.getParent(),r=t.uuid;t[Et],Pt.game._isCloning=!0,e.asset._doInstantiate(t),Pt.game._isCloning=!1,t._objFlags=i,t.modifyParent(n),t.id=r,t.prefab&&(t.prefab.instance=e.instance)}}function op(t,e,i){var n;if(e&&t){var r=e,s=null==(n=t.prefab)?void 0:n.instance;!i&&s&&(e[s.fileId]={},r=e[s.fileId]);var o=t.prefab;o&&(r[o.fileId]=t),t.components.forEach((function(t){t.__prefab&&(r[t.__prefab.fileId]=t)})),t.children.forEach((function(t){op(t,r,!1)}))}}function ap(t,e){if(!t)return null;for(var i=e,n=0;n<t.length;n++){if(!i)return null;i=i[t[n]]}return i}function up(t,e,i){if(e)for(var n=0;n<e.length;n++){var r=e[n];if(r&&r.targetInfo){var s=ap(r.targetInfo.localID,i);if(!s)continue;var o=i,a=r.targetInfo.localID;if(a.length>0)for(var u=0;u<a.length-1;u++)o=o[a[u]];if(r.nodes)for(var h=0;h<r.nodes.length;h++){var f=r.nodes[h];f&&!s.children.includes(f)&&(s.children.push(f),f.modifyParent(s),op(f,o,!1),f.siblingIndex=s.children.length-1,pp(f,!0))}}}}function hp(t,e,i){if(e)for(var n=0;n<e.length;n++){var r=e[n];if(r&&r.targetInfo){var s=ap(r.targetInfo.localID,i);if(!s)continue;if(r.components)for(var o=0;o<r.components.length;o++){var a=r.components[o];a&&(a.node=s,s.getWritableComponents().push(a))}}}}function fp(t,e,i){if(e)for(var n=0;n<e.length;n++){var r=e[n];if(r){var s=ap(r.localID,i);if(!s||!s.node)continue;var o=s.node.components.indexOf(s);o>=0&&s.node.getWritableComponents().splice(o,1)}}}function lp(t,e,i){if(!(e.length<=0))for(var n=null,r=0;r<e.length;r++){var s=e[r];if(s&&s.targetInfo){if(!(n=ap(s.targetInfo.localID,i)))continue;var o=n,a=s.propertyPath.slice();if(a.length>0){var u=a.pop();if(!u)continue;for(var h=0;h<a.length&&(o=o[a[h]]);h++);if(!o)continue;if(Array.isArray(o))if("length"===u)o[u]=s.value;else{var f=Number.parseInt(u);Number.isInteger(f)&&f<o.length&&(o[u]=s.value)}else o[u]instanceof Z?o[u].set(s.value):o[u]=s.value}}}}function cp(t){var e,i=null==(e=t.prefab)?void 0:e.targetOverrides;if(i)for(var n=0;n<i.length;n++){var r,s=i[n],o=s.source,a=s.sourceInfo;if(a){var u,h=s.source,f=null==h||null==(u=h.prefab)?void 0:u.instance;f&&f.targetMap&&(o=ap(a.localID,f.targetMap))}if(o){var l,c=s.targetInfo;if(c){var p=s.target,_=null==p||null==(r=p.prefab)?void 0:r.instance;if(_&&_.targetMap&&(l=ap(c.localID,_.targetMap))){var d=s.propertyPath.slice(),g=o;if(d.length>0){var v=d.pop();if(!v)return;for(var m=0;m<d.length&&(g=g[d[m]]);m++);if(!g)continue;g[v]=l}}}}}}function pp(t,e){var i;void 0===e&&(e=!1);var n=null==t||null==(i=t.prefab)?void 0:i.instance;if(n&&!n.expanded){sp(t),e&&t&&t.children&&t.children.forEach((function(t){pp(t,!0)}));var r={};n.targetMap=r,op(t,r,!0),up(0,n.mountedChildren,r),fp(0,n.removedComponents,r),hp(0,n.mountedComponents,r),lp(0,n.propertyOverrides,r),n.expanded=!0}else e&&t&&t.children&&t.children.forEach((function(t){pp(t,!0)}))}function _p(t){var e=t.prefab;e&&e.nestedPrefabInstanceRoots&&e.nestedPrefabInstanceRoots.forEach((function(t){pp(t)}))}Pt._PrefabInfo=rp,t("aE",Object.freeze({__proto__:null,CompPrefabInfo:Zc,MountedChildrenInfo:ep,MountedComponentsInfo:ip,PrefabInfo:rp,PrefabInstance:np,PropertyOverrideInfo:tp,TargetInfo:Qc,TargetOverrideInfo:$c,applyMountedChildren:up,applyMountedComponents:hp,applyNodeAndComponentId:function t(e,i){for(var n=e.components,r=e.children,s=0;s<n.length;s++){var o,a,u=n[s],h=null!==(o=null==(a=u.__prefab)?void 0:a.fileId)&&void 0!==o?o:"";u._id=""+i+h}for(var f=0;f<r.length;f++){var l=r[f],c=l.prefab,p=null!=c&&c.instance?c.instance.fileId:null==c?void 0:c.fileId;p&&(l.id=""+i+p,null!=c&&c.instance||t(l,i))}},applyPropertyOverrides:lp,applyRemovedComponents:fp,applyTargetOverrides:cp,createNodeWithPrefab:sp,expandNestedPrefabInstanceNode:_p,expandPrefabInstanceNode:pp,generateTargetMap:op,getTarget:ap}));var dp=t("l",tt("cc.Scene")((Kc=function(t){n(i,t);var e=i.prototype;function i(e){var i;return(i=t.call(this,e)||this).autoReleaseAssets=Yc&&Yc(),i._globals=Jc&&Jc(),i.dependAssets=null,i._renderScene=null,i._prefabSyncedInLiveReload=!1,i._activeInHierarchy=!1,Lt.director&&Lt.director.root&&(i._renderScene=Lt.director.root.createScene({})),i._inited=!Lt.game||!Lt.game._isCloning,i}return e._updateScene=function(){this._scene=this},e.destroy=function(){var t=Y.prototype.destroy.call(this);if(t)for(var e=this._children,i=0;i<e.length;++i)e[i].active=!1;return this._renderScene&&Lt.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,t},e.addComponent=function(){throw new Error(d(3822))},e._onHierarchyChanged=function(){},e._onPostActivated=function(){},e._onBatchCreated=function(t){for(var e=this._children.length,i=0;i<e;++i)this._children[i]._siblingIndex=i,this._children[i]._onBatchCreated(t)},e.updateWorldTransform=function(){},e._instantiate=function(){return null},e._load=function(){this._inited||(_p(this),cp(this),this._onBatchCreated(Ct),this._inited=!0),this.walk(pl._setScene)},e._activate=function(t){void 0===t&&(t=!0),Lt.director._nodeActivator.activateNode(this,t),this._globals.activate(this)},u(i,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}}]),i}(pl),Yc=nt(Kc.prototype,"autoReleaseAssets",[rt],(function(){return!1})),Jc=nt(Kc.prototype,"_globals",[rt],(function(){return new Xc})),qc=Kc))||qc);Lt.Scene=dp}}}));
//# sourceMappingURL=scene-D5fG1En6.js.map
