System.register(["./_virtual_internal_constants-CVZmBipG.js","./index-BcjqSS2q.js","./deprecated-gv6rCJsk.js","./director-D6Xf3-Ej.js","./wasm-web-DpHjq6qw.js","./gc-object-BD6DANSw.js","./global-exports-ZavlJGEN.js","./debug-view-zRQBd5E1.js","./node-event-BDYemSfE.js","./scene-D5fG1En6.js","./prefab-CJahvMeV.js","./pipeline-state-manager-C4BAah3w.js","./ui-renderer-BG8n0rhU.js","./buffer-barrier-CZBuOw0V.js","./device-manager-BCOP-4pU.js","./deprecated-BaebfHhU.js","./deprecated-BfPl6EQ2.js","./touch-Ch03mDFP.js","./renderer-DVTO-7-w.js","./sorting-layers-sC9IxUEk.js"],(function(t,e){"use strict";var n,i,s,a,r,o,h,l,u,c,d,_,f,m,p,v,k,g,C,y,S,E,A,D,T,b,M,I,x,w,N,R,U,L,P,O,B,F,j,z,H,V,W,Y,J,X,q,G,K,Q,Z,$,tt,et;return{setters:[null,function(t){n=t.n,i=t.c,s=t.t,a=t.a,r=t.s,o=t.aK,h=t.S,l=t.M,u=t.C,c=t.I,d=t.f,_=t.N},function(t){f=t.g},function(t){m=t.d},function(t){p=t.i,v=t.f,k=t.e},function(t){g=t.ap,C=t.L,y=t.F,S=t.a,E=t._,A=t.E,D=t.f,T=t.j,b=t.r,M=t.k,I=t.w,x=t.T,w=t.ag,N=t.d,R=t.h,U=t.b,L=t.R},function(t){P=t.l},null,function(t){O=t.A,B=t.N},function(t){F=t.N,j=t.i,z=t.k,H=t.d,V=t.M,W=t.b},null,null,function(t){Y=t.a,J=t.k,X=t.l,q=t.R,G=t.b,K=t.U,Q=t.j,Z=t.i},function(t){$=t.m,tt=t.ai,et=t.af},null,null,null,null,null,null],execute:function(){var nt;t("loadWasmModuleSpine",pn),function(t){var e;function n(t){for(var e in t)t[t[e]]=e}var i=t.MixBlend={setup:0,first:1,replace:2,add:3};n(i),n(i=t.MixDirection={mixIn:0,mixOut:1}),n(i=t.TimelineType={rotate:0,translate:1,scale:2,shear:3,attachment:4,color:5,deform:6,event:7,drawOrder:8,ikConstraint:9,transformConstraint:10,pathConstraintPosition:11,pathConstraintSpacing:12,pathConstraintMix:13,twoColor:14}),n(i=t.EventType={start:0,interrupt:1,end:2,complete:3,dispose:4,event:5}),n(i=t.BlendMode={Normal:0,Additive:1,Multiply:2,Screen:3}),n(i=t.TransformMode={Normal:0,OnlyTranslation:1,NoRotationOrReflection:2,NoScale:3,NoScaleOrReflection:4}),n(i=t.PositionMode={Fixed:0,Percent:1}),n(i=t.SpacingMode={Length:0,Fixed:1,Percent:2}),n(i=t.RotateMode={Tangent:0,Chain:1,ChainScale:2}),n(i=t.TextureFilter={Nearest:9728,Linear:9729,MipMap:9987,MipMapNearestNearest:9984,MipMapLinearNearest:9985,MipMapNearestLinear:9986,MipMapLinearLinear:9987}),n(i=t.TextureWrap={MirroredRepeat:33648,ClampToEdge:33071,Repeat:10497}),n(i=t.AttachmentType={Region:0,BoundingBox:1,Mesh:2,LinkedMesh:3,Path:4,Point:5,Clipping:6}),i=null;var s=3.1415927,a=2*s,r=180/s,o=r,h=s/180,l=h;t.MathUtils=((e=function(){function t(){}return t.clamp=function(t,e,n){return t<e?e:t>n?n:t},t.cosDeg=function(t){return Math.cos(t*l)},t.sinDeg=function(t){return Math.sin(t*l)},t.signum=function(t){return t>0?1:t<0?-1:0},t.toInt=function(t){return t>0?Math.floor(t):Math.ceil(t)},t.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e},t.randomTriangular=function(e,n){return t.randomTriangularWith(e,n,.5*(e+n))},t.randomTriangularWith=function(t,e,n){var i=Math.random(),s=e-t;return i<=(n-t)/s?t+Math.sqrt(i*s*(n-t)):e-Math.sqrt((1-i)*s*(e-n))},t}()).PI=s,e.PI2=a,e.radiansToDegrees=r,e.radDeg=o,e.degreesToRadians=h,e.degRad=l,e)}(nt||(nt={}));var it=nt;function st(t,e){return t?e===t.length?t:e<t.length?t.slice(0,e):new Array(e):new Array(e)}function at(t,e,n){var i="_"+n;Object.defineProperty(t,n,{get:function(){var t=e.call(this),n=t.size(),s=this[i];s=st(s,n);for(var a=0;a<n;a++)s[a]=t.get(a);return this[i]=s,s}})}function rt(t,e,n){var i="_"+n;Object.defineProperty(t,n,{get:function(){var t=e.call(this),n=t.size(),s=this[i];s=st(s,n);for(var a=0;a<n;a++){var r=t.get(a),o=r.size(),h=s[a];h=st(h,o);for(var l=0;l<o;l++)h[l]=r.get(l);s[a]=h}return this[i]=s,s}})}function ot(t,e,n){var i="_"+n;Object.defineProperty(t,n,{value:function(){var t=e.call(this),n=t.size(),s=this[i];s=st(s,n);for(var a=0;a<n;a++)s[a]=t.get(a);return this[i]=s,s}})}function ht(t){for(var e in it.wasmUtil=t.SpineWasmUtil,it.wasmUtil.wasm=t,it.wasmUtil.spineWasmInit(),t){var n=t[e];it[e]||(it[e]=n)}}function lt(){var t=it.PathConstraintData.prototype;at(t,t.getBones,"bones")}function ut(){var t=it.VertexAttachment.prototype;at(t,t.getBones,"bones"),at(t,t.getVertices,"vertices");var e=t.computeWorldVertices,n=new it.SPVectorFloat;Object.defineProperty(t,"computeWorldVertices",{value:function(t,i,s,a,r,o){var h=a.length;n.resize(h,0);for(var l=0;l<h;l++)n.set(l,a[l]);e.call(this,t,i,s,n,r,o);for(var u=0;u<h;u++)a[u]=n.get(u)}})}function ct(){var t=it.MeshAttachment.prototype;at(t,t.getRegionUVs,"regionUVs"),at(t,t.getUVs,"uvs"),at(t,t.getTriangles,"triangles"),at(t,t.getEdges,"edges")}function dt(){var t=it.PathAttachment.prototype;at(t,t.getLengths,"lengths")}function _t(){var t=it.RegionAttachment.prototype;at(t,t.getOffset,"offset");var e=t.getUVs,n=t.setUVs,i="_uvs";Object.defineProperty(t,"uvs",{get:function(){var n=e.call(this),s=n.size(),a=t[i];a=st(a,s);for(var r=0;r<s;r++)a[r]=n.get(r);return t[i]=a,a},set:function(t){n.call(this,t[0],t[1],t[2],t[3],1===t[4])}});var s=t.computeWorldVertices,a=new it.SPVectorFloat;Object.defineProperty(t,"computeWorldVertices",{value:function(t,e,n,i){var r=e.length;a.resize(r,0);for(var o=0;o<r;o++)a.set(o,e[o]);s.call(this,t,a,n,i);for(var h=0;h<r;h++)e[h]=a.get(h)}})}function ft(){var t=it.IkConstraint.prototype;at(t,t.getBones,"bones")}function mt(){var t=it.PathConstraint.prototype;at(t,t.getBones,"bones")}function pt(){var t=it.TransformConstraintData.prototype;at(t,t.getBones,"bones")}function vt(){var t=it.TransformConstraint.prototype;at(t,t.getBones,"bones")}function kt(){var t=it.Bone.prototype;at(t,t.getChildren,"children")}function gt(){var t=it.Slot.prototype;at(t,t.getDeform,"deform")}function Ct(){var t=it.Skin.prototype;at(t,t.getBones,"bones"),at(t,t.getAttachments,"attachments"),at(t,t.getConstraints,"constraints"),ot(t,t.getAttachments,"getAttachments");var e=t.getAttachmentsForSlot;Object.defineProperty(t,"getAttachmentsForSlot",{value:function(t,n){var i=e.call(this,t),s=i.size();n.length=s;for(var a=0;a<s;a++)n[a]=i.get(a);i.delete()}});var n=t.findNamesForSlot;Object.defineProperty(t,"findNamesForSlot",{value:function(t,e){var i=n.call(this,t),s=i.size();e.length=s;for(var a=0;a<s;a++)e[a]=i.get(a);i.delete()}})}function yt(){var t=it.SkinEntry.prototype;[["name",t.getName],["attachment",t.getAttachment]].forEach((function(e){g(t,e[0],e[1])}))}function St(){var t=it.SkeletonData.prototype;at(t,t.getBones,"bones"),at(t,t.getSlots,"slots"),at(t,t.getSkins,"skins"),at(t,t.getAnimations,"animations"),at(t,t.getEvents,"events"),at(t,t.getIkConstraints,"ikConstraints"),at(t,t.getTransformConstraints,"transformConstraints"),at(t,t.getPathConstraints,"pathConstraints")}function Et(){var t=it.RotateTimeline.prototype;at(t,t.getFrames,"frames")}function At(){var t=it.Timeline.prototype;at(t,t.getFrames,"frames")}function Dt(){var t=it.AttachmentTimeline.prototype;at(t,t.getAttachmentNames,"attachmentNames")}function Tt(){var t=it.DeformTimeline.prototype;at(t,t.getFrames,"frames"),rt(t,t.getFrameVertices,"frameVertices")}function bt(){var t=it.EventTimeline.prototype;at(t,t.getFrames,"frames"),at(t,t.getEvents,"events")}function Mt(){var t=it.DrawOrderTimeline.prototype;at(t,t.getFrames,"frames")}function It(){var t=it.AnimationState.prototype;at(t,t.getTracks,"tracks")}function xt(){var t=it.Animation.prototype;at(t,t.getTimelines,"timelines")}function wt(){var t=it.Skeleton.prototype;at(t,t.getBones,"bones"),at(t,t.getSlots,"slots"),at(t,t.getDrawOrder,"drawOrder"),at(t,t.getIkConstraints,"ikConstraints"),at(t,t.getTransformConstraints,"transformConstraints"),at(t,t.getPathConstraints,"pathConstraints"),at(t,t.getUpdateCacheList,"_updateCache")}var Nt=null,Rt=[];Rt.push((function(t){var e;ht(t),at(e=it.IkConstraintData.prototype,e.getBones,"bones"),lt(),ct(),dt(),_t(),ut(),ft(),mt(),pt(),vt(),kt(),gt(),Ct(),yt(),St(),Et(),At(),Dt(),Tt(),bt(),Mt(),It(),xt(),wt()})),f.onPostInfrastructureInitDelegate.add((function(){return k().then((function(){return n.hasFeature(n.Feature.WASM)?Promise.all([e.import("./spine.wasm-CPGvVWWv.js"),e.import("./spine-9KUNBejt.js")]).then((function(t){return e=t[0].default,n=t[1].default,new Promise((function(t,i){var s=function(t){return"[Spine]: Spine wasm load failed: "+t};e({instantiateWasm:function(t,e){p(n,t).then((function(t){e(t.instance,t.module)})).catch((function(t){return i(s(t))}))}}).then((function(t){Nt=t,Rt.forEach((function(t){t(Nt)}))})).then(t).catch((function(t){return i(s(t))}))}));var e,n})):Promise.all([e.import("./spine.asm-ByQcr60x.js"),e.import("./spine.js-DGaEcPzV.js")]).then((function(t){return e=t[0].default,n=t[1].default,new Promise((function(t,i){v(n).then((function(t){var n={};return n.buffer=new ArrayBuffer(33554432),e({wasmMemory:n,memoryInitializerRequest:{response:t,status:200}}).then((function(t){Nt=t,Rt.forEach((function(t){t(Nt)}))}))})).then(t).catch(i)}));var e,n}))})).catch((function(t){C(t)}))}));var Ut,Lt=0,Pt=0,Ot=function(){function t(){this.start=void 0,this.interrupt=void 0,this.end=void 0,this.dispose=void 0,this.complete=void 0,this.event=void 0}return t.getListeners=function(e,n){if(!e.listener){e.listener=new t;var i=++Pt;n.setTrackEntryListener(i,e),t._trackSet.set(i,e)}return e.listener},t.emitListener=function(e,n,i,s){var a=t._listenerSet.get(e);if(a)switch(s){case it.EventType.event:a.event&&a.event(n,i);break;case it.EventType.start:a.start&&a.start(n);break;case it.EventType.interrupt:a.interrupt&&a.interrupt(n);break;case it.EventType.end:a.end&&a.end(n);break;case it.EventType.dispose:a.dispose&&a.dispose(n);break;case it.EventType.complete:a.complete&&a.complete(n);break;default:y("emitListener doesn't handled",s)}},t.emitTrackEntryListener=function(t,e,n,i){var s=this._trackSet.get(t);if(s)switch(i){case it.EventType.start:s.listener.start&&s.listener.start(e);break;case it.EventType.interrupt:s.listener.interrupt&&s.listener.interrupt(e);break;case it.EventType.end:s.listener.end&&s.listener.end(e);break;case it.EventType.dispose:s.listener.dispose&&s.listener.dispose(e),this._trackSet.delete(t),s.listener=null;break;case it.EventType.complete:s.listener.complete&&s.listener.complete(e);break;case it.EventType.event:s.listener.event&&s.listener.event(e,n);break;default:y("TrackEntry doesn't handled",i)}},t.addListener=function(e){var n=++Lt;return t._listenerSet.set(n,e),n},t.removeListener=function(e){t._listenerSet.delete(e)},t}();Ot._listenerSet=new Map,Ot._trackSet=new Map,globalThis.TrackEntryListeners=Ot;var Bt=1/60;Y(J);var Ft,jt,zt,Ht,Vt,Wt,Yt,Jt,Xt,qt,Gt=Y(X),Kt=function(){this.a=0,this.b=0,this.c=0,this.d=0,this.worldX=0,this.worldY=0},Qt=function(){this.vCount=0,this.iCount=0,this.vData=null,this.iData=null,this.meshes=[]},Zt=function(){this.iCount=0,this.blendMode=0,this.textureID=0},$t=function(){function t(t){this._instance=null,this._state=null,this._skeletonData=null,this._skeleton=null,this._privateMode=!1,this._curIndex=-1,this._isCompleted=!1,this._maxFrameIdex=0,this._frameIdx=-1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this._skeletonInfo=null,this._animationName=null,this.isCompleted=!1,this.totalTime=0,this.frames=[],this._privateMode=!1,this._inited=!1,this._invalid=!0,this._instance=new it.SkeletonInstance,this._instance.isCache=!0,this._skeletonData=t,this._skeleton=this._instance.initSkeleton(t),this._instance.setUseTint(!0)}var e=t.prototype;return e.init=function(t,e){this._inited=!0,this._animationName=e,this._skeletonInfo=t},e.setSkin=function(t){this._skeleton&&this._skeleton.setSkinByName(t),this._instance.setSkin(t)},e.setAnimation=function(t){var e=this._skeletonData.animations,n=null;e.forEach((function(e){e.name===t&&(n=e)})),n?(this._maxFrameIdex=Math.floor(n.duration/Bt),this._maxFrameIdex<=0&&(this._maxFrameIdex=1),this._instance.setAnimation(0,t,!1)):y("find no animation named "+t+" !!!")},e.updateToFrame=function(t){if(this._inited&&(this.begin(),this.needToUpdate(t)))do{this._frameIdx++,this.totalTime+=Bt,this._instance.updateAnimation(Bt);var e=this._instance.updateRenderData();this.updateRenderData(this._frameIdx,e),this._frameIdx>=this._maxFrameIdex&&(this.isCompleted=!0)}while(this.needToUpdate(t))},e.getFrame=function(t){var e=t%this._maxFrameIdex;return this.frames[e]},e.invalidAnimationFrames=function(){this._curIndex=-1,this._isCompleted=!1,this.frames.length=0},e.updateRenderData=function(t,e){var n=e.vCount,i=e.iCount,s=Gt/Float32Array.BYTES_PER_ELEMENT,a=new Uint8Array(Float32Array.BYTES_PER_ELEMENT*s*n),r=new Uint16Array(i),o=it.wasmUtil.wasm.HEAPU8,h=e.vPtr,l=n*Float32Array.BYTES_PER_ELEMENT*s;a.set(o.subarray(h,h+l));var u=e.iPtr,c=Uint16Array.BYTES_PER_ELEMENT*i;new Uint8Array(r.buffer).set(o.subarray(u,u+c));var d=new Qt;d.vCount=n,d.iCount=i,d.vData=a,d.iData=r;for(var _=e.getData(),f=e.getTextures(),m=_.size(),p=0;p<m;p+=5){var v=new Zt;v.iCount=_.get(p+3),v.blendMode=_.get(p+4),v.textureID=f.get(p/5),d.meshes.push(v)}var k=this._skeleton.bones,g=[];k.forEach((function(t){var e=new Kt;e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.worldX=t.worldX,e.worldY=t.worldY,g.push(e)})),this.frames[t]={model:d,boneInfos:g}},e.begin=function(){if(this._invalid){var t=this._skeletonInfo,e=null==t?void 0:t.curAnimationCache;e&&e!==this&&(this._privateMode?e.invalidAllFrame():e.updateToFrame(0));var n=null==t?void 0:t.listener;this._instance.setAnimation(0,this._animationName,!1),this.bind(n),t.curAnimationCache=this,this._frameIdx=-1,this.isCompleted=!1,this.totalTime=0,this._invalid=!1}},e.end=function(){this.needToUpdate()||(this._skeletonInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0,this.unbind(this._skeletonInfo.listener))},e.bind=function(t){var e=this;t.complete=function(t){t&&t.animation.name===e._animationName&&(e.isCompleted=!0)}},e.unbind=function(t){t.complete=null},e.needToUpdate=function(t){return!this.isCompleted&&this.totalTime<30&&(void 0===t||this._frameIdx<t)},e.isInited=function(){return this._inited},e.isInvalid=function(){return this._invalid},e.invalidAllFrame=function(){this.isCompleted=!1,this._invalid=!0},e.enableCacheAttachedInfo=function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},e.clear=function(){this._inited=!1,this.invalidAllFrame()},e.destroy=function(){this._instance&&(this._instance.destroy(),this._instance=null)},S(t,[{key:"skeleton",get:function(){return this._skeleton}}]),t}(),te=function(){function t(){this._privateMode=void 0,this._skeletonCache=void 0,this._animationPool=void 0,this._sharedCacheMap=new Map,this._privateMode=!1,this._animationPool={},this._skeletonCache={}}var e=t.prototype;return e.enablePrivateMode=function(){this._privateMode=!0},e.clear=function(){this._animationPool={},this._skeletonCache={}},e.invalidAnimationCache=function(t){var e=this._skeletonCache[t];if(e&&e.skeleton){var n=e.animationsCache;for(var i in n)n[i].invalidAllFrame()}},e.destroySkeleton=function(t){var e=this;if(!this._privateMode){var n=this._sharedCacheMap.get(t);if(n){if((n-=1)>0)return void this._sharedCacheMap.set(t,n);this._sharedCacheMap.delete(t)}}var i=this._skeletonCache[t];if(i){var s=this._privateMode?function(t,e){e.destroy()}:function(n,i){e._animationPool[t+"#"+n]=i,i.clear()},a=i.animationsCache;for(var r in a){var o=a[r];o&&s(r,o)}i.skeleton&&it.wasmUtil.destroySpineSkeleton(i.skeleton),delete this._skeletonCache[t]}},e.createSkeletonInfo=function(t){var e=t.uuid,n=t.getRuntimeData();if(!this._privateMode){var i=this._sharedCacheMap.get(e);i?i+=1:i=1,this._sharedCacheMap.set(e,i)}if(this._skeletonCache[e])return this._skeletonCache[e];var s=new it.Skeleton(n),a=new Ot;return this._skeletonCache[e]={skeleton:s,clipper:null,state:null,listener:a,animationsCache:{},curAnimationCache:null,assetUUID:e}},e.getSkeletonInfo=function(t){var e=t.uuid;return this._skeletonCache[e]},e.getAnimationCache=function(t,e){var n=this._skeletonCache[t];return n?n.animationsCache[e]:null},e.initAnimationCache=function(t,e,n){var i=e.getRuntimeData();if(!i)return null;var s=this._skeletonCache[t];if(!s||!s.skeleton)return null;var a=s.animationsCache,r=a[n];if(!r){var o=t+"#"+n;(r=this._animationPool[o])?delete this._animationPool[o]:(r=new $t(i))._privateMode=this._privateMode,r.init(s,n),a[n]=r}return r.init(s,n),r.setAnimation(n),r},e.destroyCachedAnimations=function(t){if(t){var e=this._animationPool;for(var n in e)n.includes(t)&&(e[n].destroy(),delete e[n]);var i=this._skeletonCache[t],s=i&&i.skeleton;s&&it.wasmUtil.destroySpineSkeleton(s),i&&delete this._skeletonCache[t]}else{var a=this._animationPool;for(var r in a)a[r].destroy(),delete a[r]}},t}();Ut=te,te.FrameTime=Bt,te.sharedCache=new Ut;var ee=(Ft=i("sp.SkeletonData"),jt=s([j]),zt=s([D]),Ft((Vt=function(t){function e(){var e;return(e=t.call(this)||this)._skeletonJson=Wt&&Wt(),e.textures=Yt&&Yt(),e.textureNames=Jt&&Jt(),e.scale=Xt&&Xt(),e._atlasText=qt&&qt(),e._buffer=void 0,e._skeletonCache=null,e._skinsEnum=null,e._animsEnum=null,e.reset(),e}E(e,t);var n=e.prototype;return n.createNode=function(t){var e=new F(this.name);return e.addComponent("cc.Skeleton").skeletonData=this,t(null,e)},n.reset=function(){this._skeletonCache=null},n.resetEnums=function(){},n.getRuntimeData=function(t){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&this.textures.length>0)&&this.textureNames&&this.textureNames.length>0)return t||C(this.name+" no textures found!"),null;var e=this.mergedUUID(),n=it.wasmUtil.querySpineSkeletonDataByUUID(e);if(n)this._skeletonCache=n;else{for(var i=this.textures.length,s=[],a=0;a<i;++a){var r=this.textures[a];s.push(r.uuid||r.getId())}if(this._skeletonJson)this._skeletonCache=it.wasmUtil.createSpineSkeletonDataWithJson(this.skeletonJsonStr,this._atlasText,this.textureNames,s),it.wasmUtil.registerSpineSkeletonDataWithUUID(this._skeletonCache,e);else{var o=new Uint8Array(this._nativeAsset),h=o.length,l=it.wasmUtil.createStoreMemory(h);it.wasmUtil.wasm.HEAPU8.subarray(l,l+h).set(o),this._skeletonCache=it.wasmUtil.createSpineSkeletonDataWithBinary(h,this._atlasText,this.textureNames,s),it.wasmUtil.registerSpineSkeletonDataWithUUID(this._skeletonCache,e),it.wasmUtil.freeStoreMemory()}}return this._skeletonCache},n.getSkinsEnum=function(){if(this._skinsEnum)return this._skinsEnum;var t=this.getRuntimeData(!0);if(t){for(var e=t.skins,n={},i=0;i<e.length;i++)n[e[i].name]=i;return this._skinsEnum=A(n)}return null},n.getAnimsEnum=function(){if(this._animsEnum&&Object.keys(this._animsEnum).length>1)return this._animsEnum;var t=this.getRuntimeData(!0);if(t){for(var e={"<None>":0},n=t.animations,i=0;i<n.length;i++)e[n[i].name]=i+1;return this._animsEnum=A(e)}return null},n.mergedUUID=function(){var t=[this._atlasText].concat(this.textures.map((function(t){return t.getId()}))).join("");return""+this._uuid+$(t,668)},n.destroy=function(){return te.sharedCache.destroyCachedAnimations(this._uuid),it.wasmUtil.destroySpineSkeletonDataWithUUID(this.mergedUUID()),t.prototype.destroy.call(this)},n.isEmpty=function(){return 0===this._atlasText.length&&!this._skeletonJson&&!this._nativeAsset},S(e,[{key:"skeletonJsonStr",get:function(){return this._skeletonJson?JSON.stringify(this._skeletonJson):""}},{key:"skeletonJson",get:function(){return this._skeletonJson},set:function(t){this.reset(),this._skeletonJson="string"==typeof t?JSON.parse(t):t,!this._uuid&&t.skeleton&&(this._uuid=t.skeleton.hash)}},{key:"atlasText",get:function(){return this._atlasText},set:function(t){this._atlasText=t,this.reset()}},{key:"_nativeAsset",get:function(){return this._buffer},set:function(t){this._buffer=t,this.reset()}}]),e}(O),Wt=a(Vt.prototype,"_skeletonJson",[r],(function(){return null})),Yt=a(Vt.prototype,"textures",[r,jt],(function(){return[]})),Jt=a(Vt.prototype,"textureNames",[r,zt],(function(){return[]})),Xt=a(Vt.prototype,"scale",[r],(function(){return 1})),qt=a(Vt.prototype,"_atlasText",[r],(function(){return""})),Ht=Vt))||Ht);P.internal.SpineSkeletonData=ee;var ne=function(t){function e(){var e;return(e=t.call(this)||this)._skeletons=new Set,e}E(e,t),e.getInstance=function(){return e._instance||(e._instance=new e,m.registerSystem(e.ID,e._instance,o.HIGH)),e._instance};var n=e.prototype;return n.add=function(t){t&&(this._skeletons.has(t)||this._skeletons.add(t))},n.remove=function(t){t&&this._skeletons.has(t)&&this._skeletons.delete(t)},n.postUpdate=function(t){this._skeletons&&this._skeletons.forEach((function(e){e.updateAnimation(t)}))},n.prepareRenderData=function(){this._skeletons&&this._skeletons.forEach((function(t){t._markForUpdateRenderData()}))},e}(h);ne.ID="SKELETON",ne._instance=void 0,P.internal.SpineSkeletonSystem=ne;var ie,se,ae,re,oe,he,le,ue,ce,de,_e,fe,me,pe,ve,ke,ge,Ce,ye,Se,Ee,Ae,De,Te,be,Me,Ie,xe,we,Ne,Re,Ue=new l,Le=function(){function t(){this._isInitialized=!1,this._skeletonBones=null,this._socketNodes=null,this._keysToDelete=[],this._isInitialized=!1}var e=t.prototype;return e.init=function(t){var e;this._isInitialized=!1,t&&0!==(null==(e=t.socketNodes)?void 0:e.size)&&(this._skeletonBones=t._skeleton.bones,!this._skeletonBones||this._skeletonBones.length<1||(this._socketNodes=t.socketNodes,!this._socketNodes||this._socketNodes.size<=0||(this._isInitialized=!0,this._syncAttachedNode())))},e.updateSkeletonBones=function(t){this._skeletonBones=t},e.reset=function(){this._isInitialized=!1,this._skeletonBones=null,this._socketNodes=null,this._keysToDelete.length=0},e._syncAttachedNode=function(){if(this._isInitialized){for(var t,e=this._socketNodes,n=T(e);!(t=n()).done;){var i=t.value,s=i[0],a=i[1];if(a&&a.isValid){var r=this._skeletonBones[s];r&&this.matrixHandle(a,r)}else this._keysToDelete.push(s)}if(!(this._keysToDelete.length<=0)){for(var o,h=T(this._keysToDelete);!(o=h()).done;){var l=o.value;e.delete(l)}this._keysToDelete.length=0}}},e.matrixHandle=function(t,e){var n=Ue;n.m00=e.a,n.m01=e.c,n.m04=e.b,n.m05=e.d,n.m12=e.worldX,n.m13=e.worldY,t.matrix=Ue},t}();function Pe(t){return!!t&&!t.isEmpty()}!function(t){t[t.UNSET=-1]="UNSET",t[t.REALTIME=0]="REALTIME",t[t.SHARED_CACHE=1]="SHARED_CACHE",t[t.PRIVATE_CACHE=2]="PRIVATE_CACHE"}(Re||(Re={})),b(Re);var Oe,Be,Fe=Re;!function(t){t[t.default=0]="default"}(Oe||(Oe={})),b(Oe),function(t){t[t["<None>"]=0]="<None>"}(Be||(Be={})),b(Be);var je,ze=Be;!function(t){t[t.COLORED_TEXTURED=0]="COLORED_TEXTURED",t[t.TWO_COLORED=1]="TWO_COLORED"}(je||(je={}));var He=(ie=i("sp.Skeleton.SpineSocket"),se=s(F),ie((re=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),this.path=oe&&oe(),this.target=he&&he(),this.path=t,this.target=e},oe=a(re.prototype,"path",[r],(function(){return""})),he=a(re.prototype,"target",[se,r],(function(){return null})),ae=re))||ae);M(He,"sp.Skeleton.SpineSocket");var Ve=(le=i("sp.Skeleton"),ue=s(ee),ce=s(Oe),de=s(Be),_e=s(Re),fe=s([He]),me=s(W),le((Ne=function(t){function e(){var e;return(e=t.call(this)||this)._skeletonData=ke&&ke(),e.defaultSkin=ge&&ge(),e.defaultAnimation=Ce&&Ce(),e._premultipliedAlpha=ye&&ye(),e._timeScale=Se&&Se(),e._preCacheMode=Ee&&Ee(),e._cacheMode=Ae&&Ae(),e._sockets=De&&De(),e._useTint=Te&&Te(),e._debugMesh=be&&be(),e._debugBones=Me&&Me(),e._debugSlots=Ie&&Ie(),e._enableBatch=xe&&xe(),e._runtimeData=null,e._skeleton=null,e._instance=null,e._state=null,e._textures=[],e._skeletonInfo=null,e._animationName="",e._skinName="",e._drawList=new L((function(){return{material:null,texture:null,indexOffset:0,indexCount:0}}),1),e._materialCache={},e.paused=!1,e._enumSkins=A({}),e._enumAnimations=A({}),e.attachUtil=void 0,e._socketNodes=new Map,e._cachedSockets=new Map,e._startEntry=void 0,e._endEntry=void 0,e._paused=!1,e._accTime=0,e._playCount=0,e._skeletonCache=null,e._animCache=null,e._animationQueue=[],e._headAniInfo=null,e._isAniComplete=!0,e._playTimes=0,e._curFrame=null,e._listener=null,e._debugRenderer=null,e._startSlotIndex=void 0,e._endSlotIndex=void 0,e._customMaterialInstance=null,e._vLength=0,e._vBuffer=null,e._iLength=0,e._iBuffer=null,e._model=void 0,e._tempColor={r:0,g:0,b:0,a:0},e._eventListenerID=-1,e._slotTextures=null,e._isRenderable=!1,e.loop=we&&we(),e._useVertexOpacity=!0,e._startEntry={animation:{name:""},trackIndex:0},e._endEntry={animation:{name:""},trackIndex:0},e._startSlotIndex=-1,e._endSlotIndex=-1,e._instance=new it.SkeletonInstance,e._instance.dtRate=1*e._timeScale,e._instance.isCache=e.isAnimationCached(),e.attachUtil=new Le,e}E(e,t);var n=e.prototype;return n.__preload=function(){t.prototype.__preload.call(this),this._updateSkeletonData(),this._updateDebugDraw()},n.onRestore=function(){this.updateMaterial(),this._markForUpdateRenderData()},n.getState=function(){return this._state},n.onEnable=function(){t.prototype.onEnable.call(this),this._flushAssembler(),ne.getInstance().add(this),this._isRenderable=!0},n.onDisable=function(){t.prototype.onDisable.call(this),ne.getInstance().remove(this),this._isRenderable=!1},n.onDestroy=function(){var e;this._eventListenerID>0&&(Ot.removeListener(this._eventListenerID),this._eventListenerID=-1),this._drawList.destroy(),this.destroyRenderData(),this._cleanMaterialCache(),this._vBuffer=null,this._iBuffer=null,this.attachUtil.reset(),null==(e=this._slotTextures)||e.clear(),this._slotTextures=null,this._cachedSockets.clear(),this._socketNodes.clear(),this._animCache=null,ne.getInstance().remove(this),this._instance&&(this._instance.destroy(),this._instance=null),this._destroySkeletonInfo(this._skeletonCache),this._skeletonCache=null,t.prototype.onDestroy.call(this)},n.clearAnimation=function(t){this.isAnimationCached()||(this.clearTrack(t||0),this.setToSetupPose())},n.clearAnimations=function(){this.isAnimationCached()||(this.clearTracks(),this.setToSetupPose())},n._updateSkeletonData=function(){var t=this._skeletonData;if(!Pe(this._skeletonData))return this._runtimeData=null,this._state=null,this._skeleton=null,this._textures=[],this._refreshInspector(),void(this._isRenderable&&ne.getInstance().remove(this));this._instance&&(this._instance.dtRate=1*this._timeScale),this._runtimeData=t.getRuntimeData(),this._runtimeData&&(this.setSkeletonData(this._runtimeData),this._textures=t.textures,this._refreshInspector(),this.defaultSkin&&""!==this.defaultSkin?this.setSkin(this.defaultSkin):this._skinName&&""!==this._skinName&&this.setSkin(this._skinName),this.defaultAnimation?this.animation=this.defaultAnimation.toString():this._animationName?this.animation=this._animationName:this.animation="",this._updateUseTint(),this._indexBoneSockets(),this._updateSocketBindings(),this.attachUtil.init(this),this._preCacheMode=this._cacheMode)},n.setSkeletonData=function(t){var e=this._skeletonCache;if(this._cacheMode===Re.SHARED_CACHE?this._skeletonCache=te.sharedCache:this._cacheMode===Re.PRIVATE_CACHE?(this._skeletonCache=new te,this._skeletonCache.enablePrivateMode()):this._skeletonCache=null,e!==this._skeletonCache&&this._destroySkeletonInfo(e),this.isAnimationCached()){(this.debugBones||this.debugSlots)&&I(16410);var n=this._skeletonCache.getSkeletonInfo(this._skeletonData);this._skeletonInfo!==n&&(this._destroySkeletonInfo(this._skeletonCache),n||this._cacheMode!==Re.PRIVATE_CACHE||(this._animCache=this._skeletonCache.initAnimationCache(this.skeletonData.uuid,this._skeletonData,this._animationName)),this._skeletonInfo=this._skeletonCache.createSkeletonInfo(this._skeletonData)),this._skeletonInfo&&(this._skeleton=this._skeletonInfo.skeleton)}else this._skeleton=this._instance.initSkeleton(t),this._state=this._instance.getAnimationState(),this._instance.setPremultipliedAlpha(this._premultipliedAlpha);this._isRenderable&&ne.getInstance().add(this),this._flushAssembler()},n.setSlotsRange=function(t,e){this.isAnimationCached()?I(16411):(this._startSlotIndex=t,this._endSlotIndex=e)},n.getAttachment=function(t,e){return this._skeleton?this._skeleton.getAttachmentByName(t,e):null},n.setAttachment=function(t,e){this._skeleton&&this._skeleton.setAttachment(t,e),this.invalidAnimationCache()},n.getTextureAtlas=function(t){return t.region},n.setAnimation=function(t,e,n){if("string"!=typeof e)return x(7511),null;var i=this._skeleton;if(!i||!i.data.findAnimation(e))return x(7509,e),null;var s=null;if(void 0===n&&(n=!0),this._playTimes=n?0:1,this.isAnimationCached()){if(0!==t&&I(16412),!this._skeletonCache)return null;var a=this._skeletonCache.getAnimationCache(this._skeletonData.uuid,e);a||(a=this._skeletonCache.initAnimationCache(this.skeletonData.uuid,this._skeletonData,e))&&this._skinName&&a.setSkin(this._skinName),a&&(this._animationName=e,this._isAniComplete=!1,this._accTime=0,this._playCount=0,this._animCache=a,this._socketNodes.size>0&&this._animCache.enableCacheAttachedInfo(),this._animCache.updateToFrame(0),this._curFrame=this._animCache.frames[0])}else this._animationName=e,s=this._instance.setAnimation(t,e,n);return this._markForUpdateRenderData(),s},n.addAnimation=function(t,e,n,i){if(i=i||0,this.isAnimationCached())return 0!==t&&I(16413),this._animationQueue.push({animationName:e,loop:n,delay:i}),null;if(this._skeleton){var s,a=this._skeleton.data.findAnimation(e);return a?null==(s=this._state)?void 0:s.addAnimationWith(t,a,n,i):(x(7510,e),null)}return null},n.findAnimation=function(t){return this._skeleton?this._skeleton.data.findAnimation(t):null},n.getCurrent=function(t){if(this.isAnimationCached())I(16414);else if(this._state)return this._state.getCurrent(t);return null},n.setSkin=function(t){t&&(this._skeleton&&this._skeleton.setSkinByName(t),this._instance.setSkin(t),this.isAnimationCached()&&this._animCache&&this._animCache.setSkin(t),this._skinName=t,this.invalidAnimationCache())},n.updateAnimation=function(t){if(this._markForUpdateRenderData(),!this.paused)if(this.isAnimationCached()){if(t*=1*this._timeScale,this._isAniComplete){var e;if(0===this._animationQueue.length&&!this._headAniInfo){var n=this._animCache;if(n&&n.isInvalid()){n.updateToFrame(0);var i=n.frames;this._curFrame=i[i.length-1]}return}if(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=t,this._accTime>(null==(e=this._headAniInfo)?void 0:e.delay)){var s=this._headAniInfo;this._headAniInfo=null,this.setAnimation(0,null==s?void 0:s.animationName,null==s?void 0:s.loop)}return}this._updateCache(t)}else this._instance.updateAnimation(t)},n._updateCache=function(t){var e=this._animCache;if(e.isInited()){var n=e.frames,i=te.FrameTime;0===this._accTime&&0===this._playCount&&(this._startEntry.animation.name=this._animationName,this._listener&&this._listener.start&&this._listener.start(this._startEntry)),this._accTime+=t;var s=Math.floor(this._accTime/i);if(e.isCompleted||e.updateToFrame(s),this._curFrame=n[s],void 0!==this._curFrame&&this.attachUtil.updateSkeletonBones(this._curFrame.boneInfos),e.isCompleted&&s>=n.length){if(this._playCount++,this._playTimes>0&&this._playCount>=this._playTimes)return this._curFrame=n[n.length-1],this._accTime=0,this._playCount=0,this._isAniComplete=!0,void this._emitCacheCompleteEvent();this._accTime=0,s=0,this._curFrame=n[s],this._emitCacheCompleteEvent()}}},n._emitCacheCompleteEvent=function(){this._listener&&(this._endEntry.animation.name=this._animationName,this._listener.complete&&this._listener.complete(this._endEntry),this._listener.end&&this._listener.end(this._endEntry))},n.updateRenderData=function(){return this.isAnimationCached()?this._curFrame?this._curFrame.model:null:this._instance.updateRenderData()},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._skeleton&&this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._markForUpdateRenderData(),this._updateColor())},n._render=function(t){var e=0;if(this.renderData&&this._drawList.length>0){for(var n=this.renderData,i=n.chunk,s=i.vertexAccessor,a=n.getMeshBuffer(),r=a.indexOffset,o=0;o<this._drawList.length;o++){var h=this._drawList.data[o];h.texture&&t.commitMiddleware(this,a,r+h.indexOffset,h.indexCount,h.texture,h.material,this._enableBatch),e+=h.indexCount}var l=n.indices.subarray(0,e);s.appendIndices(i.bufferId,l),s.getMeshBuffer(i.bufferId).setDirty()}},n.requestDrawData=function(t,e,n,i){var s=this._drawList.add();s.material=t;var a,r,o=z.assets.get(e);return o||(o=null==(a=this.skeletonData)?void 0:a.textures.find((function(t){return t.uuid===e||t.getId()===e})))||(o=null==(r=this._slotTextures)?void 0:r.get(e)),s.texture=o,s.indexOffset=n,s.indexCount=i,s},n._updateBuiltinMaterial=function(){return H.get("default-spine-material")},n.updateMaterial=function(){var t;t=this._customMaterial?this._customMaterial:this._updateBuiltinMaterial(),this.setSharedMaterial(t,0),this._cleanMaterialCache()},n.getMaterialTemplate=function(){return null!==this.customMaterial?this.customMaterial:(this.material||this.updateMaterial(),this.material)},n._cleanMaterialCache=function(){for(var t in this._materialCache)this._materialCache[t].destroy();this._materialCache={}},n.getMaterialForBlendAndTint=function(t,e,n){var i=n+"/"+t+"/"+e,s=this._materialCache[i];if(s)return s;if(this._customMaterialInstance)s=this._customMaterialInstance;else{var a=this.getMaterialTemplate();s=new V({parent:a,subModelIdx:0,owner:this})}this._materialCache[i]=s,s.overridePipelineStates({blendState:{blendColor:u.WHITE,targets:[{blendEq:tt.ADD,blendAlphaEq:tt.ADD,blendSrc:t,blendDst:e,blendSrcAlpha:t,blendDstAlpha:e}]}});var r=!1;n===je.TWO_COLORED&&(r=!0);var o=!this._enableBatch;return s.recompileShaders({TWO_COLORED:r,USE_LOCAL:o}),s},n._updateAnimEnum=function(){var t;t=Pe(this.skeletonData)?this.skeletonData.getAnimsEnum():Be,this._enumAnimations=A({}),Object.assign(this._enumAnimations,t),A.update(this._enumAnimations),w(this,"_animationIndex",this._enumAnimations)},n._updateSkinEnum=function(){var t;t=Pe(this.skeletonData)?this.skeletonData.getSkinsEnum():Oe,this._enumSkins=A({}),Object.assign(this._enumSkins,t),A.update(this._enumSkins),w(this,"_defaultSkinIndex",this._enumSkins)},n._refreshInspector=function(){},n.destroyRenderData=function(){this._drawList.reset(),t.prototype.destroyRenderData.call(this)},n.createRenderEntity=function(){var t=new q(G.DYNAMIC);return t.setUseLocal(!0),t},n.markForUpdateRenderData=function(e){void 0===e&&(e=!0),t.prototype._markForUpdateRenderData.call(this,e),this._debugRenderer&&this._debugRenderer._markForUpdateRenderData(e)},n.syncAttachedNode=function(){this.attachUtil._syncAttachedNode()},n.isAnimationCached=function(){return this._cacheMode!==Re.REALTIME},n.setAnimationCacheMode=function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._preCacheMode=t,this._instance&&(this._instance.isCache=this.isAnimationCached()),this._updateSkeletonData(),this._markForUpdateRenderData())},n.setToSetupPose=function(){this._skeleton&&this._skeleton.setToSetupPose()},n.setBonesToSetupPose=function(){this._skeleton&&this._skeleton.setBonesToSetupPose()},n.setSlotsToSetupPose=function(){this._skeleton&&this._skeleton.setSlotsToSetupPose()},n.invalidAnimationCache=function(){this.isAnimationCached()&&this._skeletonCache&&this._skeletonCache.invalidAnimationCache(this._skeletonData.uuid)},n.findBone=function(t){return this._skeleton?this._skeleton.findBone(t):null},n.findSlot=function(t){return this._skeleton?this._skeleton.findSlot(t):null},n.setMix=function(t,e,n){this.isAnimationCached()?I(16415):this._state&&this._instance.setMix(t,e,n)},n.clearTracks=function(){this.isAnimationCached()?I(16416):this._state&&(this._state.clearTracks(),this.setToSetupPose())},n.clearTrack=function(t){this.isAnimationCached()?I(16417):this._state&&this._state.clearTrack(t)},n.updateWorldTransform=function(){this.isAnimationCached()&&this._skeleton&&this._skeleton.updateWorldTransform()},n._verifySockets=function(t){for(var e=0,n=t.length;e<n;e++){var i=t[e].target;!i||i.parent&&i.parent===this.node||C("Target node "+i.name+" is expected to be a direct child of "+this.node.name)}var s=new Map;t.forEach((function(t){t.target&&(s.get(t.target)?C("Target node "+t.target.name+" has existed."):s.set(t.target,!0))}))},n._updateSocketBindings=function(){if(this._skeleton){this._socketNodes.clear();for(var t=0,e=this._sockets.length;t<e;t++){var n=this._sockets[t];if(n.path&&n.target){var i=this._cachedSockets.get(n.path);if(!i){C("Skeleton data does not contain path "+n.path);continue}this._socketNodes.set(i,n.target)}}}},n._indexBoneSockets=function(){if(this._skeleton){this._cachedSockets.clear();for(var t=this._skeleton.bones,e=function e(n){return null==n.parent?n.data.name||"<Unamed>":e(t[n.parent.data.index])+"/"+n.data.name},n=0,i=t.length;n<i;n++){var s=t[n].data,a=e(t[n]);this._cachedSockets.set(a,s.index)}}},n.querySockets=function(){return this._skeleton?(0===this._cachedSockets.size&&this._indexBoneSockets(),this._cachedSockets.size>0?Array.from(this._cachedSockets.keys()).sort():[]):[]},n._updateUseTint=function(){this._cleanMaterialCache(),this.destroyRenderData(),this.isAnimationCached()||this._instance.setUseTint(this._useTint);var t=this._assembler;t&&t.createData&&this._skeleton&&(this._renderData=t.createData(this),this._markForUpdateRenderData())},n._updateBatch=function(){this._cleanMaterialCache(),this._markForUpdateRenderData()},n._updateDebugDraw=function(){if(this.debugBones||this.debugSlots||this.debugMesh){if(!this._debugRenderer){var t=new F("DEBUG_DRAW_NODE");t.layer=this.node.layer,t.hideFlags|=N.DontSave|N.HideInHierarchy;var e=null;try{(e=t.addComponent("cc.Graphics")).lineWidth=5,e.strokeColor=new u(255,0,0,255),this._debugRenderer=e,t.parent=this.node,this.node.on(B.LAYER_CHANGED,this._applyLayer,this)}catch(e){R(4501,e.message),t.destroy(),t=null}}this.isAnimationCached()?I(16418):this._instance.setDebugMode(!0)}else this._debugRenderer&&(this.node.off(B.LAYER_CHANGED,this._applyLayer,this),this._debugRenderer.node.destroy(),this._debugRenderer=null,this.isAnimationCached()||this._instance&&this._instance.setDebugMode(!1))},n._updateUITransform=function(){var t=this.node._getUITransformComp(),e=this._runtimeData;if(!e)return t.setContentSize(100,100),t.anchorX=.5,void(t.anchorX=.5);var n=e.width,i=e.height;n&&i&&(t.setContentSize(n,i),0!==n&&(t.anchorX=Math.abs(e.x)/n),0!==i&&(t.anchorY=Math.abs(e.y)/i))},n._updateColor=function(){var t=this,e=t.node._uiProps,n=t._tempColor,i=t._color,s=t.node.parent?t.node.parent._uiProps.opacity:1,a=e.localOpacity*s*i.a/255;if(n.r!==i.r||n.g!==i.g||n.b!==i.b||n.a!==a){e.colorDirty=!0,n.r=i.r,n.g=i.g,n.b=i.b,n.a=a;var r=i.r/255,o=i.g/255,h=i.b/255;this._instance.setColor(r,o,h,a)}},n.setVertexEffectDelegate=function(){I(16409)},n._ensureListener=function(){this._listener||(this._listener=new Ot,this._eventListenerID=Ot.addListener(this._listener),this._instance.setListener(this._eventListenerID))},n.setStartListener=function(t){this._ensureListener(),this._listener.start=t},n.setInterruptListener=function(t){this._ensureListener(),this._listener.interrupt=t},n.setEndListener=function(t){this._ensureListener(),this._listener.end=t},n.setDisposeListener=function(t){this._ensureListener(),this._listener.dispose=t},n.setCompleteListener=function(t){this._ensureListener(),this._listener.complete=t},n.setEventListener=function(t){this._ensureListener(),this._listener.event=t},n.setTrackStartListener=function(t,e){Ot.getListeners(t,this._instance).start=e},n.setTrackInterruptListener=function(t,e){Ot.getListeners(t,this._instance).interrupt=e},n.setTrackEndListener=function(t,e){Ot.getListeners(t,this._instance).end=e},n.setTrackDisposeListener=function(t,e){Ot.getListeners(t,this._instance).dispose=e},n.setTrackCompleteListener=function(t,e){Ot.getListeners(t,this._instance).complete=function(t){var n=Math.floor(t.trackTime/t.animationEnd);e(t,n)}},n.setTrackEventListener=function(t,e){Ot.getListeners(t,this._instance).event=e},n.getDebugShapes=function(){return this._instance.getDebugShapes()},n.setSlotTexture=function(t,e,n){if(this.isAnimationCached())C("Cached mode can't change texture of slot");else if(this.findSlot(t)){var i=e.width,s=e.height,a=n||!1;this._instance.resizeSlotRegion(t,i,s,a);var r=e.uuid;r||(r=e.getId()),this._instance.setSlotTexture(t,r),this._slotTextures||(this._slotTextures=new Map),this._slotTextures.set(r,e)}else C("No slot named:"+t)},n._destroySkeletonInfo=function(t){t&&this._skeletonInfo&&(t.destroySkeleton(this._skeletonInfo.assetUUID),this._skeletonInfo=null)},n._applyLayer=function(){this._debugRenderer&&(this._debugRenderer.node.layer=this.node.layer)},S(e,[{key:"drawList",get:function(){return this._drawList}},{key:"skeletonData",get:function(){return this._skeletonData},set:function(t){t&&t.resetEnums(),this._skeletonData!==t&&(this.destroyRenderData(),this._skeletonData=t,this.defaultSkin="",this.defaultAnimation="",this._animationName="",this._skinName="",this._updateSkeletonData(),this._updateUITransform())}},{key:"_defaultSkinIndex",get:function(){if(Pe(this.skeletonData)){var t=this.skeletonData.getSkinsEnum();if(t)if(""===this.defaultSkin){if(t.hasOwnProperty(0))return this._defaultSkinIndex=0,0}else{var e=t[this.defaultSkin];if(void 0!==e)return e}}return 0},set:function(t){var e;if(Pe(this.skeletonData)&&(e=this.skeletonData.getSkinsEnum()),e){var n=e[t];void 0!==n?(this.defaultSkin=String(n),this.setSkin(this.defaultSkin),this._refreshInspector(),this._markForUpdateRenderData()):C(this.name+" skin enums are invalid")}else C(this.name+" skin enums are invalid")}},{key:"_animationIndex",get:function(){var t=this.animation;if(Pe(this.skeletonData))if(t){var e=this.skeletonData.getAnimsEnum();if(e){var n=e[t];if(void 0!==n)return n}}else this._refreshInspector();return 0},set:function(t){var e;if(Pe(this.skeletonData)&&(e=this.skeletonData.getAnimsEnum()),e){var n=String(e[t]);void 0!==n?(this.animation=n,this.animation=n):C(this.name+" animation enums are invalid")}else C(this.name+" animation enums are invalid")}},{key:"defaultCacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode=t,this.setAnimationCacheMode(this._cacheMode)}},{key:"premultipliedAlpha",get:function(){return this._premultipliedAlpha},set:function(t){t!==this._premultipliedAlpha&&(this._premultipliedAlpha=t,this._instance.setPremultipliedAlpha(t),this._markForUpdateRenderData())}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){t!==this._timeScale&&(this._timeScale=t,this._instance&&(this._instance.dtRate=1*this._timeScale))}},{key:"useTint",get:function(){return this._useTint},set:function(t){t!==this._useTint&&(this._useTint=t,this._updateUseTint())}},{key:"enableBatch",get:function(){return this._enableBatch},set:function(t){t!==this._enableBatch&&(this._enableBatch=t,this._updateBatch())}},{key:"sockets",get:function(){return this._sockets},set:function(t){this._sockets=t,this._updateSocketBindings(),this.attachUtil.init(this)}},{key:"debugSlots",get:function(){return this._debugSlots},set:function(t){t!==this._debugSlots&&(this._debugSlots=t,this._updateDebugDraw(),this._markForUpdateRenderData())}},{key:"debugBones",get:function(){return this._debugBones},set:function(t){t!==this._debugBones&&(this._debugBones=t,this._updateDebugDraw(),this._markForUpdateRenderData())}},{key:"debugMesh",get:function(){return this._debugMesh},set:function(t){t!==this._debugMesh&&(this._debugMesh=t,this._updateDebugDraw(),this._markForUpdateRenderData())}},{key:"socketNodes",get:function(){return this._socketNodes}},{key:"animation",get:function(){return this._animationName},set:function(t){t?this.setAnimation(0,t,this.loop):this.clearAnimation(0)}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this.updateMaterial(),this._markForUpdateRenderData()}},{key:"customMaterialInstance",get:function(){if(!this._customMaterial)return null;if(!this._customMaterialInstance){var t={parent:this._customMaterial,subModelIdx:0,owner:this};this._customMaterialInstance=new V(t)}return this._customMaterialInstance}}]),e}(K),Ne.SpineSocket=He,Ne.AnimationCacheMode=Re,ke=a((ve=Ne).prototype,"_skeletonData",[r],(function(){return null})),ge=a(ve.prototype,"defaultSkin",[r],(function(){return""})),Ce=a(ve.prototype,"defaultAnimation",[r],(function(){return""})),ye=a(ve.prototype,"_premultipliedAlpha",[r],(function(){return!0})),Se=a(ve.prototype,"_timeScale",[r],(function(){return 1})),Ee=a(ve.prototype,"_preCacheMode",[r],(function(){return Re.UNSET})),Ae=a(ve.prototype,"_cacheMode",[r],(function(){return Re.REALTIME})),De=a(ve.prototype,"_sockets",[r],(function(){return[]})),Te=a(ve.prototype,"_useTint",[r],(function(){return!1})),be=a(ve.prototype,"_debugMesh",[r],(function(){return!1})),Me=a(ve.prototype,"_debugBones",[r],(function(){return!1})),Ie=a(ve.prototype,"_debugSlots",[r],(function(){return!1})),xe=a(ve.prototype,"_enableBatch",[r],(function(){return!1})),U(ve.prototype,"skeletonData",[ue],Object.getOwnPropertyDescriptor(ve.prototype,"skeletonData"),ve.prototype),U(ve.prototype,"_defaultSkinIndex",[ce],Object.getOwnPropertyDescriptor(ve.prototype,"_defaultSkinIndex"),ve.prototype),U(ve.prototype,"_animationIndex",[de],Object.getOwnPropertyDescriptor(ve.prototype,"_animationIndex"),ve.prototype),U(ve.prototype,"defaultCacheMode",[_e],Object.getOwnPropertyDescriptor(ve.prototype,"defaultCacheMode"),ve.prototype),we=a(ve.prototype,"loop",[r],(function(){return!0})),U(ve.prototype,"sockets",[fe],Object.getOwnPropertyDescriptor(ve.prototype,"sockets"),ve.prototype),U(ve.prototype,"customMaterial",[c,me],Object.getOwnPropertyDescriptor(ve.prototype,"customMaterial"),ve.prototype),pe=ve))||pe);P.internal.SpineSkeleton=Ve;var We,Ye,Je,Xe,qe=function(){function t(){this.name="sp.VertexEffectDelegate",this._vertexEffect=void 0,this._interpolation=void 0,this._effectType=void 0,this._vertexEffect=null,this._interpolation=null,this._effectType="none"}var e=t.prototype;return e.clear=function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none"},e.initJitter=function(t,e){return this._effectType="jitter",this._vertexEffect=new it.JitterEffect(t,e),this._vertexEffect},e.initSwirlWithPow=function(t,e){return this._effectType="swirl",this._interpolation=new it.Pow(e),this._vertexEffect=new it.SwirlEffect(t,this._interpolation),this._vertexEffect},e.initSwirlWithPowOut=function(t,e){return this._effectType="swirl",this._interpolation=new it.PowOut(e),this._vertexEffect=new it.SwirlEffect(t,this._interpolation),this._vertexEffect},e.getJitterVertexEffect=function(){return this._vertexEffect},e.getSwirlVertexEffect=function(){return this._vertexEffect},e.getVertexEffect=function(){return this._vertexEffect},e.getEffectType=function(){return this._effectType},t}(),Ge=1.1,Ke=new u(0,0,255,255),Qe=new u(255,0,0,255),Ze=new u(0,255,0,255),$e=new u(255,255,0,255),tn=null,en=null,nn=!1,sn=!1,an=Y(J),rn=Y(X),on=new d(0,0,0);function hn(t,e){var n,i;switch(t){case 1:n=nn?et.ONE:et.SRC_ALPHA,i=et.ONE;break;case 2:n=et.DST_COLOR,i=et.ONE_MINUS_SRC_ALPHA;break;case 3:n=nn?et.ONE:et.SRC_ALPHA,i=et.ONE_MINUS_SRC_COLOR;break;default:n=nn?et.ONE:et.SRC_ALPHA,i=et.ONE_MINUS_SRC_ALPHA}return e.getMaterialForBlendAndTint(n,i,sn?je.TWO_COLORED:je.COLORED_TEXTURED)}var ln=new(function(){function t(){this.vCount=32767}var e=t.prototype;return e.ensureAccessor=function(t){var e=t?en:tn;if(!e){var n=m.root.device,i=m.root.batcher2D,s=t?X:J;t?(e=en=new Q(n,s,this.vCount),i.registerBufferAccessor(Number.parseInt("SPINETINT",36),en)):(e=tn=new Q(n,s,this.vCount),i.registerBufferAccessor(Number.parseInt("SPINE",36),tn))}return e},e.createData=function(t){var e=t.renderData;if(!e){var n=t.useTint||t.isAnimationCached(),i=this.ensureAccessor(n);e=Z.add(n?X:J,i)}return e},e.updateRenderData=function(t){var e;t._skeleton&&t.node.active&&null!=(e=t.skeletonData)&&e.isValid&&un(t)},t}());function un(t){t.drawList.reset();var e=t.renderData;if(0!==t.color.a&&e){t._updateColor(),nn=t.premultipliedAlpha,sn=t.useTint||t.isAnimationCached(),t.isAnimationCached()?dn(t):cn(t);var n=sn?en:tn;t.syncAttachedNode(),(e.vertexCount>0||e.indexCount>0)&&n.getMeshBuffer(e.chunk.bufferId).setDirty()}}function cn(t){var e,n,i=(t.useTint?rn:an)/Float32Array.BYTES_PER_ELEMENT,s=t.updateRenderData(),a=s.vCount,r=s.iCount,o=t.renderData;if(!(!o||a<1||r<1)){o.vertexCount===a&&o.indexCount===r||((o.vertexCount<a||o.indexCount<r)&&o.resize(Math.ceil(a*Ge),Math.ceil(r*Ge)),o.indices=new Uint16Array(r),t._vLength=a*Float32Array.BYTES_PER_ELEMENT*i,t._vBuffer=new Uint8Array(o.chunk.vb.buffer,o.chunk.vb.byteOffset,t._vLength),t._iLength=Uint16Array.BYTES_PER_ELEMENT*r,t._iBuffer=new Uint8Array(o.indices.buffer));var h=o.chunk.vb,l=s.vPtr,u=s.iPtr,c=o.indices,d=it.wasmUtil.wasm.HEAPU8;null==(e=t._vBuffer)||e.set(d.subarray(l,l+t._vLength),0),null==(n=t._iBuffer)||n.set(d.subarray(u,u+t._iLength),0);for(var _=o.chunk.vertexOffset,f=0;f<r;f++)c[f]+=_;for(var m=s.getData(),p=s.getTextures(),v=m.size(),k=0,g=0,C=0;C<v;C+=5){g=m.get(C+3);var y=hn(m.get(C+4),t);t.requestDrawData(y,p.get(C/5),k,g),k+=g}if(t.enableBatch)for(var S=t.node.worldMatrix,E=0,A=0;A<a;A++)E=A*i,on.x=h[E],on.y=h[E+1],on.z=0,on.transformMat4(S),h[E]=on.x,h[E+1]=on.y,h[E+2]=on.z;var D=t._debugRenderer,T=t._skeleton;if(D&&(t.debugBones||t.debugSlots||t.debugMesh)){D.clear();for(var b=t.getDebugShapes(),M=b.size(),I=0;I<M;I++){var x=b.get(I);if(0===x.type&&t.debugSlots){D.strokeColor=Ke;var w=x.vOffset*i,N=x.vCount*i;D.moveTo(h[w],h[w+1]);for(var R=w+i,U=w+N;R<U;R+=i)D.lineTo(h[R],h[R+1]);D.close(),D.stroke()}else if(1===x.type&&t.debugMesh){D.strokeColor=$e;for(var L=x.iCount,P=x.iOffset,O=P,B=P+L;O<B;O+=3){var F=c[O]*i,j=c[O+1]*i,z=c[O+2]*i;D.moveTo(h[F],h[F+1]),D.lineTo(h[j],h[j+1]),D.lineTo(h[z],h[z+1]),D.close(),D.stroke()}}}if(t.debugBones){D.strokeColor=Qe,D.fillColor=Ke;for(var H=0,V=T.bones.length;H<V;H++){var W=T.bones[H],Y=W.data.length*W.a+W.worldX,J=W.data.length*W.c+W.worldY;D.moveTo(W.worldX,W.worldY),D.lineTo(Y,J),D.stroke(),D.circle(W.worldX,W.worldY,1.5*Math.PI),D.fill(),0===H&&(D.fillColor=Ze)}}}}}function dn(t){var e=t.updateRenderData();if(e){var n=e.vCount,i=e.iCount,s=t.renderData;if(!(!s||n<1||i<1)){s.vertexCount===n&&s.indexCount===i||((s.vertexCount<n||s.indexCount<i)&&s.resize(Math.ceil(n*Ge),Math.ceil(i*Ge)),s.indices=new Uint16Array(i));var a=s.chunk.vb,r=new Uint8Array(a.buffer,a.byteOffset,Float32Array.BYTES_PER_ELEMENT*a.length);r.set(e.vData);var o=t.color,h=t.node._uiProps.opacity;if(1-h>_||4294967295!==u.toUint32(o)||nn){We=o.r/255,Ye=o.g/255,Je=o.b/255,Xe=h;for(var l=0;l<n;l++){var c=l*rn+5*Float32Array.BYTES_PER_ELEMENT,d=r[c],f=r[c+1],m=r[c+2],p=r[c+3]*Xe,v=nn?p/255:1;r[c]=Math.floor(v*d*We),r[c+1]=Math.floor(v*f*Ye),r[c+2]=Math.floor(v*m*Je),r[c+3]=Math.floor(p),r[c+4]=Math.floor(r[c+4]*We),r[c+5]=Math.floor(r[c+5]*Ye),r[c+6]=Math.floor(r[c+6]*Je),r[c+7]=nn?255:0}}var k=s.indices;k.set(e.iData);for(var g=s.chunk.vertexOffset,C=0;C<i;C++)k[C]+=g;for(var y=e.meshes,S=y.length,E=0,A=0,D=0;D<S;D++){var T=y[D],b=hn(T.blendMode,t),M=T.textureID;A=T.iCount,t.requestDrawData(b,M,E,A),E+=A}var I=rn/Float32Array.BYTES_PER_ELEMENT;if(t.enableBatch)for(var x=t.node.worldMatrix,w=0,N=0;N<n;N++)w=N*I,on.x=a[w],on.y=a[w+1],on.z=0,on.transformMat4(x),a[w]=on.x,a[w+1]=on.y,a[w+2]=on.z}}}P.internal.SpineAssembler=ln;var _n,fn,mn={getAssembler:function(){return ln}};function pn(){return Promise.resolve()}Ve.Assembler=mn,function(t){t[t.REGION=0]="REGION",t[t.BOUNDING_BOX=1]="BOUNDING_BOX",t[t.MESH=2]="MESH",t[t.SKINNED_MESH=3]="SKINNED_MESH"}(_n||(_n={})),b(_n),function(t){t[t.START=0]="START",t[t.INTERRUPT=1]="INTERRUPT",t[t.END=2]="END",t[t.COMPLETE=3]="COMPLETE",t[t.DISPOSE=4]="DISPOSE",t[t.EVENT=5]="EVENT"}(fn||(fn={})),b(fn),t("sp",Object.freeze({__proto__:null,get ATTACHMENT_TYPE(){return _n},AnimationCacheMode:Fe,get AnimationEventType(){return fn},DefaultAnimsEnum:ze,get DefaultSkinsEnum(){return Oe},SPINE_VERSION:"4.2",Skeleton:Ve,SkeletonData:ee,get SpineAnimationCacheMode(){return Re},get SpineDefaultAnimsEnum(){return Be},get SpineMaterialType(){return je},SpineSocket:He,VertexEffectDelegate:qe,isBinaryCompatible:function(){return!1},isJsonCompatible:function(){return!1},loadWasmModuleSpine:pn,simpleSpineAssembler:mn,spine:it,timeScale:1}))}}}));
//# sourceMappingURL=spine.js.map
