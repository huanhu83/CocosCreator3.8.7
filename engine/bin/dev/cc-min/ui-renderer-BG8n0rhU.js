System.register(["./gc-object-BD6DANSw.js","./index-BcjqSS2q.js","./_virtual_internal_constants-CVZmBipG.js","./global-exports-ZavlJGEN.js","./scene-D5fG1En6.js","./node-event-BDYemSfE.js","./deprecated-BaebfHhU.js","./debug-view-zRQBd5E1.js","./device-manager-BCOP-4pU.js","./buffer-barrier-CZBuOw0V.js","./director-D6Xf3-Ej.js","./deprecated-gv6rCJsk.js","./prefab-CJahvMeV.js","./pipeline-state-manager-C4BAah3w.js","./renderer-DVTO-7-w.js","./sorting-layers-sC9IxUEk.js"],(function(t){"use strict";var e,i,n,r,s,a,o,h,f,u,c,l,_,d,y,g,D,v,p,E,m,A,S,R,x,C,b,B,k,I,M,w,T,O,P,F,L,N,V,H,z,U,G,W,j,X,Y,K,q,Z,J,Q,$,tt,et,it,nt;return{setters:[function(t){e=t.l,i=t.g,n=t.w,r=t.a,s=t.P,a=t._,o=t.h,h=t.J,f=t.z,u=t.R,c=t.r,l=t.H,_=t.b},function(t){d=t.n,y=t.C,g=t.V,D=t.f,v=t.M,p=t.l,E=t.c,m=t.d,A=t.a7,S=t.O,R=t.G,x=t.a,C=t.j,b=t.N,B=t.A,k=t.s,I=t.t,M=t.I,w=t.K},null,function(t){T=t.c},function(t){O=t.d,P=t.b},function(t){F=t.N,L=t.C},null,null,null,function(t){N=t.a,V=t.A,H=t.F,z=t.c,U=t.B,G=t.b,W=t.M,j=t.I,X=t.ap,Y=t.a6,K=t.b9,q=t.m,Z=t.af,J=t.ai,Q=t.am},function(t){$=t.d,tt=t.D,et=t.u},null,null,null,function(t){it=t.R},function(t){nt=t.S}],execute:function(){t({a:gt,g:yt});var rt,st=N.ATTR_POSITION,at=N.ATTR_COLOR,ot=N.ATTR_TEX_COORD,ht=N.ATTR_COLOR2,ft=t("p",[new V(st,H.RGB32F)]),ut=t("v",[new V(st,H.RGB32F),new V(at,H.RGBA32F)]),ct=t("d",[new V(st,H.RGB32F),new V(ot,H.RG32F),new V(at,H.RGBA32F)]),lt=t("k",[new V(st,H.RGB32F),new V(ot,H.RG32F),new V(at,H.RGBA8,!0)]),_t=[new V(st,H.RGB32F),new V(ot,H.RG32F),new V(at,H.RGBA32F),new V(ht,H.RGBA32F)],dt=t("l",[new V(st,H.RGB32F),new V(ot,H.RG32F),new V(at,H.RGBA8,!0),new V(ht,H.RGBA8,!0)]);function yt(t){for(var e=0,i=0;i<t.length;i++){var n=t[i];e+=z[n.format].count}return e}function gt(t){for(var e=0,i=0;i<t.length;i++){var n=t[i];e+=z[n.format].size}return e}T.internal.vfmtPosUvColor=ct,T.internal.vfmtPosUvTwoColor=_t,T.internal.vfmtPosUvColor4B=lt,T.internal.vfmtPosUvTwoColor4B=dt,t("o",Object.freeze({__proto__:null,getAttributeStride:gt,getComponentPerVertex:yt,vfmt:ft,vfmtPosColor:ut,vfmtPosUvColor:ct,vfmtPosUvColor4B:lt,vfmtPosUvTwoColor:_t,vfmtPosUvTwoColor4B:dt})),function(t){t[t.byteOffset=0]="byteOffset",t[t.vertexOffset=1]="vertexOffset",t[t.indexOffset=2]="indexOffset",t[t.dirty=3]="dirty",t[t.count=4]="count"}(rt||(rt={}));var Dt,vt,pt,Et,mt,At,St=t("m",function(){var t=s.prototype;function s(){this._byteOffset=0,this._vertexOffset=0,this._indexOffset=0,this._dirty=!1,this._floatsPerVertex=0,this._vData=null,this._iData=null,this._vertexFormatBytes=0,this._initVDataCount=0,this._initIDataCount=0,this._attributes=null,this._iaPool=[],this._iaInfo=null,this._nextFreeIAHandle=0}return t.initSharedBuffer=function(){},t.syncSharedBufferToNative=function(){},t.initialize=function(t,n,r,s){this._initVDataCount=r,this._initIDataCount=s,this._attributes=n,this.floatsPerVertex=gt(n)>>2,e(this._initVDataCount/this._floatsPerVertex<65536,i(9005)),this.vData&&this.iData||(this.vData=new Float32Array(this._initVDataCount),this.iData=new Uint16Array(this._initIDataCount)),this._iaPool.push(this.createNewIA(t))},t.reset=function(){this._nextFreeIAHandle=0,this.dirty=!1},t.destroy=function(){this.reset(),this._attributes=null,this._iaInfo=null,this.vData=null,this.iData=null;for(var t=0;t<this._iaPool.length;++t){var e=this._iaPool[t],i=e.vertexBuffers[0];i&&i.destroy();var n=e.indexBuffer;n&&n.destroy(),e.ia.destroy()}this._iaPool.length=0},t.setDirty=function(){this.dirty=!0},t.request=function(){return n(9002),!1},t.requireFreeIA=function(t){return this._iaPool.length<=this._nextFreeIAHandle&&this._iaPool.push(this.createNewIA(t)),this._iaPool[this._nextFreeIAHandle++].ia},t.recycleIA=function(t){for(var e=this._iaPool,i=0;i<this._nextFreeIAHandle;++i)if(t===e[i].ia){var n=e[i];return e[i]=e[--this._nextFreeIAHandle],void(e[this._nextFreeIAHandle]=n)}},t.checkCapacity=function(t,e){var i=(this.vertexOffset+t)*this._floatsPerVertex,n=this.indexOffset+e;return!(i>this._initVDataCount||n>this._initIDataCount)},t.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){var t=d.__isWebIOS14OrIPadOS14Env,e=t?this._nextFreeIAHandle:1;if(t&&e/this._iaPool.length<.5){for(var i=e/.5,n=this._iaPool.length-1;n>=i;n--){var r=this._iaPool[n];r.vertexBuffers[0]&&r.vertexBuffers[0].destroy(),r.indexBuffer&&r.indexBuffer.destroy(),r.ia.destroy()}this._iaPool.length=i}for(var s=this.byteOffset,a=this.indexOffset,o=0;o<e;++o){var h=this._iaPool[o],f=new Float32Array(this.vData.buffer,0,s>>2),u=new Uint16Array(this.iData.buffer,0,a),c=h.vertexBuffers[0];s>c.size&&c.resize(s),c.update(f),2*a>h.indexBuffer.size&&h.indexBuffer.resize(2*a),h.indexBuffer.update(u)}this.dirty=!1}},t.createNewIA=function(t){var e,i,n;if(d.__isWebIOS14OrIPadOS14Env||!this._iaPool[0]){var r=this._vertexFormatBytes=this._floatsPerVertex*Float32Array.BYTES_PER_ELEMENT,s=Uint16Array.BYTES_PER_ELEMENT,a=t.createBuffer(new U(G.VERTEX|G.TRANSFER_DST,W.HOST|W.DEVICE,r,r));n=t.createBuffer(new U(G.INDEX|G.TRANSFER_DST,W.HOST|W.DEVICE,s,s)),i=[a],this._iaInfo=new j(this._attributes,i,n),e=t.createInputAssembler(this._iaInfo)}else e=t.createInputAssembler(this._iaInfo),i=this._iaInfo.vertexBuffers,n=this._iaInfo.indexBuffer;return{ia:e,vertexBuffers:i,indexBuffer:n}},r(s,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}},{key:"byteOffset",get:function(){return this._byteOffset},set:function(t){this._byteOffset=t}},{key:"vertexOffset",get:function(){return this._vertexOffset},set:function(t){this._vertexOffset=t}},{key:"indexOffset",get:function(){return this._indexOffset},set:function(t){this._indexOffset=t}},{key:"dirty",get:function(){return this._dirty},set:function(t){this._dirty=t}},{key:"floatsPerVertex",get:function(){return this._floatsPerVertex},set:function(t){this._floatsPerVertex=t}},{key:"vData",get:function(){return this._vData},set:function(t){this._vData=t}},{key:"iData",get:function(){return this._iData},set:function(t){this._iData=t}},{key:"nativeObj",get:function(){return this._nativeObj}},{key:"sharedBuffer",get:function(){return this._sharedBuffer}}]),s}()),Rt=function(){function t(t,e){this._buffers=[],this._device=t,this._attributes=e,this._floatsPerVertex=gt(e)>>2,this._vertexFormatBytes=this._floatsPerVertex*Float32Array.BYTES_PER_ELEMENT}var e=t.prototype;return e.initialize=function(){},e.reset=function(){},e.request=function(){},e.appendBuffers=function(){},e.uploadBuffers=function(){},e.destroy=function(){this._attributes.length=0},r(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}},{key:"floatsPerVertex",get:function(){return this._floatsPerVertex}}]),t}(),xt=new s((function(){return{offset:0,length:0}}),32),Ct=function(){function t(t,i,n,r,s,a){this.vertexAccessor=t,this.bufferId=i,this.meshBuffer=n,this.vertexOffset=r,this.vb=s,this.indexCount=a,e(n===t.getMeshBuffer(i))}return t.prototype.setIndexBuffer=function(){},r(t,[{key:"ib",get:function(){return this._ib}}]),t}(),bt=t("j",function(t){function i(e,n,r,s){var a;return(a=t.call(this,e,n)||this)._freeLists=[],a._vCount=0,a._iCount=0,a._id=0,a._vCount=r||Math.floor(1024*f.BATCHER2D_MEM_INCREMENT/a._vertexFormatBytes),a._iCount=s||a._vCount*i.IB_SCALE,a._id=i.generateID(),a._allocateBuffer(),a}a(i,t);var n=i.prototype;return n.destroy=function(){for(var e=0;e<this._buffers.length;++e){this._buffers[e].destroy();for(var i=this._freeLists[e],n=0;n<i.length;++n)xt.free(i[n])}this._buffers.length=0,this._freeLists.length=0,t.prototype.destroy.call(this)},n.reset=function(){for(var t=0;t<this._buffers.length;++t){var e=this._buffers[t];e.indexOffset=0,e.reset()}},n.getVertexBuffer=function(t){return this._buffers[t].vData},n.getIndexBuffer=function(t){return this._buffers[t].iData},n.getMeshBuffer=function(t){return this._buffers[t]},n.uploadBuffers=function(){for(var t=0;t<this._buffers.length;++t){var e=this._freeLists[t][0],i=this._buffers[t];(!e||e.length<i.vData.byteLength)&&i.uploadBuffers()}},n.appendIndices=function(t,e){var i=this._buffers[t];if(e.length){var n=i.indexOffset+e.length;if(i.iData.length<n){var r=Math.floor(1.25*n),s=new Uint16Array(r);s.set(i.iData),i.iData=s}i.iData.set(e,i.indexOffset),i.indexOffset+=e.length}},n.allocateChunk=function(t,i){var n=t*this.vertexFormatBytes;if(t>this._vCount||i>this._iCount)return o(9004,n),null;for(var r,s=null,a=0,h=-1,f=null,u=0;u<this._buffers.length;++u){s=this._buffers[u],r=this._freeLists[u];for(var c=0;c<r.length;++c)if(r[c].length>=n){f=r[c],a=u,h=c;break}if(f)break}if(f||(a=this._allocateBuffer(),(s=this._buffers[a])&&(h=0,f=this._freeLists[a][h])),f){var l=f.offset/this.vertexFormatBytes;e(Number.isInteger(l));var _=new Float32Array(s.vData.buffer,f.offset,n>>2).fill(0);return this._allocateChunkFromEntry(a,h,f,n),new Ct(this,a,s,l,_,i)}return null},n.recycleChunk=function(t){var i=this._freeLists[t.bufferId],n=this._buffers[t.bufferId],r=t.vertexOffset*this.vertexFormatBytes,s=t.vb.byteLength;if(0!==s){for(var a=!1,o=0,h=null,f=i[o];f&&f.offset<r;)h=f,f=i[++o];if(h){var u=r-(h.offset+h.length);e(u>=0),0===u&&(h.length+=s,r=h.offset,s=h.length,f&&f.offset-(r+s)==0&&(h.length+=f.length,i.splice(o,1),xt.free(f),f=null),a=!0)}if(!a&&f){var c=f.offset-(r+s);if(e(c>=0),0===c)f.offset=r,f.length+=s;else{var l=xt.alloc();l.offset=r,l.length=s,i.splice(o,0,l)}a=!0}if(a)r+s===n.byteOffset&&(n.byteOffset=r);else{var _=xt.alloc();_.offset=r,_.length=s,i.push(_)}}},n._allocateChunkFromEntry=function(t,e,i,n){var r=i.length-n,s=i.offset+n,a=this._buffers[t];a.byteOffset<s&&(a.byteOffset=s),h(r>=0,9004,t,i.offset,i.length),0===r?(this._freeLists[t].splice(e,1),xt.free(i)):(i.offset+=n,i.length=r)},n._allocateBuffer=function(){h(this._buffers.length===this._freeLists.length,9003);var t=new St,e=this._vCount*this._floatsPerVertex;t.initialize(this._device,this._attributes,e,this._iCount),this._buffers.push(t);var i=xt.alloc();i.offset=0,i.length=t.vData.byteLength;var n=[i];return this._freeLists.push(n),$.root.batcher2D.syncMeshBuffersToNative(this.id,this._buffers),this._buffers.length-1},i.generateID=function(){return i.ID_COUNT++},r(i,[{key:"id",get:function(){return this._id}}]),i}(Rt));bt.IB_SCALE=4,bt.ID_COUNT=0,function(t){t[t.DrawInfoType=0]="DrawInfoType",t[t.VertDirty=1]="VertDirty",t[t.BooleanValues=2]="BooleanValues",t[t.Stride=3]="Stride",t[t.Count=4]="Count"}(Dt||(Dt={})),function(t){t[t.BufferID=0]="BufferID",t[t.AccessorID=1]="AccessorID",t[t.Count=2]="Count"}(vt||(vt={})),function(t){t[t.VertexOffset=0]="VertexOffset",t[t.IndexOffset=1]="IndexOffset",t[t.VBCount=2]="VBCount",t[t.IBCount=3]="IBCount",t[t.DataHash=4]="DataHash",t[t.Count=5]="Count"}(pt||(pt={})),t("h",Et),function(t){t[t.COMP=0]="COMP",t[t.MODEL=1]="MODEL",t[t.MIDDLEWARE=2]="MIDDLEWARE",t[t.SUB_NODE=3]="SUB_NODE"}(Et||t("h",Et={})),t("f",function(){function t(){this._accId=-1,this._bufferId=-1,this._vertexOffset=0,this._indexOffset=0,this._vb=null,this._ib=null,this._vData=null,this._iData=null,this._vertDirty=!1,this._vbCount=0,this._ibCount=0,this._dataHash=0,this._isMeshBuffer=!1,this._material=null,this._texture=null,this._sampler=null,this._stride=0,this._useLocal=!1,this._model=null,this._drawInfoType=Et.COMP,this._subNode=null,this._render2dBuffer=null}var e=t.prototype;return e.init=function(){},e.clear=function(){},e.setAccId=function(t){this._accId=t},e.setBufferId=function(t){this._bufferId=t},e.setAccAndBuffer=function(t,e){this._bufferId=e,this._accId=t},e.setVertexOffset=function(t){this._vertexOffset=t},e.setIndexOffset=function(t){this._indexOffset=t},e.setVB=function(){},e.setIB=function(){},e.setVData=function(){},e.setIData=function(){},e.setVBCount=function(t){this._vbCount=t},e.setIBCount=function(){},e.setVertDirty=function(t){this._vertDirty=t},e.setDataHash=function(t){this._dataHash=t},e.setIsMeshBuffer=function(t){this._isMeshBuffer=t},e.setVertexPositionInWorld=function(){},e.setMaterial=function(t){this._material=t},e.setTexture=function(t){this._texture=t},e.setSampler=function(t){this._sampler=t},e.setModel=function(){},e.setDrawInfoType=function(t){this._drawInfoType=t},e.setSubNode=function(t){this._subNode=t},e.setStride=function(t){this._stride=t},e.initRender2dBuffer=function(){},e.fillRender2dBuffer=function(){},r(t,[{key:"nativeObj",get:function(){return this._nativeObj}},{key:"render2dBuffer",get:function(){return this._render2dBuffer}}]),t}()),t("S",mt),function(t){t[t.DISABLED=0]="DISABLED",t[t.CLEAR=1]="CLEAR",t[t.ENTER_LEVEL=2]="ENTER_LEVEL",t[t.ENABLED=3]="ENABLED",t[t.EXIT_LEVEL=4]="EXIT_LEVEL",t[t.CLEAR_INVERTED=5]="CLEAR_INVERTED",t[t.ENTER_LEVEL_INVERTED=6]="ENTER_LEVEL_INVERTED"}(mt||t("S",mt={})),function(t){t[t.stencilTest=0]="stencilTest",t[t.func=1]="func",t[t.stencilMask=2]="stencilMask",t[t.writeMask=3]="writeMask",t[t.failOp=4]="failOp",t[t.zFailOp=5]="zFailOp",t[t.passOp=6]="passOp",t[t.ref=7]="ref",t[t.count=8]="count"}(At||(At={}));var Bt,kt,It,Mt,wt,Tt,Ot=t("n",function(){function t(){this._maskStack=[],this._stencilPattern={stencilTest:!0,func:X.ALWAYS,stencilMask:65535,writeMask:65535,failOp:K.KEEP,zFailOp:K.KEEP,passOp:K.KEEP,ref:1},this._stage=mt.DISABLED,this.stencilStateMap=new Map,this.stencilStateMapWithDepth=new Map}var e=t.prototype;return e.pushMask=function(t){this._maskStack.push(t)},e.clear=function(t){return t.stencilStage!==mt.ENTER_LEVEL?mt.CLEAR_INVERTED:mt.CLEAR},e.enableMask=function(){this.stage=mt.ENABLED},e.exitMask=function(){0!==this._maskStack.length&&(this._maskStack.pop(),0===this._maskStack.length?this.stage=mt.DISABLED:this.stage=mt.ENABLED)},e.getWriteMask=function(){return 1<<this._maskStack.length-1},e.getExitWriteMask=function(){return 1<<this._maskStack.length},e.getStencilRef=function(){for(var t=0,e=0;e<this._maskStack.length;++e)t+=1<<e;return t},e.getMaskStackSize=function(){return this._maskStack.length},e.reset=function(){this._maskStack.length=0,this.stage=mt.DISABLED},e.destroy=function(){this.stencilStateMap.forEach((function(t){t.destroy()})),this.stencilStateMap.clear()},e.getStencilStage=function(t,e){var i=0,n=!1,r=!1,s=X.LESS,a=this.stencilStateMap;if(e&&e.passes[0]){var o=e.passes[0].depthStencilState,h=0,f=0;o.depthTest&&(h=1),o.depthWrite&&(f=1),i=h|f<<1|o.depthFunc<<2|t<<6|this._maskStack.length<<9,n=o.depthTest,r=o.depthWrite,s=o.depthFunc,a=this.stencilStateMapWithDepth}else i=t<<16|this._maskStack.length;if(a&&a.has(i))return a.get(i);this.setStateFromStage(t);var u=this._stencilPattern,c=new Y(n,r,s,u.stencilTest,u.func,u.stencilMask,u.writeMask,u.failOp,u.zFailOp,u.passOp,u.ref,u.stencilTest,u.func,u.stencilMask,u.writeMask,u.failOp,u.zFailOp,u.passOp,u.ref);return a.set(i,c),c},e.getStencilHash=function(t){return t<<8|this._maskStack.length},e.setStateFromStage=function(t){var e=this._stencilPattern;t===mt.DISABLED?(e.stencilTest=!1,e.func=X.ALWAYS,e.failOp=K.KEEP,e.stencilMask=e.writeMask=65535,e.ref=1):(e.stencilTest=!0,t===mt.ENABLED?(e.func=X.EQUAL,e.failOp=K.KEEP,e.stencilMask=e.ref=this.getStencilRef(),e.writeMask=this.getWriteMask()):t===mt.CLEAR?(e.func=X.NEVER,e.failOp=K.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===mt.CLEAR_INVERTED||t===mt.ENTER_LEVEL?(e.func=X.NEVER,e.failOp=K.REPLACE,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===mt.ENTER_LEVEL_INVERTED&&(e.func=X.NEVER,e.failOp=K.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()))},r(t,[{key:"stage",get:function(){return this._stage},set:function(t){this._stage=t}},{key:"pattern",get:function(){return this._stencilPattern}}]),t}());Ot.sharedManager=null,Ot.sharedManager=new Ot,t("e",Bt),function(t){t[t.COLOR=0]="COLOR",t[t.VERTEX=1]="VERTEX"}(Bt||t("e",Bt={})),t("b",kt),function(t){t[t.STATIC=0]="STATIC",t[t.DYNAMIC=1]="DYNAMIC",t[t.CROSSED=2]="CROSSED"}(kt||t("b",kt={})),function(t){t[t.priority=0]="priority",t[t.count=1]="count"}(It||(It={})),function(t){t[t.colorR=0]="colorR",t[t.colorG=1]="colorG",t[t.colorB=2]="colorB",t[t.colorA=3]="colorA",t[t.maskMode=4]="maskMode",t[t.fillColorType=5]="fillColorType",t[t.count=6]="count"}(Mt||(Mt={})),function(t){t[t.enabled=0]="enabled",t[t.useLocal=1]="useLocal",t[t.count=2]="count"}(wt||(wt={})),function(t){t[t.NONE=0]="NONE",t[t.MASK=1]="MASK",t[t.MASK_INVERTED=2]="MASK_INVERTED",t[t.MASK_NODE=3]="MASK_NODE",t[t.MASK_NODE_INVERTED=4]="MASK_NODE_INVERTED"}(Tt||(Tt={}));var Pt,Ft,Lt,Nt,Vt,Ht,zt,Ut,Gt,Wt,jt,Xt,Yt,Kt,qt,Zt,Jt,Qt,$t=t("R",function(){var t=e.prototype;function e(){this._renderEntityType=kt.STATIC,this._dynamicDrawInfoArr=[],this._node=null,this._renderTransform=null,this._stencilStage=mt.DISABLED,this._colorDirty=!0,this._enabled=!1,this._useLocal=!1,this._maskMode=Tt.NONE,this._color=y.WHITE.clone()}return t.setPriority=function(){},t.setUseLocal=function(t){this._useLocal=t},t.addDynamicRenderDrawInfo=function(){},t.removeDynamicRenderDrawInfo=function(){},t.clearDynamicRenderDrawInfos=function(){},t.clearStaticRenderDrawInfos=function(){},t.clearRenderDrawInfos=function(){},t.setDynamicRenderDrawInfo=function(){},t.setMaskMode=function(t){this._maskMode=t},t.setFillColorType=function(){},t.getStaticRenderDrawInfo=function(){return null},t.setNode=function(t){this._node=t},t.setRenderTransform=function(t){this._renderTransform=t},t.setStencilStage=function(t){this._stencilStage=t},t.initSharedBuffer=function(){},r(e,[{key:"nativeObj",get:function(){return this._nativeObj}},{key:"renderDrawInfoArr",get:function(){return this._dynamicDrawInfoArr}},{key:"renderEntityType",get:function(){return this._renderEntityType}},{key:"color",get:function(){return this._color},set:function(t){this._color=t}},{key:"colorDirty",get:function(){return this._colorDirty},set:function(t){this._colorDirty=t}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}}]),e}()),te=gt(ct)>>2,ee=t("B",function(){function t(t){void 0===t&&(t=ct),this.chunk=null,this._renderDrawInfo=null,this._material=null,this._dataHash=0,this._isMeshBuffer=!1,this._vc=0,this._ic=0,this._floatStride=0,this._vertexFormat=ct,this._drawInfoType=Et.COMP,this._multiOwner=!1,this._batcher=null,this._floatStride=t===ct?te:gt(t)>>2,this._vertexFormat=t}var e=t.prototype;return e.isValid=function(){return this._ic>0&&this.chunk.vertexAccessor},e.initRenderDrawInfo=function(t,e){void 0===e&&(e=Et.COMP)},e.removeRenderDrawInfo=function(){},e.setRenderDrawInfoAttributes=function(){},r(t,[{key:"vertexCount",get:function(){return this._vc}},{key:"indexCount",get:function(){return this._ic}},{key:"stride",get:function(){return this._floatStride<<2}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vertexFormat",get:function(){return this._vertexFormat}},{key:"drawInfoType",get:function(){return this._drawInfoType},set:function(t){this._drawInfoType=t}},{key:"renderDrawInfo",get:function(){return this._renderDrawInfo}},{key:"material",get:function(){return this._material},set:function(t){this._material=t}},{key:"dataHash",get:function(){return this._dataHash},set:function(t){this._dataHash=t}},{key:"multiOwner",get:function(){return this._multiOwner},set:function(t){this._multiOwner=t}},{key:"batcher",get:function(){return this._batcher||(this._batcher=$.root.batcher2D),this._batcher}}]),t}()),ie=t("i",function(t){function e(e,i){var n;return void 0===e&&(e=ct),void 0===i&&(i=null),(n=t.call(this,e)||this)._vertDirty=!0,n._textureHash=0,n.indices=null,n.layer=0,n.nodeDirty=!0,n.passDirty=!0,n.textureDirty=!0,n.hashDirty=!0,n._data=[],n._frame=null,n._accessor=null,n.vertexRow=1,n.vertexCol=1,i||(i=n.batcher.switchBufferAccessor(n._vertexFormat)),n._accessor=i,n}a(e,t),e.add=function(t,i){void 0===t&&(t=ct),void 0===i&&(i=null);var n=new e(t,i);return i||(i=$.root.batcher2D.switchBufferAccessor(n._vertexFormat)),n._accessor=i,n},e.remove=function(t){t.clear(),t._accessor=null};var i=e.prototype;return i.resize=function(t,e){t===this._vc&&e===this._ic&&this.chunk||(this._vc=t,this._ic=e,this.chunk&&(this._accessor.recycleChunk(this.chunk),this.chunk=null),this.chunk=this._accessor.allocateChunk(t,e),this.updateHash())},i.setRenderDrawInfoAttributes=function(){},i.fillDrawInfoAttributes=function(){},i.syncRender2dBuffer=function(){},i.resizeAndCopy=function(t,e){if(t!==this._vc||e!==this._ic||!this.chunk){this._vc=t,this._ic=e;var i=this.chunk;this.chunk=this._accessor.allocateChunk(t,e),i&&(this.chunk.vb.set(i.vb),this._accessor.recycleChunk(i)),this.updateHash()}},i.getMeshBuffer=function(){return this.chunk&&this._accessor?this._accessor.getMeshBuffer(this.chunk.bufferId):null},i.updateNode=function(t){this.layer=t.node.layer,this.nodeDirty=!1,this.hashDirty=!0},i.updatePass=function(t){this.material=t.getRenderMaterial(0),this.passDirty=!1,this.hashDirty=!0},i.updateTexture=function(t){this.frame=t,this.textureHash=t.getHash(),this.textureDirty=!1,this.hashDirty=!0},i.updateHash=function(){var t=""+(this.chunk?this.chunk.bufferId:-1)+this.layer+" "+this.textureHash;this.dataHash=q(t,666),this.hashDirty=!1},i.updateRenderData=function(t,e){if(this.passDirty&&(this.material=t.getRenderMaterial(0),this.passDirty=!1,this.hashDirty=!0),this.nodeDirty){var i=t.node.scene?t._getRenderScene():null;this.layer=t.node.layer,null!==i&&(this.nodeDirty=!1),this.hashDirty=!0}this.textureDirty&&(this.frame=e,this.textureHash=e.getHash(),this.textureDirty=!1,this.hashDirty=!0),this.hashDirty&&this.updateHash()},i.clear=function(){this.resize(0,0),this._data.length=0,this.indices=null,this.vertDirty=!0,this.material=null,this.nodeDirty=!0,this.passDirty=!0,this.textureDirty=!0,this.hashDirty=!0,this.layer=0,this.frame=null,this.textureHash=0,this.dataHash=0},e.createStaticVBAccessor=function(t,e,i){var n=$.root.device;return new bt(n,t,e,i)},r(e,[{key:"dataLength",get:function(){return this._data.length},set:function(t){var e=this._data;if(e.length!==t){for(var i=e.length;i<t;i++)e.push({x:0,y:0,z:0,u:0,v:0,color:y.WHITE.clone()});e.length=t}this.syncRender2dBuffer()}},{key:"data",get:function(){return this._data}},{key:"vertDirty",get:function(){return this._vertDirty},set:function(t){this._vertDirty=t}},{key:"textureHash",get:function(){return this._textureHash},set:function(t){this._textureHash=t}},{key:"frame",get:function(){return this._frame},set:function(t){this._frame=t}},{key:"accessor",get:function(){return this._accessor}}]),e}(ee)),ne=(t("M",function(t){function i(e){var i;return void 0===e&&(e=ct),(i=t.call(this,e)||this)._isMeshBuffer=!0,i.vertexStart=0,i.vertexRange=0,i.indexStart=0,i.indexRange=0,i.lastFilledIndex=0,i.lastFilledVertex=0,i.frame=null,i._byteLength=0,i._vertexBuffers=[],i._indexBuffer=null,i._iaPool=null,i._iaInfo=null,i.vData=new Float32Array(256*i.stride),i.iData=new Uint16Array(1536),i}a(i,t),i.add=function(t){void 0===t&&(t=ct);var e=new i;return e._floatStride=t===ct?te:gt(t)>>2,e._vertexFormat=t,e},i.remove=function(t){t.clear()};var n=i.prototype;return n.request=function(t,e){var i=this._byteLength+t*this.stride;return!!this.reserve(t,e)&&(this._vc+=t,this._ic+=e,this._byteLength=i,this.vertexRange=this._vc,this.indexRange=this._ic,!0)},n.reserve=function(t,e){var i=this._byteLength+t*this.stride,n=this.indexCount+e;if(t+this.vertexCount>65535)return!1;var r=this.vData.byteLength,s=this.iData.length,a=this.vData.length,o=this.iData.length;if(i>r||n>s){for(;r<i||s<n;)r=4*(a*=2),s=o*=2;this._reallocBuffer(a,o)}return!0},n.resize=function(t,i){var n=t*this.stride;e(t>=0&&i>=0&&n<=this.vData.byteLength&&i<=this.iData.length),this._vc=t,this._ic=i,this._byteLength=n,this.updateRange(0,t,0,i)},n.updateRange=function(t,i,n,r){e(i>=0&&r>=0&&i<=this._vc&&r<=this._ic),this.vertexStart=t,this.indexStart=n,this.vertexRange=i,this.indexRange=r},n.requestIA=function(t){this._initIAInfo(t);var e=this._iaPool.add();return e.firstIndex=this.indexStart,e.indexCount=this.indexRange,e},n.uploadBuffers=function(){if(0!==this._byteLength&&this._vertexBuffers[0]&&this._indexBuffer){var t=this._ic,e=new Float32Array(this.vData.buffer,0,this._byteLength>>2),i=new Uint16Array(this.iData.buffer,0,t),n=this._vertexBuffers[0];this._byteLength>n.size&&n.resize(this._byteLength),n.update(e);var r=t<<1;r>this._indexBuffer.size&&this._indexBuffer.resize(r),this._indexBuffer.update(i)}},n.freeIAPool=function(){this._iaPool&&this._iaPool.reset()},n.reset=function(){this._vc=0,this._ic=0,this._byteLength=0,this.vertexStart=0,this.vertexRange=0,this.indexStart=0,this.indexRange=0,this.lastFilledIndex=0,this.lastFilledVertex=0,this.material=null,this.freeIAPool()},n.clear=function(){this.reset(),this._iaPool&&this._iaPool.destroy(),this._vertexBuffers[0]&&(this._vertexBuffers[0].destroy(),this._vertexBuffers=[]),this._iaInfo=null,this.vData=new Float32Array(256*this.stride),this.iData=new Uint16Array(1536)},n._initIAInfo=function(t){var e=this;if(!this._iaInfo){var i=this.stride,n=this._vertexBuffers;n.length||n.push(t.createBuffer(new U(G.VERTEX|G.TRANSFER_DST,W.DEVICE,i,i)));var r=Uint16Array.BYTES_PER_ELEMENT;this._indexBuffer||(this._indexBuffer=t.createBuffer(new U(G.INDEX|G.TRANSFER_DST,W.DEVICE,r,r))),this._iaInfo=new j(this._vertexFormat,n,this._indexBuffer),this._iaPool=new u((function(){return t.createInputAssembler(e._iaInfo)}),1,(function(t){t.destroy()}))}},n._reallocBuffer=function(t,e){var i=this.vData;this.vData=new Float32Array(t),i&&this.vData.set(i,0);var n=this.iData;this.iData=new Uint16Array(e),n&&this.iData.set(n,0)},n.setRenderDrawInfoAttributes=function(){},n.particleInitRenderDrawInfo=function(){},r(i,[{key:"formatByte",get:function(){return this.stride},set:function(){}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vDataOffset",get:function(){return this._byteLength>>>2}}]),i}(ee)),new g),re=new g,se=new D,ae=new v,oe=new v,he=new v,fe=new v(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),ue=new p,ce=t("c",E("cc.UITransform")(Pt=C(110)(Pt=m((Vt=function(t){function e(){var e;return(e=t.call(this)||this)._priority=0,e._contentSize=Lt&&Lt(),e._anchorPoint=Nt&&Nt(),e}a(e,t);var i=e.prototype;return i.__preload=function(){this.node._uiProps.uiTransformComp=this},i.onLoad=function(){this.node.parent&&e.insertChangeMap(this.node.parent)},i.onEnable=function(){this.node.on(F.PARENT_CHANGED,this._parentChanged,this),this._markRenderDataDirty()},i.onDisable=function(){this.node.off(F.PARENT_CHANGED,this._parentChanged,this)},i.onDestroy=function(){this.node._uiProps.uiTransformComp=null},i.setContentSize=function(t,e){var i,n,r=this._contentSize;if(void 0===e){if(A(t.width,r.width,b)&&A(t.height,r.height,b))return;i=t.width,n=t.height}else{if(A(t,r.width,b)&&A(e,r.height,b))return;i=t,n=e}r.width=i,r.height=n,this.node.emit(F.SIZE_CHANGED),this._markRenderDataDirty()},i.setAnchorPoint=function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this.node.emit(F.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty()},i.isHit=function(t){for(var e=this._contentSize.width,i=this._contentSize.height,n=ne,r=re,s=this._getRenderScene().cameras,a=0;a<s.length;a++){var o=s[a];if(o.visibility&this.node.layer){o.node.getWorldRT(ae);var h=ae.m12,f=ae.m13,u=S.center;if(ae.m12=u.x-(ae.m00*h+ae.m04*f),ae.m13=u.y-(ae.m01*h+ae.m05*f),v.invert(ae,ae),g.transformMat4(n,t,ae),this.node.getWorldMatrix(he),v.invert(ae,he),!v.strictEquals(ae,fe)){g.transformMat4(r,n,ae),r.x+=this._anchorPoint.x*e,r.y+=this._anchorPoint.y*i;var c=!1;if(r.x>=0&&r.y>=0&&r.x<=e&&r.y<=i&&(c=this._maskTest(n)),c)return!0}}}return!1},i.hitTest=function(t,e){void 0===e&&(e=0);for(var i=this._contentSize.width,n=this._contentSize.height,r=se,s=ne,a=re,o=this._getRenderScene().cameras,h=0;h<o.length;h++){var f=o[h];if(f.visibility&this.node.layer&&(!f.window||f.window.swapchain)&&f.systemWindowId===e&&(D.set(r,t.x,t.y,0),f.screenToWorld(r,r),g.set(s,r.x,r.y),this.node.getWorldMatrix(he),v.invert(ae,he),!v.strictEquals(ae,fe))){g.transformMat4(a,s,ae),a.x+=this._anchorPoint.x*i,a.y+=this._anchorPoint.y*n;var u=!1;if(a.x>=0&&a.y>=0&&a.x<=i&&a.y<=n&&(u=this._maskTest(s)),u)return!0}}return!1},i._maskTest=function(t){var e,i,n=null==(e=this.node)||null==(i=e.eventProcessor)?void 0:i.maskList;if(n)for(var r=this.node,s=n.length,a=0,o=0;r&&o<s;++a,r=r.parent){var h=n[o];if(a===h.index){if(r!==h.comp.node){n.length=o;break}var f=h.comp;if(f&&f._enabled&&!f.isHit(t))return!1;o++}else if(a>h.index){n.length=o;break}}return!0},i.convertToNodeSpaceAR=function(t,e){return this.node.getWorldMatrix(he),v.invert(ae,he),e||(e=new D),D.transformMat4(e,t,ae)},i.convertToWorldSpaceAR=function(t,e){return this.node.getWorldMatrix(he),e||(e=new D),D.transformMat4(e,t,he)},i.getBoundingBox=function(){var t=new p;return this._selfBoundingBox(t),v.fromSRT(oe,this.node.rotation,this.node.position,this.node.scale),t.transformMat4(oe),t},i.getBoundingBoxToWorld=function(){for(var t=new p,i=this.node.children,n=0;n<i.length;++n){var r=i[n];if(r&&r.active){var s=r.getComponent(e);s&&s.contentSize.width&&s.contentSize.height&&(s._selfBoundingBox(ue),ue.transformMat4(r.worldMatrix),0===t.width?t.set(ue):p.union(t,t,ue))}}return this._contentSize.width&&this._contentSize.height&&(this._selfBoundingBox(ue),ue.transformMat4(this.node.worldMatrix),0===t.width?t.set(ue):p.union(t,t,ue)),t},i.getBoundingBoxTo=function(t){var i=new p,n=this.node.children;v.invert(ae,t);for(var r=0;r<n.length;++r){var s=n[r];if(s&&s.active){var a=s.getComponent(e);a&&a.contentSize.width&&a.contentSize.height&&(a._selfBoundingBox(ue),v.multiply(oe,s.worldMatrix,ae),ue.transformMat4(oe),0===i.width?i.set(ue):p.union(i,i,ue))}}return this._contentSize.width&&this._contentSize.height&&(this._selfBoundingBox(ue),v.multiply(oe,this.node.worldMatrix,ae),ue.transformMat4(oe),0===i.width?i.set(ue):p.union(i,i,ue)),i},i.getComputeAABB=function(t){var e=this._contentSize.width,i=this._contentSize.height;ue.set(-this._anchorPoint.x*e,-this._anchorPoint.y*i,e,i),ue.transformMat4(this.node.worldMatrix);var n=ue.x+.5*ue.width,r=ue.y+.5*ue.height,s=this.node.worldPosition.z,a=ue.width/2,o=ue.height/2;return null!=t?(R.set(t,n,r,s,a,o,.001),t):new R(n,r,s,a,o,.001)},i._selfBoundingBox=function(t){var e=this._contentSize.width,i=this._contentSize.height;return t.set(-this._anchorPoint.x*e,-this._anchorPoint.y*i,e,i),t},i._parentChanged=function(){this.node.getComponent("cc.RenderRoot2D")||this.node.parent&&e.insertChangeMap(this.node.parent)},i._markRenderDataDirty=function(){var t=this.node._uiProps.uiComp;t&&t._markForUpdateRenderData()},e.insertChangeMap=function(t){var i=t.uuid;e.priorityChangeNodeMap.has(i)||e.priorityChangeNodeMap.set(i,t)},e._sortChildrenSibling=function(t){var e=t.children;e&&e.sort((function(t,e){var i=t._getUITransformComp(),n=e._getUITransformComp(),r=(i?i._priority:0)-(n?n._priority:0);return 0===r?t.siblingIndex-e.siblingIndex:r}))},e._sortSiblings=function(){e.priorityChangeNodeMap.forEach((function(t){e._sortChildrenSibling(t),t._updateSiblingIndex(),t.emit("childrenSiblingOrderChanged")})),e.priorityChangeNodeMap.clear()},e._cleanChangeMap=function(){e.priorityChangeNodeMap.clear()},r(e,[{key:"contentSize",get:function(){return this._contentSize},set:function(t){this._contentSize.equals(t)||(this._contentSize.set(t),this.node.emit(F.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"width",get:function(){return this._contentSize.width},set:function(t){this._contentSize.width!==t&&(this._contentSize.width=t,this.node.emit(F.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"height",get:function(){return this._contentSize.height},set:function(t){this.contentSize.height!==t&&(this._contentSize.height=t,this.node.emit(F.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"anchorPoint",get:function(){return this._anchorPoint},set:function(t){this._anchorPoint.equals(t)||(this._anchorPoint.set(t),this.node.emit(F.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorX",get:function(){return this._anchorPoint.x},set:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this.node.emit(F.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorY",get:function(){return this._anchorPoint.y},set:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this.node.emit(F.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority!==t&&(this.node.getComponent("cc.RenderRoot2D")?n(6706):(this._priority=t,this.node.parent&&e.insertChangeMap(this.node.parent)))}},{key:"visibility",get:function(){var t=$.root.batcher2D.getFirstRenderCamera(this.node);return t?t.visibility:0}},{key:"cameraPriority",get:function(){var t=$.root.batcher2D.getFirstRenderCamera(this.node);return t?t.priority:0}}]),e}(L),Vt.EventType=F,Vt.priorityChangeNodeMap=new Map,Lt=x((Ft=Vt).prototype,"_contentSize",[k],(function(){return new B(100,100)})),Nt=x(Ft.prototype,"_anchorPoint",[k],(function(){return new g(.5,.5)})),Pt=Ft))||Pt)||Pt)||Pt);$.on(tt.AFTER_UPDATE,ce._sortSiblings),$.on(tt.BEFORE_SCENE_LAUNCH,ce._cleanChangeMap),c(Z),c(J),c(Q),t("I",Qt),function(t){t[t.ADD_COLOR=0]="ADD_COLOR",t[t.ADD_COLOR_AND_TEXTURE=1]="ADD_COLOR_AND_TEXTURE",t[t.GRAYSCALE=2]="GRAYSCALE",t[t.USE_ALPHA_SEPARATED=3]="USE_ALPHA_SEPARATED",t[t.USE_ALPHA_SEPARATED_AND_GRAY=4]="USE_ALPHA_SEPARATED_AND_GRAY"}(Qt||t("I",Qt={}));var le=t("U",(Ht=E("cc.UIRenderer"),zt=w(ce),Ut=I(P),Gt=I(P),Ht(Wt=zt((Jt=function(t){function e(){var e;return(e=t.call(this)||this)._renderData=null,e._materials=Xt&&Xt(),e._customMaterial=Yt&&Yt(),e._srcBlendFactor=Kt&&Kt(),e._dstBlendFactor=qt&&qt(),e._color=Zt&&Zt(),e._stencilStage=mt.DISABLED,e._assembler=null,e._postAssembler=null,e._renderFlag=!0,e._instanceMaterialType=-1,e._srcBlendFactorCache=Z.SRC_ALPHA,e._dstBlendFactorCache=Z.ONE_MINUS_SRC_ALPHA,e._dirtyVersion=-1,e._internalId=-1,e._flagChangedVersion=-1,e._priority=0,e._fillColorType=Bt.COLOR,e._lastParent=null,e._renderEntity=e.createRenderEntity(),e.priority=nt.getDefaultPriority(),e}a(e,t);var i=e.prototype;return i.setRenderData=function(t){this._renderData=t},i.getFillColorType=function(){return this._fillColorType},i.setFillColorType=function(t){this._fillColorType=t},i.onLoad=function(){this._renderEntity.setNode(this.node)},i.__preload=function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()},i.onEnable=function(){this.node.on(F.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(F.SIZE_CHANGED,this._nodeStateChange,this),this.node.on(F.PARENT_CHANGED,this._colorDirty,this),!this._renderData&&this._flushAssembler&&this._flushAssembler(),this.updateMaterial(),this._colorDirty(),et.addRenderer(this),this._markForUpdateRenderData()},i.onRestore=function(){this.updateMaterial(),this._markForUpdateRenderData()},i._destroyData=function(){if(this.destroyRenderData(),this._materials)for(var t=0;t<this._materials.length;t++)this.setSharedMaterial(null,t,!0)},i.onDisable=function(){this.node.off(F.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(F.SIZE_CHANGED,this._nodeStateChange,this),this.node.off(F.PARENT_CHANGED,this._colorDirty,this),et.removeRenderer(this),this._renderFlag=!1,this._renderEntity.enabled=!1},i.onDestroy=function(){this._renderEntity.setNode(null),this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this._destroyData()},i.markForUpdateRenderData=function(t){void 0===t&&(t=!0),this._markForUpdateRenderData(t)},i._markForUpdateRenderData=function(t){if(void 0===t&&(t=!0),t){var e=this._renderData;e&&(e.vertDirty=!0),et.markDirtyRenderer(this)}},i.requestRenderData=function(t){void 0===t&&(t=Et.COMP);var e=ie.add();return e.initRenderDrawInfo(this,t),this._renderData=e,e},i.destroyRenderData=function(){this.renderEntity.clearRenderDrawInfos(),this._renderData&&(ie.remove(this._renderData),this._renderData=null)},i.updateRenderer=function(){var t=this._assembler;t&&t.updateRenderData&&t.updateRenderData(this),this._renderFlag=this._canRender(),this._renderEntity.enabled=this._renderFlag},i.fillBuffers=function(t){this._renderFlag&&this._render(t)},i.postUpdateAssembler=function(t){this._postAssembler&&this._renderFlag&&this._postRender(t)},i._render=function(){},i._postRender=function(){},i._canRender=function(){return l(this.isValid,"this component should not be invalid!"),null!==this.getSharedMaterial(0)&&this._enabled&&this._color.a>0},i._postCanRender=function(){},i.updateMaterial=function(){if(this._customMaterial)this.getSharedMaterial(0)!==this._customMaterial&&this.setSharedMaterial(this._customMaterial,0);else{var t=this._updateBuiltinMaterial();this.setSharedMaterial(t,0),this.stencilStage!==mt.ENTER_LEVEL&&this.stencilStage!==mt.ENTER_LEVEL_INVERTED||this.getMaterialInstance(0).recompileShaders({USE_ALPHA_TEST:!0}),this._updateBlendFunc()}},i._updateColor=function(){this.node._uiProps.colorDirty=!0,this.setEntityColorDirty(!0),this.setEntityColor(this._color);var t=this._assembler;if(t){t.updateColor&&t.updateColor(this);var e=this._renderFlag;if(this._renderFlag=this._canRender(),this.setEntityEnabled(this._renderFlag),e!==this._renderFlag){var i=this.renderData;i&&(i.vertDirty=!0)}}},i.setEntityColorDirty=function(){},i.setEntityColor=function(){},i.setEntityOpacity=function(){},i.setEntityEnabled=function(){},i._updateBlendFunc=function(){var t=this.getRenderMaterial(0).passes[0].blendState.targets[0];if(this._dstBlendFactorCache=t.blendDst,this._srcBlendFactorCache=t.blendSrc,this._dstBlendFactorCache!==this._dstBlendFactor||this._srcBlendFactorCache!==this._srcBlendFactor){(t=this.getMaterialInstance(0).passes[0].blendState.targets[0]).blend=!0,t.blendDstAlpha=Z.ONE_MINUS_SRC_ALPHA,t.blendDst=this._dstBlendFactor,t.blendSrc=this._srcBlendFactor;var e=this.getMaterialInstance(0).passes[0];e.blendState.setTarget(0,t),e._updatePassHash(),this._dstBlendFactorCache=this._dstBlendFactor,this._srcBlendFactorCache=this._srcBlendFactor}},i._nodeStateChange=function(){this._renderData&&this._markForUpdateRenderData();for(var t=0;t<this.node.children.length;++t){var i=this.node.children[t].getComponent(e);i&&i._markForUpdateRenderData()}},i._colorDirty=function(){this.node._uiProps.colorDirty=!0,this.setEntityColorDirty(!0)},i._onMaterialModified=function(e,i){this._renderData&&(this._markForUpdateRenderData(),this._renderData.passDirty=!0),t.prototype._onMaterialModified.call(this,e,i)},i._updateBuiltinMaterial=function(){var t;switch(this._instanceMaterialType){case Qt.ADD_COLOR:t=O.get("ui-base-material");break;case Qt.GRAYSCALE:t=O.get("ui-sprite-gray-material");break;case Qt.USE_ALPHA_SEPARATED:t=O.get("ui-sprite-alpha-sep-material");break;case Qt.USE_ALPHA_SEPARATED_AND_GRAY:t=O.get("ui-sprite-gray-alpha-sep-material");break;default:t=O.get("ui-sprite-material")}return t},i.setNodeDirty=function(){this._renderData&&(this._renderData.nodeDirty=!0)},i.setTextureDirty=function(){this._renderData&&(this._renderData.textureDirty=!0)},i.createRenderEntity=function(){return new $t(kt.STATIC)},r(e,[{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setSharedMaterial(t[e],e);if(t.length<this._materials.length){for(var i=t.length;i<this._materials.length;i++)this.setSharedMaterial(null,i);this._materials.splice(t.length)}}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this.updateMaterial()}},{key:"color",get:function(){return this._color},set:function(t){this._color.equals(t)||(this._color.set(t),this._updateColor())}},{key:"renderData",get:function(){return this._renderData}},{key:"stencilStage",get:function(){return this._stencilStage},set:function(t){this._stencilStage=t,this._renderEntity.setStencilStage(t)}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor=t}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"batcher",get:function(){return $.root.batcher2D}},{key:"renderEntity",get:function(){return l(Boolean(this._renderEntity),"this._renderEntity should not be invalid"),this._renderEntity}},{key:"_useVertexOpacity",get:function(){return this._fillColorType===Bt.VERTEX},set:function(){this.setFillColorType(Bt.VERTEX)}},{key:"useVertexOpacity",get:function(){return this._fillColorType===Bt.VERTEX}}]),e}(it),Jt.BlendState=Z,Jt.Assembler=null,Jt.PostAssembler=null,_((jt=Jt).prototype,"sharedMaterials",[M],Object.getOwnPropertyDescriptor(jt.prototype,"sharedMaterials"),jt.prototype),_(jt.prototype,"customMaterial",[Ut],Object.getOwnPropertyDescriptor(jt.prototype,"customMaterial"),jt.prototype),Xt=x(jt.prototype,"_materials",[M],(function(){return[]})),Yt=x(jt.prototype,"_customMaterial",[Gt],(function(){return null})),Kt=x(jt.prototype,"_srcBlendFactor",[k],(function(){return Z.SRC_ALPHA})),qt=x(jt.prototype,"_dstBlendFactor",[k],(function(){return Z.ONE_MINUS_SRC_ALPHA})),Zt=x(jt.prototype,"_color",[k],(function(){return y.WHITE.clone()})),Wt=jt))||Wt)||Wt));T.internal.UIRenderer=le}}}));
//# sourceMappingURL=ui-renderer-BG8n0rhU.js.map
