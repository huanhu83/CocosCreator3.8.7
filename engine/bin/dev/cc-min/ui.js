System.register(["./gc-object-BD6DANSw.js","./index-BcjqSS2q.js","./_virtual_internal_constants-CVZmBipG.js","./global-exports-ZavlJGEN.js","./sprite-frame-CT0e6iHI.js","./sprite-8ksyG6DL.js","./label-PJV2Zpvv.js","./prefab-CJahvMeV.js","./scene-D5fG1En6.js","./pipeline-state-manager-C4BAah3w.js","./node-event-BDYemSfE.js","./sprite-renderer-CC0tdWTR.js","./ui-renderer-BG8n0rhU.js","./xr.js","./director-D6Xf3-Ej.js","./deprecated-gv6rCJsk.js","./touch-Ch03mDFP.js","./camera-component-DK1ym1MK.js","./debug-view-zRQBd5E1.js","./device-manager-BCOP-4pU.js","./buffer-barrier-CZBuOw0V.js","./create-mesh-CgNcAxLl.js","./mesh-BsaPYlYJ.js","./wasm-web-DpHjq6qw.js","./zlib.min-CyXMsivM.js","./deprecated-BaebfHhU.js","./deprecated-B2PZGYTz.js","./model-renderer-KnEZ5pPV.js","./renderer-DVTO-7-w.js","./sorting-layers-sC9IxUEk.js"],(function(t){"use strict";var e,i,n,o,r,s,a,h,c,l,_,u,d,p,g,f,y,T,v,m,C,S,E,O,L,A,I,b,D,R,x,N,w,B,H,P,M,z,k,V,U,F,G,W,j,Z,X,Y,K,q,J,Q,$,tt,et,it,nt,ot,rt,st,at,ht,ct,lt,_t,ut,dt,pt,gt,ft,yt,Tt,vt,mt,Ct,St,Et,Ot,Lt,At,It;return{setters:[function(t){e=t.r,i=t._,n=t.F,o=t.a,r=t.b,s=t.E,a=t.W,h=t.a3,c=t.O,l=t.w,_=t.T,u=t.h,d=t.az,p=t.j,g=t.d,f=t.k},function(t){y=t.C,T=t.c,v=t.t,m=t.a8,C=t.f,S=t.a,E=t.j,O=t.K,L=t.u,A=t.s,I=t.M,b=t.J,D=t.n,R=t.O,x=t.A,N=t.V,w=t.P,B=t.v,H=t.a7,P=t.b6,M=t.I,z=t.N,k=t.W,V=t.i,U=t.q},function(t){F=t.M,G=t.J,W=t.R,j=t.a},function(t){Z=t.l,X=t.a,Y=t.c},function(t){K=t.S},function(t){q=t.S,J=t.a},function(t){Q=t.B,$=t.L,tt=t.V},function(t){et=t.i},function(t){it=t.T,nt=t.N,ot=t.l,rt=t.I,st=t.i},null,function(t){at=t.N,ht=t.E,ct=t.C},null,function(t){lt=t.U,_t=t.c},function(t){ut=t.XrUIPressEventType,dt=t.XrKeyboardEventType,pt=t.DeviceType},function(t){gt=t.d,ft=t.D},function(e){yt=e.V,Tt=e.g,vt=e.v,t({ResolutionPolicy:e.R,View:e.V,view:e.v})},function(t){mt=t.K,Ct=t.I,St=t.d,Et=t.S,Ot=t.E,Lt=t.e,At=t.f},function(t){It=t.C},null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var bt,Dt,Rt,xt,Nt,wt,Bt,Ht,Pt,Mt,zt,kt,Vt,Ut,Ft,Gt,Wt,jt,Zt,Xt,Yt,Kt,qt,Jt,Qt,$t,te,ee,ie,ne,oe={},re=new y;!function(t){t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR",t[t.SPRITE=2]="SPRITE",t[t.SCALE=3]="SCALE"}(ee||(ee={})),e(ee),function(t){t[t.NORMAL=0]="NORMAL",t[t.HOVER=1]="HOVER",t[t.PRESSED=2]="PRESSED",t[t.DISABLED=3]="DISABLED"}(ie||(ie={})),function(t){t.CLICK="click"}(ne||(ne={}));var se=(bt=T("cc.Button"),Dt=E(110),Rt=O(_t),xt=v(nt),Nt=v(ee),wt=v(K),Bt=v(K),Ht=v(K),Pt=v(K),Mt=v([ht]),bt(zt=Dt(zt=Rt((te=function(t){function e(){var e;return(e=t.call(this)||this).clickEvents=Vt&&Vt(),e._interactable=Ut&&Ut(),e._transition=Ft&&Ft(),e._normalColor=Gt&&Gt(),e._hoverColor=Wt&&Wt(),e._pressedColor=jt&&jt(),e._disabledColor=Zt&&Zt(),e._normalSprite=Xt&&Xt(),e._hoverSprite=Yt&&Yt(),e._pressedSprite=Kt&&Kt(),e._disabledSprite=qt&&qt(),e._duration=Jt&&Jt(),e._zoomScale=Qt&&Qt(),e._target=$t&&$t(),e._pressed=!1,e._hovered=!1,e._fromColor=new y,e._toColor=new y,e._time=0,e._transitionFinished=!0,e._fromScale=L(),e._toScale=L(),e._originalScale=null,e._sprite=null,e._targetScale=L(),e}i(e,t);var r=e.prototype;return r.__preload=function(){this.target||(this.target=this.node),this._applyTarget(),this._resetState()},r.onEnable=function(){this._registerNodeEvent()},r.onDisable=function(){this._resetState(),this._unregisterNodeEvent()},r.onDestroy=function(){this.target.isValid&&this._unregisterTargetEvent(this.target)},r.update=function(t){var e=this.target;if(!this._transitionFinished&&e&&(this._transition===ee.COLOR||this._transition===ee.SCALE)){this._time+=t;var i=1;if(this._duration>0&&(i=this._time/this._duration),i>=1&&(i=1),this._transition===ee.COLOR){var n=e._uiProps.uiComp;y.lerp(re,this._fromColor,this._toColor,i),n&&(n.color=re)}else this.transition===ee.SCALE&&(e.getScale(this._targetScale),this._targetScale.x=m(this._fromScale.x,this._toScale.x,i),this._targetScale.y=m(this._fromScale.y,this._toScale.y,i),e.setScale(this._targetScale));1===i&&(this._transitionFinished=!0)}},r._resizeNodeToTargetNode=function(){this.target&&this.target._getUITransformComp()},r._resetState=function(){this._pressed=!1,this._hovered=!1;var t=this.target;if(t){var e=this._transition;if(e===ee.COLOR&&this._interactable){var i=t.getComponent(lt);i&&(i.color=this._normalColor)}else e===ee.SCALE&&this._originalScale&&t.setScale(this._originalScale);this._transitionFinished=!0}},r._registerNodeEvent=function(){var t=this,e=t.node;e.on(at.TOUCH_START,t._onTouchBegan,t),e.on(at.TOUCH_MOVE,t._onTouchMove,t),e.on(at.TOUCH_END,t._onTouchEnded,t),e.on(at.TOUCH_CANCEL,t._onTouchCancel,t),e.on(at.MOUSE_ENTER,t._onMouseMoveIn,t),e.on(at.MOUSE_LEAVE,t._onMouseMoveOut,t),e.on(ut.XRUI_HOVER_ENTERED,t._xrHoverEnter,t),e.on(ut.XRUI_HOVER_EXITED,t._xrHoverExit,t),e.on(ut.XRUI_CLICK,t._xrClick,t),e.on(ut.XRUI_UNCLICK,t._xrUnClick,t)},r._registerTargetEvent=function(t){t.on(at.TRANSFORM_CHANGED,this._onTargetTransformChanged,this)},r._unregisterNodeEvent=function(){var t=this,e=t.node;e.off(at.TOUCH_START,t._onTouchBegan,t),e.off(at.TOUCH_MOVE,t._onTouchMove,t),e.off(at.TOUCH_END,t._onTouchEnded,t),e.off(at.TOUCH_CANCEL,t._onTouchCancel,t),e.off(at.MOUSE_ENTER,t._onMouseMoveIn,t),e.off(at.MOUSE_LEAVE,t._onMouseMoveOut,t),e.off(ut.XRUI_HOVER_ENTERED,t._xrHoverEnter,t),e.off(ut.XRUI_HOVER_EXITED,t._xrHoverExit,t),e.off(ut.XRUI_CLICK,t._xrClick,t),e.off(ut.XRUI_UNCLICK,t._xrUnClick,t)},r._unregisterTargetEvent=function(t){t.off(at.TRANSFORM_CHANGED)},r._getTargetSprite=function(t){var e=null;return t&&(e=t.getComponent(q)),e},r._applyTarget=function(){this.target&&(this._sprite=this._getTargetSprite(this.target),this._originalScale||(this._originalScale=new C),C.copy(this._originalScale,this.target.scale),this._registerTargetEvent(this.target))},r._onTargetSpriteFrameChanged=function(t){this._transition===ee.SPRITE&&this._setCurrentStateSpriteFrame(t.spriteFrame)},r._setCurrentStateSpriteFrame=function(t){if(t)switch(this._getButtonState()){case ie.NORMAL:this._normalSprite=t;break;case ie.HOVER:this._hoverSprite=t;break;case ie.PRESSED:this._pressedSprite=t;break;case ie.DISABLED:this._disabledSprite=t}},r._onTargetColorChanged=function(t){this._transition===ee.COLOR&&this._setCurrentStateColor(t)},r._setCurrentStateColor=function(t){switch(this._getButtonState()){case ie.NORMAL:this._normalColor=t;break;case ie.HOVER:this._hoverColor=t;break;case ie.PRESSED:this._pressedColor=t;break;case ie.DISABLED:this._disabledColor=t}},r._onTargetTransformChanged=function(t){t&it.SCALE&&this._originalScale&&this._transition===ee.SCALE&&this._transitionFinished&&C.copy(this._originalScale,this.target.scale)},r._onTouchBegan=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t&&(t.propagationStopped=!0))},r._onTouchMove=function(t){if(this._interactable&&this.enabledInHierarchy&&this._pressed&&t){var e=t.touch;if(e){var i,n=this.node._getUITransformComp().hitTest(e.getLocation(),t.windowId);this._transition===ee.SCALE&&this.target&&this._originalScale?n?(C.copy(this._fromScale,this._originalScale),C.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._transitionFinished=!1):(this._time=0,this._transitionFinished=!0,this.target.setScale(this._originalScale)):(i=n?ie.PRESSED:ie.NORMAL,this._applyTransition(i)),t&&(t.propagationStopped=!0)}}},r._onTouchEnded=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed&&(ht.emitEvents(this.clickEvents,t),this.node.emit(ne.CLICK,this)),this._pressed=!1,this._updateState(),t&&(t.propagationStopped=!0))},r._onTouchCancel=function(){this._interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},r._onMouseMoveIn=function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this._transition!==ee.SPRITE||this._hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},r._onMouseMoveOut=function(){this._hovered&&(this._hovered=!1,this._updateState())},r._updateState=function(){var t=this._getButtonState();this._applyTransition(t)},r._getButtonState=function(){var t=ie.NORMAL;return this._interactable?this._pressed?t=ie.PRESSED:this._hovered&&(t=ie.HOVER):t=ie.DISABLED,t},r._updateColorTransition=function(t){var e,i=this._getColorByState(t),n=null==(e=this.target)?void 0:e.getComponent(lt);n&&(t===ie.DISABLED?(n.color=i,this._transitionFinished=!0):(this._fromColor=n.color.clone(),this._toColor=i,this._time=0,this._transitionFinished=!1))},r._updateSpriteTransition=function(t){var e=this._getSpriteFrameByState(t);this._sprite&&e&&(this._sprite.spriteFrame=e)},r._updateScaleTransition=function(t){this._interactable&&(t===ie.PRESSED?this._zoomUp():this._zoomBack())},r._zoomUp=function(){this._originalScale&&(C.copy(this._fromScale,this._originalScale),C.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._time=0,this._transitionFinished=!1)},r._zoomBack=function(){this.target&&this._originalScale&&(C.copy(this._fromScale,this.target.scale),C.copy(this._toScale,this._originalScale),this._time=0,this._transitionFinished=!1)},r._applyTransition=function(t){var e=this._transition;e===ee.COLOR?this._updateColorTransition(t):e===ee.SPRITE?this._updateSpriteTransition(t):e===ee.SCALE&&this._updateScaleTransition(t)},r._getSpriteFrameByState=function(t){switch(t){case ie.NORMAL:return this._normalSprite;case ie.DISABLED:return this._disabledSprite;case ie.HOVER:return this.hoverSprite;case ie.PRESSED:return this._pressedSprite;default:return n("Button._getColorByState(): wrong state."),null}},r._getColorByState=function(t){switch(t){case ie.NORMAL:return this._normalColor;case ie.DISABLED:return this._disabledColor;case ie.HOVER:return this._hoverColor;case ie.PRESSED:return this._pressedColor;default:return n("Button._getColorByState(): wrong state."),new y}},r._xrHoverEnter=function(){this._onMouseMoveIn(),this._updateState()},r._xrHoverExit=function(){this._onMouseMoveOut(),this._pressed&&(this._pressed=!1,this._updateState())},r._xrClick=function(){this._interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState())},r._xrUnClick=function(){this._interactable&&this.enabledInHierarchy&&(this._pressed&&(ht.emitEvents(this.clickEvents,this),this.node.emit(ne.CLICK,this)),this._pressed=!1,this._updateState())},o(e,[{key:"target",get:function(){return this._target||this.node},set:function(t){this._target!==t&&(this._target&&this._unregisterTargetEvent(this._target),this._target=t,this._applyTarget())}},{key:"interactable",get:function(){return this._interactable},set:function(t){this._interactable!==t&&(this._interactable=t,this._updateState(),this._interactable||this._resetState())}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"transition",get:function(){return this._transition},set:function(t){this._transition!==t&&(this._transition===ee.COLOR?this._updateColorTransition(ie.NORMAL):this._transition===ee.SPRITE&&this._updateSpriteTransition(ie.NORMAL),this._transition=t,this._updateState())}},{key:"normalColor",get:function(){return this._normalColor},set:function(t){this._normalColor!==t&&(this._normalColor.set(t),this._updateState())}},{key:"pressedColor",get:function(){return this._pressedColor},set:function(t){this._pressedColor!==t&&this._pressedColor.set(t)}},{key:"hoverColor",get:function(){return this._hoverColor},set:function(t){this._hoverColor!==t&&this._hoverColor.set(t)}},{key:"disabledColor",get:function(){return this._disabledColor},set:function(t){this._disabledColor!==t&&(this._disabledColor.set(t),this._updateState())}},{key:"duration",get:function(){return this._duration},set:function(t){this._duration!==t&&(this._duration=t)}},{key:"zoomScale",get:function(){return this._zoomScale},set:function(t){this._zoomScale!==t&&(this._zoomScale=t)}},{key:"normalSprite",get:function(){return this._normalSprite},set:function(t){if(this._normalSprite!==t){this._normalSprite=t;var e=this.node.getComponent(q);e&&(e.spriteFrame=t),this._updateState()}}},{key:"pressedSprite",get:function(){return this._pressedSprite},set:function(t){this._pressedSprite!==t&&(this._pressedSprite=t,this._updateState())}},{key:"hoverSprite",get:function(){return this._hoverSprite},set:function(t){this._hoverSprite!==t&&(this._hoverSprite=t,this._updateState())}},{key:"disabledSprite",get:function(){return this._disabledSprite},set:function(t){this._disabledSprite!==t&&(this._disabledSprite=t,this._updateState())}}]),e}(ct),te.Transition=ee,te.EventType=ne,r((kt=te).prototype,"target",[xt],Object.getOwnPropertyDescriptor(kt.prototype,"target"),kt.prototype),r(kt.prototype,"transition",[Nt],Object.getOwnPropertyDescriptor(kt.prototype,"transition"),kt.prototype),r(kt.prototype,"normalSprite",[wt],Object.getOwnPropertyDescriptor(kt.prototype,"normalSprite"),kt.prototype),r(kt.prototype,"pressedSprite",[Bt],Object.getOwnPropertyDescriptor(kt.prototype,"pressedSprite"),kt.prototype),r(kt.prototype,"hoverSprite",[Ht],Object.getOwnPropertyDescriptor(kt.prototype,"hoverSprite"),kt.prototype),r(kt.prototype,"disabledSprite",[Pt],Object.getOwnPropertyDescriptor(kt.prototype,"disabledSprite"),kt.prototype),Vt=S(kt.prototype,"clickEvents",[Mt,A],(function(){return[]})),Ut=S(kt.prototype,"_interactable",[A],(function(){return!0})),Ft=S(kt.prototype,"_transition",[A],(function(){return ee.NONE})),Gt=S(kt.prototype,"_normalColor",[A],(function(){return y.WHITE.clone()})),Wt=S(kt.prototype,"_hoverColor",[A],(function(){return new y(211,211,211,255)})),jt=S(kt.prototype,"_pressedColor",[A],(function(){return y.WHITE.clone()})),Zt=S(kt.prototype,"_disabledColor",[A],(function(){return new y(124,124,124,255)})),Xt=S(kt.prototype,"_normalSprite",[A],(function(){return null})),Yt=S(kt.prototype,"_hoverSprite",[A],(function(){return null})),Kt=S(kt.prototype,"_pressedSprite",[A],(function(){return null})),qt=S(kt.prototype,"_disabledSprite",[A],(function(){return null})),Jt=S(kt.prototype,"_duration",[A],(function(){return.1})),Qt=S(kt.prototype,"_zoomScale",[A],(function(){return 1.2})),$t=S(kt.prototype,"_target",[A],(function(){return null})),zt=kt))||zt)||zt)||zt);t({Button:se,ButtonComponent:se}),Z.Button=se;var ae,he,ce,le=function(){function t(){}return t.add=function(t){var e=this._tabIndexList;-1===e.indexOf(t)&&e.push(t)},t.remove=function(t){var e=this._tabIndexList,i=e.indexOf(t);-1!==i&&e.splice(i,1)},t.resort=function(){this._tabIndexList.sort((function(t,e){return t._delegate.tabIndex-e._delegate.tabIndex}))},t.next=function(t){var e=this._tabIndexList,i=e.indexOf(t);if(t.setFocus(!1),-1!==i){var n=e[i+1];n&&n._delegate.tabIndex>=0&&n.setFocus(!0)}},t}();le._tabIndexList=[],function(t){t[t.DEFAULT=0]="DEFAULT",t[t.DONE=1]="DONE",t[t.SEND=2]="SEND",t[t.SEARCH=3]="SEARCH",t[t.GO=4]="GO",t[t.NEXT=5]="NEXT"}(ae||(ae={})),s(ae),function(t){t[t.ANY=0]="ANY",t[t.EMAIL_ADDR=1]="EMAIL_ADDR",t[t.NUMERIC=2]="NUMERIC",t[t.PHONE_NUMBER=3]="PHONE_NUMBER",t[t.URL=4]="URL",t[t.DECIMAL=5]="DECIMAL",t[t.SINGLE_LINE=6]="SINGLE_LINE"}(he||(he={})),s(he),function(t){t[t.PASSWORD=0]="PASSWORD",t[t.SENSITIVE=1]="SENSITIVE",t[t.INITIAL_CAPS_WORD=2]="INITIAL_CAPS_WORD",t[t.INITIAL_CAPS_SENTENCE=3]="INITIAL_CAPS_SENTENCE",t[t.INITIAL_CAPS_ALL_CHARACTERS=4]="INITIAL_CAPS_ALL_CHARACTERS",t[t.DEFAULT=5]="DEFAULT"}(ce||(ce={})),s(ce);var _e,ue,de,pe,ge,fe,ye,Te,ve,me,Ce,Se,Ee,Oe,Le,Ae,Ie,be,De,Re,xe,Ne,we,Be,He,Pe,Me,ze,ke,Ve,Ue=function(){function t(){this._editing=!1,this._delegate=null}var e=t.prototype;return e.init=function(){},e.onEnable=function(){},e.beforeDraw=function(){},e.onDisable=function(){this._editing&&this.endEditing()},e.clear=function(){this._delegate=null},e.setTabIndex=function(){},e.setSize=function(){},e.setFocus=function(t){t?this.beginEditing():this.endEditing()},e.isFocused=function(){return this._editing},e.beginEditing=function(){},e.endEditing=function(){},t}(),Fe=X.document,Ge=new I,We=new I,je=new C,Ze=null,Xe=0,Ye=function(t){function e(){var e;return(e=t.call(this)||this)._delegate=null,e._inputMode=-1,e._inputFlag=-1,e._returnType=-1,e.__eventListeners={},e.__autoResize=!1,e.__orientationChanged=void 0,e._edTxt=null,e._isTextArea=!1,e._textLabelFont=null,e._textLabelFontSize=null,e._textLabelFontColor=null,e._textLabelAlign=null,e._placeholderLabelFont=null,e._placeholderLabelFontSize=null,e._placeholderLabelFontColor=null,e._placeholderLabelAlign=null,e._placeholderLineHeight=null,e._placeholderStyleSheet=null,e._domId="EditBoxId_"+ ++Xe,e._forceUpdate=!1,e}i(e,t);var n=e.prototype;return n.init=function(t){t&&(this._delegate=t,t.inputMode===he.ANY?this._createTextArea():this._createInput(),le.add(this),this.setTabIndex(t.tabIndex),this._initStyleSheet(),this._registerEventListeners(),this._addDomToGameContainer(),yt.instance.on("canvas-resize",this._resize,this),b.on("window-resize",this._resize,this))},n.clear=function(){yt.instance.off("canvas-resize",this._resize,this),b.off("window-resize",this._resize,this),this._removeEventListeners(),this._removeDomFromGameContainer(),le.remove(this),Ze===this&&(Ze=null),this._delegate=null},n._resize=function(){this._forceUpdate=!0},n.beforeDraw=function(){(this._delegate.node.hasChangedFlags||this._forceUpdate)&&(this._forceUpdate=!1,this._updateMatrix())},n.setTabIndex=function(t){this._edTxt.tabIndex=t,le.resort()},n.setSize=function(t,e){var i=this._edTxt;i&&(i.style.width=t+"px",i.style.height=e+"px")},n.beginEditing=function(){Ze&&Ze!==this&&Ze.setFocus(!1),this._editing=!0,Ze=this,this._delegate._editBoxEditingDidBegan(),this._showDom(),this._edTxt.focus()},n.endEditing=function(){this._edTxt.blur()},n._createInput=function(){this._isTextArea=!1,this._edTxt=Fe.createElement("input")},n._createTextArea=function(){this._isTextArea=!0,this._edTxt=Fe.createElement("textarea")},n._addDomToGameContainer=function(){Tt.container&&this._edTxt&&(Tt.container.appendChild(this._edTxt),Fe.head.appendChild(this._placeholderStyleSheet))},n._removeDomFromGameContainer=function(){a(Tt.container,this._edTxt)&&this._edTxt&&Tt.container.removeChild(this._edTxt),a(Fe.head,this._placeholderStyleSheet)&&Fe.head.removeChild(this._placeholderStyleSheet),this._edTxt=null,this._placeholderStyleSheet=null},n._showDom=function(){this._updateMaxLength(),this._updateInputType(),this._updateStyleSheet(),this._edTxt&&this._delegate&&(this._edTxt.style.display="",this._delegate._hideLabels()),D.isMobile&&this._showDomOnMobile()},n._hideDom=function(){var t=this._edTxt;t&&this._delegate&&(t.style.display="none",this._delegate._showLabels()),D.isMobile&&this._hideDomOnMobile()},n._showDomOnMobile=function(){D.os!==h.ANDROID&&D.os!==h.OHOS||(b.handleResizeEvent=!1,this._adjustWindowScroll())},n._hideDomOnMobile=function(){D.os!==h.ANDROID&&D.os!==h.OHOS||(b.handleResizeEvent=!0),this._scrollBackWindow()},n._isElementInViewport=function(){if(this._edTxt){var t=this._edTxt.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(X.innerHeight||Fe.documentElement.clientHeight)&&t.right<=(X.innerWidth||Fe.documentElement.clientWidth)}return!1},n._adjustWindowScroll=function(){var t=this;setTimeout((function(){X.scrollY<40&&!t._isElementInViewport()&&t._edTxt.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}),400)},n._scrollBackWindow=function(){setTimeout((function(){D.browserType!==c.WECHAT||D.os!==h.IOS?X.scrollTo(0,0):X.top&&X.top.scrollTo(0,0)}),400)},n._updateMatrix=function(){if(this._edTxt){var t=this._delegate.node,e=vt.getScaleX(),i=vt.getScaleY(),n=vt.getViewportRect(),o=b.devicePixelRatio;t.getWorldMatrix(Ge);var r=t._getUITransformComp();if(r&&(C.set(je,-r.anchorX*r.width,-r.anchorY*r.height,je.z),I.transform(Ge,Ge,je)),t._getUITransformComp()){var s=gt.root.batcher2D.getFirstRenderCamera(t);if(s){s.node.getWorldRT(We);var a=We.m12,h=We.m13,c=R.center;We.m12=c.x-(We.m00*a+We.m04*h),We.m13=c.y-(We.m01*a+We.m05*h),e/=o,i/=o,C.set(je,e,i,1),I.scale(We,We,je);var l=Tt.container,_=parseInt(l&&l.style.paddingLeft||"0");_+=n.x/o;var u=parseInt(l&&l.style.paddingBottom||"0");u+=n.y/o,We.m12+=_,We.m13+=u,I.multiply(We,We,Ge);var d="matrix("+We.m00+","+-We.m01+","+-We.m04+","+We.m05+","+We.m12+","+-We.m13+")";this._edTxt.style.transform=d,this._edTxt.style["-webkit-transform"]=d,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}}}},n._updateInputType=function(){var t=this._delegate,e=t.inputMode,i=t.inputFlag,n=t.returnType,o=this._edTxt;if(this._inputMode!==e||this._inputFlag!==i||this._returnType!==n){if(this._inputMode=e,this._inputFlag=i,this._returnType=n,this._isTextArea){var r="none";return i===ce.INITIAL_CAPS_ALL_CHARACTERS?r="uppercase":i===ce.INITIAL_CAPS_WORD&&(r="capitalize"),void(o.style.textTransform=r)}if(i===ce.PASSWORD)return o.type="password",void(o.style.textTransform="none");var s=o.type;e===he.EMAIL_ADDR?s="email":e===he.NUMERIC?s="number":e===he.DECIMAL?s="digit":e===he.PHONE_NUMBER?(s="tel",o.addEventListener("wheel",(function(){return!1}))):e===he.URL?s="url":(s="text",n===ae.SEARCH&&(s="search")),o.type=s;var a="none";i===ce.INITIAL_CAPS_ALL_CHARACTERS?a="uppercase":i===ce.INITIAL_CAPS_WORD&&(a="capitalize"),o.style.textTransform=a}},n._updateMaxLength=function(){var t=this._delegate.maxLength;t<0&&(t=65535),this._edTxt.maxLength=t},n._initStyleSheet=function(){if(this._edTxt){var t=this._edTxt;t.style.color="#000000",t.style.border="0px",t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.outline="medium",t.style.padding="0",t.style.textTransform="none",t.style.display="none",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.className="cocosEditBox",t.style.fontFamily="Arial",t.id=this._domId,this._isTextArea?(t.style.resize="none",t.style.overflowY="scroll"):(t.type="text",t.style["-moz-appearance"]="textfield"),this._placeholderStyleSheet=Fe.createElement("style")}},n._updateStyleSheet=function(){var t=this._delegate,e=this._edTxt;e&&t&&(e.value=t.string,this._updateTextLabel(t.textLabel))},n._updateTextLabel=function(t){if(t){var e=t.font;e=!e||e instanceof Q?t.fontFamily:e._fontFamily;var i=t.fontSize*t.node.scale.y;if((this._textLabelFont!==e||this._textLabelFontSize!==i||this._textLabelFontColor!==t.fontColor||this._textLabelAlign!==t.horizontalAlign)&&(this._textLabelFont=e,this._textLabelFontSize=i,this._textLabelFontColor=t.fontColor,this._textLabelAlign=t.horizontalAlign,this._edTxt)){var n=this._edTxt;switch(n.style.fontSize=i+"px",n.style.color=t.color.toCSS(),n.style.fontFamily=e,t.horizontalAlign){case $.HorizontalAlign.LEFT:n.style.textAlign="left";break;case $.HorizontalAlign.CENTER:n.style.textAlign="center";break;case $.HorizontalAlign.RIGHT:n.style.textAlign="right"}}}},n._updatePlaceholderLabel=function(t){if(t){var e=t.font;e=!e||e instanceof Q?t.fontFamily:t.font._fontFamily;var i=t.fontSize*t.node.scale.y;if(this._placeholderLabelFont!==e||this._placeholderLabelFontSize!==i||this._placeholderLabelFontColor!==t.fontColor||this._placeholderLabelAlign!==t.horizontalAlign||this._placeholderLineHeight!==t.fontSize){this._placeholderLabelFont=e,this._placeholderLabelFontSize=i,this._placeholderLabelFontColor=t.fontColor,this._placeholderLabelAlign=t.horizontalAlign,this._placeholderLineHeight=t.fontSize;var n=this._placeholderStyleSheet,o=t.color.toCSS(),r=t.fontSize,s="";switch(t.horizontalAlign){case $.HorizontalAlign.LEFT:s="left";break;case $.HorizontalAlign.CENTER:s="center";break;case $.HorizontalAlign.RIGHT:s="right"}n.innerHTML="#"+this._domId+"::-webkit-input-placeholder{text-transform: initial;-family: "+e+";font-size: "+i+"px;color: "+o+";line-height: "+r+"px;text-align: "+s+";}#"+this._domId+"::-moz-placeholder{text-transform: initial;-family: "+e+";font-size: "+i+"px;color: "+o+";line-height: "+r+"px;text-align: "+s+";}#"+this._domId+"::-ms-input-placeholder{text-transform: initial;-family: "+e+";font-size: "+i+"px;color: "+o+";line-height: "+r+"px;text-align: "+s+";}",D.browserType===c.EDGE&&(n.innerHTML+="#"+this._domId+"::-ms-clear{display: none;}")}}},n._registerEventListeners=function(){var t=this;if(this._edTxt){var e=this._edTxt,i=!1,n=this.__eventListeners;n.compositionStart=function(){i=!0},n.compositionEnd=function(){i=!1,t._delegate._editBoxTextChanged(e.value)},n.onInput=function(){if(!i){var n=t._delegate,o=n.maxLength;o>=0&&"number"!==e.type&&(e.value=e.value.slice(0,o)),n._editBoxTextChanged(e.value)}},n.onClick=function(){t._editing&&D.isMobile&&t._adjustWindowScroll()},n.onKeydown=function(i){i.keyCode===mt.ENTER?(i.propagationStopped=!0,t._delegate._editBoxEditingReturn(),t._isTextArea||e.blur()):i.keyCode===mt.TAB&&(i.propagationStopped=!0,i.preventDefault(),le.next(t))},n.onBlur=function(){D.isMobile&&i&&n.compositionEnd(),t._editing=!1,Ze=null,t._hideDom(),t._delegate._editBoxEditingDidEnded()},e.addEventListener("compositionstart",n.compositionStart),e.addEventListener("compositionend",n.compositionEnd),e.addEventListener("input",n.onInput),e.addEventListener("keydown",n.onKeydown),e.addEventListener("blur",n.onBlur),e.addEventListener("touchstart",n.onClick)}},n._removeEventListeners=function(){if(this._edTxt){var t=this._edTxt,e=this.__eventListeners;t.removeEventListener("compositionstart",e.compositionStart),t.removeEventListener("compositionend",e.compositionEnd),t.removeEventListener("input",e.onInput),t.removeEventListener("keydown",e.onKeydown),t.removeEventListener("blur",e.onBlur),t.removeEventListener("touchstart",e.onClick),e.compositionStart=null,e.compositionEnd=null,e.onInput=null,e.onKeydown=null,e.onBlur=null,e.onClick=null}},e}(Ue);!function(t){t.EDITING_DID_BEGAN="editing-did-began",t.EDITING_DID_ENDED="editing-did-ended",t.TEXT_CHANGED="text-changed",t.EDITING_RETURN="editing-return",t.XR_EDITING_DID_BEGAN="xr-editing-did-began",t.XR_EDITING_DID_ENDED="xr-editing-did-ended"}(Ve||(Ve={}));var Ke,qe,Je,Qe,$e,ti,ei,ii,ni,oi,ri,si,ai,hi,ci,li,_i,ui,di,pi,gi,fi,yi,Ti,vi,mi,Ci,Si,Ei,Oi,Li,Ai,Ii,bi,Di=(_e=T("cc.EditBox"),ue=E(110),de=O(_t),pe=v($),ge=v($),fe=v(K),ye=v(ce),Te=v(he),ve=v(ae),me=v([ht]),Ce=v([ht]),Se=v([ht]),Ee=v([ht]),_e(Oe=ue(Oe=de((ke=function(t){function e(){var e;return(e=t.call(this)||this).editingDidBegan=Ae&&Ae(),e.textChanged=Ie&&Ie(),e.editingDidEnded=be&&be(),e.editingReturn=De&&De(),e._impl=null,e._background=null,e._textLabel=Re&&Re(),e._placeholderLabel=xe&&xe(),e._returnType=Ne&&Ne(),e._string=we&&we(),e._tabIndex=Be&&Be(),e._backgroundImage=He&&He(),e._inputFlag=Pe&&Pe(),e._inputMode=Me&&Me(),e._maxLength=ze&&ze(),e._isLabelVisible=!1,e}i(e,t);var n=e.prototype;return n.__preload=function(){this._init()},n.onEnable=function(){this._registerEvent(),this._ensureBackgroundSprite(),this._impl&&this._impl.onEnable()},n._beforeDraw=function(){this._impl&&this._impl.beforeDraw()},n.onDisable=function(){this._unregisterEvent(),this._unregisterBackgroundEvent(),this._impl&&this._impl.onDisable()},n.onDestroy=function(){gt.off(ft.BEFORE_DRAW,this._beforeDraw,this),this._impl&&this._impl.clear()},n.setFocus=function(){this._impl&&this._impl.setFocus(!0)},n.focus=function(){this._impl&&this._impl.setFocus(!0)},n.blur=function(){this._impl&&this._impl.setFocus(!1)},n.isFocused=function(){return!!this._impl&&this._impl.isFocused()},n._editBoxEditingDidBegan=function(){ht.emitEvents(this.editingDidBegan,this),this.node.emit(Ve.EDITING_DID_BEGAN,this)},n._editBoxEditingDidEnded=function(t){ht.emitEvents(this.editingDidEnded,this),this.node.emit(Ve.EDITING_DID_ENDED,this,t)},n._editBoxTextChanged=function(t){t=this._updateLabelStringStyle(t,!0),this.string=t,ht.emitEvents(this.textChanged,t,this),this.node.emit(Ve.TEXT_CHANGED,this)},n._editBoxEditingReturn=function(t){ht.emitEvents(this.editingReturn,this),this.node.emit(Ve.EDITING_RETURN,this,t)},n._showLabels=function(){this._isLabelVisible=!0,this._updateLabels()},n._hideLabels=function(){this._isLabelVisible=!1,this._textLabel&&(this._textLabel.node.active=!1),this._placeholderLabel&&(this._placeholderLabel.node.active=!1)},n._onTouchBegan=function(t){t.propagationStopped=!0},n._onTouchCancel=function(t){t.propagationStopped=!0},n._onTouchEnded=function(t){this._impl&&this._impl.beginEditing(),t.propagationStopped=!0},n._init=function(){this._updatePlaceholderLabel(),this._updateTextLabel(),this._isLabelVisible=!0,this.node.on(at.SIZE_CHANGED,this._resizeChildNodes,this),gt.on(ft.BEFORE_DRAW,this._beforeDraw,this),(this._impl=new e._EditBoxImpl).init(this),this._updateString(this._string),this._syncSize()},n._ensureBackgroundSprite=function(){if(!this._background){var t=this.node.getComponent(q);t||(t=this.node.addComponent(q)),t!==this._background&&(t.type=q.Type.SLICED,t.spriteFrame=this._backgroundImage,this._background=t,this._registerBackgroundEvent())}},n._updateTextLabel=function(){var t=this._textLabel;if(!t){var e=this.node.getChildByName("TEXT_LABEL");e||((e=new nt("TEXT_LABEL")).layer=this.node.layer),(t=e.getComponent($))||(t=e.addComponent($)),e.parent=this.node,this._textLabel=t}this._inputMode===he.ANY?(t.verticalAlign=tt.TOP,t.enableWrapText=!0):t.enableWrapText=!1,t.string=this._updateLabelStringStyle(this._string)},n._updatePlaceholderLabel=function(){var t=this._placeholderLabel;if(!t){var e=this.node.getChildByName("PLACEHOLDER_LABEL");e||((e=new nt("PLACEHOLDER_LABEL")).layer=this.node.layer),(t=e.getComponent($))||(t=e.addComponent($)),e.parent=this.node,this._placeholderLabel=t}this._inputMode===he.ANY?t.enableWrapText=!0:t.enableWrapText=!1,t.string=this.placeholder},n._syncSize=function(){var t=this.node._getUITransformComp(),e=t.contentSize;if(this._background){var i=this._background.node._getUITransformComp();i.anchorPoint=t.anchorPoint,i.setContentSize(e)}this._updateLabelPosition(e),this._impl&&this._impl.setSize(e.width,e.height)},n._updateLabels=function(){if(this._isLabelVisible){var t=this._string;this._textLabel&&(this._textLabel.node.active=""!==t),this._placeholderLabel&&(this._placeholderLabel.node.active=""===t)}},n._updateString=function(t){var e=this._textLabel;if(e){var i=t;i&&(i=this._updateLabelStringStyle(i)),e.string=i,this._updateLabels()}},n._updateLabelStringStyle=function(t,e){void 0===e&&(e=!1);var i,n=this._inputFlag;if(e||n!==ce.PASSWORD)n===ce.INITIAL_CAPS_ALL_CHARACTERS?t=t.toUpperCase():n===ce.INITIAL_CAPS_WORD?t=t.replace(/(?:^|\s)\S/g,(function(t){return t.toUpperCase()})):n===ce.INITIAL_CAPS_SENTENCE&&(t=(i=t).charAt(0).toUpperCase()+i.slice(1));else{for(var o="",r=t.length,s=0;s<r;++s)o+="â—";t=o}return t},n._registerEvent=function(){var t=this,e=t.node;e.on(at.TOUCH_START,t._onTouchBegan,t),e.on(at.TOUCH_END,t._onTouchEnded,t),e.on(ut.XRUI_UNCLICK,t._xrUnClick,t),e.on(dt.XR_KEYBOARD_INPUT,t._xrKeyBoardInput,t)},n._unregisterEvent=function(){var t=this,e=t.node;e.off(at.TOUCH_START,t._onTouchBegan,t),e.off(at.TOUCH_END,t._onTouchEnded,t),e.off(ut.XRUI_UNCLICK,t._xrUnClick,t),e.off(dt.XR_KEYBOARD_INPUT,t._xrKeyBoardInput,t)},n._onBackgroundSpriteFrameChanged=function(){this._background&&(this.backgroundImage=this._background.spriteFrame)},n._registerBackgroundEvent=function(){var t=this._background&&this._background.node;null==t||t.on(J.SPRITE_FRAME_CHANGED,this._onBackgroundSpriteFrameChanged,this)},n._unregisterBackgroundEvent=function(){var t=this._background&&this._background.node;null==t||t.off(J.SPRITE_FRAME_CHANGED,this._onBackgroundSpriteFrameChanged,this)},n._updateLabelPosition=function(t){var e=this.node._getUITransformComp(),i=-e.anchorX*e.width,n=-e.anchorY*e.height,o=this._placeholderLabel,r=this._textLabel;r&&(r.node._getUITransformComp().setContentSize(t.width-2,t.height),r.node.setPosition(i+2,n+t.height,r.node.position.z),this._inputMode===he.ANY&&(r.verticalAlign=tt.TOP),r.enableWrapText=this._inputMode===he.ANY),o&&(o.node._getUITransformComp().setContentSize(t.width-2,t.height),o.node.setPosition(i+2,n+t.height,o.node.position.z),o.enableWrapText=this._inputMode===he.ANY)},n._resizeChildNodes=function(){var t=this.node._getUITransformComp(),e=this._textLabel&&this._textLabel.node;e&&(e.setPosition(-t.width/2,t.height/2,e.position.z),e._getUITransformComp().setContentSize(t.contentSize));var i=this._placeholderLabel&&this._placeholderLabel.node;i&&(i.setPosition(-t.width/2,t.height/2,i.position.z),i._getUITransformComp().setContentSize(t.contentSize));var n=this._background&&this._background.node;n&&n._getUITransformComp().setContentSize(t.contentSize),this._syncSize()},n._xrUnClick=function(){this.node.emit(Ve.XR_EDITING_DID_BEGAN,this._maxLength,this.string)},n._xrKeyBoardInput=function(t){this.string=t},o(e,[{key:"string",get:function(){return this._string},set:function(t){this._maxLength>=0&&t.length>=this._maxLength&&(t=t.slice(0,this._maxLength)),this._string!==t&&(this._string=t,this._updateString(t))}},{key:"placeholder",get:function(){return this._placeholderLabel?this._placeholderLabel.string:""},set:function(t){this._placeholderLabel&&(this._placeholderLabel.string=t)}},{key:"textLabel",get:function(){return this._textLabel},set:function(t){this._textLabel!==t&&(this._textLabel=t,this._textLabel&&(this._updateTextLabel(),this._updateLabels()))}},{key:"placeholderLabel",get:function(){return this._placeholderLabel},set:function(t){this._placeholderLabel!==t&&(this._placeholderLabel=t,this._placeholderLabel&&(this._updatePlaceholderLabel(),this._updateLabels()))}},{key:"backgroundImage",get:function(){return this._backgroundImage},set:function(t){this._backgroundImage!==t&&(this._backgroundImage=t,this._ensureBackgroundSprite(),this._background.spriteFrame=t)}},{key:"inputFlag",get:function(){return this._inputFlag},set:function(t){this._inputFlag!==t&&(this._inputFlag=t,this._updateString(this._string))}},{key:"inputMode",get:function(){return this._inputMode},set:function(t){this._inputMode!==t&&(this._inputMode=t,this._updateTextLabel(),this._updatePlaceholderLabel())}},{key:"returnType",get:function(){return this._returnType},set:function(t){this._returnType=t}},{key:"maxLength",get:function(){return this._maxLength},set:function(t){this._maxLength=t}},{key:"tabIndex",get:function(){return this._tabIndex},set:function(t){this._tabIndex!==t&&(this._tabIndex=t,this._impl&&this._impl.setTabIndex(t))}}]),e}(ct),ke._EditBoxImpl=Ue,ke.KeyboardReturnType=ae,ke.InputFlag=ce,ke.InputMode=he,ke.EventType=Ve,r((Le=ke).prototype,"textLabel",[pe],Object.getOwnPropertyDescriptor(Le.prototype,"textLabel"),Le.prototype),r(Le.prototype,"placeholderLabel",[ge],Object.getOwnPropertyDescriptor(Le.prototype,"placeholderLabel"),Le.prototype),r(Le.prototype,"backgroundImage",[fe],Object.getOwnPropertyDescriptor(Le.prototype,"backgroundImage"),Le.prototype),r(Le.prototype,"inputFlag",[ye],Object.getOwnPropertyDescriptor(Le.prototype,"inputFlag"),Le.prototype),r(Le.prototype,"inputMode",[Te],Object.getOwnPropertyDescriptor(Le.prototype,"inputMode"),Le.prototype),r(Le.prototype,"returnType",[ve],Object.getOwnPropertyDescriptor(Le.prototype,"returnType"),Le.prototype),Ae=S(Le.prototype,"editingDidBegan",[me,A],(function(){return[]})),Ie=S(Le.prototype,"textChanged",[Ce,A],(function(){return[]})),be=S(Le.prototype,"editingDidEnded",[Se,A],(function(){return[]})),De=S(Le.prototype,"editingReturn",[Ee,A],(function(){return[]})),Re=S(Le.prototype,"_textLabel",[A],(function(){return null})),xe=S(Le.prototype,"_placeholderLabel",[A],(function(){return null})),Ne=S(Le.prototype,"_returnType",[A],(function(){return ae.DEFAULT})),we=S(Le.prototype,"_string",[A],(function(){return""})),Be=S(Le.prototype,"_tabIndex",[A],(function(){return 0})),He=S(Le.prototype,"_backgroundImage",[A],(function(){return null})),Pe=S(Le.prototype,"_inputFlag",[A],(function(){return ce.DEFAULT})),Me=S(Le.prototype,"_inputMode",[A],(function(){return he.ANY})),ze=S(Le.prototype,"_maxLength",[A],(function(){return 20})),Oe=Le))||Oe)||Oe)||Oe);t({EditBox:Di,EditBoxComponent:Di}),"object"!=typeof window||"object"!=typeof document||F||G||W||(Di._EditBoxImpl=Ye),Z.internal.EditBox=Di,function(t){t[t.NONE=0]="NONE",t[t.HORIZONTAL=1]="HORIZONTAL",t[t.VERTICAL=2]="VERTICAL",t[t.GRID=3]="GRID"}(Ei||(Ei={})),e(Ei),function(t){t[t.NONE=0]="NONE",t[t.CONTAINER=1]="CONTAINER",t[t.CHILDREN=2]="CHILDREN"}(Oi||(Oi={})),e(Oi),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(Li||(Li={})),e(Li),function(t){t[t.BOTTOM_TO_TOP=0]="BOTTOM_TO_TOP",t[t.TOP_TO_BOTTOM=1]="TOP_TO_BOTTOM"}(Ai||(Ai={})),e(Ai),function(t){t[t.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",t[t.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT"}(Ii||(Ii={})),e(Ii),function(t){t[t.NONE=0]="NONE",t[t.FIXED_ROW=1]="FIXED_ROW",t[t.FIXED_COL=2]="FIXED_COL"}(bi||(bi={})),e(bi);var Ri,xi,Ni,wi,Bi,Hi,Pi,Mi,zi,ki,Vi,Ui,Fi,Gi,Wi=new C,ji=(Ke=T("cc.Layout"),qe=E(110),Je=O(_t),Qe=v(Ei),$e=v(Oi),ti=v(Li),ei=v(Ai),ii=v(Ii),ni=v(bi),Ke(oi=qe(oi=Je((Si=function(t){function e(){var e;return(e=t.call(this)||this)._resizeMode=si&&si(),e._layoutType=ai&&ai(),e._cellSize=hi&&hi(),e._startAxis=ci&&ci(),e._paddingLeft=li&&li(),e._paddingRight=_i&&_i(),e._paddingTop=ui&&ui(),e._paddingBottom=di&&di(),e._spacingX=pi&&pi(),e._spacingY=gi&&gi(),e._verticalDirection=fi&&fi(),e._horizontalDirection=yi&&yi(),e._constraint=Ti&&Ti(),e._constraintNum=vi&&vi(),e._affectedByScale=mi&&mi(),e._isAlign=Ci&&Ci(),e._layoutSize=new x(300,200),e._layoutDirty=!0,e._childrenDirty=!1,e._usefulLayoutObj=[],e._init=!1,e}i(e,t);var n=e.prototype;return n.updateLayout=function(t){void 0===t&&(t=!1),(this._layoutDirty||t)&&(this._doLayout(),this._layoutDirty=!1)},n.onEnable=function(){this._addEventListeners();var t=this.node._getUITransformComp();t.contentSize.equals(x.ZERO)&&t.setContentSize(this._layoutSize),this._childrenChanged()},n.onDisable=function(){this._usefulLayoutObj.length=0,this._removeEventListeners()},n._checkUsefulObj=function(){this._usefulLayoutObj.length=0;for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e],n=i._getUITransformComp();i.activeInHierarchy&&n&&this._usefulLayoutObj.push(n)}},n._addEventListeners=function(){gt.on(ft.AFTER_UPDATE,this.updateLayout,this),this.node.on(at.SIZE_CHANGED,this._resized,this),this.node.on(at.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.on(at.CHILD_ADDED,this._childAdded,this),this.node.on(at.CHILD_REMOVED,this._childRemoved,this),this.node.on(at.CHILDREN_ORDER_CHANGED,this._childrenChanged,this),this.node.on("childrenSiblingOrderChanged",this.updateLayout,this),this._addChildrenEventListeners()},n._removeEventListeners=function(){gt.off(ft.AFTER_UPDATE,this.updateLayout,this),this.node.off(at.SIZE_CHANGED,this._resized,this),this.node.off(at.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.off(at.CHILD_ADDED,this._childAdded,this),this.node.off(at.CHILD_REMOVED,this._childRemoved,this),this.node.off(at.CHILDREN_ORDER_CHANGED,this._childrenChanged,this),this.node.off("childrenSiblingOrderChanged",this.updateLayout,this),this._removeChildrenEventListeners()},n._addChildrenEventListeners=function(){for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e];i.on(at.SIZE_CHANGED,this._doLayoutDirty,this),i.on(at.TRANSFORM_CHANGED,this._transformDirty,this),i.on(at.ANCHOR_CHANGED,this._doLayoutDirty,this),i.on(at.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this)}},n._removeChildrenEventListeners=function(){for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e];i.off(at.SIZE_CHANGED,this._doLayoutDirty,this),i.off(at.TRANSFORM_CHANGED,this._transformDirty,this),i.off(at.ANCHOR_CHANGED,this._doLayoutDirty,this),i.off(at.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this)}},n._childAdded=function(t){t.on(at.SIZE_CHANGED,this._doLayoutDirty,this),t.on(at.TRANSFORM_CHANGED,this._transformDirty,this),t.on(at.ANCHOR_CHANGED,this._doLayoutDirty,this),t.on(at.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this),this._childrenChanged()},n._childRemoved=function(t){t.off(at.SIZE_CHANGED,this._doLayoutDirty,this),t.off(at.TRANSFORM_CHANGED,this._transformDirty,this),t.off(at.ANCHOR_CHANGED,this._doLayoutDirty,this),t.off(at.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this),this._childrenChanged()},n._resized=function(){this._layoutSize.set(this.node._getUITransformComp().contentSize),this._doLayoutDirty()},n._doLayoutHorizontally=function(t,e,i,n){var o=this.node._getUITransformComp().anchorPoint,r=this._getFixedBreakingNum(),s=1,a=this._paddingLeft;this._horizontalDirection===Ii.RIGHT_TO_LEFT&&(s=-1,a=this._paddingRight);var h=(this._horizontalDirection-o.x)*t+s*a,c=h-s*this._spacingX,l=0,_=0,u=0,d=0,p=!1,g=this._usefulLayoutObj.length,f=this._cellSize.width,y=this._getPaddingH();this._layoutType!==Ei.GRID&&this._resizeMode===Oi.CHILDREN&&(f=(t-y-(g-1)*this._spacingX)/g);for(var T=this._usefulLayoutObj,v=0;v<T.length;++v){var m=T[v],C=m.node,S=C.scale,E=this._getUsedScaleValue(S.x),O=this._getUsedScaleValue(S.y);this._resizeMode===Oi.CHILDREN&&(m.width=f/E,this._layoutType===Ei.GRID&&(m.height=this._cellSize.height/O));var L=Math.abs(this._horizontalDirection-m.anchorX),A=m.width*E,I=m.height*O;I>u&&(d=Math.max(u,d),_=u||I,u=I),c+=s*(L*A+this._spacingX);var b=s*(1-L)*A;if(e){if(r>0)(p=v/r>0&&v%r==0)&&(_=u>I?u:_);else if(A>t-y)c>h+s*L*A&&(p=!0);else{var D=(1-this._horizontalDirection-o.x)*t,R=c+b+s*(s>0?this._paddingRight:this._paddingLeft);p=Math.abs(R)>Math.abs(D)}p&&(c=h+s*L*A,I!==u&&(_=u),l+=_+this._spacingY,_=u=I)}var x=i(C,m,l);n&&C.setPosition(c,x),c+=b}return _=Math.max(_,u),Math.max(d,l+_)+this._getPaddingV()},n._doLayoutVertically=function(t,e,i,n){var o=this.node._getUITransformComp().anchorPoint,r=this._getFixedBreakingNum(),s=1,a=this._paddingBottom;this._verticalDirection===Ai.TOP_TO_BOTTOM&&(s=-1,a=this._paddingTop);var h=(this._verticalDirection-o.y)*t+s*a,c=h-s*this._spacingY,l=0,_=0,u=0,d=0,p=!1,g=this._usefulLayoutObj.length,f=this._cellSize.height,y=this._getPaddingV();this._layoutType!==Ei.GRID&&this._resizeMode===Oi.CHILDREN&&(f=(t-y-(g-1)*this._spacingY)/g);for(var T=this._usefulLayoutObj,v=0;v<T.length;++v){var m=T[v],C=m.node,S=C.scale,E=this._getUsedScaleValue(S.x),O=this._getUsedScaleValue(S.y);this._resizeMode===Oi.CHILDREN&&(m.height=f/O,this._layoutType===Ei.GRID&&(m.width=this._cellSize.width/E));var L=Math.abs(this._verticalDirection-m.anchorY),A=m.width*E,I=m.height*O;A>l&&(_=Math.max(l,_),u=l||A,l=A),c+=s*(L*I+this._spacingY);var b=s*(1-L)*I;if(e){if(r>0)(p=v/r>0&&v%r==0)&&(u=l>I?l:u);else if(I>t-y)c>h+s*L*I&&(p=!0);else{var D=(1-this._verticalDirection-o.y)*t,R=c+b+s*(s>0?this._paddingTop:this._paddingBottom);p=Math.abs(R)>Math.abs(D)}p&&(c=h+s*L*I,A!==l&&(u=l),d+=u+this._spacingX,u=l=A)}var x=i(C,m,d);n&&(C.getPosition(Wi),C.setPosition(x,c,Wi.z)),c+=b}return u=Math.max(u,l),Math.max(_,d+u)+this._getPaddingH()},n._doLayoutGridAxisHorizontal=function(t,e){var i=this,n=e.width,o=1,r=-t.y*e.height,s=this._paddingBottom;this._verticalDirection===Ai.TOP_TO_BOTTOM&&(o=-1,r=(1-t.y)*e.height,s=this._paddingTop);var a=function(t,e,n){return r+o*(n+(1-e.anchorY)*e.height*i._getUsedScaleValue(t.scale.y)+s)},h=0;this._resizeMode===Oi.CONTAINER&&(h=this._doLayoutHorizontally(n,!0,a,!1),r=-t.y*h,this._verticalDirection===Ai.TOP_TO_BOTTOM&&(o=-1,r=(1-t.y)*h)),this._doLayoutHorizontally(n,!0,a,!0),this._resizeMode===Oi.CONTAINER&&this.node._getUITransformComp().setContentSize(n,h)},n._doLayoutGridAxisVertical=function(t,e){var i=this,n=e.height,o=1,r=-t.x*e.width,s=this._paddingLeft;this._horizontalDirection===Ii.RIGHT_TO_LEFT&&(o=-1,r=(1-t.x)*e.width,s=this._paddingRight);var a=function(t,e,n){return r+o*(n+(1-e.anchorX)*e.width*i._getUsedScaleValue(t.scale.x)+s)},h=0;this._resizeMode===Oi.CONTAINER&&(h=this._doLayoutVertically(n,!0,a,!1),r=-t.x*h,this._horizontalDirection===Ii.RIGHT_TO_LEFT&&(o=-1,r=(1-t.x)*h)),this._doLayoutVertically(n,!0,a,!0),this._resizeMode===Oi.CONTAINER&&this.node._getUITransformComp().setContentSize(h,n)},n._doLayoutGrid=function(){var t=this.node._getUITransformComp(),e=t.anchorPoint,i=t.contentSize;this.startAxis===Li.HORIZONTAL?this._doLayoutGridAxisHorizontal(e,i):this.startAxis===Li.VERTICAL&&this._doLayoutGridAxisVertical(e,i)},n._getHorizontalBaseWidth=function(){var t=this._usefulLayoutObj,e=0,i=t.length;if(this._resizeMode===Oi.CONTAINER){for(var n=0;n<t.length;++n){var o=t[n],r=o.node.scale;e+=o.width*this._getUsedScaleValue(r.x)}e+=(i-1)*this._spacingX+this._getPaddingH()}else e=this.node._getUITransformComp().width;return e},n._getVerticalBaseHeight=function(){var t=this._usefulLayoutObj,e=0,i=t.length;if(this._resizeMode===Oi.CONTAINER){for(var n=0;n<t.length;++n){var o=t[n],r=o.node.scale;e+=o.height*this._getUsedScaleValue(r.y)}e+=(i-1)*this._spacingY+this._getPaddingV()}else e=this.node._getUITransformComp().height;return e},n._doLayout=function(){var t=this;if(this._init&&!this._childrenDirty||(this._checkUsefulObj(),this._init=!0,this._childrenDirty=!1),this._layoutType===Ei.HORIZONTAL){var e=this._getHorizontalBaseWidth();this._doLayoutHorizontally(e,!1,(function(e){return(t._isAlign?C.ZERO:e.position).y}),!0),this.node._getUITransformComp().width=e}else if(this._layoutType===Ei.VERTICAL){var i=this._getVerticalBaseHeight();this._doLayoutVertically(i,!1,(function(e){return(t._isAlign?C.ZERO:e.position).x}),!0),this.node._getUITransformComp().height=i}else this._layoutType===Ei.GRID&&this._doLayoutGrid()},n._getUsedScaleValue=function(t){return this._affectedByScale?Math.abs(t):1},n._transformDirty=function(t){t&it.SCALE&&t&it.POSITION&&this._affectedByScale&&this._doLayoutDirty()},n._doLayoutDirty=function(){this._layoutDirty=!0},n._childrenChanged=function(){this._childrenDirty=!0,this._doLayoutDirty()},n._getPaddingH=function(){return this._paddingLeft+this._paddingRight},n._getPaddingV=function(){return this._paddingTop+this._paddingBottom},n._getFixedBreakingNum=function(){if(this._layoutType!==Ei.GRID||this._constraint===bi.NONE||this._constraintNum<=0)return 0;var t=this._constraint===bi.FIXED_ROW?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum;return this._startAxis===Li.VERTICAL&&(t=this._constraint===bi.FIXED_COL?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum),t},o(e,[{key:"alignHorizontal",get:function(){return this._isAlign},set:function(t){this._layoutType===Ei.HORIZONTAL&&(this._isAlign=t,this._doLayoutDirty())}},{key:"alignVertical",get:function(){return this._isAlign},set:function(t){this._layoutType===Ei.VERTICAL&&(this._isAlign=t,this._doLayoutDirty())}},{key:"type",get:function(){return this._layoutType},set:function(t){this._layoutType=t,this._doLayoutDirty()}},{key:"resizeMode",get:function(){return this._resizeMode},set:function(t){this._layoutType!==Ei.NONE&&(this._resizeMode=t,this._doLayoutDirty())}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize.set(t),this._doLayoutDirty())}},{key:"startAxis",get:function(){return this._startAxis},set:function(t){this._startAxis!==t&&(this._startAxis=t,this._doLayoutDirty())}},{key:"paddingLeft",get:function(){return this._paddingLeft},set:function(t){this._paddingLeft!==t&&(this._paddingLeft=t,this._doLayoutDirty())}},{key:"paddingRight",get:function(){return this._paddingRight},set:function(t){this._paddingRight!==t&&(this._paddingRight=t,this._doLayoutDirty())}},{key:"paddingTop",get:function(){return this._paddingTop},set:function(t){this._paddingTop!==t&&(this._paddingTop=t,this._doLayoutDirty())}},{key:"paddingBottom",get:function(){return this._paddingBottom},set:function(t){this._paddingBottom!==t&&(this._paddingBottom=t,this._doLayoutDirty())}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this._doLayoutDirty())}},{key:"spacingY",get:function(){return this._spacingY},set:function(t){this._spacingY!==t&&(this._spacingY=t,this._doLayoutDirty())}},{key:"verticalDirection",get:function(){return this._verticalDirection},set:function(t){this._verticalDirection!==t&&(this._verticalDirection=t,this._doLayoutDirty())}},{key:"horizontalDirection",get:function(){return this._horizontalDirection},set:function(t){this._horizontalDirection!==t&&(this._horizontalDirection=t,this._doLayoutDirty())}},{key:"padding",get:function(){return this._paddingLeft},set:function(t){this.paddingLeft===t&&this._paddingRight===t&&this._paddingTop===t&&this._paddingBottom===t||(this._paddingLeft=this._paddingRight=this._paddingTop=this._paddingBottom=t,this._doLayoutDirty())}},{key:"constraint",get:function(){return this._constraint},set:function(t){this._layoutType!==Ei.NONE&&this._constraint!==t&&(this._constraint=t,this._doLayoutDirty())}},{key:"constraintNum",get:function(){return this._constraintNum},set:function(t){this._constraint!==bi.NONE&&this._constraintNum!==t&&(t<=0&&l(16400),this._constraintNum=t,this._doLayoutDirty())}},{key:"affectedByScale",get:function(){return this._affectedByScale},set:function(t){this._affectedByScale=t,this._doLayoutDirty()}}]),e}(ct),Si.Type=Ei,Si.VerticalDirection=Ai,Si.HorizontalDirection=Ii,Si.ResizeMode=Oi,Si.AxisDirection=Li,Si.Constraint=bi,r((ri=Si).prototype,"type",[Qe],Object.getOwnPropertyDescriptor(ri.prototype,"type"),ri.prototype),r(ri.prototype,"resizeMode",[$e],Object.getOwnPropertyDescriptor(ri.prototype,"resizeMode"),ri.prototype),r(ri.prototype,"startAxis",[ti],Object.getOwnPropertyDescriptor(ri.prototype,"startAxis"),ri.prototype),r(ri.prototype,"verticalDirection",[ei],Object.getOwnPropertyDescriptor(ri.prototype,"verticalDirection"),ri.prototype),r(ri.prototype,"horizontalDirection",[ii],Object.getOwnPropertyDescriptor(ri.prototype,"horizontalDirection"),ri.prototype),r(ri.prototype,"constraint",[ni],Object.getOwnPropertyDescriptor(ri.prototype,"constraint"),ri.prototype),si=S(ri.prototype,"_resizeMode",[A],(function(){return Oi.NONE})),ai=S(ri.prototype,"_layoutType",[A],(function(){return Ei.NONE})),hi=S(ri.prototype,"_cellSize",[A],(function(){return new x(40,40)})),ci=S(ri.prototype,"_startAxis",[A],(function(){return Li.HORIZONTAL})),li=S(ri.prototype,"_paddingLeft",[A],(function(){return 0})),_i=S(ri.prototype,"_paddingRight",[A],(function(){return 0})),ui=S(ri.prototype,"_paddingTop",[A],(function(){return 0})),di=S(ri.prototype,"_paddingBottom",[A],(function(){return 0})),pi=S(ri.prototype,"_spacingX",[A],(function(){return 0})),gi=S(ri.prototype,"_spacingY",[A],(function(){return 0})),fi=S(ri.prototype,"_verticalDirection",[A],(function(){return Ai.TOP_TO_BOTTOM})),yi=S(ri.prototype,"_horizontalDirection",[A],(function(){return Ii.LEFT_TO_RIGHT})),Ti=S(ri.prototype,"_constraint",[A],(function(){return bi.NONE})),vi=S(ri.prototype,"_constraintNum",[A],(function(){return 2})),mi=S(ri.prototype,"_affectedByScale",[A],(function(){return!1})),Ci=S(ri.prototype,"_isAlign",[A],(function(){return!1})),oi=ri))||oi)||oi)||oi);t({Layout:ji,LayoutComponent:ji}),Z.Layout=ji,function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.FILLED=2]="FILLED"}(Gi||(Gi={})),s(Gi);var Zi,Xi,Yi,Ki,qi,Ji,Qi,$i,tn,en,nn,on,rn,sn=(Ri=T("cc.ProgressBar"),xi=E(110),Ni=O(_t),wi=v(q),Bi=v(Gi),Ri(Hi=xi(Hi=Ni((Fi=function(t){function e(){var e;return(e=t.call(this)||this)._barSprite=Mi&&Mi(),e._mode=zi&&zi(),e._totalLength=ki&&ki(),e._progress=Vi&&Vi(),e._reverse=Ui&&Ui(),e}i(e,t);var n=e.prototype;return n.onLoad=function(){this._updateBarStatus()},n._initBarSprite=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var e=this.node._getUITransformComp(),i=e.contentSize,n=e.anchorPoint,o=t._getUITransformComp().contentSize;if(this._barSprite.fillType===q.FillType.RADIAL&&(this._mode=Gi.FILLED),this._mode===Gi.HORIZONTAL?this.totalLength=o.width:this._mode===Gi.VERTICAL?this.totalLength=o.height:this.totalLength=this._barSprite.fillRange,t.parent===this.node){var r=-i.width*n.x;t.setPosition(r,0,0)}}},n._updateBarStatus=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var e=t._getUITransformComp(),i=e.anchorPoint,n=e.contentSize,o=new N(0,.5),r=w(this._progress),s=this._totalLength*r,a=n,h=0,c=0;switch(this._mode){case Gi.HORIZONTAL:this._reverse&&(o=new N(1,.5)),a=new x(s,n.height),h=this._totalLength,c=n.height;break;case Gi.VERTICAL:o=this._reverse?new N(.5,1):new N(.5,0),a=new x(n.width,s),h=n.width,c=this._totalLength}if(this._mode===Gi.FILLED)this._barSprite.type!==q.Type.FILLED?l(16397):(this._reverse&&(s*=-1),this._barSprite.fillRange=s);else if(this._barSprite.type!==q.Type.FILLED){var _=o.x-i.x,u=o.y-i.y,d=new C(t.position);d.add3f(h*_,c*u,0),t.setPosition(d),e.setAnchorPoint(o),e.setContentSize(a)}else l(16398)}},o(e,[{key:"barSprite",get:function(){return this._barSprite},set:function(t){this._barSprite!==t&&(this._barSprite=t,this._initBarSprite())}},{key:"mode",get:function(){return this._mode},set:function(t){if(this._mode!==t&&(this._mode=t,this._barSprite)){var e=this._barSprite.node;if(!e)return;var i=e._getUITransformComp().contentSize;this._mode===Gi.HORIZONTAL?this.totalLength=i.width:this._mode===Gi.VERTICAL?this.totalLength=i.height:this._mode===Gi.FILLED&&(this.totalLength=this._barSprite.fillRange)}}},{key:"totalLength",get:function(){return this._totalLength},set:function(t){this._mode===Gi.FILLED&&(t=w(t)),this._totalLength!==t&&(this._totalLength=t,this._updateBarStatus())}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateBarStatus())}},{key:"reverse",get:function(){return this._reverse},set:function(t){this._reverse!==t&&(this._reverse=t,this._barSprite&&(this._barSprite.fillStart=1-this._barSprite.fillStart),this._updateBarStatus())}}]),e}(ct),Fi.Mode=Gi,r((Pi=Fi).prototype,"barSprite",[wi],Object.getOwnPropertyDescriptor(Pi.prototype,"barSprite"),Pi.prototype),r(Pi.prototype,"mode",[Bi],Object.getOwnPropertyDescriptor(Pi.prototype,"mode"),Pi.prototype),Mi=S(Pi.prototype,"_barSprite",[A],(function(){return null})),zi=S(Pi.prototype,"_mode",[A],(function(){return Gi.HORIZONTAL})),ki=S(Pi.prototype,"_totalLength",[A],(function(){return 1})),Vi=S(Pi.prototype,"_progress",[A],(function(){return.1})),Ui=S(Pi.prototype,"_reverse",[A],(function(){return!1})),Hi=Pi))||Hi)||Hi)||Hi);t({ProgressBar:sn,ProgressBarComponent:sn}),Z.ProgressBar=sn;var an,hn=new C,cn=new C,ln=new C,_n=new N,un=new y,dn=new N;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(an||(an={})),e(an);var pn,gn=(Zi=T("cc.ScrollBar"),Xi=E(110),Yi=O(_t),Ki=v(q),qi=v(an),Zi(Ji=Xi(Ji=Yi((rn=function(t){function e(){var e;return(e=t.call(this)||this)._scrollView=$i&&$i(),e._handle=tn&&tn(),e._direction=en&&en(),e._enableAutoHide=nn&&nn(),e._autoHideTime=on&&on(),e._touching=!1,e._opacity=255,e._autoHideRemainingTime=0,e}i(e,t);var n=e.prototype;return n.hide=function(){this._autoHideRemainingTime=0,this._setOpacity(0)},n.show=function(){this._autoHideRemainingTime=this._autoHideTime,this._opacity=255,this._setOpacity(this._opacity)},n.onScroll=function(t){if(this._scrollView){var e=this._scrollView.content;if(e){var i=e._getUITransformComp().contentSize,n=this._scrollView.node._getUITransformComp().contentSize,o=this.node._getUITransformComp().contentSize;if(!this._conditionalDisableScrollBar(i,n)){this._enableAutoHide&&(this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity));var r=0,s=0,a=0,h=0,c=0,l=dn;l.set(0,0),this._direction===an.HORIZONTAL?(r=i.width,s=n.width,c=o.width,a=t.x,this._convertToScrollViewSpace(l,e),h=-l.x):this._direction===an.VERTICAL&&(r=i.height,s=n.height,c=o.height,a=t.y,this._convertToScrollViewSpace(l,e),h=-l.y);var _=this._calculateLength(r,s,c,a),u=dn;this._calculatePosition(u,r,s,c,h,a,_),this._updateLength(_),this._updateHandlerPosition(u)}}}},n.setScrollView=function(t){this._scrollView=t},n.onTouchBegan=function(){this._enableAutoHide&&(this._touching=!0)},n.onTouchEnded=function(){if(this._enableAutoHide&&(this._touching=!1,!(this._autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var e=t._getUITransformComp().contentSize,i=this._scrollView.node._getUITransformComp().contentSize;if(this._conditionalDisableScrollBar(e,i))return}}this._autoHideRemainingTime=this._autoHideTime}},n.onEnable=function(){var t=this.node.getComponent(q);t&&(this._opacity=t.color.a)},n.start=function(){this._enableAutoHide&&this._setOpacity(0)},n.update=function(t){this._processAutoHide(t)},n._convertToScrollViewSpace=function(t,e){var i=this._scrollView&&this._scrollView.node._getUITransformComp(),n=e._getUITransformComp();if(i&&n){hn.set(-n.anchorX*n.width,-n.anchorY*n.height,0),n.convertToWorldSpaceAR(hn,cn);var o=i.convertToNodeSpaceAR(cn);o.x+=i.anchorX*i.width,o.y+=i.anchorY*i.height,t.set(o.x,o.y)}else t.set(N.ZERO)},n._setOpacity=function(t){if(this._handle){var e=this.node.getComponent(q);e&&(un.set(e.color),un.a=t,e.color=un),(e=this._handle.getComponent(q))&&(un.set(e.color),un.a=t,e.color=un)}},n._updateHandlerPosition=function(t){if(this._handle){var e=ln;this._fixupHandlerPosition(e),this._handle.node.setPosition(t.x+e.x,t.y+e.y,e.z)}},n._fixupHandlerPosition=function(t){var e=this.node._getUITransformComp(),i=e.contentSize,n=e.anchorPoint,o=this.handle.node._getUITransformComp().contentSize,r=this.handle.node.parent;C.set(hn,-i.width*n.x,-i.height*n.y,0);var s=this.node._getUITransformComp().convertToWorldSpaceAR(hn,cn),a=t;a.set(0,0,0),r._getUITransformComp().convertToNodeSpaceAR(s,a),this.direction===an.HORIZONTAL?a.set(a.x,a.y+(i.height-o.height)/2,a.z):this.direction===an.VERTICAL&&a.set(a.x+(i.width-o.width)/2,a.y,a.z),this.handle.node.setPosition(a)},n._conditionalDisableScrollBar=function(t,e){return t.width<=e.width&&this._direction===an.HORIZONTAL||t.height<=e.height&&this._direction===an.VERTICAL},n._calculateLength=function(t,e,i,n){var o=t;return n&&(o+=20*(n>0?n:-n)),i*(e/o)},n._calculatePosition=function(t,e,i,n,o,r,s){var a=e-i;r&&(a+=Math.abs(r));var h=0;a&&(h=w(h=o/a));var c=(n-s)*h;this._direction===an.VERTICAL?t.set(0,c):t.set(c,0)},n._updateLength=function(t){if(this._handle){var e=this._handle.node._getUITransformComp(),i=e.contentSize,n=e.anchorPoint;n.x===_n.x&&n.y===_n.y||e.setAnchorPoint(_n),this._direction===an.HORIZONTAL?e.setContentSize(t,i.height):e.setContentSize(i.width,t)}},n._processAutoHide=function(t){if(this._enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this._autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var e=this._opacity*(this._autoHideRemainingTime/this._autoHideTime);this._setOpacity(e)}},o(e,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t,this.onScroll(N.ZERO))}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this.onScroll(N.ZERO))}},{key:"enableAutoHide",get:function(){return this._enableAutoHide},set:function(t){this._enableAutoHide!==t&&(this._enableAutoHide=t,this._enableAutoHide&&this._setOpacity(0))}},{key:"autoHideTime",get:function(){return this._autoHideTime},set:function(t){this._autoHideTime!==t&&(this._autoHideTime=t)}}]),e}(ct),rn.Direction=an,r((Qi=rn).prototype,"handle",[Ki],Object.getOwnPropertyDescriptor(Qi.prototype,"handle"),Qi.prototype),r(Qi.prototype,"direction",[qi],Object.getOwnPropertyDescriptor(Qi.prototype,"direction"),Qi.prototype),$i=S(Qi.prototype,"_scrollView",[A],(function(){return null})),tn=S(Qi.prototype,"_handle",[A],(function(){return null})),en=S(Qi.prototype,"_direction",[A],(function(){return an.HORIZONTAL})),nn=S(Qi.prototype,"_enableAutoHide",[A],(function(){return!1})),on=S(Qi.prototype,"_autoHideTime",[A],(function(){return 1})),Ji=Qi))||Ji)||Ji)||Ji);t({ScrollBar:gn,ScrollBarComponent:gn}),Z.ScrollBar=gn;var fn,yn,Tn,vn,mn,Cn,Sn,En,On,Ln,An,In,bn,Dn,Rn,xn,Nn,wn,Bn,Hn,Pn,Mn=t("ViewGroup",T("cc.ViewGroup")(pn=E(110)(pn=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e}(ct))||pn)||pn);Z.ViewGroup=Mn;var zn,kn,Vn=1e-4,Un=L(),Fn=L(),Gn=B(),Wn=B(),jn=function(){return(new Date).getMilliseconds()},Zn={"scroll-to-top":0,"scroll-to-bottom":1,"scroll-to-left":2,"scroll-to-right":3,scrolling:4,"bounce-bottom":6,"bounce-left":7,"bounce-right":8,"bounce-top":5,"scroll-ended":9,"touch-up":10,"scroll-ended-with-threshold":11,"scroll-began":12},Xn={anchor:B(),applyToHorizontal:!1,applyToVertical:!1},Yn=function(t,e,i,n){Xn.anchor.set(t,e),Xn.applyToHorizontal=i,Xn.applyToVertical=n};!function(t){t.NONE="",t.SCROLL_TO_TOP="scroll-to-top",t.SCROLL_TO_BOTTOM="scroll-to-bottom",t.SCROLL_TO_LEFT="scroll-to-left",t.SCROLL_TO_RIGHT="scroll-to-right",t.SCROLL_BEGAN="scroll-began",t.SCROLL_ENDED="scroll-ended",t.BOUNCE_TOP="bounce-top",t.BOUNCE_BOTTOM="bounce-bottom",t.BOUNCE_LEFT="bounce-left",t.BOUNCE_RIGHT="bounce-right",t.SCROLLING="scrolling",t.SCROLL_ENG_WITH_THRESHOLD="scroll-ended-with-threshold",t.TOUCH_UP="touch-up"}(zn||(zn={})),function(t){t[t.NONE=0]="NONE",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT"}(kn||(kn={}));var Kn,qn,Jn,Qn,$n,to,eo,io,no,oo,ro,so,ao,ho=(fn=T("cc.ScrollView"),yn=E(110),Tn=O(_t),vn=v(nt),mn=v(gn),Cn=v(gn),Sn=v([ht]),fn(En=yn(En=Tn((Pn=function(t){function e(){var e;return(e=t.call(this)||this).bounceDuration=Ln&&Ln(),e.brake=An&&An(),e.elastic=In&&In(),e.inertia=bn&&bn(),e.horizontal=Dn&&Dn(),e.vertical=Rn&&Rn(),e.cancelInnerEvents=xn&&xn(),e.scrollEvents=Nn&&Nn(),e._autoScrolling=!1,e._scrolling=!1,e._content=wn&&wn(),e._horizontalScrollBar=Bn&&Bn(),e._verticalScrollBar=Hn&&Hn(),e._topBoundary=0,e._bottomBoundary=0,e._leftBoundary=0,e._rightBoundary=0,e._touchMoveDisplacements=[],e._touchMoveTimeDeltas=[],e._touchMovePreviousTimestamp=0,e._touchMoved=!1,e._autoScrollAttenuate=!1,e._autoScrollStartPosition=new C,e._autoScrollTargetDelta=new C,e._autoScrollTotalTime=0,e._autoScrollAccumulatedTime=0,e._autoScrollCurrentlyOutOfBoundary=!1,e._autoScrollBraking=!1,e._autoScrollBrakingStartPosition=new C,e._outOfBoundaryAmount=new C,e._outOfBoundaryAmountDirty=!0,e._stopMouseWheel=!1,e._mouseWheelEventElapsedTime=0,e._isScrollEndedWithThresholdEventFired=!1,e._scrollEventEmitMask=0,e._isBouncing=!1,e._contentPos=new C,e._deltaPos=new C,e._deltaAmount=new C,e._hoverIn=kn.NONE,e}i(e,t);var n=e.prototype;return n.scrollToBottom=function(t,e){void 0===e&&(e=!0),this._doScroll(0,0,!1,!0,t,e)},n.scrollToTop=function(t,e){void 0===e&&(e=!0),this._doScroll(0,1,!1,!0,t,e)},n.scrollToLeft=function(t,e){void 0===e&&(e=!0),this._doScroll(0,0,!0,!1,t,e)},n.scrollToRight=function(t,e){void 0===e&&(e=!0),this._doScroll(1,0,!0,!1,t,e)},n.scrollToTopLeft=function(t,e){void 0===e&&(e=!0),this._doScroll(0,1,!0,!0,t,e)},n.scrollToTopRight=function(t,e){void 0===e&&(e=!0),this._doScroll(1,1,!0,!0,t,e)},n.scrollToBottomLeft=function(t,e){void 0===e&&(e=!0),this._doScroll(0,0,!0,!0,t,e)},n.scrollToBottomRight=function(t,e){void 0===e&&(e=!0),this._doScroll(1,0,!0,!0,t,e)},n.scrollToOffset=function(t,e,i){void 0===i&&(i=!0);var n=this.getMaxScrollOffset(),o=B();0===n.x?o.x=0:o.x=t.x/n.x,0===n.y?o.y=1:o.y=(n.y-t.y)/n.y,this.scrollTo(o,e,i)},n.getScrollOffset=function(){var t=this._getContentTopBoundary()-this._topBoundary,e=this._getContentLeftBoundary()-this._leftBoundary;return new N(e,t)},n.getMaxScrollOffset=function(){if(!this._content||!this.view)return N.ZERO;var t=this._content._getUITransformComp().contentSize,e=t.width-this.view.width,i=t.height-this.view.height;return new N(e=e>=0?e:0,i=i>=0?i:0)},n.scrollToPercentHorizontal=function(t,e,i){this._doScroll(t,0,!0,!1,e,i)},n.scrollTo=function(t,e,i){this._doScroll(t.x,t.y,!0,!0,e,i)},n.scrollToPercentVertical=function(t,e,i){this._doScroll(0,t,!1,!0,e,i)},n._doScroll=function(t,e,i,n,o,r){void 0===r&&(r=!0),Yn(t,e,i,n);var s=this._calculateMovePercentDelta(Xn);o?this._startAutoScroll(s,o,r):this._moveContent(s)},n.stopAutoScroll=function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},n.setContentPosition=function(t){this._setContentPosition(t)},n._setContentPosition=function(t){if(this._content){var e=this._getContentPosition();Math.abs(t.x-e.x)<Vn&&Math.abs(t.y-e.y)<Vn||(this._content.setPosition(t),this._outOfBoundaryAmountDirty=!0)}},n.getContentPosition=function(){return this._getContentPosition()},n._getContentPosition=function(){return this._content?(this._contentPos.set(this._content.position),this._contentPos):C.ZERO.clone()},n.isScrolling=function(){return this._scrolling},n.isAutoScrolling=function(){return this._autoScrolling},n.getScrollEndedEventTiming=function(){return Vn},n.start=function(){this._calculateBoundary(),this._content&&gt.once(ft.BEFORE_DRAW,this._adjustContentOutOfBoundary,this)},n.onEnable=function(){var t=this;t._registerEvent();var e=this._content;if(e){e.on(at.SIZE_CHANGED,t._calculateBoundary,t),e.on(at.TRANSFORM_CHANGED,t._scaleChanged,t);var i=t.view;i&&(i.node.on(at.TRANSFORM_CHANGED,t._scaleChanged,t),i.node.on(at.SIZE_CHANGED,t._calculateBoundary,t))}t._calculateBoundary(),t._updateScrollBarState()},n.update=function(t){var e=this._deltaAmount;this._autoScrolling?(this._processAutoScrolling(t),e.x=0,e.y=0):0===e.x&&0===e.y||(this._processDeltaMove(e),e.x=0,e.y=0)},n.onDisable=function(){var t=this;t._unregisterEvent();var e=t.content;if(e){e.off(at.SIZE_CHANGED,t._calculateBoundary,t),e.off(at.TRANSFORM_CHANGED,t._scaleChanged,t);var i=t.view;i&&(i.node.off(at.TRANSFORM_CHANGED,t._scaleChanged,t),i.node.off(at.SIZE_CHANGED,t._calculateBoundary,t))}t._deltaAmount.set(0,0),t._hideScrollBar(),t.stopAutoScroll()},n._registerEvent=function(){var t=this,e=t.node;e.on(at.TOUCH_START,t._onTouchBegan,t,!0),e.on(at.TOUCH_MOVE,t._onTouchMoved,t,!0),e.on(at.TOUCH_END,t._onTouchEnded,t,!0),e.on(at.TOUCH_CANCEL,t._onTouchCancelled,t,!0),e.on(at.MOUSE_WHEEL,t._onMouseWheel,t,!0),e.on(ut.XRUI_HOVER_ENTERED,t._xrHoverEnter,t),e.on(ut.XRUI_HOVER_EXITED,t._xrHoverExit,t),et.on(Ct.HANDLE_INPUT,t._dispatchEventHandleInput,t),et.on(Ct.GAMEPAD_INPUT,t._dispatchEventHandleInput,t)},n._unregisterEvent=function(){var t=this,e=t.node;e.off(at.TOUCH_START,t._onTouchBegan,t,!0),e.off(at.TOUCH_MOVE,t._onTouchMoved,t,!0),e.off(at.TOUCH_END,t._onTouchEnded,t,!0),e.off(at.TOUCH_CANCEL,t._onTouchCancelled,t,!0),e.off(at.MOUSE_WHEEL,t._onMouseWheel,t,!0),e.off(ut.XRUI_HOVER_ENTERED,t._xrHoverEnter,t),e.off(ut.XRUI_HOVER_EXITED,t._xrHoverExit,t),et.off(Ct.HANDLE_INPUT,t._dispatchEventHandleInput,t),et.off(Ct.GAMEPAD_INPUT,t._dispatchEventHandleInput,t)},n._onMouseWheel=function(t,e){var i=this;if(i.enabledInHierarchy&&!i._hasNestedViewGroup(t,e)){var n=t.getScrollY(),o=Un;i.vertical?o.set(0,-.1*n,0):i.horizontal&&o.set(-.1*n,0,0),i._mouseWheelEventElapsedTime=0,i._deltaAmount.add(o),i._stopMouseWheel||(i._handlePressLogic(),i.schedule(this._checkMouseWheel,1/60),i._stopMouseWheel=!0),i._stopPropagationIfTargetIsMe(t)}},n._onTouchBegan=function(t,e){var i=this;i.enabledInHierarchy&&i._content&&(i._hasNestedViewGroup(t,e)||(i._handlePressLogic(),i._touchMoved=!1,i._stopPropagationIfTargetIsMe(t)))},n._onTouchMoved=function(t,e){var i=this;if(i.enabledInHierarchy&&i._content&&!i._hasNestedViewGroup(t,e)){var n=t.touch;if(i._handleMoveLogic(n),i.cancelInnerEvents){var o=n.getUILocation(Gn);if(o.subtract(n.getUIStartLocation(Wn)),o.length()>7&&!i._touchMoved&&t.target!==i.node){var r=new St(t.getTouches(),t.bubbles,Et.TOUCH_CANCEL);r.touch=t.touch,r.simulate=!0,t.target.dispatchEvent(r),i._touchMoved=!0}i._stopPropagationIfTargetIsMe(t)}}},n._onTouchEnded=function(t,e){var i=this;if(i.enabledInHierarchy&&i._content&&t&&!i._hasNestedViewGroup(t,e)){i._dispatchEvent(zn.TOUCH_UP);var n=t.touch;i._handleReleaseLogic(n),i._touchMoved?t.propagationStopped=!0:i._stopPropagationIfTargetIsMe(t)}},n._onTouchCancelled=function(t,e){var i=this;i.enabledInHierarchy&&i._content&&(i._hasNestedViewGroup(t,e)||(t&&!t.simulate&&i._handleReleaseLogic(t.touch),i._stopPropagationIfTargetIsMe(t)))},n._calculateBoundary=function(){var t=this;if(t._content&&t.view){var e=t._content.getComponent(ji);e&&e.enabledInHierarchy&&e.updateLayout();var i=t.view,n=i.width*i.anchorX,o=i.height*i.anchorY;t._leftBoundary=-n,t._bottomBoundary=-o,t._rightBoundary=t._leftBoundary+i.width,t._topBoundary=t._bottomBoundary+i.height,t._moveContentToTopLeft(i.contentSize)}},n._hasNestedViewGroup=function(t,e){if(!t||t.eventPhase!==Ot.CAPTURING_PHASE)return!1;if(e)for(var i=0;i<e.length;i++){var n=e[i];if(this.node===n)return!(!t.target||!t.target.getComponent(Mn));if(n.getComponent(Mn))return!0}return!1},n._startInertiaScroll=function(t){Un.set(t),Un.multiplyScalar(.7),this._startAttenuatingAutoScroll(Un,t)},n._calculateAttenuatedFactor=function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))},n._startAttenuatingAutoScroll=function(t,e){var i=t.clone();if(i.normalize(),this._content&&this.view){var n=this._content._getUITransformComp().contentSize,o=this.view.contentSize,r=n.width-o.width,s=n.height-o.height,a=this._calculateAttenuatedFactor(r),h=this._calculateAttenuatedFactor(s);i.x=i.x*r*(1-this.brake)*a,i.y=i.y*s*h*(1-this.brake),i.z=0}var c=t.length(),l=i.length()/c;this.brake>0&&l>7?(l=Math.sqrt(l),i.set(t),i.multiplyScalar(l+1)):i.add(t);var _=this._calculateAutoScrollTimeByInitialSpeed(e.length());this.brake>0&&l>3&&(_*=l=3),0===this.brake&&l>1&&(_*=l),this._startAutoScroll(i,_,!0)},n._calculateAutoScrollTimeByInitialSpeed=function(t){return Math.sqrt(Math.sqrt(t/5))},n._startAutoScroll=function(t,e,i){void 0===i&&(i=!1);var n=this,o=n._flattenVectorByDirection(t);n._autoScrolling=!0,n._autoScrollTargetDelta=o,n._autoScrollAttenuate=i,C.copy(n._autoScrollStartPosition,n._getContentPosition()),n._autoScrollTotalTime=e,n._autoScrollAccumulatedTime=0,n._autoScrollBraking=!1,n._isScrollEndedWithThresholdEventFired=!1,n._autoScrollBrakingStartPosition.set(0,0,0),n._getHowMuchOutOfBoundary().equals(C.ZERO,Vn)||(this._autoScrollCurrentlyOutOfBoundary=!0)},n._calculateTouchMoveVelocity=function(){var t=new C,e=0;if((e=this._touchMoveTimeDeltas.reduce((function(t,e){return t+e}),e))<=0||e>=.5)t.set(C.ZERO);else{var i=Un;i.set(0,0,0),i=this._touchMoveDisplacements.reduce((function(t,e){return t.add(e),t}),i),t.set(i.x*(1-this.brake)/e,i.y*(1-this.brake)/e,i.z)}return t},n._flattenVectorByDirection=function(t){return this.horizontal||(t.x=0),this.vertical||(t.y=0),t},n._moveContent=function(t,e){var i=this._flattenVectorByDirection(t);Un.set(this._getContentPosition()),Un.add(i),Un.set(Math.round(1e4*Un.x)*Vn,Math.round(1e4*Un.y)*Vn,Un.z),this._setContentPosition(Un);var n=this._getHowMuchOutOfBoundary();Gn.set(n.x,n.y),this._updateScrollBar(Gn),this.elastic&&e&&this._startBounceBackIfNeeded()},n._getContentLeftBoundary=function(){if(!this._content)return-1;var t=this._getContentPosition(),e=this._content._getUITransformComp();return t.x-e.anchorX*e.width},n._getContentRightBoundary=function(){if(!this._content)return-1;var t=this._content._getUITransformComp();return this._getContentLeftBoundary()+t.width},n._getContentTopBoundary=function(){if(!this._content)return-1;var t=this._content._getUITransformComp();return this._getContentBottomBoundary()+t.height},n._getContentBottomBoundary=function(){if(!this._content)return-1;var t=this._getContentPosition(),e=this._content._getUITransformComp();return t.y-e.anchorY*e.height},n._getHowMuchOutOfBoundary=function(t){if(t||(t=C.ZERO),t.equals(C.ZERO,Vn)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=new C,i=this._getContentLeftBoundary(),n=this._getContentRightBoundary();i+t.x>this._leftBoundary?e.x=this._leftBoundary-(i+t.x):n+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(n+t.x));var o=this._getContentTopBoundary(),r=this._getContentBottomBoundary();return o+t.y<this._topBoundary?e.y=this._topBoundary-(o+t.y):r+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(r+t.y)),t.equals(C.ZERO,Vn)&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),this._clampDelta(e),e},n._updateScrollBar=function(t){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.onScroll(t),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.onScroll(t)},n._onScrollBarTouchBegan=function(){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.onTouchBegan(),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.onTouchBegan()},n._onScrollBarTouchEnded=function(){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.onTouchEnded(),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.onTouchEnded()},n._dispatchEvent=function(t){if(t===zn.SCROLL_ENDED)this._scrollEventEmitMask=0;else if(t===zn.SCROLL_TO_TOP||t===zn.SCROLL_TO_BOTTOM||t===zn.SCROLL_TO_LEFT||t===zn.SCROLL_TO_RIGHT){var e=1<<Zn[t];if(this._scrollEventEmitMask&e)return;this._scrollEventEmitMask|=e}ht.emitEvents(this.scrollEvents,this,Zn[t]),this.node.emit(t,this)},n._adjustContentOutOfBoundary=function(){if(this._content){this._outOfBoundaryAmountDirty=!0;var t=this._getHowMuchOutOfBoundary();!t.equals(C.ZERO,Vn)&&(Un.set(this._getContentPosition()),Un.add(t),this._setContentPosition(Un),this._updateScrollBar(N.ZERO))}},n._hideScrollBar=function(){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.hide(),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.hide()},n._updateScrollBarState=function(){var t=this;if(t._content&&t.view){var e=t.view,i=t._content._getUITransformComp(),n=t._verticalScrollBar;n&&n.isValid&&(i.height<e.height||H(i.height,e.height)?n.hide():n.show());var o=t._horizontalScrollBar;o&&o.isValid&&(i.width<e.width||H(i.width,e.width)?o.hide():o.show())}},n._stopPropagationIfTargetIsMe=function(t){t.eventPhase===Ot.AT_TARGET&&t.target===this.node&&(t.propagationStopped=!0)},n._processDeltaMove=function(t){this._scrollChildren(t),this._gatherTouchMove(t)},n._handleMoveLogic=function(t){this._getLocalAxisAlignDelta(this._deltaPos,t),this._deltaAmount.add(this._deltaPos)},n._handleReleaseLogic=function(t){var e=this;e._getLocalAxisAlignDelta(e._deltaPos,t),e._gatherTouchMove(e._deltaPos),e._processInertiaScroll(),e._scrolling&&(e._scrolling=!1,e._autoScrolling||e._dispatchEvent(zn.SCROLL_ENDED))},n._getLocalAxisAlignDelta=function(t,e){var i=this.node._getUITransformComp();i&&(e.getUILocation(Gn),e.getUIPreviousLocation(Wn),Un.set(Gn.x,Gn.y,0),Fn.set(Wn.x,Wn.y,0),i.convertToNodeSpaceAR(Un,Un),i.convertToNodeSpaceAR(Fn,Fn),C.subtract(t,Un,Fn))},n._scrollChildren=function(t){var e=this;e._clampDelta(t);var i,n=t;e.elastic&&(i=e._getHowMuchOutOfBoundary(),n.x*=0===i.x?1:.5,n.y*=0===i.y?1:.5),e.elastic||(i=e._getHowMuchOutOfBoundary(n),n.add(i));var o=zn.NONE,r=zn.NONE;if(e._content){var s=e._content._getUITransformComp(),a=s.anchorX,h=s.anchorY,c=s.width,l=s.height,_=e._content.position||C.ZERO;e.vertical&&(n.y>0?_.y-h*l+n.y>=e._bottomBoundary&&(o=zn.SCROLL_TO_BOTTOM):n.y<0&&_.y-h*l+l+n.y<=e._topBoundary&&(o=zn.SCROLL_TO_TOP)),e.horizontal&&(n.x<0?_.x-a*c+c+n.x<=e._rightBoundary&&(r=zn.SCROLL_TO_RIGHT):n.x>0&&_.x-a*c+n.x>=e._leftBoundary&&(r=zn.SCROLL_TO_LEFT))}e._moveContent(n,!1),(e.horizontal&&0!==n.x||e.vertical&&0!==n.y)&&(e._scrolling||(e._scrolling=!0,e._dispatchEvent(zn.SCROLL_BEGAN)),e._dispatchEvent(zn.SCROLLING)),o!==zn.NONE&&e._dispatchEvent(o),r!==zn.NONE&&e._dispatchEvent(r)},n._handlePressLogic=function(){var t=this;t._autoScrolling&&t._dispatchEvent(zn.SCROLL_ENDED),t._autoScrolling=!1,t._isBouncing=!1,t._touchMovePreviousTimestamp=jn(),t._touchMoveDisplacements.length=0,t._touchMoveTimeDeltas.length=0,t._onScrollBarTouchBegan()},n._clampDelta=function(t){if(this._content&&this.view){var e=this.view.contentSize,i=this._content._getUITransformComp();i.width<e.width&&(t.x=0),i.height<e.height&&(t.y=0)}},n._gatherTouchMove=function(t){var e=this,i=t.clone();for(e._clampDelta(i);e._touchMoveDisplacements.length>=5;)e._touchMoveDisplacements.shift(),e._touchMoveTimeDeltas.shift();e._touchMoveDisplacements.push(i);var n=jn();e._touchMoveTimeDeltas.push((n-e._touchMovePreviousTimestamp)/1e3),e._touchMovePreviousTimestamp=n},n._startBounceBackIfNeeded=function(){var t=this;if(!t.elastic)return!1;var e=t._getHowMuchOutOfBoundary();if(t._clampDelta(e),e.equals(C.ZERO,Vn))return!1;var i=Math.max(t.bounceDuration,0);return t._startAutoScroll(e,i,!0),t._isBouncing||(e.y>0&&t._dispatchEvent(zn.BOUNCE_TOP),e.y<0&&t._dispatchEvent(zn.BOUNCE_BOTTOM),e.x>0&&t._dispatchEvent(zn.BOUNCE_RIGHT),e.x<0&&t._dispatchEvent(zn.BOUNCE_LEFT),t._isBouncing=!0),!0},n._processInertiaScroll=function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var t=this._calculateTouchMoveVelocity();!t.equals(C.ZERO,Vn)&&this.brake<1&&this._startInertiaScroll(t)}this._onScrollBarTouchEnded()},n._isOutOfBoundary=function(){return!this._getHowMuchOutOfBoundary().equals(C.ZERO,Vn)},n._isNecessaryAutoScrollBrake=function(){var t=this;if(t._autoScrollBraking)return!0;if(t._isOutOfBoundary()){if(!t._autoScrollCurrentlyOutOfBoundary)return t._autoScrollCurrentlyOutOfBoundary=!0,t._autoScrollBraking=!0,C.copy(t._autoScrollBrakingStartPosition,t._getContentPosition()),!0}else t._autoScrollCurrentlyOutOfBoundary=!1;return!1},n._processAutoScrolling=function(t){var e=this,i=e._isNecessaryAutoScrollBrake(),n=i?.05:1;e._autoScrollAccumulatedTime+=t*(1/n);var o,r=Math.min(1,e._autoScrollAccumulatedTime/e._autoScrollTotalTime);e._autoScrollAttenuate&&(o=r,r=(o-=1)*o*o*o*o+1);var s=e._autoScrollTargetDelta.clone();s.multiplyScalar(r);var a=e._autoScrollStartPosition.clone();a.add(s);var h=Math.abs(r-1)<=Vn;if(Math.abs(r-1)<=e.getScrollEndedEventTiming()&&!e._isScrollEndedWithThresholdEventFired&&(e._dispatchEvent(zn.SCROLL_ENG_WITH_THRESHOLD),e._isScrollEndedWithThresholdEventFired=!0),e.elastic){var c=a.clone();c.subtract(e._autoScrollBrakingStartPosition),i&&c.multiplyScalar(n),a.set(e._autoScrollBrakingStartPosition),a.add(c)}else{var l=a.clone();l.subtract(e.getContentPosition());var _=e._getHowMuchOutOfBoundary(l);_.equals(C.ZERO,Vn)||(a.add(_),h=!0)}h&&(e._autoScrolling=!1);var u=a.clone();u.subtract(e._getContentPosition()),e._clampDelta(u),e._moveContent(u,h),e._dispatchEvent(zn.SCROLLING),e._autoScrolling||(e._isBouncing=!1,e._scrolling=!1,e._dispatchEvent(zn.SCROLL_ENDED))},n._checkMouseWheel=function(t){var e=this;if(!e._getHowMuchOutOfBoundary().equals(C.ZERO,Vn))return e._processInertiaScroll(),e._scrolling&&(e._scrolling=!1,e._autoScrolling||e._dispatchEvent(zn.SCROLL_ENDED)),e.unschedule(e._checkMouseWheel),void(e._stopMouseWheel=!1);e._mouseWheelEventElapsedTime+=t,e._mouseWheelEventElapsedTime>.1&&(e._onScrollBarTouchEnded(),e._scrolling&&(e._scrolling=!1,e._autoScrolling||e._dispatchEvent(zn.SCROLL_ENDED)),e.unschedule(e._checkMouseWheel),e._stopMouseWheel=!1)},n._calculateMovePercentDelta=function(t){var e=t.anchor,i=t.applyToHorizontal,n=t.applyToVertical,o=this;o._calculateBoundary(),e.clampf(N.ZERO,N.ONE);var r=o._getContentBottomBoundary()-o._bottomBoundary;r=-r;var s=o._getContentLeftBoundary()-o._leftBoundary;s=-s;var a=new C;if(o._content&&o.view){var h=0,c=o._content._getUITransformComp().contentSize,l=o.view.contentSize;i&&(h=c.width-l.width,a.x=s-h*e.x),n&&(h=c.height-l.height,a.y=r-h*e.y)}return a},n._moveContentToTopLeft=function(t){var e=this,i=e._getContentBottomBoundary()-e._bottomBoundary;i=-i;var n=new C,o=0,r=e._getContentLeftBoundary()-e._leftBoundary;if(r=-r,e._content){var s=e._content._getUITransformComp().contentSize;s.height<t.height&&(o=s.height-t.height,n.y=i-o),s.width<t.width&&(o=s.width-t.width,n.x=r)}e._updateScrollBarState(),e._moveContent(n),e._adjustContentOutOfBoundary()},n._scaleChanged=function(t){t===it.SCALE&&this._calculateBoundary()},n._xrHoverEnter=function(t){t.deviceType===pt.Left?this._hoverIn=kn.LEFT:t.deviceType===pt.Right&&(this._hoverIn=kn.RIGHT)},n._xrHoverExit=function(){this._hoverIn=kn.NONE},n._dispatchEventHandleInput=function(t){var e,i;t instanceof Lt?e=t.gamepad:t instanceof At&&(e=t.handleInputDevice),this.enabledInHierarchy&&this._hoverIn!==kn.NONE&&(this._hoverIn===kn.LEFT?(i=e.leftStick.getValue()).equals(N.ZERO)||this._xrThumbStickMove(i):this._hoverIn===kn.RIGHT&&((i=e.rightStick.getValue()).equals(N.ZERO)||this._xrThumbStickMove(i)))},n._xrThumbStickMove=function(t){var e=this;if(e.enabledInHierarchy){var i=t.y,n=Un;e.vertical?n.set(0,-62.5*i,0):e.horizontal&&n.set(-62.5*i,0,0),e._mouseWheelEventElapsedTime=0,e._deltaAmount.add(n),e._stopMouseWheel||(e._handlePressLogic(),e.schedule(e._checkMouseWheel,1/60,NaN,0),e._stopMouseWheel=!0)}},o(e,[{key:"content",get:function(){return this._content},set:function(t){if(this._content!==t){var e=t&&t.parent&&t.parent._getUITransformComp();!t||t&&e?(this._content=t,this._calculateBoundary()):_(4302)}}},{key:"horizontalScrollBar",get:function(){var t=this._horizontalScrollBar;return t&&!t.isValid&&u(4303,"horizontal",this.node.name),t},set:function(t){this._horizontalScrollBar!==t&&(this._horizontalScrollBar=t,this._horizontalScrollBar&&(this._horizontalScrollBar.setScrollView(this),this._updateScrollBar(N.ZERO)))}},{key:"verticalScrollBar",get:function(){var t=this._verticalScrollBar;return t&&!t.isValid&&u(4303,"vertical",this.node.name),t},set:function(t){this._verticalScrollBar!==t&&(this._verticalScrollBar=t,this._verticalScrollBar&&(this._verticalScrollBar.setScrollView(this),this._updateScrollBar(N.ZERO)))}},{key:"view",get:function(){var t=this._content&&this._content.parent;return t?t._getUITransformComp():null}}]),e}(Mn),Pn.EventType=zn,Ln=S((On=Pn).prototype,"bounceDuration",[A],(function(){return 1})),An=S(On.prototype,"brake",[A],(function(){return.5})),In=S(On.prototype,"elastic",[A],(function(){return!0})),bn=S(On.prototype,"inertia",[A],(function(){return!0})),r(On.prototype,"content",[vn],Object.getOwnPropertyDescriptor(On.prototype,"content"),On.prototype),Dn=S(On.prototype,"horizontal",[A],(function(){return!0})),r(On.prototype,"horizontalScrollBar",[mn],Object.getOwnPropertyDescriptor(On.prototype,"horizontalScrollBar"),On.prototype),Rn=S(On.prototype,"vertical",[A],(function(){return!0})),r(On.prototype,"verticalScrollBar",[Cn],Object.getOwnPropertyDescriptor(On.prototype,"verticalScrollBar"),On.prototype),xn=S(On.prototype,"cancelInnerEvents",[A],(function(){return!0})),Nn=S(On.prototype,"scrollEvents",[Sn,A],(function(){return[]})),wn=S(On.prototype,"_content",[A],(function(){return null})),Bn=S(On.prototype,"_horizontalScrollBar",[A],(function(){return null})),Hn=S(On.prototype,"_verticalScrollBar",[A],(function(){return null})),En=On))||En)||En)||En);t({ScrollView:ho,ScrollViewComponent:ho}),Z.ScrollView=ho;var co,lo=new C;!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(co||(co={})),e(co);var _o,uo,po,go,fo,yo,To,vo,mo,Co,So,Eo,Oo=(Kn=T("cc.Slider"),qn=E(110),Jn=O(_t),Qn=v(q),$n=v(co),to=v([ht]),Kn(eo=qn(eo=Jn((ao=function(t){function e(){var e;return(e=t.call(this)||this).slideEvents=no&&no(),e._handle=oo&&oo(),e._direction=ro&&ro(),e._progress=so&&so(),e._offset=new C,e._dragging=!1,e._touchHandle=!1,e._handleLocalPos=new C,e._touchPos=new C,e}i(e,t);var n=e.prototype;return n.__preload=function(){this._updateHandlePosition()},n.onEnable=function(){var t=this,e=t.node,i=t._handle;if(t._updateHandlePosition(),e.on(at.TOUCH_START,t._onTouchBegan,t),e.on(at.TOUCH_MOVE,t._onTouchMoved,t),e.on(at.TOUCH_END,t._onTouchEnded,t),e.on(at.TOUCH_CANCEL,t._onTouchCancelled,t),e.on(ut.XRUI_HOVER_STAY,t._xrHoverStay,t),e.on(ut.XRUI_CLICK,t._xrClick,t),e.on(ut.XRUI_UNCLICK,t._xrUnClick,t),i&&i.isValid){var n=i.node;n.on(at.TOUCH_START,t._onHandleDragStart,t),n.on(at.TOUCH_MOVE,t._onTouchMoved,t),n.on(at.TOUCH_END,t._onTouchEnded,t)}},n.onDisable=function(){var t=this,e=t.node,i=t._handle;if(e.off(at.TOUCH_START,t._onTouchBegan,t),e.off(at.TOUCH_MOVE,t._onTouchMoved,t),e.off(at.TOUCH_END,t._onTouchEnded,t),e.off(at.TOUCH_CANCEL,t._onTouchCancelled,t),e.off(ut.XRUI_HOVER_STAY,t._xrHoverStay,t),e.off(ut.XRUI_CLICK,t._xrClick,t),e.off(ut.XRUI_UNCLICK,t._xrUnClick,t),i&&i.isValid){var n=i.node;n.off(at.TOUCH_START,t._onHandleDragStart,t),n.off(at.TOUCH_MOVE,t._onTouchMoved,t),n.off(at.TOUCH_END,t._onTouchEnded,t)}},n._onHandleDragStart=function(t){if(t&&this._handle&&this._handle.node._getUITransformComp()){this._dragging=!0,this._touchHandle=!0;var e=t.touch.getUILocation();C.set(this._touchPos,e.x,e.y,0),this._handle.node._getUITransformComp().convertToNodeSpaceAR(this._touchPos,this._offset),t.propagationStopped=!0}},n._onTouchBegan=function(t){this._handle&&t&&(this._dragging=!0,this._touchHandle||this._handleSliderLogic(t.touch),t.propagationStopped=!0)},n._onTouchMoved=function(t){this._dragging&&t&&(this._handleSliderLogic(t.touch),t.propagationStopped=!0)},n._onTouchEnded=function(t){this._dragging=!1,this._touchHandle=!1,this._offset=new C,t&&(t.propagationStopped=!0)},n._onTouchCancelled=function(t){this._dragging=!1,t&&(t.propagationStopped=!0)},n._handleSliderLogic=function(t){this._updateProgress(t),this._emitSlideEvent()},n._emitSlideEvent=function(){ht.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},n._updateProgress=function(t){if(this._handle&&t){var e=t.getUILocation();C.set(this._touchPos,e.x,e.y,0);var i=this.node._getUITransformComp(),n=i.convertToNodeSpaceAR(this._touchPos,lo);this.direction===co.Horizontal?this.progress=w(.5+(n.x-this._offset.x)/i.width):this.progress=w(.5+(n.y-this._offset.y)/i.height)}},n._updateHandlePosition=function(){if(this._handle){this._handleLocalPos.set(this._handle.node.position);var t=this.node._getUITransformComp();this._direction===co.Horizontal?this._handleLocalPos.x=-t.width*t.anchorX+this.progress*t.width:this._handleLocalPos.y=-t.height*t.anchorY+this.progress*t.height,this._handle.node.setPosition(this._handleLocalPos)}},n._changeLayout=function(){var t=this.node._getUITransformComp(),e=t.contentSize;if(t.setContentSize(e.height,e.width),this._handle){var i=this._handle.node.position;this._direction===co.Horizontal?this._handle.node.setPosition(i.x,0,i.z):this._handle.node.setPosition(0,i.y,i.z),this._updateHandlePosition()}},n._xrHandleProgress=function(t){if(!this._touchHandle){var e=this.node._getUITransformComp();e.convertToNodeSpaceAR(t,lo),this.direction===co.Horizontal?this.progress=w(.5+(lo.x-this.node.position.x)/e.width):this.progress=w(.5+(lo.y-this.node.position.y)/e.height)}},n._xrClick=function(t){this._handle&&(this._dragging=!0,this._xrHandleProgress(t.hitPoint),this._emitSlideEvent())},n._xrUnClick=function(){this._dragging=!1,this._touchHandle=!1},n._xrHoverStay=function(t){this._dragging&&(this._xrHandleProgress(t.hitPoint),this._emitSlideEvent())},o(e,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._changeLayout())}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateHandlePosition())}}]),e}(ct),ao.Direction=co,r((io=ao).prototype,"handle",[Qn],Object.getOwnPropertyDescriptor(io.prototype,"handle"),io.prototype),r(io.prototype,"direction",[$n],Object.getOwnPropertyDescriptor(io.prototype,"direction"),io.prototype),no=S(io.prototype,"slideEvents",[to,A],(function(){return[]})),oo=S(io.prototype,"_handle",[A],(function(){return null})),ro=S(io.prototype,"_direction",[A],(function(){return co.Horizontal})),so=S(io.prototype,"_progress",[A],(function(){return.1})),eo=io))||eo)||eo)||eo);function Lo(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return Object.assign.apply(Object,[{}].concat(e))}t({Slider:Oo,SliderComponent:Oo}),Z.Slider=Oo,function(t){t.TOGGLE="toggle"}(Eo||(Eo={}));var Ao,Io,bo,Do,Ro,xo,No,wo=(_o=T("cc.Toggle"),uo=E(110),po=O(_t),go=v(q),fo=v([ht]),_o(yo=uo(yo=po((So=function(t){function e(){var e;return(e=t.call(this)||this).checkEvents=vo&&vo(),e._isChecked=mo&&mo(),e._checkMark=Co&&Co(),e}i(e,t);var n=e.prototype;return n._internalToggle=function(){this.isChecked=!this.isChecked},n._set=function(t,e){if(void 0===e&&(e=!0),this._isChecked!=t){this._isChecked=t;var i=this._toggleContainer;i&&i.enabled&&this.enabled&&(t||!i.anyTogglesChecked()&&!i.allowSwitchOff)&&(this._isChecked=!0,i.notifyToggleCheck(this,e)),this.playEffect(),e&&this._emitToggleEvents()}},n.playEffect=function(){this._checkMark&&(this._checkMark.node.active=this._isChecked)},n.setIsCheckedWithoutNotify=function(t){this._set(t,!1)},n.onEnable=function(){t.prototype.onEnable.call(this),this.playEffect(),this.node.on(e.EventType.CLICK,this._internalToggle,this)},n.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(e.EventType.CLICK,this._internalToggle,this)},n._emitToggleEvents=function(){this.node.emit(e.EventType.TOGGLE,this),this.checkEvents&&ht.emitEvents(this.checkEvents,this)},o(e,[{key:"isChecked",get:function(){return this._isChecked},set:function(t){this._set(t)}},{key:"checkMark",get:function(){return this._checkMark},set:function(t){this._checkMark!==t&&(this._checkMark=t)}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"_toggleContainer",get:function(){var t=this.node.parent;return Z.Node.isNode(t)?t.getComponent("cc.ToggleContainer"):null}}]),e}(se),So.EventType=Lo(Eo,ne),r((To=So).prototype,"checkMark",[go],Object.getOwnPropertyDescriptor(To.prototype,"checkMark"),To.prototype),vo=S(To.prototype,"checkEvents",[fo,A],(function(){return[]})),mo=S(To.prototype,"_isChecked",[A],(function(){return!0})),Co=S(To.prototype,"_checkMark",[A],(function(){return null})),yo=To))||yo)||yo)||yo);t({Toggle:wo,ToggleComponent:wo}),Z.Toggle=wo;var Bo,Ho,Po,Mo,zo,ko,Vo,Uo,Fo,Go,Wo,jo,Zo,Xo,Yo,Ko,qo,Jo,Qo,$o,tr,er,ir,nr,or,rr,sr=(Ao=T("cc.ToggleContainer"),Io=E(110),bo=v([ht]),Ao(Do=Io((Ro=function(t){function e(){var e;return(e=t.call(this)||this)._allowSwitchOff=xo&&xo(),e.checkEvents=No&&No(),e}i(e,t);var n=e.prototype;return n.onEnable=function(){this.ensureValidState(),this.node.on(at.CHILD_ADDED,this.ensureValidState,this),this.node.on(at.CHILD_REMOVED,this.ensureValidState,this)},n.onDisable=function(){this.node.off(at.CHILD_ADDED,this.ensureValidState,this),this.node.off(at.CHILD_REMOVED,this.ensureValidState,this)},n.activeToggles=function(){return this.toggleItems.filter((function(t){return t.isChecked}))},n.anyTogglesChecked=function(){return!!this.toggleItems.find((function(t){return t.isChecked}))},n.notifyToggleCheck=function(t,e){if(void 0===e&&(e=!0),this.enabledInHierarchy){for(var i=0;i<this.toggleItems.length;i++){var n=this.toggleItems[i];n!==t&&(e?n.isChecked=!1:n.setIsCheckedWithoutNotify(!1))}this.checkEvents&&Z.Component.EventHandler.emitEvents(this.checkEvents,t)}},n.ensureValidState=function(){var t=this.toggleItems;if(!this._allowSwitchOff&&!this.anyTogglesChecked()&&0!==t.length){var e=t[0];e.isChecked=!0,this.notifyToggleCheck(e)}var i=this.activeToggles();if(i.length>1)for(var n=i[0],o=0;o<i.length;++o){var r=i[o];r!==n&&(r.isChecked=!1)}},o(e,[{key:"allowSwitchOff",get:function(){return this._allowSwitchOff},set:function(t){this._allowSwitchOff=t}},{key:"toggleItems",get:function(){return this.node.children.map((function(t){var e=t.getComponent("cc.Toggle");return e&&e.enabled?e:null})).filter(Boolean)}}]),e}(ct),xo=S(Ro.prototype,"_allowSwitchOff",[A],(function(){return!1})),No=S(Ro.prototype,"checkEvents",[bo,A],(function(){return[]})),Do=Ro))||Do)||Do);t({ToggleContainer:sr,ToggleContainerComponent:sr}),Z.ToggleContainer=sr;var ar,hr,cr=new N;function lr(t){var e=t._getUITransformComp();return t instanceof ot?R:e?e.contentSize:x.ZERO}function _r(t,e,i,n){t.parent?cr.set(t.parent.scale.x,t.parent.scale.y):cr.set(0,0);for(var o=cr.x,r=cr.y,s=0,a=0,h=t.parent;;){if(!h)return i.x=i.y=0,void(n.x=n.y=1);var c=h.position;if(s+=c.x,a+=c.y,(h=h.parent)===e)break;h?cr.set(h.scale.x,h.scale.y):cr.set(0,0);var l=cr.x,_=cr.y;s*=l,a*=_,o*=l,r*=_}n.x=0!==o?1/o:1,n.y=0!==r?1/r:1,i.x=-s,i.y=-a}!function(t){t[t.ONCE=0]="ONCE",t[t.ALWAYS=1]="ALWAYS",t[t.ON_WINDOW_RESIZE=2]="ON_WINDOW_RESIZE"}(ar||(ar={})),e(ar),function(t){t[t.TOP=1]="TOP",t[t.MID=2]="MID",t[t.BOT=4]="BOT",t[t.LEFT=8]="LEFT",t[t.CENTER=16]="CENTER",t[t.RIGHT=32]="RIGHT",t[t.HORIZONTAL=56]="HORIZONTAL",t[t.VERTICAL=7]="VERTICAL"}(hr||(hr={}));var ur,dr,pr,gr,fr,yr,Tr,vr,mr,Cr,Sr,Er,Or=hr.TOP|hr.BOT,Lr=hr.LEFT|hr.RIGHT,Ar=(Bo=T("cc.Widget"),Ho=E(110),Po=O(_t),Mo=v(nt),zo=v(ar),Bo(ko=Ho(ko=Po((rr=function(t){function e(){var e;return(e=t.call(this)||this)._lastPos=new C,e._lastSize=new x,e._dirty=!0,e._hadAlignOnce=!1,e._alignFlags=Uo&&Uo(),e._target=Fo&&Fo(),e._left=Go&&Go(),e._right=Wo&&Wo(),e._top=jo&&jo(),e._bottom=Zo&&Zo(),e._horizontalCenter=Xo&&Xo(),e._verticalCenter=Yo&&Yo(),e._isAbsLeft=Ko&&Ko(),e._isAbsRight=qo&&qo(),e._isAbsTop=Jo&&Jo(),e._isAbsBottom=Qo&&Qo(),e._isAbsHorizontalCenter=$o&&$o(),e._isAbsVerticalCenter=tr&&tr(),e._originalWidth=er&&er(),e._originalHeight=ir&&ir(),e._alignMode=nr&&nr(),e._lockFlags=or&&or(),e}i(e,t);var n=e.prototype;return n.updateAlignment=function(){Y._widgetManager.updateAlignment(this.node)},n._validateTargetInDEV=function(){},n.setDirty=function(){this._recursiveDirty()},n.onEnable=function(){this.node.getPosition(this._lastPos),this._lastSize.set(this.node._getUITransformComp().contentSize),Y._widgetManager.add(this),this._hadAlignOnce=!1,this._registerEvent(),this._registerTargetEvents()},n.onDisable=function(){Y._widgetManager.remove(this),this._unregisterEvent(),this._unregisterTargetEvents()},n.onDestroy=function(){this._removeParentEvent()},n._adjustWidgetToAllowMovingInEditor=function(){},n._adjustWidgetToAllowResizingInEditor=function(){},n._adjustWidgetToAnchorChanged=function(){this.setDirty()},n._adjustTargetToParentChanged=function(t){t&&this._unregisterOldParentEvents(t),this.node.getParent()&&this._registerTargetEvents(),this._setDirtyByMode()},n._registerEvent=function(){this.node.on(at.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.on(at.SIZE_CHANGED,this._setDirtyByMode,this),this.node.on(at.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this),this.node.on(at.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},n._unregisterEvent=function(){this.node.off(at.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.off(at.SIZE_CHANGED,this._setDirtyByMode,this),this.node.off(at.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this)},n._removeParentEvent=function(){this.node.off(at.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},n._autoChangedValue=function(t,e){if((this._alignFlags&t)>0){var i=this.node.parent&&this.node.parent._uiProps,n=i&&i.uiTransformComp,o=n?n.contentSize:R;this.isAlignLeft&&t===hr.LEFT?this._left=e?this._left*o.width:this._left/o.width:this.isAlignRight&&t===hr.RIGHT?this._right=e?this._right*o.width:this._right/o.width:this.isAlignHorizontalCenter&&t===hr.CENTER?this._horizontalCenter=e?this._horizontalCenter*o.width:this._horizontalCenter/o.width:this.isAlignTop&&t===hr.TOP?this._top=e?this._top*o.height:this._top/o.height:this.isAlignBottom&&t===hr.BOT?this._bottom=e?this._bottom*o.height:this._bottom/o.height:this.isAbsoluteVerticalCenter&&t===hr.MID&&(this._verticalCenter=this._verticalCenter/o.height),this._recursiveDirty()}},n._registerTargetEvents=function(){var t=this._target||this.node.parent;t&&t.getComponent(_t)&&(t.on(at.TRANSFORM_CHANGED,this._setDirtyByMode,this),t.on(at.SIZE_CHANGED,this._setDirtyByMode,this),t.on(at.ANCHOR_CHANGED,this._setDirtyByMode,this))},n._unregisterTargetEvents=function(){var t=this._target||this.node.parent;t&&(t.off(at.TRANSFORM_CHANGED,this._setDirtyByMode,this),t.off(at.SIZE_CHANGED,this._setDirtyByMode,this),t.off(at.ANCHOR_CHANGED,this._setDirtyByMode,this))},n._unregisterOldParentEvents=function(t){var e=this._target||t;e&&(e.off(at.TRANSFORM_CHANGED,this._setDirtyByMode,this),e.off(at.SIZE_CHANGED,this._setDirtyByMode,this),e.off(at.ANCHOR_CHANGED,this._setDirtyByMode,this))},n._setDirtyByMode=function(){(this.alignMode===ar.ALWAYS||j)&&this._recursiveDirty()},n._setAlign=function(t,e){if(e!==(this._alignFlags&t)>0){var i=(t&Lr)>0,n=this.node._getUITransformComp();e?(this._alignFlags|=t,i?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=n.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=n.height))):(i?this.isStretchWidth&&(n.width=this._originalWidth):this.isStretchHeight&&(n.height=this._originalHeight),this._alignFlags&=~t)}},n._recursiveDirty=function(){this._dirty||(this._dirty=!0)},o(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._unregisterTargetEvents(),this._target=t,this._registerTargetEvents(),this._validateTargetInDEV(),this._recursiveDirty())}},{key:"isAlignTop",get:function(){return(this._alignFlags&hr.TOP)>0},set:function(t){this._setAlign(hr.TOP,t),this._recursiveDirty()}},{key:"isAlignBottom",get:function(){return(this._alignFlags&hr.BOT)>0},set:function(t){this._setAlign(hr.BOT,t),this._recursiveDirty()}},{key:"isAlignLeft",get:function(){return(this._alignFlags&hr.LEFT)>0},set:function(t){this._setAlign(hr.LEFT,t),this._recursiveDirty()}},{key:"isAlignRight",get:function(){return(this._alignFlags&hr.RIGHT)>0},set:function(t){this._setAlign(hr.RIGHT,t),this._recursiveDirty()}},{key:"isAlignVerticalCenter",get:function(){return(this._alignFlags&hr.MID)>0},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=hr.MID):this._alignFlags&=~hr.MID,this._recursiveDirty()}},{key:"isAlignHorizontalCenter",get:function(){return(this._alignFlags&hr.CENTER)>0},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=hr.CENTER):this._alignFlags&=~hr.CENTER,this._recursiveDirty()}},{key:"isStretchWidth",get:function(){return(this._alignFlags&Lr)===Lr}},{key:"isStretchHeight",get:function(){return(this._alignFlags&Or)===Or}},{key:"top",get:function(){return this._top},set:function(t){this._top=t,this._recursiveDirty()}},{key:"editorTop",get:function(){return this._isAbsTop?this._top:100*this._top},set:function(t){this._top=this._isAbsTop?t:t/100,this._recursiveDirty()}},{key:"bottom",get:function(){return this._bottom},set:function(t){this._bottom=t,this._recursiveDirty()}},{key:"editorBottom",get:function(){return this._isAbsBottom?this._bottom:100*this._bottom},set:function(t){this._bottom=this._isAbsBottom?t:t/100,this._recursiveDirty()}},{key:"left",get:function(){return this._left},set:function(t){this._left=t,this._recursiveDirty()}},{key:"editorLeft",get:function(){return this._isAbsLeft?this._left:100*this._left},set:function(t){this._left=this._isAbsLeft?t:t/100,this._recursiveDirty()}},{key:"right",get:function(){return this._right},set:function(t){this._right=t,this._recursiveDirty()}},{key:"editorRight",get:function(){return this._isAbsRight?this._right:100*this._right},set:function(t){this._right=this._isAbsRight?t:t/100,this._recursiveDirty()}},{key:"horizontalCenter",get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t,this._recursiveDirty()}},{key:"editorHorizontalCenter",get:function(){return this._isAbsHorizontalCenter?this._horizontalCenter:100*this._horizontalCenter},set:function(t){this._horizontalCenter=this._isAbsHorizontalCenter?t:t/100,this._recursiveDirty()}},{key:"verticalCenter",get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t,this._recursiveDirty()}},{key:"editorVerticalCenter",get:function(){return this._isAbsVerticalCenter?this._verticalCenter:100*this._verticalCenter},set:function(t){this._verticalCenter=this._isAbsVerticalCenter?t:t/100,this._recursiveDirty()}},{key:"isAbsoluteTop",get:function(){return this._isAbsTop},set:function(t){this._isAbsTop!==t&&(this._isAbsTop=t,this._autoChangedValue(hr.TOP,this._isAbsTop))}},{key:"isAbsoluteBottom",get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom!==t&&(this._isAbsBottom=t,this._autoChangedValue(hr.BOT,this._isAbsBottom))}},{key:"isAbsoluteLeft",get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft!==t&&(this._isAbsLeft=t,this._autoChangedValue(hr.LEFT,this._isAbsLeft))}},{key:"isAbsoluteRight",get:function(){return this._isAbsRight},set:function(t){this._isAbsRight!==t&&(this._isAbsRight=t,this._autoChangedValue(hr.RIGHT,this._isAbsRight))}},{key:"isAbsoluteHorizontalCenter",get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter!==t&&(this._isAbsHorizontalCenter=t,this._autoChangedValue(hr.CENTER,this._isAbsHorizontalCenter))}},{key:"isAbsoluteVerticalCenter",get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter!==t&&(this._isAbsVerticalCenter=t,this._autoChangedValue(hr.MID,this._isAbsVerticalCenter))}},{key:"alignMode",get:function(){return this._alignMode},set:function(t){this._alignMode=t,this._recursiveDirty()}},{key:"alignFlags",get:function(){return this._alignFlags},set:function(t){this._alignFlags!==t&&(this._alignFlags=t,this._recursiveDirty())}}]),e}(ct),rr.AlignMode=ar,r((Vo=rr).prototype,"target",[Mo],Object.getOwnPropertyDescriptor(Vo.prototype,"target"),Vo.prototype),r(Vo.prototype,"alignMode",[zo],Object.getOwnPropertyDescriptor(Vo.prototype,"alignMode"),Vo.prototype),Uo=S(Vo.prototype,"_alignFlags",[A],(function(){return 0})),Fo=S(Vo.prototype,"_target",[A],(function(){return null})),Go=S(Vo.prototype,"_left",[A],(function(){return 0})),Wo=S(Vo.prototype,"_right",[A],(function(){return 0})),jo=S(Vo.prototype,"_top",[A],(function(){return 0})),Zo=S(Vo.prototype,"_bottom",[A],(function(){return 0})),Xo=S(Vo.prototype,"_horizontalCenter",[A],(function(){return 0})),Yo=S(Vo.prototype,"_verticalCenter",[A],(function(){return 0})),Ko=S(Vo.prototype,"_isAbsLeft",[A],(function(){return!0})),qo=S(Vo.prototype,"_isAbsRight",[A],(function(){return!0})),Jo=S(Vo.prototype,"_isAbsTop",[A],(function(){return!0})),Qo=S(Vo.prototype,"_isAbsBottom",[A],(function(){return!0})),$o=S(Vo.prototype,"_isAbsHorizontalCenter",[A],(function(){return!0})),tr=S(Vo.prototype,"_isAbsVerticalCenter",[A],(function(){return!0})),er=S(Vo.prototype,"_originalWidth",[A],(function(){return 0})),ir=S(Vo.prototype,"_originalHeight",[A],(function(){return 0})),nr=S(Vo.prototype,"_alignMode",[A],(function(){return ar.ON_WINDOW_RESIZE})),or=S(Vo.prototype,"_lockFlags",[A,P],(function(){return 0})),ko=Vo))||ko)||ko)||ko);t({Widget:Ar,WidgetComponent:Ar}),Y.internal.computeInverseTransForTarget=_r,Y.internal.getReadonlyNodeSize=lr,Y.Widget=Ar;var Ir,br=new y;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(Ir||(Ir={})),e(Ir);var Dr,Rr,xr,Nr,wr,Br,Hr,Pr,Mr,zr,kr,Vr,Ur,Fr,Gr,Wr,jr,Zr,Xr,Yr,Kr,qr,Jr,Qr,$r=(ur=T("cc.PageViewIndicator"),dr=E(110),pr=v(K),gr=v(Ir),fr=v(x),ur(yr=dr((Er=function(t){function e(){var e;return(e=t.call(this)||this).spacing=vr&&vr(),e._spriteFrame=mr&&mr(),e._direction=Cr&&Cr(),e._cellSize=Sr&&Sr(),e._layout=null,e._pageView=null,e._indicators=[],e}i(e,t);var n=e.prototype;return n.onLoad=function(){this._updateLayout()},n.setPageView=function(t){this._pageView=t,this._refresh()},n._updateLayout=function(){this._layout=this.getComponent(ji),this._layout||(this._layout=this.addComponent(ji));var t=this._layout;this.direction===Ir.HORIZONTAL?(t.type=Ei.HORIZONTAL,t.spacingX=this.spacing):this.direction===Ir.VERTICAL&&(t.type=Ei.VERTICAL,t.spacingY=this.spacing),t.resizeMode=Oi.CONTAINER},n._createIndicator=function(){var t=new nt;t.layer=this.node.layer;var e=t.addComponent(q);return e.spriteFrame=this.spriteFrame,e.sizeMode=q.SizeMode.CUSTOM,t.parent=this.node,t._getUITransformComp().setContentSize(this._cellSize),t},n._changedState=function(){var t=this._indicators;if(0!==t.length&&this._pageView){var e=this._pageView.curPageIdx;if(!(e>=t.length)){for(var i=0;i<t.length;++i){var n=t[i];if(n._uiProps.uiComp){var o=n._uiProps.uiComp;br.set(o.color),br.a=127.5,o.color=br}}if(t[e]._uiProps.uiComp){var r=t[e]._uiProps.uiComp;br.set(r.color),br.a=255,r.color=br}}}},n._refresh=function(){if(this._pageView){var t=this._indicators,e=this._pageView.getPages();if(e.length!==t.length){var i=0;if(e.length>t.length)for(i=0;i<e.length;++i)t[i]||(t[i]=this._createIndicator());else for(i=t.length-e.length;i>0;--i){var n=t[i-1];this.node.removeChild(n),t.splice(i-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}}},o(e,[{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._spriteFrame!==t&&(this._spriteFrame=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t)}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize=t)}}]),e}(ct),Er.Direction=Ir,r((Tr=Er).prototype,"spriteFrame",[pr],Object.getOwnPropertyDescriptor(Tr.prototype,"spriteFrame"),Tr.prototype),r(Tr.prototype,"direction",[gr],Object.getOwnPropertyDescriptor(Tr.prototype,"direction"),Tr.prototype),r(Tr.prototype,"cellSize",[fr],Object.getOwnPropertyDescriptor(Tr.prototype,"cellSize"),Tr.prototype),vr=S(Tr.prototype,"spacing",[A],(function(){return 0})),mr=S(Tr.prototype,"_spriteFrame",[A],(function(){return null})),Cr=S(Tr.prototype,"_direction",[A],(function(){return Ir.HORIZONTAL})),Sr=S(Tr.prototype,"_cellSize",[A],(function(){return new x(20,20)})),yr=Tr))||yr)||yr);t({PageViewIndicator:$r,PageViewIndicatorComponent:$r}),Z.PageViewIndicator=$r;var ts,es,is,ns=new N;!function(t){t[t.Unified=0]="Unified",t[t.Free=1]="Free"}(ts||(ts={})),e(ts),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(es||(es={})),e(es),function(t){t.PAGE_TURNING="page-turning"}(is||(is={}));var os=(Dr=T("cc.PageView"),Rr=E(110),xr=v(ts),Nr=v(es),wr=v($r),Br=v(gn),Hr=v(gn),Pr=v([ht]),Mr=v([ht]),Dr(zr=Rr((Qr=function(t){function e(){var e;return(e=t.call(this)||this).autoPageTurningThreshold=Vr&&Vr(),e.horizontal=Ur&&Ur(),e.vertical=Fr&&Fr(),e.cancelInnerEvents=Gr&&Gr(),e.scrollEvents=Wr&&Wr(),e.pageTurningSpeed=jr&&jr(),e.pageEvents=Zr&&Zr(),e._sizeMode=Xr&&Xr(),e._direction=Yr&&Yr(),e._scrollThreshold=Kr&&Kr(),e._pageTurningEventTiming=qr&&qr(),e._indicator=Jr&&Jr(),e._curPageIdx=0,e._lastPageIdx=0,e._pages=[],e._initContentPos=L(),e._scrollCenterOffsetX=[],e._scrollCenterOffsetY=[],e._touchBeganPosition=B(),e._touchEndPosition=B(),e}i(e,t);var n=e.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(at.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.on(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},n.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(at.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.off(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},n.onLoad=function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},n.getCurrentPageIndex=function(){return this._curPageIdx},n.setCurrentPageIndex=function(t){this.scrollToPage(t,1)},n.getPages=function(){return this._pages},n.addPage=function(t){t&&-1===this._pages.indexOf(t)&&this.content&&(t._getUITransformComp()?(this.content.addChild(t),this._pages.push(t),this._updatePageView()):_(4301))},n.insertPage=function(t,e){if(!(e<0)&&t&&-1===this._pages.indexOf(t)&&this.content)if(e>=this._pages.length)this.addPage(t);else{if(!t._getUITransformComp())return void _(4301);this._pages.splice(e,0,t),this.content.insertChild(t,e),this._updatePageView()}},n.removePage=function(t){if(t&&this.content){var e=this._pages.indexOf(t);-1!==e?this.removePageAtIndex(e):l(4300,t.name)}},n.removePageAtIndex=function(t){var e=this._pages;if(!(t<0||t>=e.length)){var i=e[t];i&&this.content&&(this.content.removeChild(i),e.splice(t,1),this._updatePageView())}},n.removeAllPages=function(){if(this.content){for(var t=this._pages,e=0,i=t.length;e<i;e++)this.content.removeChild(t[e]);this._pages.length=0,this._updatePageView()}},n.scrollToPage=function(t,e){void 0===e&&(e=.3),t<0||t>=this._pages.length||(this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),e,!0),this.indicator&&this.indicator._changedState())},n.getScrollEndedEventTiming=function(){return this.pageTurningEventTiming},n._updatePageView=function(){if(this.content){var t=this.content.getComponent(ji);t&&t.enabled&&t.updateLayout();var e=this._pages.length;this._curPageIdx>=e&&(this._curPageIdx=0===e?0:e-1,this._lastPageIdx=this._curPageIdx);for(var i=this._initContentPos,n=0;n<e;++n){var o=this._pages[n].position;this.direction===es.HORIZONTAL?this._scrollCenterOffsetX[n]=Math.abs(i.x+o.x):this._scrollCenterOffsetY[n]=Math.abs(i.y+o.y)}this.indicator&&this.indicator._refresh()}},n._updateAllPagesSize=function(){var t=this.view;if(this.content&&t&&this._sizeMode===ts.Unified)for(var e=this._pages,i=t.contentSize,n=0,o=e.length;n<o;n++)e[n]._getUITransformComp().setContentSize(i)},n._handleReleaseLogic=function(){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(e.EventType.SCROLL_ENDED))},n._onTouchBegan=function(e,i){e.touch.getUILocation(ns),N.set(this._touchBeganPosition,ns.x,ns.y),t.prototype._onTouchBegan.call(this,e,i)},n._onTouchMoved=function(e,i){t.prototype._onTouchMoved.call(this,e,i)},n._onTouchEnded=function(e,i){e.touch.getUILocation(ns),N.set(this._touchEndPosition,ns.x,ns.y),t.prototype._onTouchEnded.call(this,e,i)},n._onTouchCancelled=function(e,i){e.touch.getUILocation(ns),N.set(this._touchEndPosition,ns.x,ns.y),t.prototype._onTouchCancelled.call(this,e,i)},n._onMouseWheel=function(){},n._syncScrollDirection=function(){this.horizontal=this.direction===es.HORIZONTAL,this.vertical=this.direction===es.VERTICAL},n._syncSizeMode=function(){var t=this.view;if(this.content&&t){var e=this.content.getComponent(ji);if(e){if(this._sizeMode===ts.Free&&this._pages.length>0){var i=this._pages[0]._getUITransformComp(),n=this._pages[this._pages.length-1]._getUITransformComp();this.direction===es.HORIZONTAL?(e.paddingLeft=(t.width-i.width)/2,e.paddingRight=(t.width-n.width)/2):this.direction===es.VERTICAL&&(e.paddingTop=(t.height-i.height)/2,e.paddingBottom=(t.height-n.height)/2)}e.updateLayout()}}},n._initPages=function(){if(this.content){this._initContentPos=this.content.position;for(var t=this.content.children,e=0;e<t.length;++e){var i=t[e];this._pages.indexOf(i)>=0||this._pages.push(i)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},n._dispatchPageTurningEvent=function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,ht.emitEvents(this.pageEvents,this,is.PAGE_TURNING),this.node.emit(is.PAGE_TURNING,this))},n._isQuicklyScrollable=function(t){if(this.direction===es.HORIZONTAL){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===es.VERTICAL&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1},n._moveOffsetValue=function(t){var e=new N;if(this._sizeMode===ts.Free)this.direction===es.HORIZONTAL?e.x=this._scrollCenterOffsetX[t]:this.direction===es.VERTICAL&&(e.y=this._scrollCenterOffsetY[t]);else{var i=this.view;if(!i)return e;this.direction===es.HORIZONTAL?e.x=t*i.width:this.direction===es.VERTICAL&&(e.y=t*i.height)}return e},n._getDragDirection=function(t){return this._direction===es.HORIZONTAL?0===t.x?0:t.x>0?1:-1:0===t.y?0:t.y<0?1:-1},n._isScrollable=function(t,e,i){if(this._sizeMode===ts.Free){var n=0,o=0;if(this.direction===es.HORIZONTAL)return n=this._scrollCenterOffsetX[e],o=this._scrollCenterOffsetX[i],Math.abs(t.x)>=Math.abs(n-o)*this.scrollThreshold;if(this.direction===es.VERTICAL)return n=this._scrollCenterOffsetY[e],o=this._scrollCenterOffsetY[i],Math.abs(t.y)>=Math.abs(n-o)*this.scrollThreshold}else{var r=this.view;if(!r)return!1;if(this.direction===es.HORIZONTAL)return Math.abs(t.x)>=r.width*this.scrollThreshold;if(this.direction===es.VERTICAL)return Math.abs(t.y)>=r.height*this.scrollThreshold}return!1},n._autoScrollToPage=function(){if(this._startBounceBackIfNeeded()){var t=this._getHowMuchOutOfBoundary();this._clampDelta(t),(t.x>0||t.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(t.x<0||t.y>0)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{var e=new N;N.subtract(e,this._touchBeganPosition,this._touchEndPosition);var i=this._curPageIdx,n=i+this._getDragDirection(e),o=this.pageTurningSpeed*Math.abs(i-n);if(n<this._pages.length){if(this._isScrollable(e,i,n))return void this.scrollToPage(n,o);var r=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(r))return void this.scrollToPage(n,o)}this.scrollToPage(i,o)}},o(e,[{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,this._syncSizeMode())}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._syncScrollDirection())}},{key:"scrollThreshold",get:function(){return this._scrollThreshold},set:function(t){this._scrollThreshold!==t&&(this._scrollThreshold=t)}},{key:"pageTurningEventTiming",get:function(){return this._pageTurningEventTiming},set:function(t){this._pageTurningEventTiming!==t&&(this._pageTurningEventTiming=t)}},{key:"indicator",get:function(){return this._indicator},set:function(t){this._indicator!==t&&(this._indicator=t,this.indicator&&this.indicator.setPageView(this))}},{key:"curPageIdx",get:function(){return this._curPageIdx}},{key:"verticalScrollBar",get:function(){return t.prototype.verticalScrollBar},set:function(t){this.verticalScrollBar=t}},{key:"horizontalScrollBar",get:function(){return t.prototype.horizontalScrollBar},set:function(t){this.horizontalScrollBar=t}}]),e}(ho),Qr.SizeMode=ts,Qr.Direction=es,Qr.EventType=Lo(is,zn),r((kr=Qr).prototype,"sizeMode",[xr],Object.getOwnPropertyDescriptor(kr.prototype,"sizeMode"),kr.prototype),r(kr.prototype,"direction",[Nr],Object.getOwnPropertyDescriptor(kr.prototype,"direction"),kr.prototype),r(kr.prototype,"indicator",[wr],Object.getOwnPropertyDescriptor(kr.prototype,"indicator"),kr.prototype),Vr=S(kr.prototype,"autoPageTurningThreshold",[A],(function(){return 100})),r(kr.prototype,"verticalScrollBar",[Br,M],Object.getOwnPropertyDescriptor(kr.prototype,"verticalScrollBar"),kr.prototype),r(kr.prototype,"horizontalScrollBar",[Hr,M],Object.getOwnPropertyDescriptor(kr.prototype,"horizontalScrollBar"),kr.prototype),Ur=S(kr.prototype,"horizontal",[M,A],(function(){return!0})),Fr=S(kr.prototype,"vertical",[M,A],(function(){return!0})),Gr=S(kr.prototype,"cancelInnerEvents",[M,A],(function(){return!0})),Wr=S(kr.prototype,"scrollEvents",[Pr,A,M],(function(){return[]})),jr=S(kr.prototype,"pageTurningSpeed",[A],(function(){return.3})),Zr=S(kr.prototype,"pageEvents",[Mr,A],(function(){return[]})),Xr=S(kr.prototype,"_sizeMode",[A],(function(){return ts.Unified})),Yr=S(kr.prototype,"_direction",[A],(function(){return es.HORIZONTAL})),Kr=S(kr.prototype,"_scrollThreshold",[A],(function(){return.5})),qr=S(kr.prototype,"_pageTurningEventTiming",[A],(function(){return.1})),Jr=S(kr.prototype,"_indicator",[A],(function(){return null})),zr=kr))||zr)||zr);t({PageView:os,PageViewComponent:os}),Z.PageView=os;var rs=new C,ss=new N,as=new N,hs=new N(1,1),cs=new N,ls=new N;function _s(t,e){if(!e._hadAlignOnce){e.alignMode===ar.ONCE&&(e._hadAlignOnce=!0);var i,n=e.target,o=as,r=hs;n?_r(t,i=n,o,r):i=t.parent;var s=lr(i),a=i instanceof ot||!i.getComponent(_t),h=a?ss:i.getComponent(_t).anchorPoint,c=a;t.getPosition(rs);var l=t._getUITransformComp(),_=rs.x,u=rs.y,d=l.anchorPoint,p=t.scale;if(e.alignFlags&hr.HORIZONTAL){var g=0,f=0,y=s.width;c?(g=R.left.x,f=R.right.x):f=(g=-h.x*y)+y,g+=e.isAbsoluteLeft?e.left:e.left*y,f-=e.isAbsoluteRight?e.right:e.right*y,n&&(g+=o.x,g*=r.x,f+=o.x,f*=r.x);var T=0,v=d.x,m=p.x;if(m<0&&(v=1-v,m=-m),e.isStretchWidth)T=f-g,0!==m&&(l.width=T/m),_=g+v*T;else{if(T=l.width*m,e.isAlignHorizontalCenter){var S=e.isAbsoluteHorizontalCenter?e.horizontalCenter:e.horizontalCenter*y,E=(.5-h.x)*s.width;n&&(S*=r.x,E+=o.x,E*=r.x),_=E+(v-.5)*T+S}else _=e.isAlignLeft?g+v*T:f+(v-1)*T;H(m,0,z)?T=l.width:T/=m}e._lastSize.width=T}if(e.alignFlags&hr.VERTICAL){var O=0,L=0,A=s.height;c?(L=R.bottom.y,O=R.top.y):O=(L=-h.y*A)+A,L+=e.isAbsoluteBottom?e.bottom:e.bottom*A,O-=e.isAbsoluteTop?e.top:e.top*A,n&&(L+=o.y,L*=r.y,O+=o.y,O*=r.y);var I=0,b=d.y,D=p.y;if(D<0&&(b=1-b,D=-D),e.isStretchHeight)I=O-L,0!==D&&(l.height=I/D),u=L+b*I;else{if(I=l.height*D,e.isAlignVerticalCenter){var x=e.isAbsoluteVerticalCenter?e.verticalCenter:e.verticalCenter*A,N=(.5-h.y)*s.height;n&&(x*=r.y,N+=o.y,N*=r.y),u=N+(b-.5)*I+x}else u=e.isAlignBottom?L+b*I:O+(b-1)*I;H(D,0,z)?I=l.height:I/=D}e._lastSize.height=I}t.setPosition(_,u,rs.z),C.set(e._lastPos,_,u,rs.z)}}function us(t){var e=t.getComponent(Ar);if(e&&e.enabled){if(!Y.isValid(t,!0))return;ys.push(e)}for(var i,n=t.children,o=p(n);!(i=o()).done;){var r=i.value;r.active&&us(r)}}function ds(){var t=gt.getScene();if(t){Ts.isAligning=!0,Ts._nodesOrderDirty&&(ys.length=0,us(t),Ts._nodesOrderDirty=!1);var e=null,i=Ts._activeWidgetsIterator;for(i.i=0;i.i<ys.length;++i.i)(e=ys[i.i])._dirty&&(_s(e.node,e),e._dirty=!1);Ts.isAligning=!1}}var ps,gs,fs,ys=[],Ts=t("widgetManager",Y._widgetManager={isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new d(ys),animationState:null,init:function(){gt.on(ft.AFTER_SCENE_LAUNCH,ds),gt.on(ft.AFTER_UPDATE,ds),yt.instance.on("design-resolution-changed",this.onResized,this);var t=this.onResized.bind(this);yt.instance.on("canvas-resize",t),b.on("window-resize",t)},add:function(){this._nodesOrderDirty=!0},remove:function(t){this._activeWidgetsIterator.remove(t)},onResized:function(){var t=gt.getScene();t&&this.refreshWidgetOnResized(t)},refreshWidgetOnResized:function(t){var e=nt.isNode(t)&&t.getComponent(Ar);e&&e.enabled&&(e.alignMode===ar.ON_WINDOW_RESIZE||e.alignMode===ar.ALWAYS)&&e.setDirty();for(var i,n=t.children,o=p(n);!(i=o()).done;){var r=i.value;this.refreshWidgetOnResized(r)}},updateOffsetsToStayPut:function(t,e){function i(t,e){return Math.abs(t-e)>1e-10?e:t}var n=t.node,o=n.parent;if(o){var r=cs;r.set(0,0);var s=ls;if(s.set(1,1),t.target&&_r(n,o=t.target,r,s),!e)return;var a=o._uiProps&&o._getUITransformComp(),h=a?a.anchorPoint:ss,c=n._getUITransformComp(),l=lr(o),_=c.anchorPoint,u=n.position,d=hr,p=n.scale,g=0;if(e&d.LEFT){var f=-h.x*l.width;f+=r.x,f*=s.x,g=u.x-_.x*c.width*Math.abs(p.x)-f,t.isAbsoluteLeft||(g/=l.width),g/=s.x,t.left=i(t.left,g)}if(e&d.RIGHT){var y=(1-h.x)*l.width;y+=r.x,g=(y*=s.x)-(u.x+(1-_.x)*c.width*Math.abs(p.x)),t.isAbsoluteRight||(g/=l.width),g/=s.x,t.right=i(t.right,g)}if(e&d.TOP){var T=(1-h.y)*l.height;T+=r.y,g=(T*=s.y)-(u.y+(1-_.y)*c.height*Math.abs(p.y)),t.isAbsoluteTop||(g/=l.height),g/=s.y,t.top=i(t.top,g)}if(e&d.BOT){var v=-h.y*l.height;v+=r.y,v*=s.y,g=u.y-_.y*c.height*Math.abs(p.y)-v,t.isAbsoluteBottom||(g/=l.height),g/=s.y,t.bottom=i(t.bottom,g)}}},updateAlignment:function t(e){var i=e.parent;i&&nt.isNode(i)&&t(i);var n=e.getComponent(Ar);n&&i&&_s(e,n)},AlignMode:ar,AlignFlags:hr});gt.on(ft.INIT,(function(){Ts.init()}));var vs,ms,Cs,Ss,Es,Os,Ls,As,Is,bs,Ds,Rs,xs=T("cc.SafeArea")(ps=E(110)(ps=O(Ar)((gs=function(t){function e(){var e;return(e=t.call(this)||this)._symmetric=fs&&fs(),e}i(e,t);var n=e.prototype;return n.onEnable=function(){this.updateArea(),b.on("window-resize",this.updateArea,this),b.on("orientation-change",this.updateArea,this)},n.onDisable=function(){b.off("window-resize",this.updateArea,this),b.off("orientation-change",this.updateArea,this)},n.updateArea=function(){var t=this.node.getComponent(Ar),e=this.node.getComponent(_t);if(t&&e){t.updateAlignment();var i=this.node.position.clone(),n=e.anchorPoint.clone();t.isAlignTop=t.isAlignBottom=t.isAlignLeft=t.isAlignRight=!0;var o=vt.getVisibleSize(),r=o.width,s=o.height,a=D.getSafeAreaRect(this._symmetric);t.top=s-a.y-a.height,t.bottom=a.y,t.left=a.x,t.right=r-a.x-a.width,t.updateAlignment();var h=this.node.position.clone(),c=n.x-(h.x-i.x)/e.width,l=n.y-(h.y-i.y)/e.height;e.setAnchorPoint(c,l),Ts.add(t)}},o(e,[{key:"symmetric",get:function(){return this._symmetric},set:function(t){this._symmetric=t}}]),e}(ct),fs=S(gs.prototype,"_symmetric",[A],(function(){return!0})),ps=gs))||ps)||ps)||ps;t({SafeArea:xs,SafeAreaComponent:xs}),Z.SafeArea=xs;var Ns,ws=(vs=T("cc.UICoordinateTracker"),ms=E(110),Cs=v(nt),Ss=v(It),Es=v([ht]),vs(Os=ms((Ls=function(t){function e(){var e;return(e=t.call(this)||this).syncEvents=As&&As(),e._target=Is&&Is(),e._camera=bs&&bs(),e._useScale=Ds&&Ds(),e._distance=Rs&&Rs(),e._transformPos=L(),e._viewPos=L(),e._canMove=!0,e._lastWPos=L(),e._lastCameraPos=L(),e}i(e,t);var n=e.prototype;return n.onEnable=function(){this._checkCanMove()},n.update=function(){var t=this.node.worldPosition,e=this._camera;if(this._canMove&&e&&e.camera&&(!this._lastWPos.equals(t)||!this._lastCameraPos.equals(e.node.worldPosition))&&(this._lastWPos.set(t),this._lastCameraPos.set(e.node.worldPosition),e.camera.update(),e.convertToUINode(t,this._target,this._transformPos),this._useScale&&C.transformMat4(this._viewPos,this.node.worldPosition,e.camera.matView),this.syncEvents.length>0)){var i=this._distance/Math.abs(this._viewPos.z);ht.emitEvents(this.syncEvents,this._transformPos,i)}},n._checkCanMove=function(){this._canMove=!(!this._camera||!this._target)},o(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._target=t,this._checkCanMove())}},{key:"camera",get:function(){return this._camera},set:function(t){this._camera!==t&&(this._camera=t,this._checkCanMove())}},{key:"useScale",get:function(){return this._useScale},set:function(t){this._useScale!==t&&(this._useScale=t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance!==t&&(this._distance=t)}}]),e}(ct),r(Ls.prototype,"target",[Cs],Object.getOwnPropertyDescriptor(Ls.prototype,"target"),Ls.prototype),r(Ls.prototype,"camera",[Ss],Object.getOwnPropertyDescriptor(Ls.prototype,"camera"),Ls.prototype),As=S(Ls.prototype,"syncEvents",[Es,A],(function(){return[]})),Is=S(Ls.prototype,"_target",[A],(function(){return null})),bs=S(Ls.prototype,"_camera",[A],(function(){return null})),Ds=S(Ls.prototype,"_useScale",[A],(function(){return!0})),Rs=S(Ls.prototype,"_distance",[A],(function(){return 1})),Os=Ls))||Os)||Os);t({UICoordinateTracker:ws,UICoordinateTrackerComponent:ws});var Bs=[at.TOUCH_START,at.TOUCH_END,at.TOUCH_MOVE,at.MOUSE_DOWN,at.MOUSE_MOVE,at.MOUSE_UP,at.MOUSE_ENTER,at.MOUSE_LEAVE,at.MOUSE_WHEEL];function Hs(t){t.propagationStopped=!0}var Ps,Ms,zs,ks,Vs=T("cc.BlockInputEvents")(Ns=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var n=e.prototype;return n.onEnable=function(){for(var t=0;t<Bs.length;t++)this.node.on(Bs[t],Hs,this)},n.onDisable=function(){for(var t=0;t<Bs.length;t++)this.node.off(Bs[t],Hs,this)},e}(ct))||Ns;t({BlockInputEvents:Vs,BlockInputEventsComponent:Vs});var Us,Fs=t("SubContextView",T("cc.SubContextView")(Ps=E(110)(Ps=O(_t)((Ms=function(t){function e(){var e;return(e=t.call(this)||this)._fps=zs&&zs(),e._sprite=null,e._imageAsset=new rt,e._texture=new st,e._updatedTime=0,e._updateInterval=0,e._openDataContext=null,e._content=new nt("content"),e._designResolutionSize=ks&&ks(),e._content.hideFlags|=g.DontSave|g.HideInHierarchy,e._updatedTime=performance.now(),e}i(e,t);var n=e.prototype;return n.onLoad=function(){oe.getOpenDataContext?(this._updateInterval=1e3/this._fps,this._openDataContext=oe.getOpenDataContext(),this._initSharedCanvas(),this._initContentNode(),this._updateSubContextView(),this._updateContentLayer()):this.enabled=!1},n.onEnable=function(){this._registerNodeEvent()},n.onDisable=function(){this._unregisterNodeEvent()},n._initSharedCanvas=function(){if(this._openDataContext){var t=this._openDataContext.canvas,e=this._designResolutionSize.width,i=this._designResolutionSize.height;t.width=e,t.height=i}},n._initContentNode=function(){if(this._openDataContext){var t=this._openDataContext.canvas,e=this._imageAsset;if(e.reset(t),this._texture.image=e,this._texture.create(t.width,t.height),this._sprite=this._content.getComponent(q),this._sprite||(this._sprite=this._content.addComponent(q)),this._sprite.spriteFrame)this._sprite.spriteFrame.texture=this._texture;else{var i=new K;i.texture=this._texture,this._sprite.spriteFrame=i}this._content.parent=this.node}},n._updateSubContextView=function(){if(this._openDataContext){var t=this.node.getComponent(_t),e=this._content.getComponent(_t),i=t.width/e.width,n=t.height/e.height,o=i>n?n:i;e.width*=o,e.height*=o;var r=vt.getViewportRect(),s=e.getBoundingBoxToWorld(),a=vt.getVisibleSize(),h=b.devicePixelRatio,c=(r.width*(s.x/a.width)+r.x)/h,l=(r.height*(s.y/a.height)+r.y)/h,_=r.width*(s.width/a.width)/h,u=r.height*(s.height/a.height)/h;this._openDataContext.postMessage({fromEngine:!0,type:"engine",event:"viewport",x:c,y:l,width:_,height:u})}},n._updateSubContextTexture=function(){var t=this._imageAsset;if(t&&this._openDataContext&&!(t.width<=0||t.height<=0)){var e=this._openDataContext.canvas;t.reset(e),(e.width>t.width||e.height>t.height)&&this._texture.create(e.width,e.height),this._texture.uploadData(e)}},n._registerNodeEvent=function(){this.node.on(at.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.on(at.SIZE_CHANGED,this._updateSubContextView,this),this.node.on(at.LAYER_CHANGED,this._updateContentLayer,this)},n._unregisterNodeEvent=function(){this.node.off(at.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.off(at.SIZE_CHANGED,this._updateSubContextView,this),this.node.off(at.LAYER_CHANGED,this._updateContentLayer,this)},n._updateContentLayer=function(){this._content.layer=this.node.layer},n.update=function(t){void 0===t?this._updateSubContextTexture():performance.now()-this._updatedTime>=this._updateInterval&&(this._updatedTime+=this._updateInterval,this._updateSubContextTexture())},n.onDestroy=function(){this._content.destroy(),this._texture.destroy(),this._sprite&&this._sprite.destroy(),this._imageAsset.destroy(),this._openDataContext=null},o(e,[{key:"designResolutionSize",get:function(){return this._designResolutionSize},set:function(){}},{key:"fps",get:function(){return this._fps},set:function(t){this._fps!==t&&(this._fps=t,this._updateInterval=1e3/t)}}]),e}(ct),zs=S(Ms.prototype,"_fps",[A],(function(){return 60})),ks=S(Ms.prototype,"_designResolutionSize",[A],(function(){return new x(640,960)})),Ps=Ms))||Ps)||Ps)||Ps);Z.SubContextView=Fs,k({ButtonComponent:{newName:"Button",since:"1.2.0",removed:!1},EditBoxComponent:{newName:"EditBox",since:"1.2.0",removed:!1},LayoutComponent:{newName:"Layout",since:"1.2.0",removed:!1},ProgressBarComponent:{newName:"ProgressBar",since:"1.2.0",removed:!1},ScrollViewComponent:{newName:"ScrollView",since:"1.2.0",removed:!1},ScrollBarComponent:{newName:"ScrollBar",since:"1.2.0",removed:!1},SliderComponent:{newName:"Slider",since:"1.2.0",removed:!1},ToggleComponent:{newName:"Toggle",since:"1.2.0",removed:!1},ToggleContainerComponent:{newName:"ToggleContainer",since:"1.2.0",removed:!1},WidgetComponent:{newName:"Widget",since:"1.2.0",removed:!1},PageViewComponent:{newName:"PageView",since:"1.2.0",removed:!1},PageViewIndicatorComponent:{newName:"PageViewIndicator",since:"1.2.0",removed:!1},SafeAreaComponent:{newName:"SafeArea",since:"1.2.0",removed:!1},UICoordinateTrackerComponent:{newName:"UICoordinateTracker",since:"1.2.0",removed:!1},BlockInputEventsComponent:{newName:"BlockInputEvents",since:"1.2.0",removed:!1}});var Gs=t("UIReorderComponent",T("cc.UIReorderComponent")(Us=function(){l(1408,"UIReorderComponent")})||Us);Z.UIReorderComponent=Gs,Z.ButtonComponent=se,f(se,"cc.ButtonComponent"),Z.EditBoxComponent=Di,f(Di,"cc.EditBoxComponent"),Z.LayoutComponent=ji,f(ji,"cc.LayoutComponent"),Z.ProgressBarComponent=sn,f(sn,"cc.ProgressBarComponent"),Z.ScrollViewComponent=ho,f(ho,"cc.ScrollViewComponent"),Z.ScrollBarComponent=gn,f(gn,"cc.ScrollBarComponent"),Z.SliderComponent=Oo,f(Oo,"cc.SliderComponent"),Z.ToggleComponent=wo,f(wo,"cc.ToggleComponent"),Z.ToggleContainerComponent=sr,f(sr,"cc.ToggleContainerComponent"),Z.WidgetComponent=Ar,f(Ar,"cc.WidgetComponent"),Z.PageViewComponent=os,f(os,"cc.PageViewComponent"),Z.PageViewIndicatorComponent=$r,f($r,"cc.PageViewIndicatorComponent"),Z.SafeAreaComponent=xs,f(xs,"cc.SafeAreaComponent"),f(ws,"cc.UICoordinateTrackerComponent"),Z.BlockInputEventsComponent=Vs,f(Vs,"cc.BlockInputEventsComponent"),V(yt.prototype,"View.prototype",[{name:"isAntiAliasEnabled",suggest:"The API of Texture2d have been largely modified, no alternative"},{name:"enableAntiAlias",suggest:"The API of Texture2d have been largely modified, no alternative"}]),U(yt.prototype,"View.prototype",[{name:"adjustViewportMeta"},{name:"enableAutoFullScreen",suggest:"use screen.requestFullScreen() instead."},{name:"isAutoFullScreenEnabled"},{name:"setCanvasSize",suggest:"setting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"getCanvasSize",suggest:"please use screen.windowSize instead."},{name:"getFrameSize",suggest:"getting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"setFrameSize",suggest:"setting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"getDevicePixelRatio",suggest:"use screen.devicePixelRatio instead."},{name:"convertToLocationInView"},{name:"enableRetina"},{name:"isRetinaEnabled"},{name:"setRealPixelResolution"}])}}}));
//# sourceMappingURL=ui.js.map
