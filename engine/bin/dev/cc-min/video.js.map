{"version":3,"file":"video.js","sources":["../../../cocos/video/assets/video-clip.ts","../../../cocos/video/video-downloader.ts","../../../cocos/video/video-player-enums.ts","../../../cocos/video/video-player-impl.ts","../../../cocos/video/video-player-impl-web.ts","../../../cocos/video/video-player-impl-manager.ts","../../../cocos/video/video-player.ts","../../../cocos/video/deprecated.ts"],"sourcesContent":["/*\r\n Copyright (c) 2017-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { ccclass, serializable } from 'cc.decorator';\r\nimport { Asset } from '../../asset/assets';\r\n\r\n/**\r\n * @en\r\n * The video clip asset.\r\n * @zh\r\n * 视频片段资源。\r\n */\r\n@ccclass('cc.VideoClip')\r\nexport class VideoClip extends Asset {\r\n    @serializable\r\n    protected _duration = 0;\r\n    protected _video: HTMLVideoElement | null = null;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    set _nativeAsset (clip: HTMLVideoElement | null) {\r\n        this._video = clip;\r\n        if (clip) {\r\n            this._duration = clip.duration;\r\n        } else {\r\n            this._duration = 0;\r\n        }\r\n    }\r\n    get _nativeAsset (): HTMLVideoElement | null {\r\n        return this._video;\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2013-2016 Chukong Technologies Inc.\r\n Copyright (c) 2017-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport downloader from '../asset/asset-manager/downloader';\r\nimport factory from '../asset/asset-manager/factory';\r\nimport { log } from '../core/platform/debug';\r\nimport { VideoClip } from './assets/video-clip';\r\nimport { ccwindow } from '../core/global-exports';\r\n\r\nconst ccdocument = ccwindow.document;\r\n\r\n// eslint-disable-next-line consistent-return\r\nexport function downloadVideo (url: string, options: Record<string, any>, onComplete: (err: Error | null, data?: any | null) => void): void {\r\n    const video = ccdocument.createElement('video');\r\n    const source = ccdocument.createElement('source');\r\n    video.appendChild(source);\r\n\r\n    const req = new XMLHttpRequest();\r\n    req.open('GET', url, true);\r\n    req.responseType = 'blob';\r\n    req.onload = function onload (): void {\r\n        if (this.status === 200 || this.status === 0) {\r\n            source.src = URL.createObjectURL(this.response);\r\n            onComplete(null, video);\r\n        } else {\r\n            onComplete(new Error(`${req.status}(no response)`));\r\n        }\r\n    };\r\n    req.onerror = function onerror (): void {\r\n        const message = `load video failure - ${url}`;\r\n        log(message);\r\n        onComplete(new Error(message));\r\n    };\r\n    req.send();\r\n}\r\n\r\nfunction createVideoClip (id: string, data: HTMLVideoElement, options: Record<string, any>, onComplete: (err: Error | null, data?: VideoClip | null) => void): void {\r\n    const out = new VideoClip();\r\n    out._nativeUrl = id;\r\n    out._nativeAsset = data;\r\n    onComplete(null, out);\r\n}\r\n\r\ndownloader.register({\r\n    // Video\r\n    '.mp4': downloadVideo,\r\n    '.avi': downloadVideo,\r\n    '.mov': downloadVideo,\r\n    '.mpg': downloadVideo,\r\n    '.mpeg': downloadVideo,\r\n    '.rm': downloadVideo,\r\n    '.rmvb': downloadVideo,\r\n});\r\n\r\nfactory.register({\r\n    // Video\r\n    '.mp4': createVideoClip,\r\n    '.avi': createVideoClip,\r\n    '.mov': createVideoClip,\r\n    '.mpg': createVideoClip,\r\n    '.mpeg': createVideoClip,\r\n    '.rm': createVideoClip,\r\n    '.rmvb': createVideoClip,\r\n});\r\n","/*\r\n Copyright (c) 2017-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\n/**\r\n * @en Enum for video resource type.\r\n * @zh 视频资源类型枚举。\r\n */\r\nimport { Enum } from '../core/value-types';\r\n\r\nexport const ResourceType = Enum({\r\n    /**\r\n     * @en\r\n     * The remote resource type.\r\n     * @zh\r\n     * 远程视频。\r\n     */\r\n    REMOTE: 0,\r\n    /**\r\n     * @en\r\n     * The local resource type.\r\n     * @zh\r\n     * 本地视频。\r\n     */\r\n    LOCAL: 1,\r\n});\r\n\r\nexport enum VideoPlayerEventType {\r\n    /**\r\n     * @en None.\r\n     * @zh 无。\r\n     */\r\n    NONE = 'none',\r\n    /**\r\n     * @en The video is playing.\r\n     * @zh 视频播放中。\r\n     */\r\n    PLAYING = 'playing',\r\n    /**\r\n     * @en Video paused.\r\n     * @zh 视频暂停中。\r\n     */\r\n    PAUSED = 'paused',\r\n    /**\r\n     * @en Video stopped.\r\n     * @zh 视频停止中。\r\n     */\r\n    STOPPED = 'stopped',\r\n    /**\r\n     * @en Video playback complete.\r\n     * @zh 视频播放完毕。\r\n     */\r\n    COMPLETED = 'completed',\r\n    /**\r\n     * @en Video metadata loading complete.\r\n     * @zh 视频元数据加载完毕。\r\n     */\r\n    META_LOADED = 'meta-loaded',\r\n    /**\r\n     * @en The video is ready to play when loaded.\r\n     * @zh 视频加载完毕可播放。\r\n     */\r\n    READY_TO_PLAY = 'ready-to-play',\r\n    /**\r\n     * @en Errors triggered while processing video\r\n     * @zh 处理视频时触发的错误。\r\n     */\r\n    ERROR = 'error',\r\n\r\n    /**\r\n     * @en Video is clicked.\r\n     * @zh 视频被点击。\r\n     */\r\n    CLICKED = 'clicked',\r\n}\r\n\r\nexport enum READY_STATE {\r\n    /**\r\n     * @en No information about whether audio/video is ready.\r\n     * @zh 没有关于音频/视频是否就绪的信息。\r\n     */\r\n    HAVE_NOTHING,\r\n    /**\r\n     * @en Metadata about audio/video ready.\r\n     * @zh 关于音频/视频就绪的元数据。\r\n     */\r\n    HAVE_METADATA,\r\n    /**\r\n     * @en Data is available for the current playback position, but not enough data to play the next frame/ms.\r\n     * @zh 当前播放位置的数据可用，但没有足够的数据来播放下一帧/毫秒。\r\n     */\r\n    HAVE_CURRENT_DATA,\r\n    /**\r\n     * @en Data for the current and at least the next frame is available.\r\n     * @zh 当前及至少下一帧的数据是可用的。\r\n     */\r\n    HAVE_FUTURE_DATA,\r\n    /**\r\n     * @en Available data is enough to start playback.\r\n     * @zh 可用数据足以开始播放。\r\n     */\r\n    HAVE_ENOUGH_DATA\r\n}\r\n","/*\r\n Copyright (c) 2017-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { legacyCC } from '../core/global-exports';\r\nimport { UITransform } from '../2d/framework';\r\nimport { VideoPlayerEventType } from './video-player-enums';\r\nimport { error } from '../core/platform';\r\nimport { director } from '../game/director';\r\nimport { Node } from '../scene-graph';\r\nimport type { Camera } from '../render-scene/scene';\r\nimport type { VideoPlayer } from './video-player';\r\nimport type { VideoClip } from './assets/video-clip';\r\n\r\nexport abstract class VideoPlayerImpl {\r\n    protected _componentEventList: Map<string, () => void> = new Map();\r\n    protected _state = VideoPlayerEventType.NONE;\r\n    protected _video: HTMLVideoElement | null = null;\r\n\r\n    protected _onInterruptedBegin: () => void;\r\n    protected _onInterruptedEnd: () => void;\r\n    protected _interrupted = false;\r\n\r\n    protected _loaded = false;\r\n    protected _loadedMeta = false;\r\n    protected _ignorePause = false;\r\n    protected _fullScreenOnAwake = false;\r\n\r\n    protected _visible = true;\r\n\r\n    protected _playing = false;\r\n    protected _cachedCurrentTime = -1;\r\n\r\n    protected _waitingFullscreen = false;\r\n    protected _waitingPlay = false;\r\n\r\n    protected _keepAspectRatio = false;\r\n\r\n    protected _component: VideoPlayer | null = null;\r\n    protected _uiTrans: UITransform | null = null;\r\n    protected _node: Node | null = null;\r\n\r\n    protected _stayOnBottom = false;\r\n    protected _dirty = false;\r\n    protected _forceUpdate = false;\r\n    protected _w = 0;\r\n    protected _h = 0;\r\n    protected _m00 = 0;\r\n    protected _m01 = 0;\r\n    protected _m04 = 0;\r\n    protected _m05 = 0;\r\n    protected _m12 = 0;\r\n    protected _m13 = 0;\r\n\r\n    constructor (component: VideoPlayer) {\r\n        this._component = component;\r\n        this._node = component.node;\r\n        this._uiTrans = component.node.getComponent(UITransform);\r\n        this._onInterruptedBegin = (): void => {\r\n            if (!this.video || this._state !== VideoPlayerEventType.PLAYING) { return; }\r\n            this.video.pause();\r\n            this._interrupted = true;\r\n        };\r\n        this._onInterruptedEnd = (): void => {\r\n            if (!this._interrupted || !this.video) { return; }\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            this.video.play();\r\n            this._interrupted = false;\r\n        };\r\n        /* handle pause & resume */\r\n        legacyCC.game.on(legacyCC.Game.EVENT_PAUSE, this._onInterruptedBegin);\r\n        legacyCC.game.on(legacyCC.Game.EVENT_RESUME, this._onInterruptedEnd);\r\n    }\r\n\r\n    //\r\n    public abstract canPlay(): void;\r\n    public abstract canFullScreen(enabled: boolean): void;\r\n\r\n    public abstract pause (): void;\r\n    public abstract resume(): void;\r\n    public abstract stop (): void;\r\n    public abstract seekTo(val: number): void;\r\n\r\n    //\r\n    public abstract createVideoPlayer(url: string): void;\r\n    public abstract removeVideoPlayer(): void;\r\n    public abstract enable(): void;\r\n    public abstract disable(noPause?: boolean): void;\r\n\r\n    // synchronizing video player data\r\n    public abstract syncClip(clip: VideoClip | null): void;\r\n    public abstract syncURL(url: string): void;\r\n    public abstract syncStayOnBottom(enabled: boolean): void;\r\n    public abstract syncKeepAspectRatio(enabled: boolean): void;\r\n    public abstract syncPlaybackRate(val: number): void;\r\n    public abstract syncVolume(val: number): void;\r\n    public abstract syncMute(enabled: boolean): void;\r\n    public abstract syncLoop(enabled: boolean): void\r\n    public abstract syncMatrix(): void;\r\n\r\n    // get video player data\r\n    public abstract getDuration(): number;\r\n    public abstract getCurrentTime(): number;\r\n    public get fullScreenOnAwake (): boolean { return this._fullScreenOnAwake; }\r\n    public get loaded (): boolean { return this._loaded; }\r\n    public get componentEventList (): Map<string, () => void> { return this._componentEventList; }\r\n    public get video (): HTMLVideoElement | null { return this._video; }\r\n    public get state (): VideoPlayerEventType { return this._state; }\r\n    public get isPlaying (): boolean { return this._playing; }\r\n    get UICamera (): Camera | null {\r\n        return director.root!.batcher2D.getFirstRenderCamera(this._node!);\r\n    }\r\n\r\n    // video player event\r\n    public onLoadedMetadata (e: Event): void {\r\n        this._loadedMeta = true;\r\n        this._forceUpdate = true;\r\n        if (this._visible) {\r\n            this.enable();\r\n        } else {\r\n            this.disable();\r\n        }\r\n        this.dispatchEvent(VideoPlayerEventType.META_LOADED);\r\n        const video = e.target as HTMLVideoElement;\r\n        if (this._keepAspectRatio && video) {\r\n            this.syncUITransform(video.videoWidth, video.videoHeight);\r\n        }\r\n        this.delayedFullScreen();\r\n        this.delayedPlay();\r\n    }\r\n\r\n    public onCanPlay (e: Event): void {\r\n        this._loaded = true;\r\n        this.dispatchEvent(VideoPlayerEventType.READY_TO_PLAY);\r\n    }\r\n\r\n    public onPlay (e: Event): void {\r\n        this._playing = true;\r\n        this.dispatchEvent(VideoPlayerEventType.PLAYING);\r\n    }\r\n\r\n    public onPlaying (e: Event): void {\r\n        this.dispatchEvent(VideoPlayerEventType.PLAYING);\r\n    }\r\n\r\n    public onPause (e: Event): void {\r\n        this._playing = false;\r\n        if (this._ignorePause) {\r\n            this._ignorePause = false;\r\n            return;\r\n        }\r\n        this.dispatchEvent(VideoPlayerEventType.PAUSED);\r\n    }\r\n\r\n    public onStoped (e: Event): void {\r\n        this._playing = false;\r\n        this._ignorePause = false;\r\n        this.dispatchEvent(VideoPlayerEventType.STOPPED);\r\n    }\r\n\r\n    public onEnded (e: Event): void {\r\n        this._playing = false;\r\n        this.dispatchEvent(VideoPlayerEventType.COMPLETED);\r\n    }\r\n\r\n    public onClick (e: Event): void {\r\n        this.dispatchEvent(VideoPlayerEventType.CLICKED);\r\n    }\r\n\r\n    public onError (e: Event): void {\r\n        this.dispatchEvent(VideoPlayerEventType.ERROR);\r\n        const video = e.target as HTMLVideoElement;\r\n        if (video && video.error) {\r\n            error(`Error ${video.error.code}; details: ${video.error.message}`);\r\n        }\r\n    }\r\n\r\n    public play (): void {\r\n        if (this._loadedMeta || this._loaded) {\r\n            this.canPlay();\r\n        } else {\r\n            this._waitingPlay = true;\r\n        }\r\n    }\r\n\r\n    public delayedPlay (): void {\r\n        if (this._waitingPlay) {\r\n            this.canPlay();\r\n            this._waitingPlay = false;\r\n        }\r\n    }\r\n\r\n    public syncFullScreenOnAwake (enabled: boolean): void {\r\n        this._fullScreenOnAwake = enabled;\r\n        if (this._loadedMeta || this._loaded) {\r\n            this.canFullScreen(enabled);\r\n        } else {\r\n            this._waitingFullscreen = true;\r\n        }\r\n    }\r\n\r\n    public delayedFullScreen (): void {\r\n        if (this._waitingFullscreen) {\r\n            this.canFullScreen(this._fullScreenOnAwake);\r\n            this._waitingFullscreen = false;\r\n        }\r\n    }\r\n\r\n    protected dispatchEvent (key: string): void {\r\n        const callback = this._componentEventList.get(key);\r\n        if (callback) {\r\n            this._state = key as VideoPlayerEventType;\r\n            callback.call(this);\r\n        }\r\n    }\r\n\r\n    protected syncUITransform (width: number, height: number): void {\r\n        const uiTrans = this._uiTrans;\r\n        if (uiTrans) {\r\n            uiTrans.width = width;\r\n            uiTrans.height = height;\r\n        }\r\n    }\r\n\r\n    protected syncCurrentTime (): void {\r\n        if (!this.video) {\r\n            return;\r\n        }\r\n        if (this._cachedCurrentTime !== -1 && this.video.currentTime !== this._cachedCurrentTime) {\r\n            this.seekTo(this._cachedCurrentTime);\r\n            this._cachedCurrentTime = -1;\r\n        }\r\n    }\r\n\r\n    public destroy (): void {\r\n        this.removeVideoPlayer();\r\n        this._componentEventList.clear();\r\n        legacyCC.game.off(legacyCC.Game.EVENT_PAUSE, this._onInterruptedBegin);\r\n        legacyCC.game.off(legacyCC.Game.EVENT_RESUME, this._onInterruptedEnd);\r\n    }\r\n}\r\n\r\nlegacyCC.internal.VideoPlayerImpl = VideoPlayerImpl;\r\n","/*\r\n Copyright (c) 2017-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { screenAdapter } from 'pal/screen-adapter';\r\nimport { mat4, visibleRect } from '../core';\r\nimport { sys, screen, warn } from '../core/platform';\r\nimport { game } from '../game';\r\nimport { contains } from '../core/utils/misc';\r\nimport { VideoPlayerEventType, READY_STATE } from './video-player-enums';\r\nimport { VideoPlayerImpl } from './video-player-impl';\r\nimport { ClearFlagBit } from '../gfx';\r\nimport { BrowserType, OS } from '../../pal/system-info/enum-type';\r\nimport { ccwindow } from '../core/global-exports';\r\nimport type { VideoPlayer } from './video-player';\r\nimport type { VideoClip } from './assets/video-clip';\r\n\r\nconst ccdocument = ccwindow.document;\r\n\r\nconst MIN_ZINDEX = -(2 ** 15);\r\n\r\nconst _mat4_temp = mat4();\r\n\r\n/** @mangle */\r\nexport class VideoPlayerImplWeb extends VideoPlayerImpl {\r\n    protected _eventList: Map<string, ((e: Event) => void)> = new Map();\r\n\r\n    // use stay on bottom\r\n    protected _clearColorA = -1;\r\n    protected _clearFlag;\r\n\r\n    constructor (component: VideoPlayer) {\r\n        super(component);\r\n    }\r\n\r\n    protected addListener (type: string, handler: (e: Event) => void): void {\r\n        if (!this._video) {\r\n            return;\r\n        }\r\n        this._eventList.set(type, handler);\r\n        this._video.addEventListener(type, handler);\r\n    }\r\n    protected removeAllListeners (): void {\r\n        this._eventList.forEach((handler, type): void => {\r\n            if (!this._video) {\r\n                return;\r\n            }\r\n            this._video.removeEventListener(type, handler);\r\n        });\r\n        this._eventList.clear();\r\n    }\r\n\r\n    public canPlay (): void {\r\n        if (this.video) {\r\n            const promise = this.video.play();\r\n            // the play API can only be initiated by user gesture.\r\n            if (ccwindow.Promise && promise instanceof Promise) {\r\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n                promise.catch((error) => {\r\n                    // Auto-play was prevented\r\n                    // Show a UI element to let the user manually start playback\r\n                }).then(() => {\r\n                    // calibration time\r\n                    this.syncCurrentTime();\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    public pause (): void {\r\n        if (this.video) {\r\n            this.video.pause();\r\n            this._cachedCurrentTime = this.video.currentTime;\r\n        }\r\n    }\r\n\r\n    public resume (): void {\r\n        this.play();\r\n    }\r\n\r\n    public stop (): void {\r\n        if (this.video) {\r\n            this._ignorePause = true;\r\n            this.video.currentTime = 0;\r\n            this.video.pause();\r\n            this._cachedCurrentTime = 0;\r\n            setTimeout(() => {\r\n                this._ignorePause = false;\r\n                this.dispatchEvent(VideoPlayerEventType.STOPPED);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    public syncClip (clip: VideoClip | null): void {\r\n        this.removeVideoPlayer();\r\n        if (!clip) { return; }\r\n        this.createVideoPlayer(clip.nativeUrl);\r\n    }\r\n\r\n    public syncURL (url: string): void {\r\n        this.removeVideoPlayer();\r\n        if (!url) { return; }\r\n        this.createVideoPlayer(url);\r\n    }\r\n\r\n    public syncPlaybackRate (val: number): void {\r\n        if (sys.browserType === BrowserType.UC) {\r\n            warn('playbackRate is not supported by the uc mobile browser.');\r\n            return;\r\n        }\r\n        if (this.video) {\r\n            this.video.playbackRate = val;\r\n        }\r\n    }\r\n\r\n    public syncVolume (val: number): void {\r\n        if (this.video) {\r\n            this.video.volume = val;\r\n        }\r\n    }\r\n\r\n    public syncMute (enabled: boolean): void {\r\n        if (this.video) {\r\n            this.video.muted = enabled;\r\n        }\r\n    }\r\n\r\n    public syncLoop (enabled: boolean): void {\r\n        if (this.video) {\r\n            this.video.loop = enabled;\r\n        }\r\n    }\r\n\r\n    public getDuration (): number {\r\n        if (!this.video) {\r\n            return 0;\r\n        }\r\n        return this.video.duration;\r\n    }\r\n\r\n    public getCurrentTime (): number {\r\n        if (this.video) {\r\n            return this.video.currentTime;\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    public seekTo (val: number): void {\r\n        if (this.video) {\r\n            this.video.currentTime = val;\r\n            this._cachedCurrentTime = this.video.currentTime;\r\n        }\r\n    }\r\n\r\n    canFullScreen (enabled: boolean): void {\r\n        // NOTE: below we visited some non-standard web interfaces to complement browser compatibility\r\n        const video = this._video as HTMLVideoElement & {\r\n            webkitEnterFullscreen?: () => void;\r\n            webkitExitFullscreen?: () => void;\r\n            webkitDisplayingFullscreen: boolean;\r\n        };\r\n        if (!video || video.readyState !== READY_STATE.HAVE_ENOUGH_DATA) {\r\n            return;\r\n        }\r\n\r\n        if (sys.os === OS.IOS && sys.isBrowser) {\r\n            if (enabled) {\r\n                if (video.webkitEnterFullscreen) {\r\n                    video.webkitEnterFullscreen();\r\n                }\r\n            } else if (video.webkitExitFullscreen) {\r\n                video.webkitExitFullscreen();\r\n            }\r\n            this._fullScreenOnAwake = video.webkitDisplayingFullscreen;\r\n            return;\r\n        }\r\n\r\n        // If video does not support native full-screen playback,\r\n        // change to setting the video size to full screen.\r\n        if (!screen.supportsFullScreen) {\r\n            this._fullScreenOnAwake = enabled;\r\n            this._forceUpdate = true;\r\n            this.syncMatrix();\r\n            return;\r\n        }\r\n\r\n        if (enabled) {\r\n            // fix IE full screen content is not centered\r\n            if (sys.browserType === BrowserType.IE) {\r\n                video.style.transform = '';\r\n            }\r\n            // Monitor video entry and exit full-screen events\r\n            video.setAttribute('x5-video-player-fullscreen', 'true');\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            screen.requestFullScreen(video, (document) => {\r\n                const fullscreenElement = sys.browserType === BrowserType.IE ? document.msFullscreenElement : document.fullscreenElement;\r\n                this._fullScreenOnAwake = (fullscreenElement === video);\r\n            }, () => {\r\n                this._fullScreenOnAwake = false;\r\n            });\r\n        } else {\r\n            video.removeAttribute('x5-video-player-fullscreen');\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            screen.exitFullScreen();\r\n        }\r\n    }\r\n\r\n    public syncStayOnBottom (enabled: boolean): void {\r\n        if (this._video) {\r\n            this._video.style['z-index'] = enabled ? MIN_ZINDEX : 0;\r\n            this._stayOnBottom = enabled;\r\n        }\r\n        this._dirty = true;\r\n    }\r\n\r\n    public syncKeepAspectRatio (enabled: boolean): void {\r\n        this._keepAspectRatio = enabled;\r\n        if (enabled && this._loadedMeta && this._video) {\r\n            this.syncUITransform(this._video.videoWidth, this._video.videoHeight);\r\n        }\r\n    }\r\n\r\n    public removeVideoPlayer (): void {\r\n        const video = this._video;\r\n        if (video) {\r\n            if (contains(game.container, video)) {\r\n                game.container!.removeChild(video);\r\n                this.removeAllListeners();\r\n            }\r\n        }\r\n        this._cachedCurrentTime = 0;\r\n        this._playing = false;\r\n        this._loaded = false;\r\n        this._loadedMeta = false;\r\n        this._video = null;\r\n    }\r\n\r\n    public createVideoPlayer (url: string): void {\r\n        const video = this._video = ccdocument.createElement('video');\r\n        video.className = 'cocosVideo';\r\n        video.style.visibility = 'hidden';\r\n        video.style.position = 'absolute';\r\n        video.style.bottom = '0px';\r\n        video.style.left = '0px';\r\n        // video.style['object-fit'] = 'none';\r\n        video.style['transform-origin'] = '0px 100% 0px';\r\n        video.style['-webkit-transform-origin'] = '0px 100% 0px';\r\n        video.setAttribute('preload', 'auto');\r\n        video.setAttribute('webkit-playsinline', '');\r\n        // This x5-playsinline tag must be added, otherwise the play, pause events will only fire once, in the qq browser.\r\n        video.setAttribute('x5-playsinline', '');\r\n        video.setAttribute('playsinline', '');\r\n        this._bindDomEvent();\r\n        game.container!.appendChild(video);\r\n        const source = ccdocument.createElement('source');\r\n        video.appendChild(source);\r\n        source.src = url;\r\n    }\r\n\r\n    protected _bindDomEvent (): void {\r\n        const video = this._video;\r\n        this.addListener('loadedmetadata', this.onLoadedMetadata.bind(this));\r\n        this.addListener('canplay', this.onCanPlay.bind(this));\r\n        this.addListener('canplaythrough', this.onCanPlay.bind(this));\r\n        this.addListener('play', this.onPlay.bind(this));\r\n        this.addListener('playing', this.onPlaying.bind(this));\r\n        this.addListener('pause', this.onPause.bind(this));\r\n        this.addListener('click', this.onClick.bind(this));\r\n        this.addListener('ended', this.onEnded.bind(this));\r\n        this.addListener('error', this.onError.bind(this));\r\n    }\r\n\r\n    public onCanPlay (e: Event): void {\r\n        const video = e.target as HTMLVideoElement;\r\n        if (this._loaded && video) {\r\n            return;\r\n        }\r\n        // eslint-disable-next-line default-case\r\n        switch (video.readyState) {\r\n        case READY_STATE.HAVE_METADATA:\r\n        case READY_STATE.HAVE_ENOUGH_DATA: {\r\n            super.onCanPlay(e);\r\n            break;\r\n        }\r\n        }\r\n    }\r\n\r\n    public enable (): void {\r\n        if (this._video) {\r\n            this._visible = true;\r\n            if (this._video.style.visibility === 'visible') {\r\n                return;\r\n            }\r\n            this._video.style.visibility = 'visible';\r\n        }\r\n    }\r\n\r\n    public disable (noPause?: boolean): void {\r\n        if (this._video) {\r\n            if (!noPause && this._playing) {\r\n                this._video.pause();\r\n            }\r\n            this._visible = false;\r\n            if (this._video.style.visibility === 'hidden') {\r\n                return;\r\n            }\r\n            this._video.style.visibility = 'hidden';\r\n        }\r\n    }\r\n\r\n    public syncMatrix (): void {\r\n        if (!this._video || !this._visible || !this._component) return;\r\n\r\n        const camera = this.UICamera;\r\n        if (!camera) {\r\n            return;\r\n        }\r\n\r\n        // use stayOnBottom\r\n        if (this._dirty) {\r\n            this._dirty = false;\r\n            if (this._stayOnBottom) {\r\n                this._clearColorA = camera.clearColor.w;\r\n                this._clearFlag = camera.clearFlag;\r\n                camera.clearColor.w = 0;\r\n                camera.clearFlag = ClearFlagBit.ALL;\r\n            } else if (this._clearFlag) {\r\n                camera.clearColor.w = this._clearColorA;\r\n                camera.clearFlag = this._clearFlag;\r\n                this._clearColorA = -1;\r\n                this._clearFlag = null;\r\n            }\r\n        }\r\n\r\n        this._component.node.getWorldMatrix(_mat4_temp);\r\n        camera.update(true);\r\n        camera.worldMatrixToScreen(_mat4_temp, _mat4_temp, game.canvas!.width, game.canvas!.height);\r\n\r\n        let width = 0; let height = 0;\r\n        if (this._fullScreenOnAwake) {\r\n            width = visibleRect.width;\r\n            height = visibleRect.height;\r\n        } else {\r\n            width = this._uiTrans!.contentSize.width;\r\n            height = this._uiTrans!.contentSize.height;\r\n        }\r\n\r\n        if (!this._forceUpdate\r\n            && this._m00 === _mat4_temp.m00 && this._m01 === _mat4_temp.m01\r\n            && this._m04 === _mat4_temp.m04 && this._m05 === _mat4_temp.m05\r\n            && this._m12 === _mat4_temp.m12 && this._m13 === _mat4_temp.m13\r\n            && this._w === width && this._h === height) {\r\n            return;\r\n        }\r\n\r\n        // update matrix cache\r\n        this._m00 = _mat4_temp.m00;\r\n        this._m01 = _mat4_temp.m01;\r\n        this._m04 = _mat4_temp.m04;\r\n        this._m05 = _mat4_temp.m05;\r\n        this._m12 = _mat4_temp.m12;\r\n        this._m13 = _mat4_temp.m13;\r\n        this._w = width;\r\n        this._h = height;\r\n\r\n        // TODO: implement videoPlayer in PAL\r\n        const dpr = screenAdapter.devicePixelRatio;\r\n        const scaleX = 1 / dpr;\r\n        const scaleY = 1 / dpr;\r\n\r\n        const container = game.container;\r\n        const sx = _mat4_temp.m00 * scaleX; const b = _mat4_temp.m01; const c = _mat4_temp.m04; const sy = _mat4_temp.m05 * scaleY;\r\n\r\n        this._video.style.width = `${this._w}px`;\r\n        this._video.style.height = `${this._h}px`;\r\n\r\n        if (sys.browserType !== BrowserType.MOBILE_QQ) {\r\n            this._video.style.objectFit = this._keepAspectRatio ? 'none' : 'fill';\r\n        } else {\r\n            warn('keepAspectRatio is not supported by the qq mobile browser.');\r\n        }\r\n\r\n        const w = this._w * scaleX;\r\n        const h = this._h * scaleY;\r\n\r\n        const { x, y } = this._uiTrans!.anchorPoint;\r\n        const appx = (w * _mat4_temp.m00) * x;\r\n        const appy = (h * _mat4_temp.m05) * y;\r\n\r\n        const offsetX = container && container.style.paddingLeft ? parseInt(container.style.paddingLeft) : 0;\r\n        const offsetY = container && container.style.paddingBottom ? parseInt(container.style.paddingBottom) : 0;\r\n        const tx = _mat4_temp.m12 * scaleX - appx + offsetX; const ty = _mat4_temp.m13 * scaleY - appy + offsetY;\r\n\r\n        const matrix = `matrix(${sx},${-b},${-c},${sy},${tx},${-ty})`;\r\n        this._video.style.transform = matrix;\r\n        this._video.style['-webkit-transform'] = matrix;\r\n        // video style would change when enter fullscreen on IE\r\n        // there is no way to add fullscreenchange event listeners on IE so that we can restore the cached video style\r\n        if (sys.browserType !== BrowserType.IE) {\r\n            this._forceUpdate = false;\r\n        }\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2017-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { legacyCC } from '../core/global-exports';\r\nimport { VideoPlayer } from './video-player';\r\nimport { VideoPlayerImplWeb } from './video-player-impl-web';\r\n\r\nexport class VideoPlayerImplManager {\r\n    // default web\r\n    static getImpl (component: VideoPlayer): VideoPlayerImplWeb {\r\n        return new VideoPlayerImplWeb(component);\r\n    }\r\n}\r\n\r\nlegacyCC.internal.VideoPlayerImplManager = VideoPlayerImplManager;\r\n","/*\r\n Copyright (c) 2017-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n http://www.cocos.com\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { ccclass, displayOrder, executeInEditMode, help, menu, slide, range, requireComponent, tooltip, type, serializable } from 'cc.decorator';\r\nimport { EDITOR_NOT_IN_PREVIEW } from 'internal:constants';\r\nimport { warn } from '../core/platform';\r\nimport { Component, EventHandler as ComponentEventHandler } from '../scene-graph';\r\nimport { UITransform } from '../2d/framework';\r\nimport { clamp } from '../core/math';\r\nimport { VideoClip } from './assets/video-clip';\r\nimport { VideoPlayerImplManager } from './video-player-impl-manager';\r\nimport { VideoPlayerEventType, ResourceType } from './video-player-enums';\r\nimport { legacyCC } from '../core/global-exports';\r\nimport { VideoPlayerImplWeb } from './video-player-impl-web';\r\n\r\n/**\r\n * @en\r\n * VideoPlayer is a component for playing videos, you can use it for showing videos in your game.\r\n * Because different platforms have different authorization, API and control methods for VideoPlayer component.\r\n * And have not yet formed a unified standard, only Web, iOS, and Android platforms are currently supported.\r\n * @zh\r\n * Video 组件，用于在游戏中播放视频。\r\n * 由于不同平台对于 VideoPlayer 组件的授权、API、控制方式都不同，还没有形成统一的标准，所以目前只支持 Web、iOS 和 Android 平台。\r\n */\r\n@ccclass('cc.VideoPlayer')\r\n@help('i18n:cc.VideoPlayer')\r\n@menu('Video/VideoPlayer')\r\n@requireComponent(UITransform)\r\n@executeInEditMode\r\nexport class VideoPlayer extends Component {\r\n    @serializable\r\n    protected _resourceType = ResourceType.LOCAL;\r\n    @serializable\r\n    protected _remoteURL = '';\r\n    @type(VideoClip)\r\n    @serializable\r\n    protected _clip: VideoClip | null = null;\r\n    @serializable\r\n    protected _playOnAwake = true;\r\n    @serializable\r\n    protected _volume = 1.0;\r\n    @serializable\r\n    protected _mute = false;\r\n    @serializable\r\n    protected _playbackRate = 1;\r\n    @serializable\r\n    protected _loop = false;\r\n    @serializable\r\n    protected _fullScreenOnAwake = false;\r\n    @serializable\r\n    protected _stayOnBottom = false;\r\n    @serializable\r\n    protected _keepAspectRatio = true;\r\n\r\n    protected _impl: VideoPlayerImplWeb | null = null;\r\n    protected _cachedCurrentTime = 0;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * The resource type of video player, REMOTE for remote url and LOCAL for local file path.\r\n     * @zh\r\n     * 视频来源：REMOTE 表示远程视频 URL，LOCAL 表示本地视频地址。\r\n     */\r\n    @type(ResourceType)\r\n    @tooltip('i18n:videoplayer.resourceType')\r\n    get resourceType (): number {\r\n        return this._resourceType;\r\n    }\r\n    set resourceType (val) {\r\n        if (this._resourceType !== val) {\r\n            this._resourceType = val;\r\n            this.syncSource();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * The remote URL of video.\r\n     * @zh\r\n     * 远程视频的 URL。\r\n     */\r\n    @tooltip('i18n:videoplayer.remoteURL')\r\n    get remoteURL (): string {\r\n        return this._remoteURL;\r\n    }\r\n    set remoteURL (val: string) {\r\n        if (this._remoteURL !== val) {\r\n            this._remoteURL = val;\r\n            this.syncSource();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * The local video clip.\r\n     * @zh\r\n     * 本地视频剪辑。\r\n     */\r\n    @type(VideoClip)\r\n    @tooltip('i18n:videoplayer.clip')\r\n    get clip (): VideoClip | null {\r\n        return this._clip;\r\n    }\r\n    set clip (val) {\r\n        if (this._clip !== val) {\r\n            this._clip = val;\r\n            this.syncSource();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Whether the video start playing automatically after loaded.\r\n     * @zh\r\n     * 视频加载后是否自动开始播放。\r\n     */\r\n    @tooltip('i18n:videoplayer.playOnAwake')\r\n    get playOnAwake (): boolean {\r\n        return this._playOnAwake;\r\n    }\r\n    set playOnAwake (value) {\r\n        this._playOnAwake = value;\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * The Video playback rate. The value range is from [0.0 ~ 10.0].\r\n     * @zh\r\n     * 视频播放时的速率, 值的区间为[0.0 ~ 10.0]。\r\n     */\r\n    @slide\r\n    @range([0.0, 10, 1.0])\r\n    @tooltip('i18n:videoplayer.playbackRate')\r\n    get playbackRate (): number {\r\n        return this._playbackRate;\r\n    }\r\n    set playbackRate (value: number) {\r\n        this._playbackRate = value;\r\n        if (this._impl) {\r\n            this._impl.syncPlaybackRate(value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * The volume of the video. The value range is from [0.0 ~ 1.0].\r\n     * @zh\r\n     * 视频的音量. 值的区间为[0.0 ~ 1.0]。\r\n     */\r\n    @slide\r\n    @range([0.0, 1.0, 0.1])\r\n    @tooltip('i18n:videoplayer.volume')\r\n    get volume (): number {\r\n        return this._volume;\r\n    }\r\n    set volume (value: number) {\r\n        this._volume = value;\r\n        if (this._impl) {\r\n            this._impl.syncVolume(value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Mutes the VideoPlayer. When the volume is set to 0, the volume is muted, and unmuted is to restore the original volume.\r\n     * @zh\r\n     * 是否静音视频。设置音量为0时是静音，取消静音是恢复原来的音量。\r\n     */\r\n    @tooltip('i18n:videoplayer.mute')\r\n    get mute (): boolean {\r\n        return this._mute;\r\n    }\r\n    set mute (value) {\r\n        this._mute = value;\r\n        if (this._impl) {\r\n            this._impl.syncMute(value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Whether the video should play again when it ends.\r\n     * @zh\r\n     * 视频是否应在结束时再次播放。\r\n     */\r\n    @tooltip('i18n:videoplayer.loop')\r\n    get loop (): boolean {\r\n        return this._loop;\r\n    }\r\n    set loop (value) {\r\n        this._loop = value;\r\n        if (this._impl) {\r\n            this._impl.syncLoop(value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Whether to keep the original aspect ratio of the video.\r\n     * @zh\r\n     * 是否保持视频原来的宽高比。\r\n     */\r\n    @tooltip('i18n:videoplayer.keepAspectRatio')\r\n    get keepAspectRatio (): boolean {\r\n        return this._keepAspectRatio;\r\n    }\r\n    set keepAspectRatio (value) {\r\n        if (this._keepAspectRatio !== value) {\r\n            this._keepAspectRatio = value;\r\n            if (this._impl) {\r\n                this._impl.syncKeepAspectRatio(value);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Whether to play the video in full screen.\r\n     * @zh\r\n     * 是否全屏播放视频。\r\n     */\r\n    @tooltip('i18n:videoplayer.fullScreenOnAwake')\r\n    get fullScreenOnAwake (): boolean {\r\n        if (!EDITOR_NOT_IN_PREVIEW) {\r\n            if (this._impl) {\r\n                this._fullScreenOnAwake = this._impl.fullScreenOnAwake;\r\n                return this._fullScreenOnAwake;\r\n            }\r\n        }\r\n        return this._fullScreenOnAwake;\r\n    }\r\n    set fullScreenOnAwake (value: boolean) {\r\n        if (this._fullScreenOnAwake !== value) {\r\n            this._fullScreenOnAwake = value;\r\n            if (this._impl) {\r\n                this._impl.syncFullScreenOnAwake(value);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Always at the bottom of the game view.\r\n     * This property relies on the translucency feature of Canvas, please enable ENABLE_TRANSPARENT_CANVAS in project preferences.\r\n     * Note: It's only available on the Web platform.\r\n     * Due to the support and limitations of each browser, the effect may not be guaranteed to be consistent.\r\n     * @zh\r\n     * 永远在游戏视图最底层。\r\n     * 该属性依赖 Canvas 的半透明特性，请在项目偏好设置里开启 ENABLE_TRANSPARENT_CANVAS。\r\n     * 注意：该属性只有在 Web 平台上有效果。由于各浏览器的支持与限制，效果可能无法保证一致。\r\n     */\r\n    @tooltip('i18n:videoplayer.stayOnBottom')\r\n    get stayOnBottom (): boolean {\r\n        return this._stayOnBottom;\r\n    }\r\n    set stayOnBottom (value: boolean) {\r\n        if (this._stayOnBottom !== value) {\r\n            this._stayOnBottom = value;\r\n            if (this._impl) {\r\n                this._impl.syncStayOnBottom(value);\r\n            }\r\n        }\r\n    }\r\n\r\n    public static EventType = VideoPlayerEventType;\r\n    public static ResourceType = ResourceType;\r\n\r\n    /**\r\n     * @en\r\n     * The video player's callback, it will be triggered in certain situations, such as playing, paused, stopped and completed.\r\n     * @zh\r\n     * 视频播放回调函数，该回调函数会在特定情况被触发，比如播放中，暂时，停止和完成播放。\r\n     */\r\n    @serializable\r\n    @type([ComponentEventHandler])\r\n    @displayOrder(100)\r\n    @tooltip('i18n:videoplayer.videoPlayerEvent')\r\n    public videoPlayerEvent: ComponentEventHandler[] = [];\r\n\r\n    /**\r\n     * @en\r\n     * Gets the original video object, generally used for user customization.\r\n     * @zh\r\n     * 获取原始视频对象，一般用于用户定制。\r\n     */\r\n    get nativeVideo (): HTMLVideoElement | null {\r\n        return (this._impl && this._impl.video) || null;\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Gets the time progress of the current video playback.\r\n     * @zh\r\n     * 获取当前视频播放的时间进度。\r\n     */\r\n    get currentTime (): number {\r\n        if (!this._impl) { return this._cachedCurrentTime; }\r\n        return this._impl.getCurrentTime();\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Sets the time point when the video starts to play, in seconds.\r\n     * @zh\r\n     * 设置视频开始播放的时间点，单位是秒。\r\n     */\r\n    set currentTime (val: number) {\r\n        if (Number.isNaN(val)) { warn(`illegal video time! value:${val}`); return; }\r\n        val = clamp(val, 0, this.duration);\r\n        this._cachedCurrentTime = val;\r\n        if (this._impl) {\r\n            this._impl.seekTo(val);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Gets the audio duration, in seconds.\r\n     * @zh\r\n     * 获取以秒为单位的视频总时长。\r\n     */\r\n    get duration (): number {\r\n        if (!this._impl) { return 0; }\r\n        return this._impl.getDuration();\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Gets current audio state.\r\n     * @zh\r\n     * 获取当前视频状态。\r\n     */\r\n    get state (): VideoPlayerEventType {\r\n        if (!this._impl) { return VideoPlayerEventType.NONE; }\r\n        return this._impl.state;\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Whether the current video is playing, The return value type is Boolean.\r\n     * @zh\r\n     * 当前视频是否正在播放，返回值为布尔类型。\r\n     */\r\n    get isPlaying (): boolean {\r\n        if (!this._impl) { return false; }\r\n        return this._impl.isPlaying;\r\n    }\r\n\r\n    protected syncSource (): void {\r\n        const impl = this._impl;\r\n        if (!impl) { return; }\r\n\r\n        if (this._resourceType === ResourceType.REMOTE) {\r\n            impl.syncURL(this._remoteURL);\r\n        } else {\r\n            impl.syncClip(this._clip);\r\n        }\r\n        this._cachedCurrentTime = 0;\r\n\r\n        impl.syncLoop(this._loop);\r\n        impl.syncVolume(this._volume);\r\n        impl.syncMute(this._mute);\r\n        impl.seekTo(this._cachedCurrentTime);\r\n        impl.syncPlaybackRate(this._playbackRate);\r\n        impl.syncStayOnBottom(this._stayOnBottom);\r\n        impl.syncKeepAspectRatio(this._keepAspectRatio);\r\n        impl.syncFullScreenOnAwake(this._fullScreenOnAwake);\r\n    }\r\n\r\n    public __preload (): void {\r\n        if (EDITOR_NOT_IN_PREVIEW) {\r\n            return;\r\n        }\r\n        this._impl = VideoPlayerImplManager.getImpl(this);\r\n        this.syncSource();\r\n\r\n        const { componentEventList } = this._impl;\r\n        componentEventList.set(VideoPlayerEventType.META_LOADED, this.onMetaLoaded.bind(this));\r\n        componentEventList.set(VideoPlayerEventType.READY_TO_PLAY, this.onReadyToPlay.bind(this));\r\n        componentEventList.set(VideoPlayerEventType.PLAYING, this.onPlaying.bind(this));\r\n        componentEventList.set(VideoPlayerEventType.PAUSED, this.onPaused.bind(this));\r\n        componentEventList.set(VideoPlayerEventType.STOPPED, this.onStopped.bind(this));\r\n        componentEventList.set(VideoPlayerEventType.COMPLETED, this.onCompleted.bind(this));\r\n        componentEventList.set(VideoPlayerEventType.ERROR, this.onError.bind(this));\r\n        componentEventList.set(VideoPlayerEventType.CLICKED, this.onClicked.bind(this));\r\n        if (this._playOnAwake && this._impl.loaded) {\r\n            this.play();\r\n        }\r\n    }\r\n\r\n    public onEnable (): void {\r\n        if (this._impl) {\r\n            this._impl.enable();\r\n        }\r\n    }\r\n\r\n    public onDisable (): void {\r\n        if (this._impl) {\r\n            this._impl.disable();\r\n        }\r\n    }\r\n\r\n    public onDestroy (): void {\r\n        if (this._impl) {\r\n            this._impl.destroy();\r\n            this._impl = null;\r\n        }\r\n    }\r\n\r\n    public update (dt: number): void {\r\n        if (this._impl) {\r\n            this._impl.syncMatrix();\r\n        }\r\n    }\r\n\r\n    private onMetaLoaded (): void {\r\n        ComponentEventHandler.emitEvents(this.videoPlayerEvent, this, VideoPlayerEventType.META_LOADED);\r\n        this.node.emit('meta-loaded', this);\r\n    }\r\n\r\n    private onReadyToPlay (): void {\r\n        if (this._playOnAwake && !this.isPlaying) { this.play(); }\r\n        ComponentEventHandler.emitEvents(this.videoPlayerEvent, this, VideoPlayerEventType.READY_TO_PLAY);\r\n        this.node.emit(VideoPlayerEventType.READY_TO_PLAY, this);\r\n    }\r\n\r\n    private onPlaying (): void {\r\n        ComponentEventHandler.emitEvents(this.videoPlayerEvent, this, VideoPlayerEventType.PLAYING);\r\n        this.node.emit(VideoPlayerEventType.PLAYING, this);\r\n    }\r\n\r\n    private onPaused (): void {\r\n        ComponentEventHandler.emitEvents(this.videoPlayerEvent, this, VideoPlayerEventType.PAUSED);\r\n        this.node.emit(VideoPlayerEventType.PAUSED, this);\r\n    }\r\n\r\n    private onStopped (): void {\r\n        ComponentEventHandler.emitEvents(this.videoPlayerEvent, this, VideoPlayerEventType.STOPPED);\r\n        this.node.emit(VideoPlayerEventType.STOPPED, this);\r\n    }\r\n\r\n    private onCompleted (): void {\r\n        ComponentEventHandler.emitEvents(this.videoPlayerEvent, this, VideoPlayerEventType.COMPLETED);\r\n        this.node.emit(VideoPlayerEventType.COMPLETED, this);\r\n    }\r\n\r\n    private onError (): void {\r\n        ComponentEventHandler.emitEvents(this.videoPlayerEvent, this, VideoPlayerEventType.ERROR);\r\n        this.node.emit(VideoPlayerEventType.ERROR, this);\r\n    }\r\n\r\n    private onClicked (): void {\r\n        ComponentEventHandler.emitEvents(this.videoPlayerEvent, this, VideoPlayerEventType.CLICKED);\r\n        this.node.emit(VideoPlayerEventType.CLICKED, this);\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Play the clip.<br>\r\n     * Restart if already playing.<br>\r\n     * Resume if paused.\r\n     * @zh\r\n     * 开始播放。<br>\r\n     * 如果视频处于正在播放状态，将会重新开始播放视频。<br>\r\n     * 如果视频处于暂停状态，则会继续播放视频。\r\n     */\r\n    public play (): void {\r\n        if (this._impl) {\r\n            this._impl.play();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Resume the clip.\r\n     * If a video is paused, call this method to resume playing.\r\n     * @zh\r\n     * 继续播放。如果一个视频播放被暂停播放了，调用这个接口可以继续播放。\r\n     */\r\n    public resume (): void {\r\n        if (this._impl) {\r\n            this._impl.resume();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Pause the clip.\r\n     * @zh\r\n     * 暂停播放。\r\n     */\r\n    public pause (): void {\r\n        if (this._impl) {\r\n            this._impl.pause();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Stop the clip.\r\n     * @zh\r\n     * 停止播放。\r\n     */\r\n    public stop (): void {\r\n        if (this._impl) {\r\n            this._impl.stop();\r\n        }\r\n    }\r\n}\r\n\r\n// TODO Since jsb adapter does not support import cc, put it on internal first and adjust it later.\r\nlegacyCC.internal.VideoPlayer = VideoPlayer;\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { replaceProperty } from '../core/utils/x-deprecated';\r\nimport { VideoPlayer } from './video-player';\r\n\r\nreplaceProperty(VideoPlayer.prototype, 'VideoPlayer.prototype', [\r\n    {\r\n        name: 'onPasued',\r\n        newName: 'onPaused',\r\n    },\r\n]);\r\n"],"names":["VideoClip","exports","ccclass","_dec","_class2","_Asset","_this","call","this","_duration","_initializer","_video","_inheritsLoose","_createClass","key","get","set","clip","duration","Asset","serializable","_class","ccdocument","ccwindow","document","downloadVideo","url","options","onComplete","video","createElement","source","appendChild","req","XMLHttpRequest","open","responseType","onload","status","src","URL","createObjectURL","response","Error","onerror","message","log","send","createVideoClip","id","data","out","_nativeUrl","_nativeAsset","downloader","register","factory","VideoPlayerEventType","READY_STATE","ResourceType","Enum","REMOTE","LOCAL","VideoPlayerImpl","component","_componentEventList","Map","_state","NONE","_onInterruptedBegin","_onInterruptedEnd","_interrupted","_loaded","_loadedMeta","_ignorePause","_fullScreenOnAwake","_visible","_playing","_cachedCurrentTime","_waitingFullscreen","_waitingPlay","_keepAspectRatio","_component","_uiTrans","_node","_stayOnBottom","_dirty","_forceUpdate","_w","_h","_m00","_m01","_m04","_m05","_m12","_m13","node","getComponent","UITransform","PLAYING","pause","play","legacyCC","game","on","Game","EVENT_PAUSE","EVENT_RESUME","_proto","prototype","onLoadedMetadata","e","enable","disable","dispatchEvent","META_LOADED","target","syncUITransform","videoWidth","videoHeight","delayedFullScreen","delayedPlay","onCanPlay","READY_TO_PLAY","onPlay","onPlaying","onPause","PAUSED","onStoped","STOPPED","onEnded","COMPLETED","onClick","CLICKED","onError","ERROR","error","code","canPlay","syncFullScreenOnAwake","enabled","canFullScreen","callback","width","height","uiTrans","syncCurrentTime","currentTime","seekTo","destroy","removeVideoPlayer","clear","off","director","root","batcher2D","getFirstRenderCamera","internal","MIN_ZINDEX","Math","pow","_mat4_temp","mat4","VideoPlayerImplWeb","_VideoPlayerImpl","_eventList","_clearColorA","_clearFlag","addListener","type","handler","addEventListener","removeAllListeners","_this2","forEach","removeEventListener","_this3","promise","Promise","then","resume","stop","_this4","setTimeout","syncClip","createVideoPlayer","nativeUrl","syncURL","syncPlaybackRate","val","sys","browserType","BrowserType","UC","playbackRate","warn","syncVolume","volume","syncMute","muted","syncLoop","loop","getDuration","getCurrentTime","_this5","readyState","HAVE_ENOUGH_DATA","os","OS","IOS","isBrowser","webkitEnterFullscreen","webkitExitFullscreen","webkitDisplayingFullscreen","screen","supportsFullScreen","IE","style","transform","setAttribute","requestFullScreen","fullscreenElement","msFullscreenElement","removeAttribute","exitFullScreen","syncMatrix","syncStayOnBottom","syncKeepAspectRatio","contains","container","removeChild","className","visibility","position","bottom","left","_bindDomEvent","bind","HAVE_METADATA","noPause","camera","UICamera","clearColor","w","clearFlag","ClearFlagBit","ALL","getWorldMatrix","update","worldMatrixToScreen","canvas","visibleRect","contentSize","m00","m01","m04","m05","m12","m13","dpr","screenAdapter","devicePixelRatio","scaleX","scaleY","sx","b","c","sy","MOBILE_QQ","objectFit","h","_anchorPoint","anchorPoint","x","y","appx","appy","offsetX","paddingLeft","parseInt","offsetY","paddingBottom","matrix","tx","VideoPlayerImplManager","getImpl","VideoPlayer","_dec2","requireComponent","_dec5","_dec6","ComponentEventHandler","_class3","_Component","_resourceType","_remoteURL","_initializer2","_clip","_initializer3","_playOnAwake","_initializer4","_volume","_initializer5","_mute","_initializer6","_playbackRate","_initializer7","_loop","_initializer8","_initializer9","_initializer10","_initializer11","_impl","videoPlayerEvent","_initializer12","syncSource","impl","__preload","componentEventList","onMetaLoaded","onReadyToPlay","onPaused","onStopped","onCompleted","onClicked","loaded","onEnable","onDisable","onDestroy","emitEvents","emit","isPlaying","value","fullScreenOnAwake","Number","isNaN","clamp","state","Component","EventType","_applyDecoratedInitializer","_dec3","_applyDecoratedDescriptor","_dec4","Object","getOwnPropertyDescriptor","replaceProperty","name","newName"],"mappings":"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"}